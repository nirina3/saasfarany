function z1(t,e){for(var s=0;s<e.length;s++){const r=e[s];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();function ov(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lv={exports:{}},zd={},cv={exports:{}},Le={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dl=Symbol.for("react.element"),B1=Symbol.for("react.portal"),q1=Symbol.for("react.fragment"),G1=Symbol.for("react.strict_mode"),W1=Symbol.for("react.profiler"),H1=Symbol.for("react.provider"),K1=Symbol.for("react.context"),Q1=Symbol.for("react.forward_ref"),Y1=Symbol.for("react.suspense"),X1=Symbol.for("react.memo"),J1=Symbol.for("react.lazy"),nx=Symbol.iterator;function Z1(t){return t===null||typeof t!="object"?null:(t=nx&&t[nx]||t["@@iterator"],typeof t=="function"?t:null)}var dv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uv=Object.assign,hv={};function Ea(t,e,s){this.props=t,this.context=e,this.refs=hv,this.updater=s||dv}Ea.prototype.isReactComponent={};Ea.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ea.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function mv(){}mv.prototype=Ea.prototype;function ap(t,e,s){this.props=t,this.context=e,this.refs=hv,this.updater=s||dv}var op=ap.prototype=new mv;op.constructor=ap;uv(op,Ea.prototype);op.isPureReactComponent=!0;var rx=Array.isArray,pv=Object.prototype.hasOwnProperty,lp={current:null},fv={key:!0,ref:!0,__self:!0,__source:!0};function gv(t,e,s){var r,i={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)pv.call(e,r)&&!fv.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=s;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];i.children=d}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:dl,type:t,key:a,ref:o,props:i,_owner:lp.current}}function e_(t,e){return{$$typeof:dl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function cp(t){return typeof t=="object"&&t!==null&&t.$$typeof===dl}function t_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var ix=/\/+/g;function Yu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?t_(""+t.key):e.toString(36)}function wc(t,e,s,r,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case dl:case B1:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Yu(o,0):r,rx(i)?(s="",t!=null&&(s=t.replace(ix,"$&/")+"/"),wc(i,e,s,"",function(u){return u})):i!=null&&(cp(i)&&(i=e_(i,s+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(ix,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",rx(t))for(var l=0;l<t.length;l++){a=t[l];var d=r+Yu(a,l);o+=wc(a,e,s,d,i)}else if(d=Z1(t),typeof d=="function")for(t=d.call(t),l=0;!(a=t.next()).done;)a=a.value,d=r+Yu(a,l++),o+=wc(a,e,s,d,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Xl(t,e,s){if(t==null)return t;var r=[],i=0;return wc(t,r,"","",function(a){return e.call(s,a,i++)}),r}function s_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ds={current:null},jc={transition:null},n_={ReactCurrentDispatcher:ds,ReactCurrentBatchConfig:jc,ReactCurrentOwner:lp};function xv(){throw Error("act(...) is not supported in production builds of React.")}Le.Children={map:Xl,forEach:function(t,e,s){Xl(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return Xl(t,function(){e++}),e},toArray:function(t){return Xl(t,function(e){return e})||[]},only:function(t){if(!cp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Le.Component=Ea;Le.Fragment=q1;Le.Profiler=W1;Le.PureComponent=ap;Le.StrictMode=G1;Le.Suspense=Y1;Le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=n_;Le.act=xv;Le.cloneElement=function(t,e,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=uv({},t.props),i=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=lp.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(d in e)pv.call(e,d)&&!fv.hasOwnProperty(d)&&(r[d]=e[d]===void 0&&l!==void 0?l[d]:e[d])}var d=arguments.length-2;if(d===1)r.children=s;else if(1<d){l=Array(d);for(var u=0;u<d;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:dl,type:t.type,key:i,ref:a,props:r,_owner:o}};Le.createContext=function(t){return t={$$typeof:K1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:H1,_context:t},t.Consumer=t};Le.createElement=gv;Le.createFactory=function(t){var e=gv.bind(null,t);return e.type=t,e};Le.createRef=function(){return{current:null}};Le.forwardRef=function(t){return{$$typeof:Q1,render:t}};Le.isValidElement=cp;Le.lazy=function(t){return{$$typeof:J1,_payload:{_status:-1,_result:t},_init:s_}};Le.memo=function(t,e){return{$$typeof:X1,type:t,compare:e===void 0?null:e}};Le.startTransition=function(t){var e=jc.transition;jc.transition={};try{t()}finally{jc.transition=e}};Le.unstable_act=xv;Le.useCallback=function(t,e){return ds.current.useCallback(t,e)};Le.useContext=function(t){return ds.current.useContext(t)};Le.useDebugValue=function(){};Le.useDeferredValue=function(t){return ds.current.useDeferredValue(t)};Le.useEffect=function(t,e){return ds.current.useEffect(t,e)};Le.useId=function(){return ds.current.useId()};Le.useImperativeHandle=function(t,e,s){return ds.current.useImperativeHandle(t,e,s)};Le.useInsertionEffect=function(t,e){return ds.current.useInsertionEffect(t,e)};Le.useLayoutEffect=function(t,e){return ds.current.useLayoutEffect(t,e)};Le.useMemo=function(t,e){return ds.current.useMemo(t,e)};Le.useReducer=function(t,e,s){return ds.current.useReducer(t,e,s)};Le.useRef=function(t){return ds.current.useRef(t)};Le.useState=function(t){return ds.current.useState(t)};Le.useSyncExternalStore=function(t,e,s){return ds.current.useSyncExternalStore(t,e,s)};Le.useTransition=function(){return ds.current.useTransition()};Le.version="18.3.1";cv.exports=Le;var I=cv.exports;const To=ov(I),r_=z1({__proto__:null,default:To},[I]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i_=I,a_=Symbol.for("react.element"),o_=Symbol.for("react.fragment"),l_=Object.prototype.hasOwnProperty,c_=i_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d_={key:!0,ref:!0,__self:!0,__source:!0};function yv(t,e,s){var r,i={},a=null,o=null;s!==void 0&&(a=""+s),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)l_.call(e,r)&&!d_.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:a_,type:t,key:a,ref:o,props:i,_owner:c_.current}}zd.Fragment=o_;zd.jsx=yv;zd.jsxs=yv;lv.exports=zd;var n=lv.exports,vv={exports:{}},Ds={},bv={exports:{}},wv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,oe){var X=W.length;W.push(oe);e:for(;0<X;){var re=X-1>>>1,Z=W[re];if(0<i(Z,oe))W[re]=oe,W[X]=Z,X=re;else break e}}function s(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var oe=W[0],X=W.pop();if(X!==oe){W[0]=X;e:for(var re=0,Z=W.length,$=Z>>>1;re<$;){var q=2*(re+1)-1,ue=W[q],se=q+1,ve=W[se];if(0>i(ue,X))se<Z&&0>i(ve,ue)?(W[re]=ve,W[se]=X,re=se):(W[re]=ue,W[q]=X,re=q);else if(se<Z&&0>i(ve,X))W[re]=ve,W[se]=X,re=se;else break e}}return oe}function i(W,oe){var X=W.sortIndex-oe.sortIndex;return X!==0?X:W.id-oe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var d=[],u=[],h=1,m=null,g=3,x=!1,y=!1,R=!1,_=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(W){for(var oe=s(u);oe!==null;){if(oe.callback===null)r(u);else if(oe.startTime<=W)r(u),oe.sortIndex=oe.expirationTime,e(d,oe);else break;oe=s(u)}}function k(W){if(R=!1,C(W),!y)if(s(d)!==null)y=!0,z(D);else{var oe=s(u);oe!==null&&J(k,oe.startTime-W)}}function D(W,oe){y=!1,R&&(R=!1,T(b),b=-1),x=!0;var X=g;try{for(C(oe),m=s(d);m!==null&&(!(m.expirationTime>oe)||W&&!j());){var re=m.callback;if(typeof re=="function"){m.callback=null,g=m.priorityLevel;var Z=re(m.expirationTime<=oe);oe=t.unstable_now(),typeof Z=="function"?m.callback=Z:m===s(d)&&r(d),C(oe)}else r(d);m=s(d)}if(m!==null)var $=!0;else{var q=s(u);q!==null&&J(k,q.startTime-oe),$=!1}return $}finally{m=null,g=X,x=!1}}var P=!1,v=null,b=-1,N=5,f=-1;function j(){return!(t.unstable_now()-f<N)}function E(){if(v!==null){var W=t.unstable_now();f=W;var oe=!0;try{oe=v(!0,W)}finally{oe?S():(P=!1,v=null)}}else P=!1}var S;if(typeof A=="function")S=function(){A(E)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,U=ee.port2;ee.port1.onmessage=E,S=function(){U.postMessage(null)}}else S=function(){_(E,0)};function z(W){v=W,P||(P=!0,S())}function J(W,oe){b=_(function(){W(t.unstable_now())},oe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){y||x||(y=!0,z(D))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return s(d)},t.unstable_next=function(W){switch(g){case 1:case 2:case 3:var oe=3;break;default:oe=g}var X=g;g=oe;try{return W()}finally{g=X}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,oe){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var X=g;g=W;try{return oe()}finally{g=X}},t.unstable_scheduleCallback=function(W,oe,X){var re=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?re+X:re):X=re,W){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=X+Z,W={id:h++,callback:oe,priorityLevel:W,startTime:X,expirationTime:Z,sortIndex:-1},X>re?(W.sortIndex=X,e(u,W),s(d)===null&&W===s(u)&&(R?(T(b),b=-1):R=!0,J(k,X-re))):(W.sortIndex=Z,e(d,W),y||x||(y=!0,z(D))),W},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(W){var oe=g;return function(){var X=g;g=oe;try{return W.apply(this,arguments)}finally{g=X}}}})(wv);bv.exports=wv;var u_=bv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h_=I,Ts=u_;function ie(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jv=new Set,Ro={};function bi(t,e){oa(t,e),oa(t+"Capture",e)}function oa(t,e){for(Ro[t]=e,t=0;t<e.length;t++)jv.add(e[t])}var On=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vh=Object.prototype.hasOwnProperty,m_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ax={},ox={};function p_(t){return Vh.call(ox,t)?!0:Vh.call(ax,t)?!1:m_.test(t)?ox[t]=!0:(ax[t]=!0,!1)}function f_(t,e,s,r){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function g_(t,e,s,r){if(e===null||typeof e>"u"||f_(t,e,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function us(t,e,s,r,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=s,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Bt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Bt[t]=new us(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Bt[e]=new us(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Bt[t]=new us(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Bt[t]=new us(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Bt[t]=new us(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Bt[t]=new us(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Bt[t]=new us(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Bt[t]=new us(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Bt[t]=new us(t,5,!1,t.toLowerCase(),null,!1,!1)});var dp=/[\-:]([a-z])/g;function up(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(dp,up);Bt[e]=new us(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(dp,up);Bt[e]=new us(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(dp,up);Bt[e]=new us(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Bt[t]=new us(t,1,!1,t.toLowerCase(),null,!1,!1)});Bt.xlinkHref=new us("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Bt[t]=new us(t,1,!1,t.toLowerCase(),null,!0,!0)});function hp(t,e,s,r){var i=Bt.hasOwnProperty(e)?Bt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(g_(e,s,i,r)&&(s=null),r||i===null?p_(e)&&(s===null?t.removeAttribute(e):t.setAttribute(e,""+s)):i.mustUseProperty?t[i.propertyName]=s===null?i.type===3?!1:"":s:(e=i.attributeName,r=i.attributeNamespace,s===null?t.removeAttribute(e):(i=i.type,s=i===3||i===4&&s===!0?"":""+s,r?t.setAttributeNS(r,e,s):t.setAttribute(e,s))))}var Yn=h_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Jl=Symbol.for("react.element"),Li=Symbol.for("react.portal"),Vi=Symbol.for("react.fragment"),mp=Symbol.for("react.strict_mode"),Oh=Symbol.for("react.profiler"),Nv=Symbol.for("react.provider"),_v=Symbol.for("react.context"),pp=Symbol.for("react.forward_ref"),Fh=Symbol.for("react.suspense"),$h=Symbol.for("react.suspense_list"),fp=Symbol.for("react.memo"),rr=Symbol.for("react.lazy"),Sv=Symbol.for("react.offscreen"),lx=Symbol.iterator;function Ka(t){return t===null||typeof t!="object"?null:(t=lx&&t[lx]||t["@@iterator"],typeof t=="function"?t:null)}var pt=Object.assign,Xu;function no(t){if(Xu===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);Xu=e&&e[1]||""}return`
`+Xu+t}var Ju=!1;function Zu(t,e){if(!t||Ju)return"";Ju=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,l=a.length-1;1<=o&&0<=l&&i[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==a[l]){var d=`
`+i[o].replace(" at new "," at ");return t.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",t.displayName)),d}while(1<=o&&0<=l);break}}}finally{Ju=!1,Error.prepareStackTrace=s}return(t=t?t.displayName||t.name:"")?no(t):""}function x_(t){switch(t.tag){case 5:return no(t.type);case 16:return no("Lazy");case 13:return no("Suspense");case 19:return no("SuspenseList");case 0:case 2:case 15:return t=Zu(t.type,!1),t;case 11:return t=Zu(t.type.render,!1),t;case 1:return t=Zu(t.type,!0),t;default:return""}}function Uh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Vi:return"Fragment";case Li:return"Portal";case Oh:return"Profiler";case mp:return"StrictMode";case Fh:return"Suspense";case $h:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case _v:return(t.displayName||"Context")+".Consumer";case Nv:return(t._context.displayName||"Context")+".Provider";case pp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case fp:return e=t.displayName||null,e!==null?e:Uh(t.type)||"Memo";case rr:e=t._payload,t=t._init;try{return Uh(t(e))}catch{}}return null}function y_(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Uh(e);case 8:return e===mp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Tr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Ev(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function v_(t){var e=Ev(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var i=s.get,a=s.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Zl(t){t._valueTracker||(t._valueTracker=v_(t))}function Av(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),r="";return t&&(r=Ev(t)?t.checked?"true":"false":t.value),t=r,t!==s?(e.setValue(t),!0):!1}function Bc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function zh(t,e){var s=e.checked;return pt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??t._wrapperState.initialChecked})}function cx(t,e){var s=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;s=Tr(e.value!=null?e.value:s),t._wrapperState={initialChecked:r,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Iv(t,e){e=e.checked,e!=null&&hp(t,"checked",e,!1)}function Bh(t,e){Iv(t,e);var s=Tr(e.value),r=e.type;if(s!=null)r==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+s):t.value!==""+s&&(t.value=""+s);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?qh(t,e.type,s):e.hasOwnProperty("defaultValue")&&qh(t,e.type,Tr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function dx(t,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,s||e===t.value||(t.value=e),t.defaultValue=e}s=t.name,s!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,s!==""&&(t.name=s)}function qh(t,e,s){(e!=="number"||Bc(t.ownerDocument)!==t)&&(s==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+s&&(t.defaultValue=""+s))}var ro=Array.isArray;function Qi(t,e,s,r){if(t=t.options,e){e={};for(var i=0;i<s.length;i++)e["$"+s[i]]=!0;for(s=0;s<t.length;s++)i=e.hasOwnProperty("$"+t[s].value),t[s].selected!==i&&(t[s].selected=i),i&&r&&(t[s].defaultSelected=!0)}else{for(s=""+Tr(s),e=null,i=0;i<t.length;i++){if(t[i].value===s){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Gh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ie(91));return pt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ux(t,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(ie(92));if(ro(s)){if(1<s.length)throw Error(ie(93));s=s[0]}e=s}e==null&&(e=""),s=e}t._wrapperState={initialValue:Tr(s)}}function kv(t,e){var s=Tr(e.value),r=Tr(e.defaultValue);s!=null&&(s=""+s,s!==t.value&&(t.value=s),e.defaultValue==null&&t.defaultValue!==s&&(t.defaultValue=s)),r!=null&&(t.defaultValue=""+r)}function hx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Cv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Cv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ec,Tv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,s,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ec=ec||document.createElement("div"),ec.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ec.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Po(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var po={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},b_=["Webkit","ms","Moz","O"];Object.keys(po).forEach(function(t){b_.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),po[e]=po[t]})});function Rv(t,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||po.hasOwnProperty(t)&&po[t]?(""+e).trim():e+"px"}function Pv(t,e){t=t.style;for(var s in e)if(e.hasOwnProperty(s)){var r=s.indexOf("--")===0,i=Rv(s,e[s],r);s==="float"&&(s="cssFloat"),r?t.setProperty(s,i):t[s]=i}}var w_=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hh(t,e){if(e){if(w_[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ie(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ie(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ie(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ie(62))}}function Kh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qh=null;function gp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Yh=null,Yi=null,Xi=null;function mx(t){if(t=ml(t)){if(typeof Yh!="function")throw Error(ie(280));var e=t.stateNode;e&&(e=Hd(e),Yh(t.stateNode,t.type,e))}}function Dv(t){Yi?Xi?Xi.push(t):Xi=[t]:Yi=t}function Mv(){if(Yi){var t=Yi,e=Xi;if(Xi=Yi=null,mx(t),e)for(t=0;t<e.length;t++)mx(e[t])}}function Lv(t,e){return t(e)}function Vv(){}var eh=!1;function Ov(t,e,s){if(eh)return t(e,s);eh=!0;try{return Lv(t,e,s)}finally{eh=!1,(Yi!==null||Xi!==null)&&(Vv(),Mv())}}function Do(t,e){var s=t.stateNode;if(s===null)return null;var r=Hd(s);if(r===null)return null;s=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(ie(231,e,typeof s));return s}var Xh=!1;if(On)try{var Qa={};Object.defineProperty(Qa,"passive",{get:function(){Xh=!0}}),window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{Xh=!1}function j_(t,e,s,r,i,a,o,l,d){var u=Array.prototype.slice.call(arguments,3);try{e.apply(s,u)}catch(h){this.onError(h)}}var fo=!1,qc=null,Gc=!1,Jh=null,N_={onError:function(t){fo=!0,qc=t}};function __(t,e,s,r,i,a,o,l,d){fo=!1,qc=null,j_.apply(N_,arguments)}function S_(t,e,s,r,i,a,o,l,d){if(__.apply(this,arguments),fo){if(fo){var u=qc;fo=!1,qc=null}else throw Error(ie(198));Gc||(Gc=!0,Jh=u)}}function wi(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function Fv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function px(t){if(wi(t)!==t)throw Error(ie(188))}function E_(t){var e=t.alternate;if(!e){if(e=wi(t),e===null)throw Error(ie(188));return e!==t?null:t}for(var s=t,r=e;;){var i=s.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){s=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===s)return px(i),t;if(a===r)return px(i),e;a=a.sibling}throw Error(ie(188))}if(s.return!==r.return)s=i,r=a;else{for(var o=!1,l=i.child;l;){if(l===s){o=!0,s=i,r=a;break}if(l===r){o=!0,r=i,s=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===s){o=!0,s=a,r=i;break}if(l===r){o=!0,r=a,s=i;break}l=l.sibling}if(!o)throw Error(ie(189))}}if(s.alternate!==r)throw Error(ie(190))}if(s.tag!==3)throw Error(ie(188));return s.stateNode.current===s?t:e}function $v(t){return t=E_(t),t!==null?Uv(t):null}function Uv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Uv(t);if(e!==null)return e;t=t.sibling}return null}var zv=Ts.unstable_scheduleCallback,fx=Ts.unstable_cancelCallback,A_=Ts.unstable_shouldYield,I_=Ts.unstable_requestPaint,wt=Ts.unstable_now,k_=Ts.unstable_getCurrentPriorityLevel,xp=Ts.unstable_ImmediatePriority,Bv=Ts.unstable_UserBlockingPriority,Wc=Ts.unstable_NormalPriority,C_=Ts.unstable_LowPriority,qv=Ts.unstable_IdlePriority,Bd=null,cn=null;function T_(t){if(cn&&typeof cn.onCommitFiberRoot=="function")try{cn.onCommitFiberRoot(Bd,t,void 0,(t.current.flags&128)===128)}catch{}}var Xs=Math.clz32?Math.clz32:D_,R_=Math.log,P_=Math.LN2;function D_(t){return t>>>=0,t===0?32:31-(R_(t)/P_|0)|0}var tc=64,sc=4194304;function io(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Hc(t,e){var s=t.pendingLanes;if(s===0)return 0;var r=0,i=t.suspendedLanes,a=t.pingedLanes,o=s&268435455;if(o!==0){var l=o&~i;l!==0?r=io(l):(a&=o,a!==0&&(r=io(a)))}else o=s&~i,o!==0?r=io(o):a!==0&&(r=io(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(r&4&&(r|=s&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)s=31-Xs(e),i=1<<s,r|=t[s],e&=~i;return r}function M_(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function L_(t,e){for(var s=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-Xs(a),l=1<<o,d=i[o];d===-1?(!(l&s)||l&r)&&(i[o]=M_(l,e)):d<=e&&(t.expiredLanes|=l),a&=~l}}function Zh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Gv(){var t=tc;return tc<<=1,!(tc&4194240)&&(tc=64),t}function th(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function ul(t,e,s){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Xs(e),t[e]=s}function V_(t,e){var s=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<s;){var i=31-Xs(s),a=1<<i;e[i]=0,r[i]=-1,t[i]=-1,s&=~a}}function yp(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var r=31-Xs(s),i=1<<r;i&e|t[r]&e&&(t[r]|=e),s&=~i}}var Ze=0;function Wv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Hv,vp,Kv,Qv,Yv,em=!1,nc=[],xr=null,yr=null,vr=null,Mo=new Map,Lo=new Map,ar=[],O_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gx(t,e){switch(t){case"focusin":case"focusout":xr=null;break;case"dragenter":case"dragleave":yr=null;break;case"mouseover":case"mouseout":vr=null;break;case"pointerover":case"pointerout":Mo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lo.delete(e.pointerId)}}function Ya(t,e,s,r,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:s,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},e!==null&&(e=ml(e),e!==null&&vp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function F_(t,e,s,r,i){switch(e){case"focusin":return xr=Ya(xr,t,e,s,r,i),!0;case"dragenter":return yr=Ya(yr,t,e,s,r,i),!0;case"mouseover":return vr=Ya(vr,t,e,s,r,i),!0;case"pointerover":var a=i.pointerId;return Mo.set(a,Ya(Mo.get(a)||null,t,e,s,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Lo.set(a,Ya(Lo.get(a)||null,t,e,s,r,i)),!0}return!1}function Xv(t){var e=Zr(t.target);if(e!==null){var s=wi(e);if(s!==null){if(e=s.tag,e===13){if(e=Fv(s),e!==null){t.blockedOn=e,Yv(t.priority,function(){Kv(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Nc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=tm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(s===null){s=t.nativeEvent;var r=new s.constructor(s.type,s);Qh=r,s.target.dispatchEvent(r),Qh=null}else return e=ml(s),e!==null&&vp(e),t.blockedOn=s,!1;e.shift()}return!0}function xx(t,e,s){Nc(t)&&s.delete(e)}function $_(){em=!1,xr!==null&&Nc(xr)&&(xr=null),yr!==null&&Nc(yr)&&(yr=null),vr!==null&&Nc(vr)&&(vr=null),Mo.forEach(xx),Lo.forEach(xx)}function Xa(t,e){t.blockedOn===e&&(t.blockedOn=null,em||(em=!0,Ts.unstable_scheduleCallback(Ts.unstable_NormalPriority,$_)))}function Vo(t){function e(i){return Xa(i,t)}if(0<nc.length){Xa(nc[0],t);for(var s=1;s<nc.length;s++){var r=nc[s];r.blockedOn===t&&(r.blockedOn=null)}}for(xr!==null&&Xa(xr,t),yr!==null&&Xa(yr,t),vr!==null&&Xa(vr,t),Mo.forEach(e),Lo.forEach(e),s=0;s<ar.length;s++)r=ar[s],r.blockedOn===t&&(r.blockedOn=null);for(;0<ar.length&&(s=ar[0],s.blockedOn===null);)Xv(s),s.blockedOn===null&&ar.shift()}var Ji=Yn.ReactCurrentBatchConfig,Kc=!0;function U_(t,e,s,r){var i=Ze,a=Ji.transition;Ji.transition=null;try{Ze=1,bp(t,e,s,r)}finally{Ze=i,Ji.transition=a}}function z_(t,e,s,r){var i=Ze,a=Ji.transition;Ji.transition=null;try{Ze=4,bp(t,e,s,r)}finally{Ze=i,Ji.transition=a}}function bp(t,e,s,r){if(Kc){var i=tm(t,e,s,r);if(i===null)uh(t,e,r,Qc,s),gx(t,r);else if(F_(i,t,e,s,r))r.stopPropagation();else if(gx(t,r),e&4&&-1<O_.indexOf(t)){for(;i!==null;){var a=ml(i);if(a!==null&&Hv(a),a=tm(t,e,s,r),a===null&&uh(t,e,r,Qc,s),a===i)break;i=a}i!==null&&r.stopPropagation()}else uh(t,e,r,null,s)}}var Qc=null;function tm(t,e,s,r){if(Qc=null,t=gp(r),t=Zr(t),t!==null)if(e=wi(t),e===null)t=null;else if(s=e.tag,s===13){if(t=Fv(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qc=t,null}function Jv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(k_()){case xp:return 1;case Bv:return 4;case Wc:case C_:return 16;case qv:return 536870912;default:return 16}default:return 16}}var mr=null,wp=null,_c=null;function Zv(){if(_c)return _c;var t,e=wp,s=e.length,r,i="value"in mr?mr.value:mr.textContent,a=i.length;for(t=0;t<s&&e[t]===i[t];t++);var o=s-t;for(r=1;r<=o&&e[s-r]===i[a-r];r++);return _c=i.slice(t,1<r?1-r:void 0)}function Sc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function rc(){return!0}function yx(){return!1}function Ms(t){function e(s,r,i,a,o){this._reactName=s,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(s=t[l],this[l]=s?s(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?rc:yx,this.isPropagationStopped=yx,this}return pt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=rc)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=rc)},persist:function(){},isPersistent:rc}),e}var Aa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jp=Ms(Aa),hl=pt({},Aa,{view:0,detail:0}),B_=Ms(hl),sh,nh,Ja,qd=pt({},hl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Np,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ja&&(Ja&&t.type==="mousemove"?(sh=t.screenX-Ja.screenX,nh=t.screenY-Ja.screenY):nh=sh=0,Ja=t),sh)},movementY:function(t){return"movementY"in t?t.movementY:nh}}),vx=Ms(qd),q_=pt({},qd,{dataTransfer:0}),G_=Ms(q_),W_=pt({},hl,{relatedTarget:0}),rh=Ms(W_),H_=pt({},Aa,{animationName:0,elapsedTime:0,pseudoElement:0}),K_=Ms(H_),Q_=pt({},Aa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Y_=Ms(Q_),X_=pt({},Aa,{data:0}),bx=Ms(X_),J_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Z_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=eS[t])?!!e[t]:!1}function Np(){return tS}var sS=pt({},hl,{key:function(t){if(t.key){var e=J_[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Sc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Z_[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Np,charCode:function(t){return t.type==="keypress"?Sc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Sc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),nS=Ms(sS),rS=pt({},qd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wx=Ms(rS),iS=pt({},hl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Np}),aS=Ms(iS),oS=pt({},Aa,{propertyName:0,elapsedTime:0,pseudoElement:0}),lS=Ms(oS),cS=pt({},qd,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),dS=Ms(cS),uS=[9,13,27,32],_p=On&&"CompositionEvent"in window,go=null;On&&"documentMode"in document&&(go=document.documentMode);var hS=On&&"TextEvent"in window&&!go,eb=On&&(!_p||go&&8<go&&11>=go),jx=" ",Nx=!1;function tb(t,e){switch(t){case"keyup":return uS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Oi=!1;function mS(t,e){switch(t){case"compositionend":return sb(e);case"keypress":return e.which!==32?null:(Nx=!0,jx);case"textInput":return t=e.data,t===jx&&Nx?null:t;default:return null}}function pS(t,e){if(Oi)return t==="compositionend"||!_p&&tb(t,e)?(t=Zv(),_c=wp=mr=null,Oi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return eb&&e.locale!=="ko"?null:e.data;default:return null}}var fS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _x(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!fS[t.type]:e==="textarea"}function nb(t,e,s,r){Dv(r),e=Yc(e,"onChange"),0<e.length&&(s=new jp("onChange","change",null,s,r),t.push({event:s,listeners:e}))}var xo=null,Oo=null;function gS(t){pb(t,0)}function Gd(t){var e=Ui(t);if(Av(e))return t}function xS(t,e){if(t==="change")return e}var rb=!1;if(On){var ih;if(On){var ah="oninput"in document;if(!ah){var Sx=document.createElement("div");Sx.setAttribute("oninput","return;"),ah=typeof Sx.oninput=="function"}ih=ah}else ih=!1;rb=ih&&(!document.documentMode||9<document.documentMode)}function Ex(){xo&&(xo.detachEvent("onpropertychange",ib),Oo=xo=null)}function ib(t){if(t.propertyName==="value"&&Gd(Oo)){var e=[];nb(e,Oo,t,gp(t)),Ov(gS,e)}}function yS(t,e,s){t==="focusin"?(Ex(),xo=e,Oo=s,xo.attachEvent("onpropertychange",ib)):t==="focusout"&&Ex()}function vS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Gd(Oo)}function bS(t,e){if(t==="click")return Gd(e)}function wS(t,e){if(t==="input"||t==="change")return Gd(e)}function jS(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var en=typeof Object.is=="function"?Object.is:jS;function Fo(t,e){if(en(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),r=Object.keys(e);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var i=s[r];if(!Vh.call(e,i)||!en(t[i],e[i]))return!1}return!0}function Ax(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ix(t,e){var s=Ax(t);t=0;for(var r;s;){if(s.nodeType===3){if(r=t+s.textContent.length,t<=e&&r>=e)return{node:s,offset:e-t};t=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Ax(s)}}function ab(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ab(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ob(){for(var t=window,e=Bc();e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=Bc(t.document)}return e}function Sp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function NS(t){var e=ob(),s=t.focusedElem,r=t.selectionRange;if(e!==s&&s&&s.ownerDocument&&ab(s.ownerDocument.documentElement,s)){if(r!==null&&Sp(s)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(t,s.value.length);else if(t=(e=s.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=s.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!t.extend&&a>r&&(i=r,r=a,a=i),i=Ix(s,a);var o=Ix(s,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=s;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)t=e[s],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _S=On&&"documentMode"in document&&11>=document.documentMode,Fi=null,sm=null,yo=null,nm=!1;function kx(t,e,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;nm||Fi==null||Fi!==Bc(r)||(r=Fi,"selectionStart"in r&&Sp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),yo&&Fo(yo,r)||(yo=r,r=Yc(sm,"onSelect"),0<r.length&&(e=new jp("onSelect","select",null,e,s),t.push({event:e,listeners:r}),e.target=Fi)))}function ic(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var $i={animationend:ic("Animation","AnimationEnd"),animationiteration:ic("Animation","AnimationIteration"),animationstart:ic("Animation","AnimationStart"),transitionend:ic("Transition","TransitionEnd")},oh={},lb={};On&&(lb=document.createElement("div").style,"AnimationEvent"in window||(delete $i.animationend.animation,delete $i.animationiteration.animation,delete $i.animationstart.animation),"TransitionEvent"in window||delete $i.transitionend.transition);function Wd(t){if(oh[t])return oh[t];if(!$i[t])return t;var e=$i[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in lb)return oh[t]=e[s];return t}var cb=Wd("animationend"),db=Wd("animationiteration"),ub=Wd("animationstart"),hb=Wd("transitionend"),mb=new Map,Cx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vr(t,e){mb.set(t,e),bi(e,[t])}for(var lh=0;lh<Cx.length;lh++){var ch=Cx[lh],SS=ch.toLowerCase(),ES=ch[0].toUpperCase()+ch.slice(1);Vr(SS,"on"+ES)}Vr(cb,"onAnimationEnd");Vr(db,"onAnimationIteration");Vr(ub,"onAnimationStart");Vr("dblclick","onDoubleClick");Vr("focusin","onFocus");Vr("focusout","onBlur");Vr(hb,"onTransitionEnd");oa("onMouseEnter",["mouseout","mouseover"]);oa("onMouseLeave",["mouseout","mouseover"]);oa("onPointerEnter",["pointerout","pointerover"]);oa("onPointerLeave",["pointerout","pointerover"]);bi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bi("onBeforeInput",["compositionend","keypress","textInput","paste"]);bi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ao="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AS=new Set("cancel close invalid load scroll toggle".split(" ").concat(ao));function Tx(t,e,s){var r=t.type||"unknown-event";t.currentTarget=s,S_(r,e,void 0,t),t.currentTarget=null}function pb(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var r=t[s],i=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],d=l.instance,u=l.currentTarget;if(l=l.listener,d!==a&&i.isPropagationStopped())break e;Tx(i,l,u),a=d}else for(o=0;o<r.length;o++){if(l=r[o],d=l.instance,u=l.currentTarget,l=l.listener,d!==a&&i.isPropagationStopped())break e;Tx(i,l,u),a=d}}}if(Gc)throw t=Jh,Gc=!1,Jh=null,t}function at(t,e){var s=e[lm];s===void 0&&(s=e[lm]=new Set);var r=t+"__bubble";s.has(r)||(fb(e,t,2,!1),s.add(r))}function dh(t,e,s){var r=0;e&&(r|=4),fb(s,t,r,e)}var ac="_reactListening"+Math.random().toString(36).slice(2);function $o(t){if(!t[ac]){t[ac]=!0,jv.forEach(function(s){s!=="selectionchange"&&(AS.has(s)||dh(s,!1,t),dh(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ac]||(e[ac]=!0,dh("selectionchange",!1,e))}}function fb(t,e,s,r){switch(Jv(e)){case 1:var i=U_;break;case 4:i=z_;break;default:i=bp}s=i.bind(null,e,s,t),i=void 0,!Xh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,s,{capture:!0,passive:i}):t.addEventListener(e,s,!0):i!==void 0?t.addEventListener(e,s,{passive:i}):t.addEventListener(e,s,!1)}function uh(t,e,s,r,i){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var d=o.tag;if((d===3||d===4)&&(d=o.stateNode.containerInfo,d===i||d.nodeType===8&&d.parentNode===i))return;o=o.return}for(;l!==null;){if(o=Zr(l),o===null)return;if(d=o.tag,d===5||d===6){r=a=o;continue e}l=l.parentNode}}r=r.return}Ov(function(){var u=a,h=gp(s),m=[];e:{var g=mb.get(t);if(g!==void 0){var x=jp,y=t;switch(t){case"keypress":if(Sc(s)===0)break e;case"keydown":case"keyup":x=nS;break;case"focusin":y="focus",x=rh;break;case"focusout":y="blur",x=rh;break;case"beforeblur":case"afterblur":x=rh;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=vx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=G_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=aS;break;case cb:case db:case ub:x=K_;break;case hb:x=lS;break;case"scroll":x=B_;break;case"wheel":x=dS;break;case"copy":case"cut":case"paste":x=Y_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=wx}var R=(e&4)!==0,_=!R&&t==="scroll",T=R?g!==null?g+"Capture":null:g;R=[];for(var A=u,C;A!==null;){C=A;var k=C.stateNode;if(C.tag===5&&k!==null&&(C=k,T!==null&&(k=Do(A,T),k!=null&&R.push(Uo(A,k,C)))),_)break;A=A.return}0<R.length&&(g=new x(g,y,null,s,h),m.push({event:g,listeners:R}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",g&&s!==Qh&&(y=s.relatedTarget||s.fromElement)&&(Zr(y)||y[Fn]))break e;if((x||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,x?(y=s.relatedTarget||s.toElement,x=u,y=y?Zr(y):null,y!==null&&(_=wi(y),y!==_||y.tag!==5&&y.tag!==6)&&(y=null)):(x=null,y=u),x!==y)){if(R=vx,k="onMouseLeave",T="onMouseEnter",A="mouse",(t==="pointerout"||t==="pointerover")&&(R=wx,k="onPointerLeave",T="onPointerEnter",A="pointer"),_=x==null?g:Ui(x),C=y==null?g:Ui(y),g=new R(k,A+"leave",x,s,h),g.target=_,g.relatedTarget=C,k=null,Zr(h)===u&&(R=new R(T,A+"enter",y,s,h),R.target=C,R.relatedTarget=_,k=R),_=k,x&&y)t:{for(R=x,T=y,A=0,C=R;C;C=Ri(C))A++;for(C=0,k=T;k;k=Ri(k))C++;for(;0<A-C;)R=Ri(R),A--;for(;0<C-A;)T=Ri(T),C--;for(;A--;){if(R===T||T!==null&&R===T.alternate)break t;R=Ri(R),T=Ri(T)}R=null}else R=null;x!==null&&Rx(m,g,x,R,!1),y!==null&&_!==null&&Rx(m,_,y,R,!0)}}e:{if(g=u?Ui(u):window,x=g.nodeName&&g.nodeName.toLowerCase(),x==="select"||x==="input"&&g.type==="file")var D=xS;else if(_x(g))if(rb)D=wS;else{D=vS;var P=yS}else(x=g.nodeName)&&x.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(D=bS);if(D&&(D=D(t,u))){nb(m,D,s,h);break e}P&&P(t,g,u),t==="focusout"&&(P=g._wrapperState)&&P.controlled&&g.type==="number"&&qh(g,"number",g.value)}switch(P=u?Ui(u):window,t){case"focusin":(_x(P)||P.contentEditable==="true")&&(Fi=P,sm=u,yo=null);break;case"focusout":yo=sm=Fi=null;break;case"mousedown":nm=!0;break;case"contextmenu":case"mouseup":case"dragend":nm=!1,kx(m,s,h);break;case"selectionchange":if(_S)break;case"keydown":case"keyup":kx(m,s,h)}var v;if(_p)e:{switch(t){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Oi?tb(t,s)&&(b="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(b="onCompositionStart");b&&(eb&&s.locale!=="ko"&&(Oi||b!=="onCompositionStart"?b==="onCompositionEnd"&&Oi&&(v=Zv()):(mr=h,wp="value"in mr?mr.value:mr.textContent,Oi=!0)),P=Yc(u,b),0<P.length&&(b=new bx(b,t,null,s,h),m.push({event:b,listeners:P}),v?b.data=v:(v=sb(s),v!==null&&(b.data=v)))),(v=hS?mS(t,s):pS(t,s))&&(u=Yc(u,"onBeforeInput"),0<u.length&&(h=new bx("onBeforeInput","beforeinput",null,s,h),m.push({event:h,listeners:u}),h.data=v))}pb(m,e)})}function Uo(t,e,s){return{instance:t,listener:e,currentTarget:s}}function Yc(t,e){for(var s=e+"Capture",r=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Do(t,s),a!=null&&r.unshift(Uo(t,a,i)),a=Do(t,e),a!=null&&r.push(Uo(t,a,i))),t=t.return}return r}function Ri(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Rx(t,e,s,r,i){for(var a=e._reactName,o=[];s!==null&&s!==r;){var l=s,d=l.alternate,u=l.stateNode;if(d!==null&&d===r)break;l.tag===5&&u!==null&&(l=u,i?(d=Do(s,a),d!=null&&o.unshift(Uo(s,d,l))):i||(d=Do(s,a),d!=null&&o.push(Uo(s,d,l)))),s=s.return}o.length!==0&&t.push({event:e,listeners:o})}var IS=/\r\n?/g,kS=/\u0000|\uFFFD/g;function Px(t){return(typeof t=="string"?t:""+t).replace(IS,`
`).replace(kS,"")}function oc(t,e,s){if(e=Px(e),Px(t)!==e&&s)throw Error(ie(425))}function Xc(){}var rm=null,im=null;function am(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var om=typeof setTimeout=="function"?setTimeout:void 0,CS=typeof clearTimeout=="function"?clearTimeout:void 0,Dx=typeof Promise=="function"?Promise:void 0,TS=typeof queueMicrotask=="function"?queueMicrotask:typeof Dx<"u"?function(t){return Dx.resolve(null).then(t).catch(RS)}:om;function RS(t){setTimeout(function(){throw t})}function hh(t,e){var s=e,r=0;do{var i=s.nextSibling;if(t.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"){if(r===0){t.removeChild(i),Vo(e);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=i}while(s);Vo(e)}function br(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Mx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return t;e--}else s==="/$"&&e++}t=t.previousSibling}return null}var Ia=Math.random().toString(36).slice(2),on="__reactFiber$"+Ia,zo="__reactProps$"+Ia,Fn="__reactContainer$"+Ia,lm="__reactEvents$"+Ia,PS="__reactListeners$"+Ia,DS="__reactHandles$"+Ia;function Zr(t){var e=t[on];if(e)return e;for(var s=t.parentNode;s;){if(e=s[Fn]||s[on]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=Mx(t);t!==null;){if(s=t[on])return s;t=Mx(t)}return e}t=s,s=t.parentNode}return null}function ml(t){return t=t[on]||t[Fn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ui(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ie(33))}function Hd(t){return t[zo]||null}var cm=[],zi=-1;function Or(t){return{current:t}}function lt(t){0>zi||(t.current=cm[zi],cm[zi]=null,zi--)}function rt(t,e){zi++,cm[zi]=t.current,t.current=e}var Rr={},ts=Or(Rr),gs=Or(!1),oi=Rr;function la(t,e){var s=t.type.contextTypes;if(!s)return Rr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in s)i[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function xs(t){return t=t.childContextTypes,t!=null}function Jc(){lt(gs),lt(ts)}function Lx(t,e,s){if(ts.current!==Rr)throw Error(ie(168));rt(ts,e),rt(gs,s)}function gb(t,e,s){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ie(108,y_(t)||"Unknown",i));return pt({},s,r)}function Zc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Rr,oi=ts.current,rt(ts,t),rt(gs,gs.current),!0}function Vx(t,e,s){var r=t.stateNode;if(!r)throw Error(ie(169));s?(t=gb(t,e,oi),r.__reactInternalMemoizedMergedChildContext=t,lt(gs),lt(ts),rt(ts,t)):lt(gs),rt(gs,s)}var kn=null,Kd=!1,mh=!1;function xb(t){kn===null?kn=[t]:kn.push(t)}function MS(t){Kd=!0,xb(t)}function Fr(){if(!mh&&kn!==null){mh=!0;var t=0,e=Ze;try{var s=kn;for(Ze=1;t<s.length;t++){var r=s[t];do r=r(!0);while(r!==null)}kn=null,Kd=!1}catch(i){throw kn!==null&&(kn=kn.slice(t+1)),zv(xp,Fr),i}finally{Ze=e,mh=!1}}return null}var Bi=[],qi=0,ed=null,td=0,Ls=[],Vs=0,li=null,Cn=1,Tn="";function Yr(t,e){Bi[qi++]=td,Bi[qi++]=ed,ed=t,td=e}function yb(t,e,s){Ls[Vs++]=Cn,Ls[Vs++]=Tn,Ls[Vs++]=li,li=t;var r=Cn;t=Tn;var i=32-Xs(r)-1;r&=~(1<<i),s+=1;var a=32-Xs(e)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Cn=1<<32-Xs(e)+i|s<<i|r,Tn=a+t}else Cn=1<<a|s<<i|r,Tn=t}function Ep(t){t.return!==null&&(Yr(t,1),yb(t,1,0))}function Ap(t){for(;t===ed;)ed=Bi[--qi],Bi[qi]=null,td=Bi[--qi],Bi[qi]=null;for(;t===li;)li=Ls[--Vs],Ls[Vs]=null,Tn=Ls[--Vs],Ls[Vs]=null,Cn=Ls[--Vs],Ls[Vs]=null}var As=null,Ss=null,dt=!1,Qs=null;function vb(t,e){var s=Os(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=t,e=t.deletions,e===null?(t.deletions=[s],t.flags|=16):e.push(s)}function Ox(t,e){switch(t.tag){case 5:var s=t.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,As=t,Ss=br(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,As=t,Ss=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=li!==null?{id:Cn,overflow:Tn}:null,t.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=Os(18,null,null,0),s.stateNode=e,s.return=t,t.child=s,As=t,Ss=null,!0):!1;default:return!1}}function dm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function um(t){if(dt){var e=Ss;if(e){var s=e;if(!Ox(t,e)){if(dm(t))throw Error(ie(418));e=br(s.nextSibling);var r=As;e&&Ox(t,e)?vb(r,s):(t.flags=t.flags&-4097|2,dt=!1,As=t)}}else{if(dm(t))throw Error(ie(418));t.flags=t.flags&-4097|2,dt=!1,As=t}}}function Fx(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;As=t}function lc(t){if(t!==As)return!1;if(!dt)return Fx(t),dt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!am(t.type,t.memoizedProps)),e&&(e=Ss)){if(dm(t))throw bb(),Error(ie(418));for(;e;)vb(t,e),e=br(e.nextSibling)}if(Fx(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ie(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"){if(e===0){Ss=br(t.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}t=t.nextSibling}Ss=null}}else Ss=As?br(t.stateNode.nextSibling):null;return!0}function bb(){for(var t=Ss;t;)t=br(t.nextSibling)}function ca(){Ss=As=null,dt=!1}function Ip(t){Qs===null?Qs=[t]:Qs.push(t)}var LS=Yn.ReactCurrentBatchConfig;function Za(t,e,s){if(t=s.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(ie(309));var r=s.stateNode}if(!r)throw Error(ie(147,t));var i=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var l=i.refs;o===null?delete l[a]:l[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(ie(284));if(!s._owner)throw Error(ie(290,t))}return t}function cc(t,e){throw t=Object.prototype.toString.call(e),Error(ie(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function $x(t){var e=t._init;return e(t._payload)}function wb(t){function e(T,A){if(t){var C=T.deletions;C===null?(T.deletions=[A],T.flags|=16):C.push(A)}}function s(T,A){if(!t)return null;for(;A!==null;)e(T,A),A=A.sibling;return null}function r(T,A){for(T=new Map;A!==null;)A.key!==null?T.set(A.key,A):T.set(A.index,A),A=A.sibling;return T}function i(T,A){return T=_r(T,A),T.index=0,T.sibling=null,T}function a(T,A,C){return T.index=C,t?(C=T.alternate,C!==null?(C=C.index,C<A?(T.flags|=2,A):C):(T.flags|=2,A)):(T.flags|=1048576,A)}function o(T){return t&&T.alternate===null&&(T.flags|=2),T}function l(T,A,C,k){return A===null||A.tag!==6?(A=bh(C,T.mode,k),A.return=T,A):(A=i(A,C),A.return=T,A)}function d(T,A,C,k){var D=C.type;return D===Vi?h(T,A,C.props.children,k,C.key):A!==null&&(A.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===rr&&$x(D)===A.type)?(k=i(A,C.props),k.ref=Za(T,A,C),k.return=T,k):(k=Rc(C.type,C.key,C.props,null,T.mode,k),k.ref=Za(T,A,C),k.return=T,k)}function u(T,A,C,k){return A===null||A.tag!==4||A.stateNode.containerInfo!==C.containerInfo||A.stateNode.implementation!==C.implementation?(A=wh(C,T.mode,k),A.return=T,A):(A=i(A,C.children||[]),A.return=T,A)}function h(T,A,C,k,D){return A===null||A.tag!==7?(A=ii(C,T.mode,k,D),A.return=T,A):(A=i(A,C),A.return=T,A)}function m(T,A,C){if(typeof A=="string"&&A!==""||typeof A=="number")return A=bh(""+A,T.mode,C),A.return=T,A;if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Jl:return C=Rc(A.type,A.key,A.props,null,T.mode,C),C.ref=Za(T,null,A),C.return=T,C;case Li:return A=wh(A,T.mode,C),A.return=T,A;case rr:var k=A._init;return m(T,k(A._payload),C)}if(ro(A)||Ka(A))return A=ii(A,T.mode,C,null),A.return=T,A;cc(T,A)}return null}function g(T,A,C,k){var D=A!==null?A.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return D!==null?null:l(T,A,""+C,k);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Jl:return C.key===D?d(T,A,C,k):null;case Li:return C.key===D?u(T,A,C,k):null;case rr:return D=C._init,g(T,A,D(C._payload),k)}if(ro(C)||Ka(C))return D!==null?null:h(T,A,C,k,null);cc(T,C)}return null}function x(T,A,C,k,D){if(typeof k=="string"&&k!==""||typeof k=="number")return T=T.get(C)||null,l(A,T,""+k,D);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Jl:return T=T.get(k.key===null?C:k.key)||null,d(A,T,k,D);case Li:return T=T.get(k.key===null?C:k.key)||null,u(A,T,k,D);case rr:var P=k._init;return x(T,A,C,P(k._payload),D)}if(ro(k)||Ka(k))return T=T.get(C)||null,h(A,T,k,D,null);cc(A,k)}return null}function y(T,A,C,k){for(var D=null,P=null,v=A,b=A=0,N=null;v!==null&&b<C.length;b++){v.index>b?(N=v,v=null):N=v.sibling;var f=g(T,v,C[b],k);if(f===null){v===null&&(v=N);break}t&&v&&f.alternate===null&&e(T,v),A=a(f,A,b),P===null?D=f:P.sibling=f,P=f,v=N}if(b===C.length)return s(T,v),dt&&Yr(T,b),D;if(v===null){for(;b<C.length;b++)v=m(T,C[b],k),v!==null&&(A=a(v,A,b),P===null?D=v:P.sibling=v,P=v);return dt&&Yr(T,b),D}for(v=r(T,v);b<C.length;b++)N=x(v,T,b,C[b],k),N!==null&&(t&&N.alternate!==null&&v.delete(N.key===null?b:N.key),A=a(N,A,b),P===null?D=N:P.sibling=N,P=N);return t&&v.forEach(function(j){return e(T,j)}),dt&&Yr(T,b),D}function R(T,A,C,k){var D=Ka(C);if(typeof D!="function")throw Error(ie(150));if(C=D.call(C),C==null)throw Error(ie(151));for(var P=D=null,v=A,b=A=0,N=null,f=C.next();v!==null&&!f.done;b++,f=C.next()){v.index>b?(N=v,v=null):N=v.sibling;var j=g(T,v,f.value,k);if(j===null){v===null&&(v=N);break}t&&v&&j.alternate===null&&e(T,v),A=a(j,A,b),P===null?D=j:P.sibling=j,P=j,v=N}if(f.done)return s(T,v),dt&&Yr(T,b),D;if(v===null){for(;!f.done;b++,f=C.next())f=m(T,f.value,k),f!==null&&(A=a(f,A,b),P===null?D=f:P.sibling=f,P=f);return dt&&Yr(T,b),D}for(v=r(T,v);!f.done;b++,f=C.next())f=x(v,T,b,f.value,k),f!==null&&(t&&f.alternate!==null&&v.delete(f.key===null?b:f.key),A=a(f,A,b),P===null?D=f:P.sibling=f,P=f);return t&&v.forEach(function(E){return e(T,E)}),dt&&Yr(T,b),D}function _(T,A,C,k){if(typeof C=="object"&&C!==null&&C.type===Vi&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case Jl:e:{for(var D=C.key,P=A;P!==null;){if(P.key===D){if(D=C.type,D===Vi){if(P.tag===7){s(T,P.sibling),A=i(P,C.props.children),A.return=T,T=A;break e}}else if(P.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===rr&&$x(D)===P.type){s(T,P.sibling),A=i(P,C.props),A.ref=Za(T,P,C),A.return=T,T=A;break e}s(T,P);break}else e(T,P);P=P.sibling}C.type===Vi?(A=ii(C.props.children,T.mode,k,C.key),A.return=T,T=A):(k=Rc(C.type,C.key,C.props,null,T.mode,k),k.ref=Za(T,A,C),k.return=T,T=k)}return o(T);case Li:e:{for(P=C.key;A!==null;){if(A.key===P)if(A.tag===4&&A.stateNode.containerInfo===C.containerInfo&&A.stateNode.implementation===C.implementation){s(T,A.sibling),A=i(A,C.children||[]),A.return=T,T=A;break e}else{s(T,A);break}else e(T,A);A=A.sibling}A=wh(C,T.mode,k),A.return=T,T=A}return o(T);case rr:return P=C._init,_(T,A,P(C._payload),k)}if(ro(C))return y(T,A,C,k);if(Ka(C))return R(T,A,C,k);cc(T,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,A!==null&&A.tag===6?(s(T,A.sibling),A=i(A,C),A.return=T,T=A):(s(T,A),A=bh(C,T.mode,k),A.return=T,T=A),o(T)):s(T,A)}return _}var da=wb(!0),jb=wb(!1),sd=Or(null),nd=null,Gi=null,kp=null;function Cp(){kp=Gi=nd=null}function Tp(t){var e=sd.current;lt(sd),t._currentValue=e}function hm(t,e,s){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===s)break;t=t.return}}function Zi(t,e){nd=t,kp=Gi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(fs=!0),t.firstContext=null)}function Us(t){var e=t._currentValue;if(kp!==t)if(t={context:t,memoizedValue:e,next:null},Gi===null){if(nd===null)throw Error(ie(308));Gi=t,nd.dependencies={lanes:0,firstContext:t}}else Gi=Gi.next=t;return e}var ei=null;function Rp(t){ei===null?ei=[t]:ei.push(t)}function Nb(t,e,s,r){var i=e.interleaved;return i===null?(s.next=s,Rp(e)):(s.next=i.next,i.next=s),e.interleaved=s,$n(t,r)}function $n(t,e){t.lanes|=e;var s=t.alternate;for(s!==null&&(s.lanes|=e),s=t,t=t.return;t!==null;)t.childLanes|=e,s=t.alternate,s!==null&&(s.childLanes|=e),s=t,t=t.return;return s.tag===3?s.stateNode:null}var ir=!1;function Pp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _b(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Mn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function wr(t,e,s){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ge&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,$n(t,s)}return i=r.interleaved,i===null?(e.next=e,Rp(r)):(e.next=i.next,i.next=e),r.interleaved=e,$n(t,s)}function Ec(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,s|=r,e.lanes=s,yp(t,s)}}function Ux(t,e){var s=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var i=null,a=null;if(s=s.firstBaseUpdate,s!==null){do{var o={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};a===null?i=a=o:a=a.next=o,s=s.next}while(s!==null);a===null?i=a=e:a=a.next=e}else i=a=e;s={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}function rd(t,e,s,r){var i=t.updateQueue;ir=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var d=l,u=d.next;d.next=null,o===null?a=u:o.next=u,o=d;var h=t.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=d))}if(a!==null){var m=i.baseState;o=0,h=u=d=null,l=a;do{var g=l.lane,x=l.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=t,R=l;switch(g=e,x=s,R.tag){case 1:if(y=R.payload,typeof y=="function"){m=y.call(x,m,g);break e}m=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=R.payload,g=typeof y=="function"?y.call(x,m,g):y,g==null)break e;m=pt({},m,g);break e;case 2:ir=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,g=i.effects,g===null?i.effects=[l]:g.push(l))}else x={eventTime:x,lane:g,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=x,d=m):h=h.next=x,o|=g;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;g=l,l=g.next,g.next=null,i.lastBaseUpdate=g,i.shared.pending=null}}while(!0);if(h===null&&(d=m),i.baseState=d,i.firstBaseUpdate=u,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);di|=o,t.lanes=o,t.memoizedState=m}}function zx(t,e,s){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=s,typeof i!="function")throw Error(ie(191,i));i.call(r)}}}var pl={},dn=Or(pl),Bo=Or(pl),qo=Or(pl);function ti(t){if(t===pl)throw Error(ie(174));return t}function Dp(t,e){switch(rt(qo,e),rt(Bo,t),rt(dn,pl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Wh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Wh(e,t)}lt(dn),rt(dn,e)}function ua(){lt(dn),lt(Bo),lt(qo)}function Sb(t){ti(qo.current);var e=ti(dn.current),s=Wh(e,t.type);e!==s&&(rt(Bo,t),rt(dn,s))}function Mp(t){Bo.current===t&&(lt(dn),lt(Bo))}var ut=Or(0);function id(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ph=[];function Lp(){for(var t=0;t<ph.length;t++)ph[t]._workInProgressVersionPrimary=null;ph.length=0}var Ac=Yn.ReactCurrentDispatcher,fh=Yn.ReactCurrentBatchConfig,ci=0,mt=null,Et=null,Pt=null,ad=!1,vo=!1,Go=0,VS=0;function Ht(){throw Error(ie(321))}function Vp(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!en(t[s],e[s]))return!1;return!0}function Op(t,e,s,r,i,a){if(ci=a,mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ac.current=t===null||t.memoizedState===null?US:zS,t=s(r,i),vo){a=0;do{if(vo=!1,Go=0,25<=a)throw Error(ie(301));a+=1,Pt=Et=null,e.updateQueue=null,Ac.current=BS,t=s(r,i)}while(vo)}if(Ac.current=od,e=Et!==null&&Et.next!==null,ci=0,Pt=Et=mt=null,ad=!1,e)throw Error(ie(300));return t}function Fp(){var t=Go!==0;return Go=0,t}function an(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?mt.memoizedState=Pt=t:Pt=Pt.next=t,Pt}function zs(){if(Et===null){var t=mt.alternate;t=t!==null?t.memoizedState:null}else t=Et.next;var e=Pt===null?mt.memoizedState:Pt.next;if(e!==null)Pt=e,Et=t;else{if(t===null)throw Error(ie(310));Et=t,t={memoizedState:Et.memoizedState,baseState:Et.baseState,baseQueue:Et.baseQueue,queue:Et.queue,next:null},Pt===null?mt.memoizedState=Pt=t:Pt=Pt.next=t}return Pt}function Wo(t,e){return typeof e=="function"?e(t):e}function gh(t){var e=zs(),s=e.queue;if(s===null)throw Error(ie(311));s.lastRenderedReducer=t;var r=Et,i=r.baseQueue,a=s.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,s.pending=null}if(i!==null){a=i.next,r=r.baseState;var l=o=null,d=null,u=a;do{var h=u.lane;if((ci&h)===h)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var m={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(l=d=m,o=r):d=d.next=m,mt.lanes|=h,di|=h}u=u.next}while(u!==null&&u!==a);d===null?o=r:d.next=l,en(r,e.memoizedState)||(fs=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=d,s.lastRenderedState=r}if(t=s.interleaved,t!==null){i=t;do a=i.lane,mt.lanes|=a,di|=a,i=i.next;while(i!==t)}else i===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function xh(t){var e=zs(),s=e.queue;if(s===null)throw Error(ie(311));s.lastRenderedReducer=t;var r=s.dispatch,i=s.pending,a=e.memoizedState;if(i!==null){s.pending=null;var o=i=i.next;do a=t(a,o.action),o=o.next;while(o!==i);en(a,e.memoizedState)||(fs=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),s.lastRenderedState=a}return[a,r]}function Eb(){}function Ab(t,e){var s=mt,r=zs(),i=e(),a=!en(r.memoizedState,i);if(a&&(r.memoizedState=i,fs=!0),r=r.queue,$p(Cb.bind(null,s,r,t),[t]),r.getSnapshot!==e||a||Pt!==null&&Pt.memoizedState.tag&1){if(s.flags|=2048,Ho(9,kb.bind(null,s,r,i,e),void 0,null),Dt===null)throw Error(ie(349));ci&30||Ib(s,e,i)}return i}function Ib(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function kb(t,e,s,r){e.value=s,e.getSnapshot=r,Tb(e)&&Rb(t)}function Cb(t,e,s){return s(function(){Tb(e)&&Rb(t)})}function Tb(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!en(t,s)}catch{return!0}}function Rb(t){var e=$n(t,1);e!==null&&Js(e,t,1,-1)}function Bx(t){var e=an();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:t},e.queue=t,t=t.dispatch=$S.bind(null,mt,t),[e.memoizedState,t]}function Ho(t,e,s,r){return t={tag:t,create:e,destroy:s,deps:r,next:null},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.lastEffect=t.next=t):(s=e.lastEffect,s===null?e.lastEffect=t.next=t:(r=s.next,s.next=t,t.next=r,e.lastEffect=t)),t}function Pb(){return zs().memoizedState}function Ic(t,e,s,r){var i=an();mt.flags|=t,i.memoizedState=Ho(1|e,s,void 0,r===void 0?null:r)}function Qd(t,e,s,r){var i=zs();r=r===void 0?null:r;var a=void 0;if(Et!==null){var o=Et.memoizedState;if(a=o.destroy,r!==null&&Vp(r,o.deps)){i.memoizedState=Ho(e,s,a,r);return}}mt.flags|=t,i.memoizedState=Ho(1|e,s,a,r)}function qx(t,e){return Ic(8390656,8,t,e)}function $p(t,e){return Qd(2048,8,t,e)}function Db(t,e){return Qd(4,2,t,e)}function Mb(t,e){return Qd(4,4,t,e)}function Lb(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Vb(t,e,s){return s=s!=null?s.concat([t]):null,Qd(4,4,Lb.bind(null,e,t),s)}function Up(){}function Ob(t,e){var s=zs();e=e===void 0?null:e;var r=s.memoizedState;return r!==null&&e!==null&&Vp(e,r[1])?r[0]:(s.memoizedState=[t,e],t)}function Fb(t,e){var s=zs();e=e===void 0?null:e;var r=s.memoizedState;return r!==null&&e!==null&&Vp(e,r[1])?r[0]:(t=t(),s.memoizedState=[t,e],t)}function $b(t,e,s){return ci&21?(en(s,e)||(s=Gv(),mt.lanes|=s,di|=s,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,fs=!0),t.memoizedState=s)}function OS(t,e){var s=Ze;Ze=s!==0&&4>s?s:4,t(!0);var r=fh.transition;fh.transition={};try{t(!1),e()}finally{Ze=s,fh.transition=r}}function Ub(){return zs().memoizedState}function FS(t,e,s){var r=Nr(t);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},zb(t))Bb(e,s);else if(s=Nb(t,e,s,r),s!==null){var i=ls();Js(s,t,r,i),qb(s,e,r)}}function $S(t,e,s){var r=Nr(t),i={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(zb(t))Bb(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,s);if(i.hasEagerState=!0,i.eagerState=l,en(l,o)){var d=e.interleaved;d===null?(i.next=i,Rp(e)):(i.next=d.next,d.next=i),e.interleaved=i;return}}catch{}finally{}s=Nb(t,e,i,r),s!==null&&(i=ls(),Js(s,t,r,i),qb(s,e,r))}}function zb(t){var e=t.alternate;return t===mt||e!==null&&e===mt}function Bb(t,e){vo=ad=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function qb(t,e,s){if(s&4194240){var r=e.lanes;r&=t.pendingLanes,s|=r,e.lanes=s,yp(t,s)}}var od={readContext:Us,useCallback:Ht,useContext:Ht,useEffect:Ht,useImperativeHandle:Ht,useInsertionEffect:Ht,useLayoutEffect:Ht,useMemo:Ht,useReducer:Ht,useRef:Ht,useState:Ht,useDebugValue:Ht,useDeferredValue:Ht,useTransition:Ht,useMutableSource:Ht,useSyncExternalStore:Ht,useId:Ht,unstable_isNewReconciler:!1},US={readContext:Us,useCallback:function(t,e){return an().memoizedState=[t,e===void 0?null:e],t},useContext:Us,useEffect:qx,useImperativeHandle:function(t,e,s){return s=s!=null?s.concat([t]):null,Ic(4194308,4,Lb.bind(null,e,t),s)},useLayoutEffect:function(t,e){return Ic(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ic(4,2,t,e)},useMemo:function(t,e){var s=an();return e=e===void 0?null:e,t=t(),s.memoizedState=[t,e],t},useReducer:function(t,e,s){var r=an();return e=s!==void 0?s(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=FS.bind(null,mt,t),[r.memoizedState,t]},useRef:function(t){var e=an();return t={current:t},e.memoizedState=t},useState:Bx,useDebugValue:Up,useDeferredValue:function(t){return an().memoizedState=t},useTransition:function(){var t=Bx(!1),e=t[0];return t=OS.bind(null,t[1]),an().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,s){var r=mt,i=an();if(dt){if(s===void 0)throw Error(ie(407));s=s()}else{if(s=e(),Dt===null)throw Error(ie(349));ci&30||Ib(r,e,s)}i.memoizedState=s;var a={value:s,getSnapshot:e};return i.queue=a,qx(Cb.bind(null,r,a,t),[t]),r.flags|=2048,Ho(9,kb.bind(null,r,a,s,e),void 0,null),s},useId:function(){var t=an(),e=Dt.identifierPrefix;if(dt){var s=Tn,r=Cn;s=(r&~(1<<32-Xs(r)-1)).toString(32)+s,e=":"+e+"R"+s,s=Go++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=VS++,e=":"+e+"r"+s.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},zS={readContext:Us,useCallback:Ob,useContext:Us,useEffect:$p,useImperativeHandle:Vb,useInsertionEffect:Db,useLayoutEffect:Mb,useMemo:Fb,useReducer:gh,useRef:Pb,useState:function(){return gh(Wo)},useDebugValue:Up,useDeferredValue:function(t){var e=zs();return $b(e,Et.memoizedState,t)},useTransition:function(){var t=gh(Wo)[0],e=zs().memoizedState;return[t,e]},useMutableSource:Eb,useSyncExternalStore:Ab,useId:Ub,unstable_isNewReconciler:!1},BS={readContext:Us,useCallback:Ob,useContext:Us,useEffect:$p,useImperativeHandle:Vb,useInsertionEffect:Db,useLayoutEffect:Mb,useMemo:Fb,useReducer:xh,useRef:Pb,useState:function(){return xh(Wo)},useDebugValue:Up,useDeferredValue:function(t){var e=zs();return Et===null?e.memoizedState=t:$b(e,Et.memoizedState,t)},useTransition:function(){var t=xh(Wo)[0],e=zs().memoizedState;return[t,e]},useMutableSource:Eb,useSyncExternalStore:Ab,useId:Ub,unstable_isNewReconciler:!1};function Hs(t,e){if(t&&t.defaultProps){e=pt({},e),t=t.defaultProps;for(var s in t)e[s]===void 0&&(e[s]=t[s]);return e}return e}function mm(t,e,s,r){e=t.memoizedState,s=s(r,e),s=s==null?e:pt({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Yd={isMounted:function(t){return(t=t._reactInternals)?wi(t)===t:!1},enqueueSetState:function(t,e,s){t=t._reactInternals;var r=ls(),i=Nr(t),a=Mn(r,i);a.payload=e,s!=null&&(a.callback=s),e=wr(t,a,i),e!==null&&(Js(e,t,i,r),Ec(e,t,i))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var r=ls(),i=Nr(t),a=Mn(r,i);a.tag=1,a.payload=e,s!=null&&(a.callback=s),e=wr(t,a,i),e!==null&&(Js(e,t,i,r),Ec(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=ls(),r=Nr(t),i=Mn(s,r);i.tag=2,e!=null&&(i.callback=e),e=wr(t,i,r),e!==null&&(Js(e,t,r,s),Ec(e,t,r))}};function Gx(t,e,s,r,i,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!Fo(s,r)||!Fo(i,a):!0}function Gb(t,e,s){var r=!1,i=Rr,a=e.contextType;return typeof a=="object"&&a!==null?a=Us(a):(i=xs(e)?oi:ts.current,r=e.contextTypes,a=(r=r!=null)?la(t,i):Rr),e=new e(s,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Yd,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function Wx(t,e,s,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,r),e.state!==t&&Yd.enqueueReplaceState(e,e.state,null)}function pm(t,e,s,r){var i=t.stateNode;i.props=s,i.state=t.memoizedState,i.refs={},Pp(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=Us(a):(a=xs(e)?oi:ts.current,i.context=la(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(mm(t,e,a,s),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Yd.enqueueReplaceState(i,i.state,null),rd(t,s,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function ha(t,e){try{var s="",r=e;do s+=x_(r),r=r.return;while(r);var i=s}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function yh(t,e,s){return{value:t,source:null,stack:s??null,digest:e??null}}function fm(t,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var qS=typeof WeakMap=="function"?WeakMap:Map;function Wb(t,e,s){s=Mn(-1,s),s.tag=3,s.payload={element:null};var r=e.value;return s.callback=function(){cd||(cd=!0,Sm=r),fm(t,e)},s}function Hb(t,e,s){s=Mn(-1,s),s.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;s.payload=function(){return r(i)},s.callback=function(){fm(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(s.callback=function(){fm(t,e),typeof r!="function"&&(jr===null?jr=new Set([this]):jr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),s}function Hx(t,e,s){var r=t.pingCache;if(r===null){r=t.pingCache=new qS;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(s)||(i.add(s),t=r2.bind(null,t,e,s),e.then(t,t))}function Kx(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Qx(t,e,s,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=Mn(-1,1),e.tag=2,wr(s,e,1))),s.lanes|=1),t)}var GS=Yn.ReactCurrentOwner,fs=!1;function rs(t,e,s,r){e.child=t===null?jb(e,null,s,r):da(e,t.child,s,r)}function Yx(t,e,s,r,i){s=s.render;var a=e.ref;return Zi(e,i),r=Op(t,e,s,r,a,i),s=Fp(),t!==null&&!fs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Un(t,e,i)):(dt&&s&&Ep(e),e.flags|=1,rs(t,e,r,i),e.child)}function Xx(t,e,s,r,i){if(t===null){var a=s.type;return typeof a=="function"&&!Qp(a)&&a.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=a,Kb(t,e,a,r,i)):(t=Rc(s.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var o=a.memoizedProps;if(s=s.compare,s=s!==null?s:Fo,s(o,r)&&t.ref===e.ref)return Un(t,e,i)}return e.flags|=1,t=_r(a,r),t.ref=e.ref,t.return=e,e.child=t}function Kb(t,e,s,r,i){if(t!==null){var a=t.memoizedProps;if(Fo(a,r)&&t.ref===e.ref)if(fs=!1,e.pendingProps=r=a,(t.lanes&i)!==0)t.flags&131072&&(fs=!0);else return e.lanes=t.lanes,Un(t,e,i)}return gm(t,e,s,r,i)}function Qb(t,e,s){var r=e.pendingProps,i=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt(Hi,_s),_s|=s;else{if(!(s&1073741824))return t=a!==null?a.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,rt(Hi,_s),_s|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:s,rt(Hi,_s),_s|=r}else a!==null?(r=a.baseLanes|s,e.memoizedState=null):r=s,rt(Hi,_s),_s|=r;return rs(t,e,i,s),e.child}function Yb(t,e){var s=e.ref;(t===null&&s!==null||t!==null&&t.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function gm(t,e,s,r,i){var a=xs(s)?oi:ts.current;return a=la(e,a),Zi(e,i),s=Op(t,e,s,r,a,i),r=Fp(),t!==null&&!fs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Un(t,e,i)):(dt&&r&&Ep(e),e.flags|=1,rs(t,e,s,i),e.child)}function Jx(t,e,s,r,i){if(xs(s)){var a=!0;Zc(e)}else a=!1;if(Zi(e,i),e.stateNode===null)kc(t,e),Gb(e,s,r),pm(e,s,r,i),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var d=o.context,u=s.contextType;typeof u=="object"&&u!==null?u=Us(u):(u=xs(s)?oi:ts.current,u=la(e,u));var h=s.getDerivedStateFromProps,m=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||d!==u)&&Wx(e,o,r,u),ir=!1;var g=e.memoizedState;o.state=g,rd(e,r,o,i),d=e.memoizedState,l!==r||g!==d||gs.current||ir?(typeof h=="function"&&(mm(e,s,h,r),d=e.memoizedState),(l=ir||Gx(e,s,l,r,g,d,u))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=d),o.props=r,o.state=d,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,_b(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:Hs(e.type,l),o.props=u,m=e.pendingProps,g=o.context,d=s.contextType,typeof d=="object"&&d!==null?d=Us(d):(d=xs(s)?oi:ts.current,d=la(e,d));var x=s.getDerivedStateFromProps;(h=typeof x=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==m||g!==d)&&Wx(e,o,r,d),ir=!1,g=e.memoizedState,o.state=g,rd(e,r,o,i);var y=e.memoizedState;l!==m||g!==y||gs.current||ir?(typeof x=="function"&&(mm(e,s,x,r),y=e.memoizedState),(u=ir||Gx(e,s,u,r,g,y,d)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,d),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,d)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=y),o.props=r,o.state=y,o.context=d,r=u):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return xm(t,e,s,r,a,i)}function xm(t,e,s,r,i,a){Yb(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Vx(e,s,!1),Un(t,e,a);r=e.stateNode,GS.current=e;var l=o&&typeof s.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=da(e,t.child,null,a),e.child=da(e,null,l,a)):rs(t,e,l,a),e.memoizedState=r.state,i&&Vx(e,s,!0),e.child}function Xb(t){var e=t.stateNode;e.pendingContext?Lx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Lx(t,e.context,!1),Dp(t,e.containerInfo)}function Zx(t,e,s,r,i){return ca(),Ip(i),e.flags|=256,rs(t,e,s,r),e.child}var ym={dehydrated:null,treeContext:null,retryLane:0};function vm(t){return{baseLanes:t,cachePool:null,transitions:null}}function Jb(t,e,s){var r=e.pendingProps,i=ut.current,a=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(i&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),rt(ut,i&1),t===null)return um(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=Zd(o,r,0,null),t=ii(t,r,s,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=vm(s),e.memoizedState=ym,t):zp(e,o));if(i=t.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return WS(t,e,o,r,l,i,s);if(a){a=r.fallback,o=e.mode,i=t.child,l=i.sibling;var d={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=d,e.deletions=null):(r=_r(i,d),r.subtreeFlags=i.subtreeFlags&14680064),l!==null?a=_r(l,a):(a=ii(a,o,s,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?vm(s):{baseLanes:o.baseLanes|s,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~s,e.memoizedState=ym,r}return a=t.child,t=a.sibling,r=_r(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=s),r.return=e,r.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=r,e.memoizedState=null,r}function zp(t,e){return e=Zd({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function dc(t,e,s,r){return r!==null&&Ip(r),da(e,t.child,null,s),t=zp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function WS(t,e,s,r,i,a,o){if(s)return e.flags&256?(e.flags&=-257,r=yh(Error(ie(422))),dc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,i=e.mode,r=Zd({mode:"visible",children:r.children},i,0,null),a=ii(a,i,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&da(e,t.child,null,o),e.child.memoizedState=vm(o),e.memoizedState=ym,a);if(!(e.mode&1))return dc(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var l=r.dgst;return r=l,a=Error(ie(419)),r=yh(a,r,void 0),dc(t,e,o,r)}if(l=(o&t.childLanes)!==0,fs||l){if(r=Dt,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,$n(t,i),Js(r,t,i,-1))}return Kp(),r=yh(Error(ie(421))),dc(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=i2.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,Ss=br(i.nextSibling),As=e,dt=!0,Qs=null,t!==null&&(Ls[Vs++]=Cn,Ls[Vs++]=Tn,Ls[Vs++]=li,Cn=t.id,Tn=t.overflow,li=e),e=zp(e,r.children),e.flags|=4096,e)}function e0(t,e,s){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),hm(t.return,e,s)}function vh(t,e,s,r,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=s,a.tailMode=i)}function Zb(t,e,s){var r=e.pendingProps,i=r.revealOrder,a=r.tail;if(rs(t,e,r.children,s),r=ut.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&e0(t,s,e);else if(t.tag===19)e0(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(rt(ut,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(s=e.child,i=null;s!==null;)t=s.alternate,t!==null&&id(t)===null&&(i=s),s=s.sibling;s=i,s===null?(i=e.child,e.child=null):(i=s.sibling,s.sibling=null),vh(e,!1,i,s,a);break;case"backwards":for(s=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&id(t)===null){e.child=i;break}t=i.sibling,i.sibling=s,s=i,i=t}vh(e,!0,s,null,a);break;case"together":vh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function kc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Un(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),di|=e.lanes,!(s&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ie(153));if(e.child!==null){for(t=e.child,s=_r(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=_r(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function HS(t,e,s){switch(e.tag){case 3:Xb(e),ca();break;case 5:Sb(e);break;case 1:xs(e.type)&&Zc(e);break;case 4:Dp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;rt(sd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(rt(ut,ut.current&1),e.flags|=128,null):s&e.child.childLanes?Jb(t,e,s):(rt(ut,ut.current&1),t=Un(t,e,s),t!==null?t.sibling:null);rt(ut,ut.current&1);break;case 19:if(r=(s&e.childLanes)!==0,t.flags&128){if(r)return Zb(t,e,s);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),rt(ut,ut.current),r)break;return null;case 22:case 23:return e.lanes=0,Qb(t,e,s)}return Un(t,e,s)}var ew,bm,tw,sw;ew=function(t,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)t.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};bm=function(){};tw=function(t,e,s,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ti(dn.current);var a=null;switch(s){case"input":i=zh(t,i),r=zh(t,r),a=[];break;case"select":i=pt({},i,{value:void 0}),r=pt({},r,{value:void 0}),a=[];break;case"textarea":i=Gh(t,i),r=Gh(t,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Xc)}Hh(s,r);var o;s=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(s||(s={}),s[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ro.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var d=r[u];if(l=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&d!==l&&(d!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||d&&d.hasOwnProperty(o)||(s||(s={}),s[o]="");for(o in d)d.hasOwnProperty(o)&&l[o]!==d[o]&&(s||(s={}),s[o]=d[o])}else s||(a||(a=[]),a.push(u,s)),s=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(a=a||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(a=a||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ro.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&at("scroll",t),a||l===d||(a=[])):(a=a||[]).push(u,d))}s&&(a=a||[]).push("style",s);var u=a;(e.updateQueue=u)&&(e.flags|=4)}};sw=function(t,e,s,r){s!==r&&(e.flags|=4)};function eo(t,e){if(!dt)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Kt(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,r=0;if(e)for(var i=t.child;i!==null;)s|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)s|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=s,e}function KS(t,e,s){var r=e.pendingProps;switch(Ap(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kt(e),null;case 1:return xs(e.type)&&Jc(),Kt(e),null;case 3:return r=e.stateNode,ua(),lt(gs),lt(ts),Lp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(lc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Qs!==null&&(Im(Qs),Qs=null))),bm(t,e),Kt(e),null;case 5:Mp(e);var i=ti(qo.current);if(s=e.type,t!==null&&e.stateNode!=null)tw(t,e,s,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ie(166));return Kt(e),null}if(t=ti(dn.current),lc(e)){r=e.stateNode,s=e.type;var a=e.memoizedProps;switch(r[on]=e,r[zo]=a,t=(e.mode&1)!==0,s){case"dialog":at("cancel",r),at("close",r);break;case"iframe":case"object":case"embed":at("load",r);break;case"video":case"audio":for(i=0;i<ao.length;i++)at(ao[i],r);break;case"source":at("error",r);break;case"img":case"image":case"link":at("error",r),at("load",r);break;case"details":at("toggle",r);break;case"input":cx(r,a),at("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},at("invalid",r);break;case"textarea":ux(r,a),at("invalid",r)}Hh(s,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?r.textContent!==l&&(a.suppressHydrationWarning!==!0&&oc(r.textContent,l,t),i=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&oc(r.textContent,l,t),i=["children",""+l]):Ro.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&at("scroll",r)}switch(s){case"input":Zl(r),dx(r,a,!0);break;case"textarea":Zl(r),hx(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Xc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Cv(s)),t==="http://www.w3.org/1999/xhtml"?s==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(s,{is:r.is}):(t=o.createElement(s),s==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,s),t[on]=e,t[zo]=r,ew(t,e,!1,!1),e.stateNode=t;e:{switch(o=Kh(s,r),s){case"dialog":at("cancel",t),at("close",t),i=r;break;case"iframe":case"object":case"embed":at("load",t),i=r;break;case"video":case"audio":for(i=0;i<ao.length;i++)at(ao[i],t);i=r;break;case"source":at("error",t),i=r;break;case"img":case"image":case"link":at("error",t),at("load",t),i=r;break;case"details":at("toggle",t),i=r;break;case"input":cx(t,r),i=zh(t,r),at("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=pt({},r,{value:void 0}),at("invalid",t);break;case"textarea":ux(t,r),i=Gh(t,r),at("invalid",t);break;default:i=r}Hh(s,i),l=i;for(a in l)if(l.hasOwnProperty(a)){var d=l[a];a==="style"?Pv(t,d):a==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Tv(t,d)):a==="children"?typeof d=="string"?(s!=="textarea"||d!=="")&&Po(t,d):typeof d=="number"&&Po(t,""+d):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Ro.hasOwnProperty(a)?d!=null&&a==="onScroll"&&at("scroll",t):d!=null&&hp(t,a,d,o))}switch(s){case"input":Zl(t),dx(t,r,!1);break;case"textarea":Zl(t),hx(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Tr(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?Qi(t,!!r.multiple,a,!1):r.defaultValue!=null&&Qi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Xc)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Kt(e),null;case 6:if(t&&e.stateNode!=null)sw(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ie(166));if(s=ti(qo.current),ti(dn.current),lc(e)){if(r=e.stateNode,s=e.memoizedProps,r[on]=e,(a=r.nodeValue!==s)&&(t=As,t!==null))switch(t.tag){case 3:oc(r.nodeValue,s,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&oc(r.nodeValue,s,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[on]=e,e.stateNode=r}return Kt(e),null;case 13:if(lt(ut),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(dt&&Ss!==null&&e.mode&1&&!(e.flags&128))bb(),ca(),e.flags|=98560,a=!1;else if(a=lc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(ie(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(ie(317));a[on]=e}else ca(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Kt(e),a=!1}else Qs!==null&&(Im(Qs),Qs=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ut.current&1?It===0&&(It=3):Kp())),e.updateQueue!==null&&(e.flags|=4),Kt(e),null);case 4:return ua(),bm(t,e),t===null&&$o(e.stateNode.containerInfo),Kt(e),null;case 10:return Tp(e.type._context),Kt(e),null;case 17:return xs(e.type)&&Jc(),Kt(e),null;case 19:if(lt(ut),a=e.memoizedState,a===null)return Kt(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)eo(a,!1);else{if(It!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=id(t),o!==null){for(e.flags|=128,eo(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=s,s=e.child;s!==null;)a=s,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),s=s.sibling;return rt(ut,ut.current&1|2),e.child}t=t.sibling}a.tail!==null&&wt()>ma&&(e.flags|=128,r=!0,eo(a,!1),e.lanes=4194304)}else{if(!r)if(t=id(o),t!==null){if(e.flags|=128,r=!0,s=t.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),eo(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!dt)return Kt(e),null}else 2*wt()-a.renderingStartTime>ma&&s!==1073741824&&(e.flags|=128,r=!0,eo(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(s=a.last,s!==null?s.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=wt(),e.sibling=null,s=ut.current,rt(ut,r?s&1|2:s&1),e):(Kt(e),null);case 22:case 23:return Hp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?_s&1073741824&&(Kt(e),e.subtreeFlags&6&&(e.flags|=8192)):Kt(e),null;case 24:return null;case 25:return null}throw Error(ie(156,e.tag))}function QS(t,e){switch(Ap(e),e.tag){case 1:return xs(e.type)&&Jc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ua(),lt(gs),lt(ts),Lp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Mp(e),null;case 13:if(lt(ut),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ie(340));ca()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return lt(ut),null;case 4:return ua(),null;case 10:return Tp(e.type._context),null;case 22:case 23:return Hp(),null;case 24:return null;default:return null}}var uc=!1,Jt=!1,YS=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Wi(t,e){var s=t.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){xt(t,e,r)}else s.current=null}function wm(t,e,s){try{s()}catch(r){xt(t,e,r)}}var t0=!1;function XS(t,e){if(rm=Kc,t=ob(),Sp(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{s.nodeType,a.nodeType}catch{s=null;break e}var o=0,l=-1,d=-1,u=0,h=0,m=t,g=null;t:for(;;){for(var x;m!==s||i!==0&&m.nodeType!==3||(l=o+i),m!==a||r!==0&&m.nodeType!==3||(d=o+r),m.nodeType===3&&(o+=m.nodeValue.length),(x=m.firstChild)!==null;)g=m,m=x;for(;;){if(m===t)break t;if(g===s&&++u===i&&(l=o),g===a&&++h===r&&(d=o),(x=m.nextSibling)!==null)break;m=g,g=m.parentNode}m=x}s=l===-1||d===-1?null:{start:l,end:d}}else s=null}s=s||{start:0,end:0}}else s=null;for(im={focusedElem:t,selectionRange:s},Kc=!1,ge=e;ge!==null;)if(e=ge,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ge=t;else for(;ge!==null;){e=ge;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var R=y.memoizedProps,_=y.memoizedState,T=e.stateNode,A=T.getSnapshotBeforeUpdate(e.elementType===e.type?R:Hs(e.type,R),_);T.__reactInternalSnapshotBeforeUpdate=A}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ie(163))}}catch(k){xt(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,ge=t;break}ge=e.return}return y=t0,t0=!1,y}function bo(t,e,s){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&wm(e,s,a)}i=i.next}while(i!==r)}}function Xd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&t)===t){var r=s.create;s.destroy=r()}s=s.next}while(s!==e)}}function jm(t){var e=t.ref;if(e!==null){var s=t.stateNode;switch(t.tag){case 5:t=s;break;default:t=s}typeof e=="function"?e(t):e.current=t}}function nw(t){var e=t.alternate;e!==null&&(t.alternate=null,nw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[on],delete e[zo],delete e[lm],delete e[PS],delete e[DS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function rw(t){return t.tag===5||t.tag===3||t.tag===4}function s0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||rw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Nm(t,e,s){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(t,e):s.insertBefore(t,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(t,s)):(e=s,e.appendChild(t)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Xc));else if(r!==4&&(t=t.child,t!==null))for(Nm(t,e,s),t=t.sibling;t!==null;)Nm(t,e,s),t=t.sibling}function _m(t,e,s){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(_m(t,e,s),t=t.sibling;t!==null;)_m(t,e,s),t=t.sibling}var Lt=null,Ks=!1;function sr(t,e,s){for(s=s.child;s!==null;)iw(t,e,s),s=s.sibling}function iw(t,e,s){if(cn&&typeof cn.onCommitFiberUnmount=="function")try{cn.onCommitFiberUnmount(Bd,s)}catch{}switch(s.tag){case 5:Jt||Wi(s,e);case 6:var r=Lt,i=Ks;Lt=null,sr(t,e,s),Lt=r,Ks=i,Lt!==null&&(Ks?(t=Lt,s=s.stateNode,t.nodeType===8?t.parentNode.removeChild(s):t.removeChild(s)):Lt.removeChild(s.stateNode));break;case 18:Lt!==null&&(Ks?(t=Lt,s=s.stateNode,t.nodeType===8?hh(t.parentNode,s):t.nodeType===1&&hh(t,s),Vo(t)):hh(Lt,s.stateNode));break;case 4:r=Lt,i=Ks,Lt=s.stateNode.containerInfo,Ks=!0,sr(t,e,s),Lt=r,Ks=i;break;case 0:case 11:case 14:case 15:if(!Jt&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&wm(s,e,o),i=i.next}while(i!==r)}sr(t,e,s);break;case 1:if(!Jt&&(Wi(s,e),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(l){xt(s,e,l)}sr(t,e,s);break;case 21:sr(t,e,s);break;case 22:s.mode&1?(Jt=(r=Jt)||s.memoizedState!==null,sr(t,e,s),Jt=r):sr(t,e,s);break;default:sr(t,e,s)}}function n0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var s=t.stateNode;s===null&&(s=t.stateNode=new YS),e.forEach(function(r){var i=a2.bind(null,t,r);s.has(r)||(s.add(r),r.then(i,i))})}}function Ws(t,e){var s=e.deletions;if(s!==null)for(var r=0;r<s.length;r++){var i=s[r];try{var a=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Lt=l.stateNode,Ks=!1;break e;case 3:Lt=l.stateNode.containerInfo,Ks=!0;break e;case 4:Lt=l.stateNode.containerInfo,Ks=!0;break e}l=l.return}if(Lt===null)throw Error(ie(160));iw(a,o,i),Lt=null,Ks=!1;var d=i.alternate;d!==null&&(d.return=null),i.return=null}catch(u){xt(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)aw(e,t),e=e.sibling}function aw(t,e){var s=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ws(e,t),rn(t),r&4){try{bo(3,t,t.return),Xd(3,t)}catch(R){xt(t,t.return,R)}try{bo(5,t,t.return)}catch(R){xt(t,t.return,R)}}break;case 1:Ws(e,t),rn(t),r&512&&s!==null&&Wi(s,s.return);break;case 5:if(Ws(e,t),rn(t),r&512&&s!==null&&Wi(s,s.return),t.flags&32){var i=t.stateNode;try{Po(i,"")}catch(R){xt(t,t.return,R)}}if(r&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,o=s!==null?s.memoizedProps:a,l=t.type,d=t.updateQueue;if(t.updateQueue=null,d!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&Iv(i,a),Kh(l,o);var u=Kh(l,a);for(o=0;o<d.length;o+=2){var h=d[o],m=d[o+1];h==="style"?Pv(i,m):h==="dangerouslySetInnerHTML"?Tv(i,m):h==="children"?Po(i,m):hp(i,h,m,u)}switch(l){case"input":Bh(i,a);break;case"textarea":kv(i,a);break;case"select":var g=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var x=a.value;x!=null?Qi(i,!!a.multiple,x,!1):g!==!!a.multiple&&(a.defaultValue!=null?Qi(i,!!a.multiple,a.defaultValue,!0):Qi(i,!!a.multiple,a.multiple?[]:"",!1))}i[zo]=a}catch(R){xt(t,t.return,R)}}break;case 6:if(Ws(e,t),rn(t),r&4){if(t.stateNode===null)throw Error(ie(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(R){xt(t,t.return,R)}}break;case 3:if(Ws(e,t),rn(t),r&4&&s!==null&&s.memoizedState.isDehydrated)try{Vo(e.containerInfo)}catch(R){xt(t,t.return,R)}break;case 4:Ws(e,t),rn(t);break;case 13:Ws(e,t),rn(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Gp=wt())),r&4&&n0(t);break;case 22:if(h=s!==null&&s.memoizedState!==null,t.mode&1?(Jt=(u=Jt)||h,Ws(e,t),Jt=u):Ws(e,t),rn(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(ge=t,h=t.child;h!==null;){for(m=ge=h;ge!==null;){switch(g=ge,x=g.child,g.tag){case 0:case 11:case 14:case 15:bo(4,g,g.return);break;case 1:Wi(g,g.return);var y=g.stateNode;if(typeof y.componentWillUnmount=="function"){r=g,s=g.return;try{e=r,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(R){xt(r,s,R)}}break;case 5:Wi(g,g.return);break;case 22:if(g.memoizedState!==null){i0(m);continue}}x!==null?(x.return=g,ge=x):i0(m)}h=h.sibling}e:for(h=null,m=t;;){if(m.tag===5){if(h===null){h=m;try{i=m.stateNode,u?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=m.stateNode,d=m.memoizedProps.style,o=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Rv("display",o))}catch(R){xt(t,t.return,R)}}}else if(m.tag===6){if(h===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(R){xt(t,t.return,R)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;h===m&&(h=null),m=m.return}h===m&&(h=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Ws(e,t),rn(t),r&4&&n0(t);break;case 21:break;default:Ws(e,t),rn(t)}}function rn(t){var e=t.flags;if(e&2){try{e:{for(var s=t.return;s!==null;){if(rw(s)){var r=s;break e}s=s.return}throw Error(ie(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Po(i,""),r.flags&=-33);var a=s0(t);_m(t,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,l=s0(t);Nm(t,l,o);break;default:throw Error(ie(161))}}catch(d){xt(t,t.return,d)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function JS(t,e,s){ge=t,ow(t)}function ow(t,e,s){for(var r=(t.mode&1)!==0;ge!==null;){var i=ge,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||uc;if(!o){var l=i.alternate,d=l!==null&&l.memoizedState!==null||Jt;l=uc;var u=Jt;if(uc=o,(Jt=d)&&!u)for(ge=i;ge!==null;)o=ge,d=o.child,o.tag===22&&o.memoizedState!==null?a0(i):d!==null?(d.return=o,ge=d):a0(i);for(;a!==null;)ge=a,ow(a),a=a.sibling;ge=i,uc=l,Jt=u}r0(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,ge=a):r0(t)}}function r0(t){for(;ge!==null;){var e=ge;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Jt||Xd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Jt)if(s===null)r.componentDidMount();else{var i=e.elementType===e.type?s.memoizedProps:Hs(e.type,s.memoizedProps);r.componentDidUpdate(i,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&zx(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}zx(e,o,s)}break;case 5:var l=e.stateNode;if(s===null&&e.flags&4){s=l;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&s.focus();break;case"img":d.src&&(s.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var m=h.dehydrated;m!==null&&Vo(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ie(163))}Jt||e.flags&512&&jm(e)}catch(g){xt(e,e.return,g)}}if(e===t){ge=null;break}if(s=e.sibling,s!==null){s.return=e.return,ge=s;break}ge=e.return}}function i0(t){for(;ge!==null;){var e=ge;if(e===t){ge=null;break}var s=e.sibling;if(s!==null){s.return=e.return,ge=s;break}ge=e.return}}function a0(t){for(;ge!==null;){var e=ge;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{Xd(4,e)}catch(d){xt(e,s,d)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(d){xt(e,i,d)}}var a=e.return;try{jm(e)}catch(d){xt(e,a,d)}break;case 5:var o=e.return;try{jm(e)}catch(d){xt(e,o,d)}}}catch(d){xt(e,e.return,d)}if(e===t){ge=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ge=l;break}ge=e.return}}var ZS=Math.ceil,ld=Yn.ReactCurrentDispatcher,Bp=Yn.ReactCurrentOwner,Fs=Yn.ReactCurrentBatchConfig,Ge=0,Dt=null,_t=null,$t=0,_s=0,Hi=Or(0),It=0,Ko=null,di=0,Jd=0,qp=0,wo=null,hs=null,Gp=0,ma=1/0,In=null,cd=!1,Sm=null,jr=null,hc=!1,pr=null,dd=0,jo=0,Em=null,Cc=-1,Tc=0;function ls(){return Ge&6?wt():Cc!==-1?Cc:Cc=wt()}function Nr(t){return t.mode&1?Ge&2&&$t!==0?$t&-$t:LS.transition!==null?(Tc===0&&(Tc=Gv()),Tc):(t=Ze,t!==0||(t=window.event,t=t===void 0?16:Jv(t.type)),t):1}function Js(t,e,s,r){if(50<jo)throw jo=0,Em=null,Error(ie(185));ul(t,s,r),(!(Ge&2)||t!==Dt)&&(t===Dt&&(!(Ge&2)&&(Jd|=s),It===4&&or(t,$t)),ys(t,r),s===1&&Ge===0&&!(e.mode&1)&&(ma=wt()+500,Kd&&Fr()))}function ys(t,e){var s=t.callbackNode;L_(t,e);var r=Hc(t,t===Dt?$t:0);if(r===0)s!==null&&fx(s),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(s!=null&&fx(s),e===1)t.tag===0?MS(o0.bind(null,t)):xb(o0.bind(null,t)),TS(function(){!(Ge&6)&&Fr()}),s=null;else{switch(Wv(r)){case 1:s=xp;break;case 4:s=Bv;break;case 16:s=Wc;break;case 536870912:s=qv;break;default:s=Wc}s=fw(s,lw.bind(null,t))}t.callbackPriority=e,t.callbackNode=s}}function lw(t,e){if(Cc=-1,Tc=0,Ge&6)throw Error(ie(327));var s=t.callbackNode;if(ea()&&t.callbackNode!==s)return null;var r=Hc(t,t===Dt?$t:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ud(t,r);else{e=r;var i=Ge;Ge|=2;var a=dw();(Dt!==t||$t!==e)&&(In=null,ma=wt()+500,ri(t,e));do try{s2();break}catch(l){cw(t,l)}while(!0);Cp(),ld.current=a,Ge=i,_t!==null?e=0:(Dt=null,$t=0,e=It)}if(e!==0){if(e===2&&(i=Zh(t),i!==0&&(r=i,e=Am(t,i))),e===1)throw s=Ko,ri(t,0),or(t,r),ys(t,wt()),s;if(e===6)or(t,r);else{if(i=t.current.alternate,!(r&30)&&!e2(i)&&(e=ud(t,r),e===2&&(a=Zh(t),a!==0&&(r=a,e=Am(t,a))),e===1))throw s=Ko,ri(t,0),or(t,r),ys(t,wt()),s;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(ie(345));case 2:Xr(t,hs,In);break;case 3:if(or(t,r),(r&130023424)===r&&(e=Gp+500-wt(),10<e)){if(Hc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){ls(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=om(Xr.bind(null,t,hs,In),e);break}Xr(t,hs,In);break;case 4:if(or(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Xs(r);a=1<<o,o=e[o],o>i&&(i=o),r&=~a}if(r=i,r=wt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ZS(r/1960))-r,10<r){t.timeoutHandle=om(Xr.bind(null,t,hs,In),r);break}Xr(t,hs,In);break;case 5:Xr(t,hs,In);break;default:throw Error(ie(329))}}}return ys(t,wt()),t.callbackNode===s?lw.bind(null,t):null}function Am(t,e){var s=wo;return t.current.memoizedState.isDehydrated&&(ri(t,e).flags|=256),t=ud(t,e),t!==2&&(e=hs,hs=s,e!==null&&Im(e)),t}function Im(t){hs===null?hs=t:hs.push.apply(hs,t)}function e2(t){for(var e=t;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var i=s[r],a=i.getSnapshot;i=i.value;try{if(!en(a(),i))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function or(t,e){for(e&=~qp,e&=~Jd,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var s=31-Xs(e),r=1<<s;t[s]=-1,e&=~r}}function o0(t){if(Ge&6)throw Error(ie(327));ea();var e=Hc(t,0);if(!(e&1))return ys(t,wt()),null;var s=ud(t,e);if(t.tag!==0&&s===2){var r=Zh(t);r!==0&&(e=r,s=Am(t,r))}if(s===1)throw s=Ko,ri(t,0),or(t,e),ys(t,wt()),s;if(s===6)throw Error(ie(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Xr(t,hs,In),ys(t,wt()),null}function Wp(t,e){var s=Ge;Ge|=1;try{return t(e)}finally{Ge=s,Ge===0&&(ma=wt()+500,Kd&&Fr())}}function ui(t){pr!==null&&pr.tag===0&&!(Ge&6)&&ea();var e=Ge;Ge|=1;var s=Fs.transition,r=Ze;try{if(Fs.transition=null,Ze=1,t)return t()}finally{Ze=r,Fs.transition=s,Ge=e,!(Ge&6)&&Fr()}}function Hp(){_s=Hi.current,lt(Hi)}function ri(t,e){t.finishedWork=null,t.finishedLanes=0;var s=t.timeoutHandle;if(s!==-1&&(t.timeoutHandle=-1,CS(s)),_t!==null)for(s=_t.return;s!==null;){var r=s;switch(Ap(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Jc();break;case 3:ua(),lt(gs),lt(ts),Lp();break;case 5:Mp(r);break;case 4:ua();break;case 13:lt(ut);break;case 19:lt(ut);break;case 10:Tp(r.type._context);break;case 22:case 23:Hp()}s=s.return}if(Dt=t,_t=t=_r(t.current,null),$t=_s=e,It=0,Ko=null,qp=Jd=di=0,hs=wo=null,ei!==null){for(e=0;e<ei.length;e++)if(s=ei[e],r=s.interleaved,r!==null){s.interleaved=null;var i=r.next,a=s.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}s.pending=r}ei=null}return t}function cw(t,e){do{var s=_t;try{if(Cp(),Ac.current=od,ad){for(var r=mt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ad=!1}if(ci=0,Pt=Et=mt=null,vo=!1,Go=0,Bp.current=null,s===null||s.return===null){It=1,Ko=e,_t=null;break}e:{var a=t,o=s.return,l=s,d=e;if(e=$t,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,h=l,m=h.tag;if(!(h.mode&1)&&(m===0||m===11||m===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var x=Kx(o);if(x!==null){x.flags&=-257,Qx(x,o,l,a,e),x.mode&1&&Hx(a,u,e),e=x,d=u;var y=e.updateQueue;if(y===null){var R=new Set;R.add(d),e.updateQueue=R}else y.add(d);break e}else{if(!(e&1)){Hx(a,u,e),Kp();break e}d=Error(ie(426))}}else if(dt&&l.mode&1){var _=Kx(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),Qx(_,o,l,a,e),Ip(ha(d,l));break e}}a=d=ha(d,l),It!==4&&(It=2),wo===null?wo=[a]:wo.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var T=Wb(a,d,e);Ux(a,T);break e;case 1:l=d;var A=a.type,C=a.stateNode;if(!(a.flags&128)&&(typeof A.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(jr===null||!jr.has(C)))){a.flags|=65536,e&=-e,a.lanes|=e;var k=Hb(a,l,e);Ux(a,k);break e}}a=a.return}while(a!==null)}hw(s)}catch(D){e=D,_t===s&&s!==null&&(_t=s=s.return);continue}break}while(!0)}function dw(){var t=ld.current;return ld.current=od,t===null?od:t}function Kp(){(It===0||It===3||It===2)&&(It=4),Dt===null||!(di&268435455)&&!(Jd&268435455)||or(Dt,$t)}function ud(t,e){var s=Ge;Ge|=2;var r=dw();(Dt!==t||$t!==e)&&(In=null,ri(t,e));do try{t2();break}catch(i){cw(t,i)}while(!0);if(Cp(),Ge=s,ld.current=r,_t!==null)throw Error(ie(261));return Dt=null,$t=0,It}function t2(){for(;_t!==null;)uw(_t)}function s2(){for(;_t!==null&&!A_();)uw(_t)}function uw(t){var e=pw(t.alternate,t,_s);t.memoizedProps=t.pendingProps,e===null?hw(t):_t=e,Bp.current=null}function hw(t){var e=t;do{var s=e.alternate;if(t=e.return,e.flags&32768){if(s=QS(s,e),s!==null){s.flags&=32767,_t=s;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{It=6,_t=null;return}}else if(s=KS(s,e,_s),s!==null){_t=s;return}if(e=e.sibling,e!==null){_t=e;return}_t=e=t}while(e!==null);It===0&&(It=5)}function Xr(t,e,s){var r=Ze,i=Fs.transition;try{Fs.transition=null,Ze=1,n2(t,e,s,r)}finally{Fs.transition=i,Ze=r}return null}function n2(t,e,s,r){do ea();while(pr!==null);if(Ge&6)throw Error(ie(327));s=t.finishedWork;var i=t.finishedLanes;if(s===null)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(ie(177));t.callbackNode=null,t.callbackPriority=0;var a=s.lanes|s.childLanes;if(V_(t,a),t===Dt&&(_t=Dt=null,$t=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||hc||(hc=!0,fw(Wc,function(){return ea(),null})),a=(s.flags&15990)!==0,s.subtreeFlags&15990||a){a=Fs.transition,Fs.transition=null;var o=Ze;Ze=1;var l=Ge;Ge|=4,Bp.current=null,XS(t,s),aw(s,t),NS(im),Kc=!!rm,im=rm=null,t.current=s,JS(s),I_(),Ge=l,Ze=o,Fs.transition=a}else t.current=s;if(hc&&(hc=!1,pr=t,dd=i),a=t.pendingLanes,a===0&&(jr=null),T_(s.stateNode),ys(t,wt()),e!==null)for(r=t.onRecoverableError,s=0;s<e.length;s++)i=e[s],r(i.value,{componentStack:i.stack,digest:i.digest});if(cd)throw cd=!1,t=Sm,Sm=null,t;return dd&1&&t.tag!==0&&ea(),a=t.pendingLanes,a&1?t===Em?jo++:(jo=0,Em=t):jo=0,Fr(),null}function ea(){if(pr!==null){var t=Wv(dd),e=Fs.transition,s=Ze;try{if(Fs.transition=null,Ze=16>t?16:t,pr===null)var r=!1;else{if(t=pr,pr=null,dd=0,Ge&6)throw Error(ie(331));var i=Ge;for(Ge|=4,ge=t.current;ge!==null;){var a=ge,o=a.child;if(ge.flags&16){var l=a.deletions;if(l!==null){for(var d=0;d<l.length;d++){var u=l[d];for(ge=u;ge!==null;){var h=ge;switch(h.tag){case 0:case 11:case 15:bo(8,h,a)}var m=h.child;if(m!==null)m.return=h,ge=m;else for(;ge!==null;){h=ge;var g=h.sibling,x=h.return;if(nw(h),h===u){ge=null;break}if(g!==null){g.return=x,ge=g;break}ge=x}}}var y=a.alternate;if(y!==null){var R=y.child;if(R!==null){y.child=null;do{var _=R.sibling;R.sibling=null,R=_}while(R!==null)}}ge=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,ge=o;else e:for(;ge!==null;){if(a=ge,a.flags&2048)switch(a.tag){case 0:case 11:case 15:bo(9,a,a.return)}var T=a.sibling;if(T!==null){T.return=a.return,ge=T;break e}ge=a.return}}var A=t.current;for(ge=A;ge!==null;){o=ge;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,ge=C;else e:for(o=A;ge!==null;){if(l=ge,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Xd(9,l)}}catch(D){xt(l,l.return,D)}if(l===o){ge=null;break e}var k=l.sibling;if(k!==null){k.return=l.return,ge=k;break e}ge=l.return}}if(Ge=i,Fr(),cn&&typeof cn.onPostCommitFiberRoot=="function")try{cn.onPostCommitFiberRoot(Bd,t)}catch{}r=!0}return r}finally{Ze=s,Fs.transition=e}}return!1}function l0(t,e,s){e=ha(s,e),e=Wb(t,e,1),t=wr(t,e,1),e=ls(),t!==null&&(ul(t,1,e),ys(t,e))}function xt(t,e,s){if(t.tag===3)l0(t,t,s);else for(;e!==null;){if(e.tag===3){l0(e,t,s);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(jr===null||!jr.has(r))){t=ha(s,t),t=Hb(e,t,1),e=wr(e,t,1),t=ls(),e!==null&&(ul(e,1,t),ys(e,t));break}}e=e.return}}function r2(t,e,s){var r=t.pingCache;r!==null&&r.delete(e),e=ls(),t.pingedLanes|=t.suspendedLanes&s,Dt===t&&($t&s)===s&&(It===4||It===3&&($t&130023424)===$t&&500>wt()-Gp?ri(t,0):qp|=s),ys(t,e)}function mw(t,e){e===0&&(t.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var s=ls();t=$n(t,e),t!==null&&(ul(t,e,s),ys(t,s))}function i2(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),mw(t,s)}function a2(t,e){var s=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(s=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ie(314))}r!==null&&r.delete(e),mw(t,s)}var pw;pw=function(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps||gs.current)fs=!0;else{if(!(t.lanes&s)&&!(e.flags&128))return fs=!1,HS(t,e,s);fs=!!(t.flags&131072)}else fs=!1,dt&&e.flags&1048576&&yb(e,td,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;kc(t,e),t=e.pendingProps;var i=la(e,ts.current);Zi(e,s),i=Op(null,e,r,t,i,s);var a=Fp();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,xs(r)?(a=!0,Zc(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Pp(e),i.updater=Yd,e.stateNode=i,i._reactInternals=e,pm(e,r,t,s),e=xm(null,e,r,!0,a,s)):(e.tag=0,dt&&a&&Ep(e),rs(null,e,i,s),e=e.child),e;case 16:r=e.elementType;e:{switch(kc(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=l2(r),t=Hs(r,t),i){case 0:e=gm(null,e,r,t,s);break e;case 1:e=Jx(null,e,r,t,s);break e;case 11:e=Yx(null,e,r,t,s);break e;case 14:e=Xx(null,e,r,Hs(r.type,t),s);break e}throw Error(ie(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Hs(r,i),gm(t,e,r,i,s);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Hs(r,i),Jx(t,e,r,i,s);case 3:e:{if(Xb(e),t===null)throw Error(ie(387));r=e.pendingProps,a=e.memoizedState,i=a.element,_b(t,e),rd(e,r,null,s);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=ha(Error(ie(423)),e),e=Zx(t,e,r,s,i);break e}else if(r!==i){i=ha(Error(ie(424)),e),e=Zx(t,e,r,s,i);break e}else for(Ss=br(e.stateNode.containerInfo.firstChild),As=e,dt=!0,Qs=null,s=jb(e,null,r,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ca(),r===i){e=Un(t,e,s);break e}rs(t,e,r,s)}e=e.child}return e;case 5:return Sb(e),t===null&&um(e),r=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,o=i.children,am(r,i)?o=null:a!==null&&am(r,a)&&(e.flags|=32),Yb(t,e),rs(t,e,o,s),e.child;case 6:return t===null&&um(e),null;case 13:return Jb(t,e,s);case 4:return Dp(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=da(e,null,r,s):rs(t,e,r,s),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Hs(r,i),Yx(t,e,r,i,s);case 7:return rs(t,e,e.pendingProps,s),e.child;case 8:return rs(t,e,e.pendingProps.children,s),e.child;case 12:return rs(t,e,e.pendingProps.children,s),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,rt(sd,r._currentValue),r._currentValue=o,a!==null)if(en(a.value,o)){if(a.children===i.children&&!gs.current){e=Un(t,e,s);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var d=l.firstContext;d!==null;){if(d.context===r){if(a.tag===1){d=Mn(-1,s&-s),d.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?d.next=d:(d.next=h.next,h.next=d),u.pending=d}}a.lanes|=s,d=a.alternate,d!==null&&(d.lanes|=s),hm(a.return,s,e),l.lanes|=s;break}d=d.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(ie(341));o.lanes|=s,l=o.alternate,l!==null&&(l.lanes|=s),hm(o,s,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}rs(t,e,i.children,s),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Zi(e,s),i=Us(i),r=r(i),e.flags|=1,rs(t,e,r,s),e.child;case 14:return r=e.type,i=Hs(r,e.pendingProps),i=Hs(r.type,i),Xx(t,e,r,i,s);case 15:return Kb(t,e,e.type,e.pendingProps,s);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Hs(r,i),kc(t,e),e.tag=1,xs(r)?(t=!0,Zc(e)):t=!1,Zi(e,s),Gb(e,r,i),pm(e,r,i,s),xm(null,e,r,!0,t,s);case 19:return Zb(t,e,s);case 22:return Qb(t,e,s)}throw Error(ie(156,e.tag))};function fw(t,e){return zv(t,e)}function o2(t,e,s,r){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Os(t,e,s,r){return new o2(t,e,s,r)}function Qp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function l2(t){if(typeof t=="function")return Qp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===pp)return 11;if(t===fp)return 14}return 2}function _r(t,e){var s=t.alternate;return s===null?(s=Os(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&14680064,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s}function Rc(t,e,s,r,i,a){var o=2;if(r=t,typeof t=="function")Qp(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Vi:return ii(s.children,i,a,e);case mp:o=8,i|=8;break;case Oh:return t=Os(12,s,e,i|2),t.elementType=Oh,t.lanes=a,t;case Fh:return t=Os(13,s,e,i),t.elementType=Fh,t.lanes=a,t;case $h:return t=Os(19,s,e,i),t.elementType=$h,t.lanes=a,t;case Sv:return Zd(s,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Nv:o=10;break e;case _v:o=9;break e;case pp:o=11;break e;case fp:o=14;break e;case rr:o=16,r=null;break e}throw Error(ie(130,t==null?t:typeof t,""))}return e=Os(o,s,e,i),e.elementType=t,e.type=r,e.lanes=a,e}function ii(t,e,s,r){return t=Os(7,t,r,e),t.lanes=s,t}function Zd(t,e,s,r){return t=Os(22,t,r,e),t.elementType=Sv,t.lanes=s,t.stateNode={isHidden:!1},t}function bh(t,e,s){return t=Os(6,t,null,e),t.lanes=s,t}function wh(t,e,s){return e=Os(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function c2(t,e,s,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=th(0),this.expirationTimes=th(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=th(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Yp(t,e,s,r,i,a,o,l,d){return t=new c2(t,e,s,l,d),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Os(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pp(a),t}function d2(t,e,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Li,key:r==null?null:""+r,children:t,containerInfo:e,implementation:s}}function gw(t){if(!t)return Rr;t=t._reactInternals;e:{if(wi(t)!==t||t.tag!==1)throw Error(ie(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(xs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ie(171))}if(t.tag===1){var s=t.type;if(xs(s))return gb(t,s,e)}return e}function xw(t,e,s,r,i,a,o,l,d){return t=Yp(s,r,!0,t,i,a,o,l,d),t.context=gw(null),s=t.current,r=ls(),i=Nr(s),a=Mn(r,i),a.callback=e??null,wr(s,a,i),t.current.lanes=i,ul(t,i,r),ys(t,r),t}function eu(t,e,s,r){var i=e.current,a=ls(),o=Nr(i);return s=gw(s),e.context===null?e.context=s:e.pendingContext=s,e=Mn(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=wr(i,e,o),t!==null&&(Js(t,i,o,a),Ec(t,i,o)),o}function hd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function c0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function Xp(t,e){c0(t,e),(t=t.alternate)&&c0(t,e)}function u2(){return null}var yw=typeof reportError=="function"?reportError:function(t){console.error(t)};function Jp(t){this._internalRoot=t}tu.prototype.render=Jp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ie(409));eu(t,e,null,null)};tu.prototype.unmount=Jp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ui(function(){eu(null,t,null,null)}),e[Fn]=null}};function tu(t){this._internalRoot=t}tu.prototype.unstable_scheduleHydration=function(t){if(t){var e=Qv();t={blockedOn:null,target:t,priority:e};for(var s=0;s<ar.length&&e!==0&&e<ar[s].priority;s++);ar.splice(s,0,t),s===0&&Xv(t)}};function Zp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function su(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function d0(){}function h2(t,e,s,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var u=hd(o);a.call(u)}}var o=xw(e,r,t,0,null,!1,!1,"",d0);return t._reactRootContainer=o,t[Fn]=o.current,$o(t.nodeType===8?t.parentNode:t),ui(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var l=r;r=function(){var u=hd(d);l.call(u)}}var d=Yp(t,0,!1,null,null,!1,!1,"",d0);return t._reactRootContainer=d,t[Fn]=d.current,$o(t.nodeType===8?t.parentNode:t),ui(function(){eu(e,d,s,r)}),d}function nu(t,e,s,r,i){var a=s._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var l=i;i=function(){var d=hd(o);l.call(d)}}eu(e,o,t,i)}else o=h2(s,e,t,i,r);return hd(o)}Hv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var s=io(e.pendingLanes);s!==0&&(yp(e,s|1),ys(e,wt()),!(Ge&6)&&(ma=wt()+500,Fr()))}break;case 13:ui(function(){var r=$n(t,1);if(r!==null){var i=ls();Js(r,t,1,i)}}),Xp(t,1)}};vp=function(t){if(t.tag===13){var e=$n(t,134217728);if(e!==null){var s=ls();Js(e,t,134217728,s)}Xp(t,134217728)}};Kv=function(t){if(t.tag===13){var e=Nr(t),s=$n(t,e);if(s!==null){var r=ls();Js(s,t,e,r)}Xp(t,e)}};Qv=function(){return Ze};Yv=function(t,e){var s=Ze;try{return Ze=t,e()}finally{Ze=s}};Yh=function(t,e,s){switch(e){case"input":if(Bh(t,s),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var r=s[e];if(r!==t&&r.form===t.form){var i=Hd(r);if(!i)throw Error(ie(90));Av(r),Bh(r,i)}}}break;case"textarea":kv(t,s);break;case"select":e=s.value,e!=null&&Qi(t,!!s.multiple,e,!1)}};Lv=Wp;Vv=ui;var m2={usingClientEntryPoint:!1,Events:[ml,Ui,Hd,Dv,Mv,Wp]},to={findFiberByHostInstance:Zr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},p2={bundleType:to.bundleType,version:to.version,rendererPackageName:to.rendererPackageName,rendererConfig:to.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$v(t),t===null?null:t.stateNode},findFiberByHostInstance:to.findFiberByHostInstance||u2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mc.isDisabled&&mc.supportsFiber)try{Bd=mc.inject(p2),cn=mc}catch{}}Ds.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=m2;Ds.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zp(e))throw Error(ie(200));return d2(t,e,null,s)};Ds.createRoot=function(t,e){if(!Zp(t))throw Error(ie(299));var s=!1,r="",i=yw;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Yp(t,1,!1,null,null,s,!1,r,i),t[Fn]=e.current,$o(t.nodeType===8?t.parentNode:t),new Jp(e)};Ds.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ie(188)):(t=Object.keys(t).join(","),Error(ie(268,t)));return t=$v(e),t=t===null?null:t.stateNode,t};Ds.flushSync=function(t){return ui(t)};Ds.hydrate=function(t,e,s){if(!su(e))throw Error(ie(200));return nu(null,t,e,!0,s)};Ds.hydrateRoot=function(t,e,s){if(!Zp(t))throw Error(ie(405));var r=s!=null&&s.hydratedSources||null,i=!1,a="",o=yw;if(s!=null&&(s.unstable_strictMode===!0&&(i=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(o=s.onRecoverableError)),e=xw(e,null,t,1,s??null,i,!1,a,o),t[Fn]=e.current,$o(t),r)for(t=0;t<r.length;t++)s=r[t],i=s._getVersion,i=i(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,i]:e.mutableSourceEagerHydrationData.push(s,i);return new tu(e)};Ds.render=function(t,e,s){if(!su(e))throw Error(ie(200));return nu(null,t,e,!1,s)};Ds.unmountComponentAtNode=function(t){if(!su(t))throw Error(ie(40));return t._reactRootContainer?(ui(function(){nu(null,null,t,!1,function(){t._reactRootContainer=null,t[Fn]=null})}),!0):!1};Ds.unstable_batchedUpdates=Wp;Ds.unstable_renderSubtreeIntoContainer=function(t,e,s,r){if(!su(s))throw Error(ie(200));if(t==null||t._reactInternals===void 0)throw Error(ie(38));return nu(t,e,s,!1,r)};Ds.version="18.3.1-next-f1338f8080-20240426";function vw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vw)}catch(t){console.error(t)}}vw(),vv.exports=Ds;var f2=vv.exports,bw,u0=f2;bw=u0.createRoot,u0.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qo(){return Qo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Qo.apply(this,arguments)}var fr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(fr||(fr={}));const h0="popstate";function g2(t){t===void 0&&(t={});function e(r,i){let{pathname:a,search:o,hash:l}=r.location;return km("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(r,i){return typeof i=="string"?i:md(i)}return y2(e,s,null,t)}function jt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function ww(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function x2(){return Math.random().toString(36).substr(2,8)}function m0(t,e){return{usr:t.state,key:t.key,idx:e}}function km(t,e,s,r){return s===void 0&&(s=null),Qo({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ka(e):e,{state:s,key:e&&e.key||r||x2()})}function md(t){let{pathname:e="/",search:s="",hash:r=""}=t;return s&&s!=="?"&&(e+=s.charAt(0)==="?"?s:"?"+s),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ka(t){let e={};if(t){let s=t.indexOf("#");s>=0&&(e.hash=t.substr(s),t=t.substr(0,s));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function y2(t,e,s,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,l=fr.Pop,d=null,u=h();u==null&&(u=0,o.replaceState(Qo({},o.state,{idx:u}),""));function h(){return(o.state||{idx:null}).idx}function m(){l=fr.Pop;let _=h(),T=_==null?null:_-u;u=_,d&&d({action:l,location:R.location,delta:T})}function g(_,T){l=fr.Push;let A=km(R.location,_,T);u=h()+1;let C=m0(A,u),k=R.createHref(A);try{o.pushState(C,"",k)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;i.location.assign(k)}a&&d&&d({action:l,location:R.location,delta:1})}function x(_,T){l=fr.Replace;let A=km(R.location,_,T);u=h();let C=m0(A,u),k=R.createHref(A);o.replaceState(C,"",k),a&&d&&d({action:l,location:R.location,delta:0})}function y(_){let T=i.location.origin!=="null"?i.location.origin:i.location.href,A=typeof _=="string"?_:md(_);return A=A.replace(/ $/,"%20"),jt(T,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,T)}let R={get action(){return l},get location(){return t(i,o)},listen(_){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(h0,m),d=_,()=>{i.removeEventListener(h0,m),d=null}},createHref(_){return e(i,_)},createURL:y,encodeLocation(_){let T=y(_);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:g,replace:x,go(_){return o.go(_)}};return R}var p0;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(p0||(p0={}));function v2(t,e,s){return s===void 0&&(s="/"),b2(t,e,s,!1)}function b2(t,e,s,r){let i=typeof e=="string"?ka(e):e,a=ef(i.pathname||"/",s);if(a==null)return null;let o=jw(t);w2(o);let l=null;for(let d=0;l==null&&d<o.length;++d){let u=R2(a);l=C2(o[d],u,r)}return l}function jw(t,e,s,r){e===void 0&&(e=[]),s===void 0&&(s=[]),r===void 0&&(r="");let i=(a,o,l)=>{let d={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};d.relativePath.startsWith("/")&&(jt(d.relativePath.startsWith(r),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(r.length));let u=Sr([r,d.relativePath]),h=s.concat(d);a.children&&a.children.length>0&&(jt(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),jw(a.children,e,h,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:I2(u,a.index),routesMeta:h})};return t.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let d of Nw(a.path))i(a,o,d)}),e}function Nw(t){let e=t.split("/");if(e.length===0)return[];let[s,...r]=e,i=s.endsWith("?"),a=s.replace(/\?$/,"");if(r.length===0)return i?[a,""]:[a];let o=Nw(r.join("/")),l=[];return l.push(...o.map(d=>d===""?a:[a,d].join("/"))),i&&l.push(...o),l.map(d=>t.startsWith("/")&&d===""?"/":d)}function w2(t){t.sort((e,s)=>e.score!==s.score?s.score-e.score:k2(e.routesMeta.map(r=>r.childrenIndex),s.routesMeta.map(r=>r.childrenIndex)))}const j2=/^:[\w-]+$/,N2=3,_2=2,S2=1,E2=10,A2=-2,f0=t=>t==="*";function I2(t,e){let s=t.split("/"),r=s.length;return s.some(f0)&&(r+=A2),e&&(r+=_2),s.filter(i=>!f0(i)).reduce((i,a)=>i+(j2.test(a)?N2:a===""?S2:E2),r)}function k2(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function C2(t,e,s){let{routesMeta:r}=t,i={},a="/",o=[];for(let l=0;l<r.length;++l){let d=r[l],u=l===r.length-1,h=a==="/"?e:e.slice(a.length)||"/",m=g0({path:d.relativePath,caseSensitive:d.caseSensitive,end:u},h),g=d.route;if(!m&&u&&s&&!r[r.length-1].route.index&&(m=g0({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},h)),!m)return null;Object.assign(i,m.params),o.push({params:i,pathname:Sr([a,m.pathname]),pathnameBase:L2(Sr([a,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(a=Sr([a,m.pathnameBase]))}return o}function g0(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[s,r]=T2(t.path,t.caseSensitive,t.end),i=e.match(s);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((u,h,m)=>{let{paramName:g,isOptional:x}=h;if(g==="*"){let R=l[m]||"";o=a.slice(0,a.length-R.length).replace(/(.)\/+$/,"$1")}const y=l[m];return x&&!y?u[g]=void 0:u[g]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:o,pattern:t}}function T2(t,e,s){e===void 0&&(e=!1),s===void 0&&(s=!0),ww(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,d)=>(r.push({paramName:l,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function R2(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ww(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function ef(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,r=t.charAt(s);return r&&r!=="/"?null:t.slice(s)||"/"}function P2(t,e){e===void 0&&(e="/");let{pathname:s,search:r="",hash:i=""}=typeof t=="string"?ka(t):t;return{pathname:s?s.startsWith("/")?s:D2(s,e):e,search:V2(r),hash:O2(i)}}function D2(t,e){let s=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function jh(t,e,s,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function M2(t){return t.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function tf(t,e){let s=M2(t);return e?s.map((r,i)=>i===s.length-1?r.pathname:r.pathnameBase):s.map(r=>r.pathnameBase)}function sf(t,e,s,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=ka(t):(i=Qo({},t),jt(!i.pathname||!i.pathname.includes("?"),jh("?","pathname","search",i)),jt(!i.pathname||!i.pathname.includes("#"),jh("#","pathname","hash",i)),jt(!i.search||!i.search.includes("#"),jh("#","search","hash",i)));let a=t===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=s;else{let m=e.length-1;if(!r&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),m-=1;i.pathname=g.join("/")}l=m>=0?e[m]:"/"}let d=P2(i,l),u=o&&o!=="/"&&o.endsWith("/"),h=(a||o===".")&&s.endsWith("/");return!d.pathname.endsWith("/")&&(u||h)&&(d.pathname+="/"),d}const Sr=t=>t.join("/").replace(/\/\/+/g,"/"),L2=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),V2=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,O2=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function F2(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const _w=["post","put","patch","delete"];new Set(_w);const $2=["get",..._w];new Set($2);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Yo(){return Yo=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Yo.apply(this,arguments)}const nf=I.createContext(null),U2=I.createContext(null),$r=I.createContext(null),ru=I.createContext(null),Ur=I.createContext({outlet:null,matches:[],isDataRoute:!1}),Sw=I.createContext(null);function z2(t,e){let{relative:s}=e===void 0?{}:e;Ca()||jt(!1);let{basename:r,navigator:i}=I.useContext($r),{hash:a,pathname:o,search:l}=Aw(t,{relative:s}),d=o;return r!=="/"&&(d=o==="/"?r:Sr([r,o])),i.createHref({pathname:d,search:l,hash:a})}function Ca(){return I.useContext(ru)!=null}function ji(){return Ca()||jt(!1),I.useContext(ru).location}function Ew(t){I.useContext($r).static||I.useLayoutEffect(t)}function fl(){let{isDataRoute:t}=I.useContext(Ur);return t?tE():B2()}function B2(){Ca()||jt(!1);let t=I.useContext(nf),{basename:e,future:s,navigator:r}=I.useContext($r),{matches:i}=I.useContext(Ur),{pathname:a}=ji(),o=JSON.stringify(tf(i,s.v7_relativeSplatPath)),l=I.useRef(!1);return Ew(()=>{l.current=!0}),I.useCallback(function(u,h){if(h===void 0&&(h={}),!l.current)return;if(typeof u=="number"){r.go(u);return}let m=sf(u,JSON.parse(o),a,h.relative==="path");t==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:Sr([e,m.pathname])),(h.replace?r.replace:r.push)(m,h.state,h)},[e,r,o,a,t])}function Aw(t,e){let{relative:s}=e===void 0?{}:e,{future:r}=I.useContext($r),{matches:i}=I.useContext(Ur),{pathname:a}=ji(),o=JSON.stringify(tf(i,r.v7_relativeSplatPath));return I.useMemo(()=>sf(t,JSON.parse(o),a,s==="path"),[t,o,a,s])}function q2(t,e){return G2(t,e)}function G2(t,e,s,r){Ca()||jt(!1);let{navigator:i}=I.useContext($r),{matches:a}=I.useContext(Ur),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let d=o?o.pathnameBase:"/";o&&o.route;let u=ji(),h;if(e){var m;let _=typeof e=="string"?ka(e):e;d==="/"||(m=_.pathname)!=null&&m.startsWith(d)||jt(!1),h=_}else h=u;let g=h.pathname||"/",x=g;if(d!=="/"){let _=d.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(_.length).join("/")}let y=v2(t,{pathname:x}),R=Y2(y&&y.map(_=>Object.assign({},_,{params:Object.assign({},l,_.params),pathname:Sr([d,i.encodeLocation?i.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?d:Sr([d,i.encodeLocation?i.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),a,s,r);return e&&R?I.createElement(ru.Provider,{value:{location:Yo({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:fr.Pop}},R):R}function W2(){let t=eE(),e=F2(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),s=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return I.createElement(I.Fragment,null,I.createElement("h2",null,"Unexpected Application Error!"),I.createElement("h3",{style:{fontStyle:"italic"}},e),s?I.createElement("pre",{style:i},s):null,null)}const H2=I.createElement(W2,null);class K2 extends I.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,s){return s.location!==e.location||s.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:s.error,location:s.location,revalidation:e.revalidation||s.revalidation}}componentDidCatch(e,s){console.error("React Router caught the following error during render",e,s)}render(){return this.state.error!==void 0?I.createElement(Ur.Provider,{value:this.props.routeContext},I.createElement(Sw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Q2(t){let{routeContext:e,match:s,children:r}=t,i=I.useContext(nf);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),I.createElement(Ur.Provider,{value:e},r)}function Y2(t,e,s,r){var i;if(e===void 0&&(e=[]),s===void 0&&(s=null),r===void 0&&(r=null),t==null){var a;if(!s)return null;if(s.errors)t=s.matches;else if((a=r)!=null&&a.v7_partialHydration&&e.length===0&&!s.initialized&&s.matches.length>0)t=s.matches;else return null}let o=t,l=(i=s)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(m=>m.route.id&&(l==null?void 0:l[m.route.id])!==void 0);h>=0||jt(!1),o=o.slice(0,Math.min(o.length,h+1))}let d=!1,u=-1;if(s&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let m=o[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(u=h),m.route.id){let{loaderData:g,errors:x}=s,y=m.route.loader&&g[m.route.id]===void 0&&(!x||x[m.route.id]===void 0);if(m.route.lazy||y){d=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((h,m,g)=>{let x,y=!1,R=null,_=null;s&&(x=l&&m.route.id?l[m.route.id]:void 0,R=m.route.errorElement||H2,d&&(u<0&&g===0?(y=!0,_=null):u===g&&(y=!0,_=m.route.hydrateFallbackElement||null)));let T=e.concat(o.slice(0,g+1)),A=()=>{let C;return x?C=R:y?C=_:m.route.Component?C=I.createElement(m.route.Component,null):m.route.element?C=m.route.element:C=h,I.createElement(Q2,{match:m,routeContext:{outlet:h,matches:T,isDataRoute:s!=null},children:C})};return s&&(m.route.ErrorBoundary||m.route.errorElement||g===0)?I.createElement(K2,{location:s.location,revalidation:s.revalidation,component:R,error:x,children:A(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):A()},null)}var Iw=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Iw||{}),pd=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(pd||{});function X2(t){let e=I.useContext(nf);return e||jt(!1),e}function J2(t){let e=I.useContext(U2);return e||jt(!1),e}function Z2(t){let e=I.useContext(Ur);return e||jt(!1),e}function kw(t){let e=Z2(),s=e.matches[e.matches.length-1];return s.route.id||jt(!1),s.route.id}function eE(){var t;let e=I.useContext(Sw),s=J2(pd.UseRouteError),r=kw(pd.UseRouteError);return e!==void 0?e:(t=s.errors)==null?void 0:t[r]}function tE(){let{router:t}=X2(Iw.UseNavigateStable),e=kw(pd.UseNavigateStable),s=I.useRef(!1);return Ew(()=>{s.current=!0}),I.useCallback(function(i,a){a===void 0&&(a={}),s.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Yo({fromRouteId:e},a)))},[t,e])}function sE(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Cw(t){let{to:e,replace:s,state:r,relative:i}=t;Ca()||jt(!1);let{future:a,static:o}=I.useContext($r),{matches:l}=I.useContext(Ur),{pathname:d}=ji(),u=fl(),h=sf(e,tf(l,a.v7_relativeSplatPath),d,i==="path"),m=JSON.stringify(h);return I.useEffect(()=>u(JSON.parse(m),{replace:s,state:r,relative:i}),[u,m,i,s,r]),null}function Yt(t){jt(!1)}function nE(t){let{basename:e="/",children:s=null,location:r,navigationType:i=fr.Pop,navigator:a,static:o=!1,future:l}=t;Ca()&&jt(!1);let d=e.replace(/^\/*/,"/"),u=I.useMemo(()=>({basename:d,navigator:a,static:o,future:Yo({v7_relativeSplatPath:!1},l)}),[d,l,a,o]);typeof r=="string"&&(r=ka(r));let{pathname:h="/",search:m="",hash:g="",state:x=null,key:y="default"}=r,R=I.useMemo(()=>{let _=ef(h,d);return _==null?null:{location:{pathname:_,search:m,hash:g,state:x,key:y},navigationType:i}},[d,h,m,g,x,y,i]);return R==null?null:I.createElement($r.Provider,{value:u},I.createElement(ru.Provider,{children:s,value:R}))}function rE(t){let{children:e,location:s}=t;return q2(Cm(e),s)}new Promise(()=>{});function Cm(t,e){e===void 0&&(e=[]);let s=[];return I.Children.forEach(t,(r,i)=>{if(!I.isValidElement(r))return;let a=[...e,i];if(r.type===I.Fragment){s.push.apply(s,Cm(r.props.children,a));return}r.type!==Yt&&jt(!1),!r.props.index||!r.props.children||jt(!1);let o={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Cm(r.props.children,a)),s.push(o)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tm(){return Tm=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},Tm.apply(this,arguments)}function iE(t,e){if(t==null)return{};var s={},r=Object.keys(t),i,a;for(a=0;a<r.length;a++)i=r[a],!(e.indexOf(i)>=0)&&(s[i]=t[i]);return s}function aE(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function oE(t,e){return t.button===0&&(!e||e==="_self")&&!aE(t)}const lE=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],cE="6";try{window.__reactRouterVersion=cE}catch{}const dE="startTransition",x0=r_[dE];function uE(t){let{basename:e,children:s,future:r,window:i}=t,a=I.useRef();a.current==null&&(a.current=g2({window:i,v5Compat:!0}));let o=a.current,[l,d]=I.useState({action:o.action,location:o.location}),{v7_startTransition:u}=r||{},h=I.useCallback(m=>{u&&x0?x0(()=>d(m)):d(m)},[d,u]);return I.useLayoutEffect(()=>o.listen(h),[o,h]),I.useEffect(()=>sE(r),[r]),I.createElement(nE,{basename:e,children:s,location:l.location,navigationType:l.action,navigator:o,future:r})}const hE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",mE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,y0=I.forwardRef(function(e,s){let{onClick:r,relative:i,reloadDocument:a,replace:o,state:l,target:d,to:u,preventScrollReset:h,viewTransition:m}=e,g=iE(e,lE),{basename:x}=I.useContext($r),y,R=!1;if(typeof u=="string"&&mE.test(u)&&(y=u,hE))try{let C=new URL(window.location.href),k=u.startsWith("//")?new URL(C.protocol+u):new URL(u),D=ef(k.pathname,x);k.origin===C.origin&&D!=null?u=D+k.search+k.hash:R=!0}catch{}let _=z2(u,{relative:i}),T=pE(u,{replace:o,state:l,target:d,preventScrollReset:h,relative:i,viewTransition:m});function A(C){r&&r(C),C.defaultPrevented||T(C)}return I.createElement("a",Tm({},g,{href:y||_,onClick:R||a?r:A,ref:s,target:d}))});var v0;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(v0||(v0={}));var b0;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(b0||(b0={}));function pE(t,e){let{target:s,replace:r,state:i,preventScrollReset:a,relative:o,viewTransition:l}=e===void 0?{}:e,d=fl(),u=ji(),h=Aw(t,{relative:o});return I.useCallback(m=>{if(oE(m,s)){m.preventDefault();let g=r!==void 0?r:md(u)===md(h);d(t,{replace:g,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[u,d,h,r,i,s,t,a,o,l])}let fE={data:""},gE=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||fE,xE=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,yE=/\/\*[^]*?\*\/|  +/g,w0=/\n+/g,lr=(t,e)=>{let s="",r="",i="";for(let a in t){let o=t[a];a[0]=="@"?a[1]=="i"?s=a+" "+o+";":r+=a[1]=="f"?lr(o,a):a+"{"+lr(o,a[1]=="k"?"":e)+"}":typeof o=="object"?r+=lr(o,e?e.replace(/([^,])+/g,l=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,l):l?l+" "+d:d)):a):o!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=lr.p?lr.p(a,o):a+":"+o+";")}return s+(e&&i?e+"{"+i+"}":i)+r},An={},Tw=t=>{if(typeof t=="object"){let e="";for(let s in t)e+=s+Tw(t[s]);return e}return t},vE=(t,e,s,r,i)=>{let a=Tw(t),o=An[a]||(An[a]=(d=>{let u=0,h=11;for(;u<d.length;)h=101*h+d.charCodeAt(u++)>>>0;return"go"+h})(a));if(!An[o]){let d=a!==t?t:(u=>{let h,m,g=[{}];for(;h=xE.exec(u.replace(yE,""));)h[4]?g.shift():h[3]?(m=h[3].replace(w0," ").trim(),g.unshift(g[0][m]=g[0][m]||{})):g[0][h[1]]=h[2].replace(w0," ").trim();return g[0]})(t);An[o]=lr(i?{["@keyframes "+o]:d}:d,s?"":"."+o)}let l=s&&An.g?An.g:null;return s&&(An.g=An[o]),((d,u,h,m)=>{m?u.data=u.data.replace(m,d):u.data.indexOf(d)===-1&&(u.data=h?d+u.data:u.data+d)})(An[o],e,r,l),o},bE=(t,e,s)=>t.reduce((r,i,a)=>{let o=e[a];if(o&&o.call){let l=o(s),d=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=d?"."+d:l&&typeof l=="object"?l.props?"":lr(l,""):l===!1?"":l}return r+i+(o??"")},"");function iu(t){let e=this||{},s=t.call?t(e.p):t;return vE(s.unshift?s.raw?bE(s,[].slice.call(arguments,1),e.p):s.reduce((r,i)=>Object.assign(r,i&&i.call?i(e.p):i),{}):s,gE(e.target),e.g,e.o,e.k)}let Rw,Rm,Pm;iu.bind({g:1});let zn=iu.bind({k:1});function wE(t,e,s,r){lr.p=e,Rw=t,Rm=s,Pm=r}function zr(t,e){let s=this||{};return function(){let r=arguments;function i(a,o){let l=Object.assign({},a),d=l.className||i.className;s.p=Object.assign({theme:Rm&&Rm()},l),s.o=/ *go\d+/.test(d),l.className=iu.apply(s,r)+(d?" "+d:"");let u=t;return t[0]&&(u=l.as||t,delete l.as),Pm&&u[0]&&Pm(l),Rw(u,l)}return i}}var jE=t=>typeof t=="function",fd=(t,e)=>jE(t)?t(e):t,NE=(()=>{let t=0;return()=>(++t).toString()})(),Pw=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),_E=20,Dw=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,_E)};case 1:return{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case 2:let{toast:s}=e;return Dw(t,{type:t.toasts.find(a=>a.id===s.id)?1:0,toast:s});case 3:let{toastId:r}=e;return{...t,toasts:t.toasts.map(a=>a.id===r||r===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let i=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+i}))}}},Pc=[],si={toasts:[],pausedAt:void 0},Ni=t=>{si=Dw(si,t),Pc.forEach(e=>{e(si)})},SE={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},EE=(t={})=>{let[e,s]=I.useState(si),r=I.useRef(si);I.useEffect(()=>(r.current!==si&&s(si),Pc.push(s),()=>{let a=Pc.indexOf(s);a>-1&&Pc.splice(a,1)}),[]);let i=e.toasts.map(a=>{var o,l,d;return{...t,...t[a.type],...a,removeDelay:a.removeDelay||((o=t[a.type])==null?void 0:o.removeDelay)||(t==null?void 0:t.removeDelay),duration:a.duration||((l=t[a.type])==null?void 0:l.duration)||(t==null?void 0:t.duration)||SE[a.type],style:{...t.style,...(d=t[a.type])==null?void 0:d.style,...a.style}}});return{...e,toasts:i}},AE=(t,e="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...s,id:(s==null?void 0:s.id)||NE()}),gl=t=>(e,s)=>{let r=AE(e,t,s);return Ni({type:2,toast:r}),r.id},as=(t,e)=>gl("blank")(t,e);as.error=gl("error");as.success=gl("success");as.loading=gl("loading");as.custom=gl("custom");as.dismiss=t=>{Ni({type:3,toastId:t})};as.remove=t=>Ni({type:4,toastId:t});as.promise=(t,e,s)=>{let r=as.loading(e.loading,{...s,...s==null?void 0:s.loading});return typeof t=="function"&&(t=t()),t.then(i=>{let a=e.success?fd(e.success,i):void 0;return a?as.success(a,{id:r,...s,...s==null?void 0:s.success}):as.dismiss(r),i}).catch(i=>{let a=e.error?fd(e.error,i):void 0;a?as.error(a,{id:r,...s,...s==null?void 0:s.error}):as.dismiss(r)}),t};var IE=(t,e)=>{Ni({type:1,toast:{id:t,height:e}})},kE=()=>{Ni({type:5,time:Date.now()})},No=new Map,CE=1e3,TE=(t,e=CE)=>{if(No.has(t))return;let s=setTimeout(()=>{No.delete(t),Ni({type:4,toastId:t})},e);No.set(t,s)},RE=t=>{let{toasts:e,pausedAt:s}=EE(t);I.useEffect(()=>{if(s)return;let a=Date.now(),o=e.map(l=>{if(l.duration===1/0)return;let d=(l.duration||0)+l.pauseDuration-(a-l.createdAt);if(d<0){l.visible&&as.dismiss(l.id);return}return setTimeout(()=>as.dismiss(l.id),d)});return()=>{o.forEach(l=>l&&clearTimeout(l))}},[e,s]);let r=I.useCallback(()=>{s&&Ni({type:6,time:Date.now()})},[s]),i=I.useCallback((a,o)=>{let{reverseOrder:l=!1,gutter:d=8,defaultPosition:u}=o||{},h=e.filter(x=>(x.position||u)===(a.position||u)&&x.height),m=h.findIndex(x=>x.id===a.id),g=h.filter((x,y)=>y<m&&x.visible).length;return h.filter(x=>x.visible).slice(...l?[g+1]:[0,g]).reduce((x,y)=>x+(y.height||0)+d,0)},[e]);return I.useEffect(()=>{e.forEach(a=>{if(a.dismissed)TE(a.id,a.removeDelay);else{let o=No.get(a.id);o&&(clearTimeout(o),No.delete(a.id))}})},[e]),{toasts:e,handlers:{updateHeight:IE,startPause:kE,endPause:r,calculateOffset:i}}},PE=zn`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,DE=zn`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ME=zn`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,LE=zr("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${PE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${DE} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${ME} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,VE=zn`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,OE=zr("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${VE} 1s linear infinite;
`,FE=zn`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,$E=zn`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,UE=zr("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${FE} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${$E} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,zE=zr("div")`
  position: absolute;
`,BE=zr("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,qE=zn`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,GE=zr("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${qE} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,WE=({toast:t})=>{let{icon:e,type:s,iconTheme:r}=t;return e!==void 0?typeof e=="string"?I.createElement(GE,null,e):e:s==="blank"?null:I.createElement(BE,null,I.createElement(OE,{...r}),s!=="loading"&&I.createElement(zE,null,s==="error"?I.createElement(LE,{...r}):I.createElement(UE,{...r})))},HE=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,KE=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,QE="0%{opacity:0;} 100%{opacity:1;}",YE="0%{opacity:1;} 100%{opacity:0;}",XE=zr("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,JE=zr("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,ZE=(t,e)=>{let s=t.includes("top")?1:-1,[r,i]=Pw()?[QE,YE]:[HE(s),KE(s)];return{animation:e?`${zn(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${zn(i)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},eA=I.memo(({toast:t,position:e,style:s,children:r})=>{let i=t.height?ZE(t.position||e||"top-center",t.visible):{opacity:0},a=I.createElement(WE,{toast:t}),o=I.createElement(JE,{...t.ariaProps},fd(t.message,t));return I.createElement(XE,{className:t.className,style:{...i,...s,...t.style}},typeof r=="function"?r({icon:a,message:o}):I.createElement(I.Fragment,null,a,o))});wE(I.createElement);var tA=({id:t,className:e,style:s,onHeightUpdate:r,children:i})=>{let a=I.useCallback(o=>{if(o){let l=()=>{let d=o.getBoundingClientRect().height;r(t,d)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[t,r]);return I.createElement("div",{ref:a,className:e,style:s},i)},sA=(t,e)=>{let s=t.includes("top"),r=s?{top:0}:{bottom:0},i=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Pw()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(s?1:-1)}px)`,...r,...i}},nA=iu`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,pc=16,rA=({reverseOrder:t,position:e="top-center",toastOptions:s,gutter:r,children:i,containerStyle:a,containerClassName:o})=>{let{toasts:l,handlers:d}=RE(s);return I.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:pc,left:pc,right:pc,bottom:pc,pointerEvents:"none",...a},className:o,onMouseEnter:d.startPause,onMouseLeave:d.endPause},l.map(u=>{let h=u.position||e,m=d.calculateOffset(u,{reverseOrder:t,gutter:r,defaultPosition:e}),g=sA(h,m);return I.createElement(tA,{id:u.id,key:u.id,onHeightUpdate:d.updateHeight,className:u.visible?nA:"",style:g},u.type==="custom"?fd(u.message,u):i?i(u):I.createElement(eA,{toast:u,position:h}))}))},L=as;const iA={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},j0=t=>{let e;const s=new Set,r=(h,m)=>{const g=typeof h=="function"?h(e):h;if(!Object.is(g,e)){const x=e;e=m??(typeof g!="object"||g===null)?g:Object.assign({},e,g),s.forEach(y=>y(e,x))}},i=()=>e,d={setState:r,getState:i,getInitialState:()=>u,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(iA?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},u=e=t(r,i,d);return d},aA=t=>t?j0(t):j0;var Mw={exports:{}},Lw={},Vw={exports:{}},Ow={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pa=I;function oA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var lA=typeof Object.is=="function"?Object.is:oA,cA=pa.useState,dA=pa.useEffect,uA=pa.useLayoutEffect,hA=pa.useDebugValue;function mA(t,e){var s=e(),r=cA({inst:{value:s,getSnapshot:e}}),i=r[0].inst,a=r[1];return uA(function(){i.value=s,i.getSnapshot=e,Nh(i)&&a({inst:i})},[t,s,e]),dA(function(){return Nh(i)&&a({inst:i}),t(function(){Nh(i)&&a({inst:i})})},[t]),hA(s),s}function Nh(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!lA(t,s)}catch{return!0}}function pA(t,e){return e()}var fA=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?pA:mA;Ow.useSyncExternalStore=pa.useSyncExternalStore!==void 0?pa.useSyncExternalStore:fA;Vw.exports=Ow;var gA=Vw.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var au=I,xA=gA;function yA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var vA=typeof Object.is=="function"?Object.is:yA,bA=xA.useSyncExternalStore,wA=au.useRef,jA=au.useEffect,NA=au.useMemo,_A=au.useDebugValue;Lw.useSyncExternalStoreWithSelector=function(t,e,s,r,i){var a=wA(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=NA(function(){function d(x){if(!u){if(u=!0,h=x,x=r(x),i!==void 0&&o.hasValue){var y=o.value;if(i(y,x))return m=y}return m=x}if(y=m,vA(h,x))return y;var R=r(x);return i!==void 0&&i(y,R)?(h=x,y):(h=x,m=R)}var u=!1,h,m,g=s===void 0?null:s;return[function(){return d(e())},g===null?void 0:function(){return d(g())}]},[e,s,r,i]);var l=bA(t,a[0],a[1]);return jA(function(){o.hasValue=!0,o.value=l},[l]),_A(l),l};Mw.exports=Lw;var SA=Mw.exports;const EA=ov(SA),Fw={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},{useDebugValue:AA}=To,{useSyncExternalStoreWithSelector:IA}=EA;let N0=!1;const kA=t=>t;function CA(t,e=kA,s){(Fw?"production":void 0)!=="production"&&s&&!N0&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),N0=!0);const r=IA(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,s);return AA(r),r}const _0=t=>{(Fw?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?aA(t):t,s=(r,i)=>CA(e,r,i);return Object.assign(s,e),s},TA=t=>t?_0(t):_0;var S0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w=function(t){const e=[];let s=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},RA=function(t){const e=[];let s=0,r=0;for(;s<t.length;){const i=t[s++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=t[s++];e[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=t[s++],o=t[s++],l=t[s++],d=((i&7)<<18|(a&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{const a=t[s++],o=t[s++];e[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return e.join("")},Uw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const a=t[i],o=i+1<t.length,l=o?t[i+1]:0,d=i+2<t.length,u=d?t[i+2]:0,h=a>>2,m=(a&3)<<4|l>>4;let g=(l&15)<<2|u>>6,x=u&63;d||(x=64,o||(g=64)),r.push(s[h],s[m],s[g],s[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray($w(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):RA(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const a=s[t.charAt(i++)],l=i<t.length?s[t.charAt(i)]:0;++i;const u=i<t.length?s[t.charAt(i)]:64;++i;const m=i<t.length?s[t.charAt(i)]:64;if(++i,a==null||l==null||u==null||m==null)throw new PA;const g=a<<2|l>>4;if(r.push(g),u!==64){const x=l<<4&240|u>>2;if(r.push(x),m!==64){const y=u<<6&192|m;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class PA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const DA=function(t){const e=$w(t);return Uw.encodeByteArray(e,!0)},gd=function(t){return DA(t).replace(/\./g,"")},zw=function(t){try{return Uw.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=()=>MA().__FIREBASE_DEFAULTS__,VA=()=>{if(typeof process>"u"||typeof S0>"u")return;const t=S0.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},OA=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&zw(t[1]);return e&&JSON.parse(e)},ou=()=>{try{return LA()||VA()||OA()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Bw=t=>{var e,s;return(s=(e=ou())===null||e===void 0?void 0:e.emulatorHosts)===null||s===void 0?void 0:s[t]},rf=t=>{const e=Bw(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),r]:[e.substring(0,s),r]},qw=()=>{var t;return(t=ou())===null||t===void 0?void 0:t.config},Gw=t=>{var e;return(e=ou())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,r)=>{s?this.reject(s):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,a=t.sub||t.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},t);return[gd(JSON.stringify(s)),gd(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $A(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ss())}function UA(){var t;const e=(t=ou())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function zA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function BA(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function qA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function GA(){const t=ss();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function WA(){return!UA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function HA(){try{return typeof indexedDB=="object"}catch{return!1}}function KA(){return new Promise((t,e)=>{try{let s=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(s){e(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QA="FirebaseError";class jn extends Error{constructor(e,s,r){super(s),this.code=e,this.customData=r,this.name=QA,Object.setPrototypeOf(this,jn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xl.prototype.create)}}class xl{constructor(e,s,r){this.service=e,this.serviceName=s,this.errors=r}create(e,...s){const r=s[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?YA(a,r):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new jn(i,l,r)}}function YA(t,e){return t.replace(XA,(s,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const XA=/\{\$([^}]+)}/g;function JA(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xd(t,e){if(t===e)return!0;const s=Object.keys(t),r=Object.keys(e);for(const i of s){if(!r.includes(i))return!1;const a=t[i],o=e[i];if(E0(a)&&E0(o)){if(!xd(a,o))return!1}else if(a!==o)return!1}for(const i of r)if(!s.includes(i))return!1;return!0}function E0(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yl(t){const e=[];for(const[s,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function oo(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,a]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function lo(t){const e=t.indexOf("?");if(!e)return"";const s=t.indexOf("#",e);return t.substring(e,s>0?s:void 0)}function ZA(t,e){const s=new eI(t,e);return s.subscribe.bind(s)}class eI{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,r){let i;if(e===void 0&&s===void 0&&r===void 0)throw new Error("Missing Observer.");tI(e,["next","error","complete"])?i=e:i={next:e,error:s,complete:r},i.next===void 0&&(i.next=_h),i.error===void 0&&(i.error=_h),i.complete===void 0&&(i.complete=_h);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function tI(t,e){if(typeof t!="object"||t===null)return!1;for(const s of e)if(s in t&&typeof t[s]=="function")return!0;return!1}function _h(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tt(t){return t&&t._delegate?t._delegate:t}class Bn{constructor(e,s,r){this.name=e,this.instanceFactory=s,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sI{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const r=new FA;if(this.instancesDeferred.set(s,r),this.isInitialized(s)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:s});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){var s;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(s=e==null?void 0:e.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rI(e))try{this.getOrInitializeService({instanceIdentifier:Jr})}catch{}for(const[s,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(s);try{const a=this.getOrInitializeService({instanceIdentifier:i});r.resolve(a)}catch{}}}}clearInstance(e=Jr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Jr){return this.instances.has(e)}getOptions(e=Jr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:s});for(const[a,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);r===l&&o.resolve(i)}return i}onInit(e,s){var r;const i=this.normalizeInstanceIdentifier(s),a=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;a.add(e),this.onInitCallbacks.set(i,a);const o=this.instances.get(i);return o&&e(o,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,s){const r=this.onInitCallbacks.get(s);if(r)for(const i of r)try{i(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:nI(e),options:s}),this.instances.set(e,r),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Jr){return this.component?this.component.multipleInstances?e:Jr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function nI(t){return t===Jr?void 0:t}function rI(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new sI(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Oe||(Oe={}));const aI={debug:Oe.DEBUG,verbose:Oe.VERBOSE,info:Oe.INFO,warn:Oe.WARN,error:Oe.ERROR,silent:Oe.SILENT},oI=Oe.INFO,lI={[Oe.DEBUG]:"log",[Oe.VERBOSE]:"log",[Oe.INFO]:"info",[Oe.WARN]:"warn",[Oe.ERROR]:"error"},cI=(t,e,...s)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=lI[e];if(i)console[i](`[${r}]  ${t.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class af{constructor(e){this.name=e,this._logLevel=oI,this._logHandler=cI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Oe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?aI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Oe.DEBUG,...e),this._logHandler(this,Oe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Oe.VERBOSE,...e),this._logHandler(this,Oe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Oe.INFO,...e),this._logHandler(this,Oe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Oe.WARN,...e),this._logHandler(this,Oe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Oe.ERROR,...e),this._logHandler(this,Oe.ERROR,...e)}}const dI=(t,e)=>e.some(s=>t instanceof s);let A0,I0;function uI(){return A0||(A0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hI(){return I0||(I0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Hw=new WeakMap,Dm=new WeakMap,Kw=new WeakMap,Sh=new WeakMap,of=new WeakMap;function mI(t){const e=new Promise((s,r)=>{const i=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{s(Er(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",a),t.addEventListener("error",o)});return e.then(s=>{s instanceof IDBCursor&&Hw.set(s,t)}).catch(()=>{}),of.set(e,t),e}function pI(t){if(Dm.has(t))return;const e=new Promise((s,r)=>{const i=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{s(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});Dm.set(t,e)}let Mm={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return Dm.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Kw.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Er(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function fI(t){Mm=t(Mm)}function gI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const r=t.call(Eh(this),e,...s);return Kw.set(r,e.sort?e.sort():[e]),Er(r)}:hI().includes(t)?function(...e){return t.apply(Eh(this),e),Er(Hw.get(this))}:function(...e){return Er(t.apply(Eh(this),e))}}function xI(t){return typeof t=="function"?gI(t):(t instanceof IDBTransaction&&pI(t),dI(t,uI())?new Proxy(t,Mm):t)}function Er(t){if(t instanceof IDBRequest)return mI(t);if(Sh.has(t))return Sh.get(t);const e=xI(t);return e!==t&&(Sh.set(t,e),of.set(e,t)),e}const Eh=t=>of.get(t);function yI(t,e,{blocked:s,upgrade:r,blocking:i,terminated:a}={}){const o=indexedDB.open(t,e),l=Er(o);return r&&o.addEventListener("upgradeneeded",d=>{r(Er(o.result),d.oldVersion,d.newVersion,Er(o.transaction),d)}),s&&o.addEventListener("blocked",d=>s(d.oldVersion,d.newVersion,d)),l.then(d=>{a&&d.addEventListener("close",()=>a()),i&&d.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const vI=["get","getKey","getAll","getAllKeys","count"],bI=["put","add","delete","clear"],Ah=new Map;function k0(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ah.get(e))return Ah.get(e);const s=e.replace(/FromIndex$/,""),r=e!==s,i=bI.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||vI.includes(s)))return;const a=async function(o,...l){const d=this.transaction(o,i?"readwrite":"readonly");let u=d.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&d.done]))[0]};return Ah.set(e,a),a}fI(t=>({...t,get:(e,s,r)=>k0(e,s)||t.get(e,s,r),has:(e,s)=>!!k0(e,s)||t.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(jI(s)){const r=s.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(s=>s).join(" ")}}function jI(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Lm="@firebase/app",C0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn=new af("@firebase/app"),NI="@firebase/app-compat",_I="@firebase/analytics-compat",SI="@firebase/analytics",EI="@firebase/app-check-compat",AI="@firebase/app-check",II="@firebase/auth",kI="@firebase/auth-compat",CI="@firebase/database",TI="@firebase/data-connect",RI="@firebase/database-compat",PI="@firebase/functions",DI="@firebase/functions-compat",MI="@firebase/installations",LI="@firebase/installations-compat",VI="@firebase/messaging",OI="@firebase/messaging-compat",FI="@firebase/performance",$I="@firebase/performance-compat",UI="@firebase/remote-config",zI="@firebase/remote-config-compat",BI="@firebase/storage",qI="@firebase/storage-compat",GI="@firebase/firestore",WI="@firebase/vertexai-preview",HI="@firebase/firestore-compat",KI="firebase",QI="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vm="[DEFAULT]",YI={[Lm]:"fire-core",[NI]:"fire-core-compat",[SI]:"fire-analytics",[_I]:"fire-analytics-compat",[AI]:"fire-app-check",[EI]:"fire-app-check-compat",[II]:"fire-auth",[kI]:"fire-auth-compat",[CI]:"fire-rtdb",[TI]:"fire-data-connect",[RI]:"fire-rtdb-compat",[PI]:"fire-fn",[DI]:"fire-fn-compat",[MI]:"fire-iid",[LI]:"fire-iid-compat",[VI]:"fire-fcm",[OI]:"fire-fcm-compat",[FI]:"fire-perf",[$I]:"fire-perf-compat",[UI]:"fire-rc",[zI]:"fire-rc-compat",[BI]:"fire-gcs",[qI]:"fire-gcs-compat",[GI]:"fire-fst",[HI]:"fire-fst-compat",[WI]:"fire-vertex","fire-js":"fire-js",[KI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yd=new Map,XI=new Map,Om=new Map;function T0(t,e){try{t.container.addComponent(e)}catch(s){qn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,s)}}function Pr(t){const e=t.name;if(Om.has(e))return qn.debug(`There were multiple attempts to register component ${e}.`),!1;Om.set(e,t);for(const s of yd.values())T0(s,t);for(const s of XI.values())T0(s,t);return!0}function vl(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function ln(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ar=new xl("app","Firebase",JI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e,s,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Bn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ar.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i=QI;function Qw(t,e={}){let s=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Vm,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Ar.create("bad-app-name",{appName:String(i)});if(s||(s=qw()),!s)throw Ar.create("no-options");const a=yd.get(i);if(a){if(xd(s,a.options)&&xd(r,a.config))return a;throw Ar.create("duplicate-app",{appName:i})}const o=new iI(i);for(const d of Om.values())o.addComponent(d);const l=new ZI(s,r,o);return yd.set(i,l),l}function lu(t=Vm){const e=yd.get(t);if(!e&&t===Vm&&qw())return Qw();if(!e)throw Ar.create("no-app",{appName:t});return e}function $s(t,e,s){var r;let i=(r=YI[t])!==null&&r!==void 0?r:t;s&&(i+=`-${s}`);const a=i.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const l=[`Unable to register library "${i}" with version "${e}":`];a&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qn.warn(l.join(" "));return}Pr(new Bn(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek="firebase-heartbeat-database",tk=1,Xo="firebase-heartbeat-store";let Ih=null;function Yw(){return Ih||(Ih=yI(ek,tk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Xo)}catch(s){console.warn(s)}}}}).catch(t=>{throw Ar.create("idb-open",{originalErrorMessage:t.message})})),Ih}async function sk(t){try{const s=(await Yw()).transaction(Xo),r=await s.objectStore(Xo).get(Xw(t));return await s.done,r}catch(e){if(e instanceof jn)qn.warn(e.message);else{const s=Ar.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qn.warn(s.message)}}}async function R0(t,e){try{const r=(await Yw()).transaction(Xo,"readwrite");await r.objectStore(Xo).put(e,Xw(t)),await r.done}catch(s){if(s instanceof jn)qn.warn(s.message);else{const r=Ar.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});qn.warn(r.message)}}}function Xw(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nk=1024,rk=30*24*60*60*1e3;class ik{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new ok(s),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,s;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=P0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a)?void 0:(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=rk}),this._storage.overwrite(this._heartbeatsCache))}catch(r){qn.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=P0(),{heartbeatsToSend:r,unsentEntries:i}=ak(this._heartbeatsCache.heartbeats),a=gd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=s,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(s){return qn.warn(s),""}}}function P0(){return new Date().toISOString().substring(0,10)}function ak(t,e=nk){const s=[];let r=t.slice();for(const i of t){const a=s.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),D0(s)>e){a.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),D0(s)>e){s.pop();break}r=r.slice(1)}return{heartbeatsToSend:s,unsentEntries:r}}class ok{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return HA()?KA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await sk(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return R0(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return R0(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function D0(t){return gd(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(t){Pr(new Bn("platform-logger",e=>new wI(e),"PRIVATE")),Pr(new Bn("heartbeat",e=>new ik(e),"PRIVATE")),$s(Lm,C0,t),$s(Lm,C0,"esm2017"),$s("fire-js","")}lk("");function lf(t,e){var s={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(s[r[i]]=t[r[i]]);return s}function Jw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ck=Jw,Zw=new xl("auth","Firebase",Jw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vd=new af("@firebase/auth");function dk(t,...e){vd.logLevel<=Oe.WARN&&vd.warn(`Auth (${_i}): ${t}`,...e)}function Dc(t,...e){vd.logLevel<=Oe.ERROR&&vd.error(`Auth (${_i}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(t,...e){throw cf(t,...e)}function un(t,...e){return cf(t,...e)}function ej(t,e,s){const r=Object.assign(Object.assign({},ck()),{[e]:s});return new xl("auth","Firebase",r).create(e,{appName:t.name})}function Ln(t){return ej(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cf(t,...e){if(typeof t!="string"){const s=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(s,...r)}return Zw.create(t,...e)}function Se(t,e,...s){if(!t)throw cf(e,...s)}function Rn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Dc(e),new Error(e)}function Gn(t,e){t||Rn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fm(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function uk(){return M0()==="http:"||M0()==="https:"}function M0(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uk()||BA()||"connection"in navigator)?navigator.onLine:!0}function mk(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(e,s){this.shortDelay=e,this.longDelay=s,Gn(s>e,"Short delay should be less than long delay!"),this.isMobile=$A()||qA()}get(){return hk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(t,e){Gn(t.emulator,"Emulator should always be set here");const{url:s}=t.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{static initialize(e,s,r){this.fetchImpl=e,s&&(this.headersImpl=s),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=new bl(3e4,6e4);function Xn(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Nn(t,e,s,r,i={}){return sj(t,i,async()=>{let a={},o={};r&&(e==="GET"?o=r:a={body:JSON.stringify(r)});const l=yl(Object.assign({key:t.config.apiKey},o)).slice(1),d=await t._getAdditionalHeaders();d["Content-Type"]="application/json",t.languageCode&&(d["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:d},a);return zA()||(u.referrerPolicy="no-referrer"),tj.fetch()(nj(t,t.config.apiHost,s,l),u)})}async function sj(t,e,s){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},pk),e);try{const i=new xk(t),a=await Promise.race([s(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw fc(t,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const l=a.ok?o.errorMessage:o.error.message,[d,u]=l.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw fc(t,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw fc(t,"email-already-in-use",o);if(d==="USER_DISABLED")throw fc(t,"user-disabled",o);const h=r[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ej(t,h,u);tn(t,h)}}catch(i){if(i instanceof jn)throw i;tn(t,"network-request-failed",{message:String(i)})}}async function wl(t,e,s,r,i={}){const a=await Nn(t,e,s,r,i);return"mfaPendingCredential"in a&&tn(t,"multi-factor-auth-required",{_serverResponse:a}),a}function nj(t,e,s,r){const i=`${e}${s}?${r}`;return t.config.emulator?df(t.config,i):`${t.config.apiScheme}://${i}`}function gk(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class xk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,r)=>{this.timer=setTimeout(()=>r(un(this.auth,"network-request-failed")),fk.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function fc(t,e,s){const r={appName:t.name};s.email&&(r.email=s.email),s.phoneNumber&&(r.phoneNumber=s.phoneNumber);const i=un(t,e,r);return i.customData._tokenResponse=s,i}function L0(t){return t!==void 0&&t.enterprise!==void 0}class yk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return gk(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function vk(t,e){return Nn(t,"GET","/v2/recaptchaConfig",Xn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bk(t,e){return Nn(t,"POST","/v1/accounts:delete",e)}async function rj(t,e){return Nn(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _o(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function wk(t,e=!1){const s=tt(t),r=await s.getIdToken(e),i=uf(r);Se(i&&i.exp&&i.auth_time&&i.iat,s.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:_o(kh(i.auth_time)),issuedAtTime:_o(kh(i.iat)),expirationTime:_o(kh(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function kh(t){return Number(t)*1e3}function uf(t){const[e,s,r]=t.split(".");if(e===void 0||s===void 0||r===void 0)return Dc("JWT malformed, contained fewer than 3 sections"),null;try{const i=zw(s);return i?JSON.parse(i):(Dc("Failed to decode base64 JWT payload"),null)}catch(i){return Dc("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function V0(t){const e=uf(t);return Se(e,"internal-error"),Se(typeof e.exp<"u","internal-error"),Se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fa(t,e,s=!1){if(s)return e;try{return await e}catch(r){throw r instanceof jn&&jk(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function jk({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var s;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=_o(this.lastLoginAt),this.creationTime=_o(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bd(t){var e;const s=t.auth,r=await t.getIdToken(),i=await fa(t,rj(s,{idToken:r}));Se(i==null?void 0:i.users.length,s,"internal-error");const a=i.users[0];t._notifyReloadListener(a);const o=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?ij(a.providerUserInfo):[],l=Sk(t.providerData,o),d=t.isAnonymous,u=!(t.email&&a.passwordHash)&&!(l!=null&&l.length),h=d?u:!1,m={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new $m(a.createdAt,a.lastLoginAt),isAnonymous:h};Object.assign(t,m)}async function _k(t){const e=tt(t);await bd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Sk(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function ij(t){return t.map(e=>{var{providerId:s}=e,r=lf(e,["providerId"]);return{providerId:s,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek(t,e){const s=await sj(t,{},async()=>{const r=yl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=t.config,o=nj(t,i,"/v1/token",`key=${a}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",tj.fetch()(o,{method:"POST",headers:l,body:r})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function Ak(t,e){return Nn(t,"POST","/v2/accounts:revokeToken",Xn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Se(e.idToken,"internal-error"),Se(typeof e.idToken<"u","internal-error"),Se(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):V0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){Se(e.length!==0,"internal-error");const s=V0(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Se(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:r,refreshToken:i,expiresIn:a}=await Ek(e,s);this.updateTokensAndExpiration(r,i,Number(a))}updateTokensAndExpiration(e,s,r){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,s){const{refreshToken:r,accessToken:i,expirationTime:a}=s,o=new ta;return r&&(Se(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(Se(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),a&&(Se(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ta,this.toJSON())}_performRefresh(){return Rn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nr(t,e){Se(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Pn{constructor(e){var{uid:s,auth:r,stsTokenManager:i}=e,a=lf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Nk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new $m(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const s=await fa(this,this.stsTokenManager.getToken(this.auth,e));return Se(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return wk(this,e)}reload(){return _k(this)}_assign(e){this!==e&&(Se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>Object.assign({},s)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new Pn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(e){Se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),s&&await bd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ln(this.auth.app))return Promise.reject(Ln(this.auth));const e=await this.getIdToken();return await fa(this,bk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){var r,i,a,o,l,d,u,h;const m=(r=s.displayName)!==null&&r!==void 0?r:void 0,g=(i=s.email)!==null&&i!==void 0?i:void 0,x=(a=s.phoneNumber)!==null&&a!==void 0?a:void 0,y=(o=s.photoURL)!==null&&o!==void 0?o:void 0,R=(l=s.tenantId)!==null&&l!==void 0?l:void 0,_=(d=s._redirectEventId)!==null&&d!==void 0?d:void 0,T=(u=s.createdAt)!==null&&u!==void 0?u:void 0,A=(h=s.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:C,emailVerified:k,isAnonymous:D,providerData:P,stsTokenManager:v}=s;Se(C&&v,e,"internal-error");const b=ta.fromJSON(this.name,v);Se(typeof C=="string",e,"internal-error"),nr(m,e.name),nr(g,e.name),Se(typeof k=="boolean",e,"internal-error"),Se(typeof D=="boolean",e,"internal-error"),nr(x,e.name),nr(y,e.name),nr(R,e.name),nr(_,e.name),nr(T,e.name),nr(A,e.name);const N=new Pn({uid:C,auth:e,email:g,emailVerified:k,displayName:m,isAnonymous:D,photoURL:y,phoneNumber:x,tenantId:R,stsTokenManager:b,createdAt:T,lastLoginAt:A});return P&&Array.isArray(P)&&(N.providerData=P.map(f=>Object.assign({},f))),_&&(N._redirectEventId=_),N}static async _fromIdTokenResponse(e,s,r=!1){const i=new ta;i.updateFromServerResponse(s);const a=new Pn({uid:s.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await bd(a),a}static async _fromGetAccountInfoResponse(e,s,r){const i=s.users[0];Se(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?ij(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),l=new ta;l.updateFromIdToken(r);const d=new Pn({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new $m(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(d,u),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O0=new Map;function Dn(t){Gn(t instanceof Function,"Expected a class definition");let e=O0.get(t);return e?(Gn(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,O0.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}aj.type="NONE";const F0=aj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mc(t,e,s){return`firebase:${t}:${e}:${s}`}class sa{constructor(e,s,r){this.persistence=e,this.auth=s,this.userKey=r;const{config:i,name:a}=this.auth;this.fullUserKey=Mc(this.userKey,i.apiKey,a),this.fullPersistenceKey=Mc("persistence",i.apiKey,a),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Pn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,r="authUser"){if(!s.length)return new sa(Dn(F0),e,r);const i=(await Promise.all(s.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let a=i[0]||Dn(F0);const o=Mc(r,e.config.apiKey,e.name);let l=null;for(const u of s)try{const h=await u._get(o);if(h){const m=Pn._fromJSON(e,h);u!==a&&(l=m),a=u;break}}catch{}const d=i.filter(u=>u._shouldAllowMigration);return!a._shouldAllowMigration||!d.length?new sa(a,e,r):(a=d[0],l&&await a._set(o,l.toJSON()),await Promise.all(s.map(async u=>{if(u!==a)try{await u._remove(o)}catch{}})),new sa(a,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $0(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dj(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(oj(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(hj(e))return"Blackberry";if(mj(e))return"Webos";if(lj(e))return"Safari";if((e.includes("chrome/")||cj(e))&&!e.includes("edge/"))return"Chrome";if(uj(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(s);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function oj(t=ss()){return/firefox\//i.test(t)}function lj(t=ss()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function cj(t=ss()){return/crios\//i.test(t)}function dj(t=ss()){return/iemobile/i.test(t)}function uj(t=ss()){return/android/i.test(t)}function hj(t=ss()){return/blackberry/i.test(t)}function mj(t=ss()){return/webos/i.test(t)}function hf(t=ss()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Ik(t=ss()){var e;return hf(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function kk(){return GA()&&document.documentMode===10}function pj(t=ss()){return hf(t)||uj(t)||mj(t)||hj(t)||/windows phone/i.test(t)||dj(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fj(t,e=[]){let s;switch(t){case"Browser":s=$0(ss());break;case"Worker":s=`${$0(ss())}-${t}`;break;default:s=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${_i}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const r=a=>new Promise((o,l)=>{try{const d=e(a);o(d)}catch(d){l(d)}});r.onAbort=s,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const r of this.queue)await r(e),r.onAbort&&s.push(r.onAbort)}catch(r){s.reverse();for(const i of s)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tk(t,e={}){return Nn(t,"GET","/v2/passwordPolicy",Xn(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk=6;class Pk{constructor(e){var s,r,i,a;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=o.minPasswordLength)!==null&&s!==void 0?s:Rk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var s,r,i,a,o,l;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(s=d.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),d.isValid&&(d.isValid=(r=d.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),d.isValid&&(d.isValid=(i=d.containsLowercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(a=d.containsUppercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(l=d.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),d}validatePasswordLengthOptions(e,s){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(s.meetsMinPasswordLength=e.length>=r),i&&(s.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(s,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,s,r,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(e,s,r,i){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new U0(this),this.idTokenSubscription=new U0(this),this.beforeStateQueue=new Ck(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Zw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=Dn(s)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await sa.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await rj(this,{idToken:e}),r=await Pn._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(r)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(ln(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,l=i==null?void 0:i._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&(d!=null&&d.user)&&(i=d.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Se(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await bd(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=mk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ln(this.app))return Promise.reject(Ln(this));const s=e?tt(e):null;return s&&Se(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&Se(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ln(this.app)?Promise.reject(Ln(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ln(this.app)?Promise.reject(Ln(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Dn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Tk(this),s=new Pk(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new xl("auth","Firebase",e())}onAuthStateChanged(e,s,r){return this.registerStateListener(this.authStateSubscription,e,s,r)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,r){return this.registerStateListener(this.idTokenSubscription,e,s,r)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(r.tenantId=this.tenantId),await Ak(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,s){const r=await this.getOrInitRedirectPersistenceManager(s);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&Dn(e)||this._popupRedirectResolver;Se(s,this,"argument-error"),this.redirectPersistenceManager=await sa.create(this,[Dn(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,r;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(s=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,r,i){if(this._deleted)return()=>{};const a=typeof s=="function"?s:s.next.bind(s);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Se(l,this,"internal-error"),l.then(()=>{o||a(this.currentUser)}),typeof s=="function"){const d=e.addObserver(s,r,i);return()=>{o=!0,d()}}else{const d=e.addObserver(s);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fj(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(s["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(s["X-Firebase-AppCheck"]=i),s}async _getAppCheckToken(){var e;const s=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return s!=null&&s.error&&dk(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Br(t){return tt(t)}class U0{constructor(e){this.auth=e,this.observer=null,this.addObserver=ZA(s=>this.observer=s)}get next(){return Se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Mk(t){cu=t}function gj(t){return cu.loadJS(t)}function Lk(){return cu.recaptchaEnterpriseScript}function Vk(){return cu.gapiScript}function Ok(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const Fk="recaptcha-enterprise",$k="NO_RECAPTCHA";class Uk{constructor(e){this.type=Fk,this.auth=Br(e)}async verify(e="verify",s=!1){async function r(a){if(!s){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,l)=>{vk(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(d.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const u=new yk(d);return a.tenantId==null?a._agentRecaptchaConfig=u:a._tenantRecaptchaConfigs[a.tenantId]=u,o(u.siteKey)}}).catch(d=>{l(d)})})}function i(a,o,l){const d=window.grecaptcha;L0(d)?d.enterprise.ready(()=>{d.enterprise.execute(a,{action:e}).then(u=>{o(u)}).catch(()=>{o($k)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,o)=>{r(this.auth).then(l=>{if(!s&&L0(window.grecaptcha))i(l,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let d=Lk();d.length!==0&&(d+=l),gj(d).then(()=>{i(l,a,o)}).catch(u=>{o(u)})}}).catch(l=>{o(l)})})}}async function z0(t,e,s,r=!1){const i=new Uk(t);let a;try{a=await i.verify(s)}catch{a=await i.verify(s,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function wd(t,e,s,r){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await z0(t,e,s,s==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await z0(t,e,s,s==="getOobCode");return r(t,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zk(t,e){const s=vl(t,"auth");if(s.isInitialized()){const i=s.getImmediate(),a=s.getOptions();if(xd(a,e??{}))return i;tn(i,"already-initialized")}return s.initialize({options:e})}function Bk(t,e){const s=(e==null?void 0:e.persistence)||[],r=(Array.isArray(s)?s:[s]).map(Dn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function qk(t,e,s){const r=Br(t);Se(r._canInitEmulator,r,"emulator-config-failed"),Se(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,a=xj(e),{host:o,port:l}=Gk(e),d=l===null?"":`:${l}`;r.config.emulator={url:`${a}//${o}${d}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),Wk()}function xj(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Gk(t){const e=xj(t),s=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!s)return{host:"",port:null};const r=s[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const a=i[1];return{host:a,port:B0(r.substr(a.length+1))}}else{const[a,o]=r.split(":");return{host:a,port:B0(o)}}}function B0(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Wk(){function t(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return Rn("not implemented")}_getIdTokenResponse(e){return Rn("not implemented")}_linkToIdToken(e,s){return Rn("not implemented")}_getReauthenticationResolver(e){return Rn("not implemented")}}async function Hk(t,e){return Nn(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(t,e){return wl(t,"POST","/v1/accounts:signInWithPassword",Xn(t,e))}async function yj(t,e){return Nn(t,"POST","/v1/accounts:sendOobCode",Xn(t,e))}async function Qk(t,e){return yj(t,e)}async function Yk(t,e){return yj(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xk(t,e){return wl(t,"POST","/v1/accounts:signInWithEmailLink",Xn(t,e))}async function Jk(t,e){return wl(t,"POST","/v1/accounts:signInWithEmailLink",Xn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo extends mf{constructor(e,s,r,i=null){super("password",r),this._email=e,this._password=s,this._tenantId=i}static _fromEmailAndPassword(e,s){return new Jo(e,s,"password")}static _fromEmailAndCode(e,s,r=null){return new Jo(e,s,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wd(e,s,"signInWithPassword",Kk);case"emailLink":return Xk(e,{email:this._email,oobCode:this._password});default:tn(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const r={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wd(e,r,"signUpPassword",Hk);case"emailLink":return Jk(e,{idToken:s,email:this._email,oobCode:this._password});default:tn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function na(t,e){return wl(t,"POST","/v1/accounts:signInWithIdp",Xn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk="http://localhost";class hi extends mf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new hi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):tn("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=s,a=lf(s,["providerId","signInMethod"]);if(!r||!i)return null;const o=new hi(r,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const s=this.buildRequest();return na(e,s)}_linkToIdToken(e,s){const r=this.buildRequest();return r.idToken=s,na(e,r)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,na(e,s)}buildRequest(){const e={requestUri:Zk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=yl(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function tC(t){const e=oo(lo(t)).link,s=e?oo(lo(e)).deep_link_id:null,r=oo(lo(t)).deep_link_id;return(r?oo(lo(r)).link:null)||r||s||e||t}class pf{constructor(e){var s,r,i,a,o,l;const d=oo(lo(e)),u=(s=d.apiKey)!==null&&s!==void 0?s:null,h=(r=d.oobCode)!==null&&r!==void 0?r:null,m=eC((i=d.mode)!==null&&i!==void 0?i:null);Se(u&&h&&m,"argument-error"),this.apiKey=u,this.operation=m,this.code=h,this.continueUrl=(a=d.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=d.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=d.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const s=tC(e);try{return new pf(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(){this.providerId=Si.PROVIDER_ID}static credential(e,s){return Jo._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const r=pf.parseLink(s);return Se(r,"argument-error"),Jo._fromEmailAndCode(e,r.code,r.tenantId)}}Si.PROVIDER_ID="password";Si.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Si.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl extends vj{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr extends jl{constructor(){super("facebook.com")}static credential(e){return hi._fromParams({providerId:cr.PROVIDER_ID,signInMethod:cr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return cr.credentialFromTaggedObject(e)}static credentialFromError(e){return cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return cr.credential(e.oauthAccessToken)}catch{return null}}}cr.FACEBOOK_SIGN_IN_METHOD="facebook.com";cr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr extends jl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return hi._fromParams({providerId:dr.PROVIDER_ID,signInMethod:dr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return dr.credentialFromTaggedObject(e)}static credentialFromError(e){return dr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:r}=e;if(!s&&!r)return null;try{return dr.credential(s,r)}catch{return null}}}dr.GOOGLE_SIGN_IN_METHOD="google.com";dr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur extends jl{constructor(){super("github.com")}static credential(e){return hi._fromParams({providerId:ur.PROVIDER_ID,signInMethod:ur.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ur.credentialFromTaggedObject(e)}static credentialFromError(e){return ur.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ur.credential(e.oauthAccessToken)}catch{return null}}}ur.GITHUB_SIGN_IN_METHOD="github.com";ur.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr extends jl{constructor(){super("twitter.com")}static credential(e,s){return hi._fromParams({providerId:hr.PROVIDER_ID,signInMethod:hr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return hr.credentialFromTaggedObject(e)}static credentialFromError(e){return hr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:r}=e;if(!s||!r)return null;try{return hr.credential(s,r)}catch{return null}}}hr.TWITTER_SIGN_IN_METHOD="twitter.com";hr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sC(t,e){return wl(t,"POST","/v1/accounts:signUp",Xn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,r,i=!1){const a=await Pn._fromIdTokenResponse(e,r,i),o=q0(r);return new mi({user:a,providerId:o,_tokenResponse:r,operationType:s})}static async _forOperation(e,s,r){await e._updateTokensIfNecessary(r,!0);const i=q0(r);return new mi({user:e,providerId:i,_tokenResponse:r,operationType:s})}}function q0(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd extends jn{constructor(e,s,r,i){var a;super(s.code,s.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,jd.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:s.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,s,r,i){return new jd(e,s,r,i)}}function bj(t,e,s,r){return(e==="reauthenticate"?s._getReauthenticationResolver(t):s._getIdTokenResponse(t)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?jd._fromErrorAndOperation(t,a,e,r):a})}async function nC(t,e,s=!1){const r=await fa(t,e._linkToIdToken(t.auth,await t.getIdToken()),s);return mi._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wj(t,e,s=!1){const{auth:r}=t;if(ln(r.app))return Promise.reject(Ln(r));const i="reauthenticate";try{const a=await fa(t,bj(r,i,e,t),s);Se(a.idToken,r,"internal-error");const o=uf(a.idToken);Se(o,r,"internal-error");const{sub:l}=o;return Se(t.uid===l,r,"user-mismatch"),mi._forOperation(t,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&tn(r,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jj(t,e,s=!1){if(ln(t.app))return Promise.reject(Ln(t));const r="signIn",i=await bj(t,r,e),a=await mi._fromIdTokenResponse(t,r,i);return s||await t._updateCurrentUser(a.user),a}async function rC(t,e){return jj(Br(t),e)}async function iC(t,e){return wj(tt(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aC(t,e,s){var r;Se(((r=s.url)===null||r===void 0?void 0:r.length)>0,t,"invalid-continue-uri"),Se(typeof s.dynamicLinkDomain>"u"||s.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=s.url,e.dynamicLinkDomain=s.dynamicLinkDomain,e.canHandleCodeInApp=s.handleCodeInApp,s.iOS&&(Se(s.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=s.iOS.bundleId),s.android&&(Se(s.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=s.android.installApp,e.androidMinimumVersionCode=s.android.minimumVersion,e.androidPackageName=s.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nj(t){const e=Br(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function ff(t,e,s){const r=Br(t),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};s&&aC(r,i,s),await wd(r,i,"getOobCode",Qk)}async function Zo(t,e,s){if(ln(t.app))return Promise.reject(Ln(t));const r=Br(t),o=await wd(r,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",sC).catch(d=>{throw d.code==="auth/password-does-not-meet-requirements"&&Nj(t),d}),l=await mi._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function el(t,e,s){return ln(t.app)?Promise.reject(Ln(t)):rC(tt(t),Si.credential(e,s)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Nj(t),r})}async function oC(t,e,s){const r=tt(t),a={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await t.getIdToken(),newEmail:e},{email:o}=await Yk(r.auth,a);o!==t.email&&await t.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lC(t,e){return Nn(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tl(t,{displayName:e,photoURL:s}){if(e===void 0&&s===void 0)return;const r=tt(t),a={idToken:await r.getIdToken(),displayName:e,photoUrl:s,returnSecureToken:!0},o=await fa(r,lC(r.auth,a));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const l=r.providerData.find(({providerId:d})=>d==="password");l&&(l.displayName=r.displayName,l.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cC(t,e){return tt(t).setPersistence(e)}function dC(t,e,s,r){return tt(t).onIdTokenChanged(e,s,r)}function uC(t,e,s){return tt(t).beforeAuthStateChanged(e,s)}function hC(t,e,s,r){return tt(t).onAuthStateChanged(e,s,r)}function ra(t){return tt(t).signOut()}async function _j(t){return tt(t).delete()}const Nd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sj{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Nd,"1"),this.storage.removeItem(Nd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC=1e3,pC=10;class Ej extends Sj{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pj(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const r=this.storage.getItem(s),i=this.localCache[s];r!==i&&e(s,i,r)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((o,l,d)=>{this.notifyListeners(o,d)});return}const r=e.key;s?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!s&&this.localCache[r]===o||this.notifyListeners(r,o)},a=this.storage.getItem(r);kk()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,pC):i()}notifyListeners(e,s){this.localCache[e]=s;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:r}),!0)})},mC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ej.type="LOCAL";const fC=Ej;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aj extends Sj{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}Aj.type="SESSION";const gf=Aj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(i=>i.isListeningto(e));if(s)return s;const r=new du(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:r,eventType:i,data:a}=s.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;s.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const l=Array.from(o).map(async u=>u(s.origin,a)),d=await gC(l);s.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:d})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}du.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xf(t="",e=10){let s="";for(let r=0;r<e;r++)s+=Math.floor(Math.random()*10);return t+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((l,d)=>{const u=xf("",20);i.port1.start();const h=setTimeout(()=>{d(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(m){const g=m;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(h),a=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(g.data.response);break;default:clearTimeout(h),clearTimeout(a),d(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:s},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(){return window}function yC(t){hn().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ij(){return typeof hn().WorkerGlobalScope<"u"&&typeof hn().importScripts=="function"}async function vC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function bC(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function wC(){return Ij()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kj="firebaseLocalStorageDb",jC=1,_d="firebaseLocalStorage",Cj="fbase_key";class Nl{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function uu(t,e){return t.transaction([_d],e?"readwrite":"readonly").objectStore(_d)}function NC(){const t=indexedDB.deleteDatabase(kj);return new Nl(t).toPromise()}function Um(){const t=indexedDB.open(kj,jC);return new Promise((e,s)=>{t.addEventListener("error",()=>{s(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(_d,{keyPath:Cj})}catch(i){s(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(_d)?e(r):(r.close(),await NC(),e(await Um()))})})}async function G0(t,e,s){const r=uu(t,!0).put({[Cj]:e,value:s});return new Nl(r).toPromise()}async function _C(t,e){const s=uu(t,!1).get(e),r=await new Nl(s).toPromise();return r===void 0?null:r.value}function W0(t,e){const s=uu(t,!0).delete(e);return new Nl(s).toPromise()}const SC=800,EC=3;class Tj{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Um(),this.db)}async _withRetries(e){let s=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(s++>EC)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ij()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=du._getInstance(wC()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var e,s;if(this.activeServiceWorker=await vC(),!this.activeServiceWorker)return;this.sender=new xC(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((s=r[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||bC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Um();return await G0(e,Nd,"1"),await W0(e,Nd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(r=>G0(r,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(r=>_C(r,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>W0(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=uu(i,!1).getAll();return new Nl(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),s.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),s.push(i));return s}notifyListeners(e,s){this.localCache[e]=s;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),SC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Tj.type="LOCAL";const AC=Tj;new bl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IC(t,e){return e?Dn(e):(Se(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf extends mf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return na(e,this._buildIdpRequest())}_linkToIdToken(e,s){return na(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return na(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function kC(t){return jj(t.auth,new yf(t),t.bypassAuthState)}function CC(t){const{auth:e,user:s}=t;return Se(s,e,"internal-error"),wj(s,new yf(t),t.bypassAuthState)}async function TC(t){const{auth:e,user:s}=t;return Se(s,e,"internal-error"),nC(s,new yf(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rj{constructor(e,s,r,i,a=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:r,postBody:i,tenantId:a,error:o,type:l}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:s,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(d))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return kC;case"linkViaPopup":case"linkViaRedirect":return TC;case"reauthViaPopup":case"reauthViaRedirect":return CC;default:tn(this.auth,"internal-error")}}resolve(e){Gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Gn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RC=new bl(2e3,1e4);class Ki extends Rj{constructor(e,s,r,i,a){super(e,s,i,a),this.provider=r,this.authWindow=null,this.pollId=null,Ki.currentPopupAction&&Ki.currentPopupAction.cancel(),Ki.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Se(e,this.auth,"internal-error"),e}async onExecution(){Gn(this.filter.length===1,"Popup operations only handle one event");const e=xf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(un(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(un(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ki.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,r;if(!((r=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(un(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,RC.get())};e()}}Ki.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PC="pendingRedirect",Lc=new Map;class DC extends Rj{constructor(e,s,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,r),this.eventId=null}async execute(){let e=Lc.get(this.auth._key());if(!e){try{const r=await MC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(s){e=()=>Promise.reject(s)}Lc.set(this.auth._key(),e)}return this.bypassAuthState||Lc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function MC(t,e){const s=OC(e),r=VC(t);if(!await r._isAvailable())return!1;const i=await r._get(s)==="true";return await r._remove(s),i}function LC(t,e){Lc.set(t._key(),e)}function VC(t){return Dn(t._redirectPersistence)}function OC(t){return Mc(PC,t.config.apiKey,t.name)}async function FC(t,e,s=!1){if(ln(t.app))return Promise.reject(Ln(t));const r=Br(t),i=IC(r,e),o=await new DC(r,i,s).execute();return o&&!s&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C=10*60*1e3;class UC{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(s=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!zC(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var r;if(e.error&&!Pj(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";s.onError(un(this.auth,i))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const r=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=$C&&this.cachedEventUids.clear(),this.cachedEventUids.has(H0(e))}saveEventToCache(e){this.cachedEventUids.add(H0(e)),this.lastProcessedEventTime=Date.now()}}function H0(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Pj({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function zC(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Pj(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(t,e={}){return Nn(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,GC=/^https?/;async function WC(t){if(t.config.emulator)return;const{authorizedDomains:e}=await BC(t);for(const s of e)try{if(HC(s))return}catch{}tn(t,"unauthorized-domain")}function HC(t){const e=Fm(),{protocol:s,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?s==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&o.hostname===r}if(!GC.test(s))return!1;if(qC.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC=new bl(3e4,6e4);function K0(){const t=hn().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let s=0;s<t.CP.length;s++)t.CP[s]=null}}function QC(t){return new Promise((e,s)=>{var r,i,a;function o(){K0(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{K0(),s(un(t,"network-request-failed"))},timeout:KC.get()})}if(!((i=(r=hn().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((a=hn().gapi)===null||a===void 0)&&a.load)o();else{const l=Ok("iframefcb");return hn()[l]=()=>{gapi.load?o():s(un(t,"network-request-failed"))},gj(`${Vk()}?onload=${l}`).catch(d=>s(d))}}).catch(e=>{throw Vc=null,e})}let Vc=null;function YC(t){return Vc=Vc||QC(t),Vc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC=new bl(5e3,15e3),JC="__/auth/iframe",ZC="emulator/auth/iframe",eT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function sT(t){const e=t.config;Se(e.authDomain,t,"auth-domain-config-required");const s=e.emulator?df(e,ZC):`https://${t.config.authDomain}/${JC}`,r={apiKey:e.apiKey,appName:t.name,v:_i},i=tT.get(t.config.apiHost);i&&(r.eid=i);const a=t._getFrameworks();return a.length&&(r.fw=a.join(",")),`${s}?${yl(r).slice(1)}`}async function nT(t){const e=await YC(t),s=hn().gapi;return Se(s,t,"internal-error"),e.open({where:document.body,url:sT(t),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:eT,dontclear:!0},r=>new Promise(async(i,a)=>{await r.restyle({setHideOnLeave:!1});const o=un(t,"network-request-failed"),l=hn().setTimeout(()=>{a(o)},XC.get());function d(){hn().clearTimeout(l),i(r)}r.ping(d).then(d,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},iT=500,aT=600,oT="_blank",lT="http://localhost";class Q0{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function cT(t,e,s,r=iT,i=aT){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const d=Object.assign(Object.assign({},rT),{width:r.toString(),height:i.toString(),top:a,left:o}),u=ss().toLowerCase();s&&(l=cj(u)?oT:s),oj(u)&&(e=e||lT,d.scrollbars="yes");const h=Object.entries(d).reduce((g,[x,y])=>`${g}${x}=${y},`,"");if(Ik(u)&&l!=="_self")return dT(e||"",l),new Q0(null);const m=window.open(e||"",l,h);Se(m,t,"popup-blocked");try{m.focus()}catch{}return new Q0(m)}function dT(t,e){const s=document.createElement("a");s.href=t,s.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uT="__/auth/handler",hT="emulator/auth/handler",mT=encodeURIComponent("fac");async function Y0(t,e,s,r,i,a){Se(t.config.authDomain,t,"auth-domain-config-required"),Se(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:s,redirectUrl:r,v:_i,eventId:i};if(e instanceof vj){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",JA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,m]of Object.entries({}))o[h]=m}if(e instanceof jl){const h=e.getScopes().filter(m=>m!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const d=await t._getAppCheckToken(),u=d?`#${mT}=${encodeURIComponent(d)}`:"";return`${pT(t)}?${yl(l).slice(1)}${u}`}function pT({config:t}){return t.emulator?df(t,hT):`https://${t.authDomain}/${uT}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch="webStorageSupport";class fT{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gf,this._completeRedirectFn=FC,this._overrideRedirectResult=LC}async _openPopup(e,s,r,i){var a;Gn((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await Y0(e,s,r,Fm(),i);return cT(e,o,xf())}async _openRedirect(e,s,r,i){await this._originValidation(e);const a=await Y0(e,s,r,Fm(),i);return yC(a),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:i,promise:a}=this.eventManagers[s];return i?Promise.resolve(i):(Gn(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[s]={promise:r},r.catch(()=>{delete this.eventManagers[s]}),r}async initAndGetManager(e){const s=await nT(e),r=new UC(e);return s.register("authEvent",i=>(Se(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=s,r}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(Ch,{type:Ch},i=>{var a;const o=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[Ch];o!==void 0&&s(!!o),tn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=WC(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return pj()||lj()||hf()}}const gT=fT;var X0="@firebase/auth",J0="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yT(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function vT(t){Pr(new Bn("auth",(e,{options:s})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Se(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const d={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fj(t)},u=new Dk(r,i,a,d);return Bk(u,s),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,r)=>{e.getProvider("auth-internal").initialize()})),Pr(new Bn("auth-internal",e=>{const s=Br(e.getProvider("auth").getImmediate());return(r=>new xT(r))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),$s(X0,J0,yT(t)),$s(X0,J0,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bT=5*60,wT=Gw("authIdTokenMaxAge")||bT;let Z0=null;const jT=t=>async e=>{const s=e&&await e.getIdTokenResult(),r=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(r&&r>wT)return;const i=s==null?void 0:s.token;Z0!==i&&(Z0=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Dj(t=lu()){const e=vl(t,"auth");if(e.isInitialized())return e.getImmediate();const s=zk(t,{popupRedirectResolver:gT,persistence:[AC,fC,gf]}),r=Gw("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(r,location.origin);if(location.origin===a.origin){const o=jT(a.toString());uC(s,o,()=>o(s.currentUser)),dC(s,l=>o(l))}}const i=Bw("auth");return i&&qk(s,`http://${i}`),s}function NT(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Mk({loadJS(t){return new Promise((e,s)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const a=un("internal-error");a.customData=i,s(a)},r.type="text/javascript",r.charset="UTF-8",NT().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});vT("Browser");var ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ai,Mj;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,b){function N(){}N.prototype=b.prototype,v.D=b.prototype,v.prototype=new N,v.prototype.constructor=v,v.C=function(f,j,E){for(var S=Array(arguments.length-2),ee=2;ee<arguments.length;ee++)S[ee-2]=arguments[ee];return b.prototype[j].apply(f,S)}}function s(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,s),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,b,N){N||(N=0);var f=Array(16);if(typeof b=="string")for(var j=0;16>j;++j)f[j]=b.charCodeAt(N++)|b.charCodeAt(N++)<<8|b.charCodeAt(N++)<<16|b.charCodeAt(N++)<<24;else for(j=0;16>j;++j)f[j]=b[N++]|b[N++]<<8|b[N++]<<16|b[N++]<<24;b=v.g[0],N=v.g[1],j=v.g[2];var E=v.g[3],S=b+(E^N&(j^E))+f[0]+3614090360&4294967295;b=N+(S<<7&4294967295|S>>>25),S=E+(j^b&(N^j))+f[1]+3905402710&4294967295,E=b+(S<<12&4294967295|S>>>20),S=j+(N^E&(b^N))+f[2]+606105819&4294967295,j=E+(S<<17&4294967295|S>>>15),S=N+(b^j&(E^b))+f[3]+3250441966&4294967295,N=j+(S<<22&4294967295|S>>>10),S=b+(E^N&(j^E))+f[4]+4118548399&4294967295,b=N+(S<<7&4294967295|S>>>25),S=E+(j^b&(N^j))+f[5]+1200080426&4294967295,E=b+(S<<12&4294967295|S>>>20),S=j+(N^E&(b^N))+f[6]+2821735955&4294967295,j=E+(S<<17&4294967295|S>>>15),S=N+(b^j&(E^b))+f[7]+4249261313&4294967295,N=j+(S<<22&4294967295|S>>>10),S=b+(E^N&(j^E))+f[8]+1770035416&4294967295,b=N+(S<<7&4294967295|S>>>25),S=E+(j^b&(N^j))+f[9]+2336552879&4294967295,E=b+(S<<12&4294967295|S>>>20),S=j+(N^E&(b^N))+f[10]+4294925233&4294967295,j=E+(S<<17&4294967295|S>>>15),S=N+(b^j&(E^b))+f[11]+2304563134&4294967295,N=j+(S<<22&4294967295|S>>>10),S=b+(E^N&(j^E))+f[12]+1804603682&4294967295,b=N+(S<<7&4294967295|S>>>25),S=E+(j^b&(N^j))+f[13]+4254626195&4294967295,E=b+(S<<12&4294967295|S>>>20),S=j+(N^E&(b^N))+f[14]+2792965006&4294967295,j=E+(S<<17&4294967295|S>>>15),S=N+(b^j&(E^b))+f[15]+1236535329&4294967295,N=j+(S<<22&4294967295|S>>>10),S=b+(j^E&(N^j))+f[1]+4129170786&4294967295,b=N+(S<<5&4294967295|S>>>27),S=E+(N^j&(b^N))+f[6]+3225465664&4294967295,E=b+(S<<9&4294967295|S>>>23),S=j+(b^N&(E^b))+f[11]+643717713&4294967295,j=E+(S<<14&4294967295|S>>>18),S=N+(E^b&(j^E))+f[0]+3921069994&4294967295,N=j+(S<<20&4294967295|S>>>12),S=b+(j^E&(N^j))+f[5]+3593408605&4294967295,b=N+(S<<5&4294967295|S>>>27),S=E+(N^j&(b^N))+f[10]+38016083&4294967295,E=b+(S<<9&4294967295|S>>>23),S=j+(b^N&(E^b))+f[15]+3634488961&4294967295,j=E+(S<<14&4294967295|S>>>18),S=N+(E^b&(j^E))+f[4]+3889429448&4294967295,N=j+(S<<20&4294967295|S>>>12),S=b+(j^E&(N^j))+f[9]+568446438&4294967295,b=N+(S<<5&4294967295|S>>>27),S=E+(N^j&(b^N))+f[14]+3275163606&4294967295,E=b+(S<<9&4294967295|S>>>23),S=j+(b^N&(E^b))+f[3]+4107603335&4294967295,j=E+(S<<14&4294967295|S>>>18),S=N+(E^b&(j^E))+f[8]+1163531501&4294967295,N=j+(S<<20&4294967295|S>>>12),S=b+(j^E&(N^j))+f[13]+2850285829&4294967295,b=N+(S<<5&4294967295|S>>>27),S=E+(N^j&(b^N))+f[2]+4243563512&4294967295,E=b+(S<<9&4294967295|S>>>23),S=j+(b^N&(E^b))+f[7]+1735328473&4294967295,j=E+(S<<14&4294967295|S>>>18),S=N+(E^b&(j^E))+f[12]+2368359562&4294967295,N=j+(S<<20&4294967295|S>>>12),S=b+(N^j^E)+f[5]+4294588738&4294967295,b=N+(S<<4&4294967295|S>>>28),S=E+(b^N^j)+f[8]+2272392833&4294967295,E=b+(S<<11&4294967295|S>>>21),S=j+(E^b^N)+f[11]+1839030562&4294967295,j=E+(S<<16&4294967295|S>>>16),S=N+(j^E^b)+f[14]+4259657740&4294967295,N=j+(S<<23&4294967295|S>>>9),S=b+(N^j^E)+f[1]+2763975236&4294967295,b=N+(S<<4&4294967295|S>>>28),S=E+(b^N^j)+f[4]+1272893353&4294967295,E=b+(S<<11&4294967295|S>>>21),S=j+(E^b^N)+f[7]+4139469664&4294967295,j=E+(S<<16&4294967295|S>>>16),S=N+(j^E^b)+f[10]+3200236656&4294967295,N=j+(S<<23&4294967295|S>>>9),S=b+(N^j^E)+f[13]+681279174&4294967295,b=N+(S<<4&4294967295|S>>>28),S=E+(b^N^j)+f[0]+3936430074&4294967295,E=b+(S<<11&4294967295|S>>>21),S=j+(E^b^N)+f[3]+3572445317&4294967295,j=E+(S<<16&4294967295|S>>>16),S=N+(j^E^b)+f[6]+76029189&4294967295,N=j+(S<<23&4294967295|S>>>9),S=b+(N^j^E)+f[9]+3654602809&4294967295,b=N+(S<<4&4294967295|S>>>28),S=E+(b^N^j)+f[12]+3873151461&4294967295,E=b+(S<<11&4294967295|S>>>21),S=j+(E^b^N)+f[15]+530742520&4294967295,j=E+(S<<16&4294967295|S>>>16),S=N+(j^E^b)+f[2]+3299628645&4294967295,N=j+(S<<23&4294967295|S>>>9),S=b+(j^(N|~E))+f[0]+4096336452&4294967295,b=N+(S<<6&4294967295|S>>>26),S=E+(N^(b|~j))+f[7]+1126891415&4294967295,E=b+(S<<10&4294967295|S>>>22),S=j+(b^(E|~N))+f[14]+2878612391&4294967295,j=E+(S<<15&4294967295|S>>>17),S=N+(E^(j|~b))+f[5]+4237533241&4294967295,N=j+(S<<21&4294967295|S>>>11),S=b+(j^(N|~E))+f[12]+1700485571&4294967295,b=N+(S<<6&4294967295|S>>>26),S=E+(N^(b|~j))+f[3]+2399980690&4294967295,E=b+(S<<10&4294967295|S>>>22),S=j+(b^(E|~N))+f[10]+4293915773&4294967295,j=E+(S<<15&4294967295|S>>>17),S=N+(E^(j|~b))+f[1]+2240044497&4294967295,N=j+(S<<21&4294967295|S>>>11),S=b+(j^(N|~E))+f[8]+1873313359&4294967295,b=N+(S<<6&4294967295|S>>>26),S=E+(N^(b|~j))+f[15]+4264355552&4294967295,E=b+(S<<10&4294967295|S>>>22),S=j+(b^(E|~N))+f[6]+2734768916&4294967295,j=E+(S<<15&4294967295|S>>>17),S=N+(E^(j|~b))+f[13]+1309151649&4294967295,N=j+(S<<21&4294967295|S>>>11),S=b+(j^(N|~E))+f[4]+4149444226&4294967295,b=N+(S<<6&4294967295|S>>>26),S=E+(N^(b|~j))+f[11]+3174756917&4294967295,E=b+(S<<10&4294967295|S>>>22),S=j+(b^(E|~N))+f[2]+718787259&4294967295,j=E+(S<<15&4294967295|S>>>17),S=N+(E^(j|~b))+f[9]+3951481745&4294967295,v.g[0]=v.g[0]+b&4294967295,v.g[1]=v.g[1]+(j+(S<<21&4294967295|S>>>11))&4294967295,v.g[2]=v.g[2]+j&4294967295,v.g[3]=v.g[3]+E&4294967295}r.prototype.u=function(v,b){b===void 0&&(b=v.length);for(var N=b-this.blockSize,f=this.B,j=this.h,E=0;E<b;){if(j==0)for(;E<=N;)i(this,v,E),E+=this.blockSize;if(typeof v=="string"){for(;E<b;)if(f[j++]=v.charCodeAt(E++),j==this.blockSize){i(this,f),j=0;break}}else for(;E<b;)if(f[j++]=v[E++],j==this.blockSize){i(this,f),j=0;break}}this.h=j,this.o+=b},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var b=1;b<v.length-8;++b)v[b]=0;var N=8*this.o;for(b=v.length-8;b<v.length;++b)v[b]=N&255,N/=256;for(this.u(v),v=Array(16),b=N=0;4>b;++b)for(var f=0;32>f;f+=8)v[N++]=this.g[b]>>>f&255;return v};function a(v,b){var N=l;return Object.prototype.hasOwnProperty.call(N,v)?N[v]:N[v]=b(v)}function o(v,b){this.h=b;for(var N=[],f=!0,j=v.length-1;0<=j;j--){var E=v[j]|0;f&&E==b||(N[j]=E,f=!1)}this.g=N}var l={};function d(v){return-128<=v&&128>v?a(v,function(b){return new o([b|0],0>b?-1:0)}):new o([v|0],0>v?-1:0)}function u(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return _(u(-v));for(var b=[],N=1,f=0;v>=N;f++)b[f]=v/N|0,N*=4294967296;return new o(b,0)}function h(v,b){if(v.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(v.charAt(0)=="-")return _(h(v.substring(1),b));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=u(Math.pow(b,8)),f=m,j=0;j<v.length;j+=8){var E=Math.min(8,v.length-j),S=parseInt(v.substring(j,j+E),b);8>E?(E=u(Math.pow(b,E)),f=f.j(E).add(u(S))):(f=f.j(N),f=f.add(u(S)))}return f}var m=d(0),g=d(1),x=d(16777216);t=o.prototype,t.m=function(){if(R(this))return-_(this).m();for(var v=0,b=1,N=0;N<this.g.length;N++){var f=this.i(N);v+=(0<=f?f:4294967296+f)*b,b*=4294967296}return v},t.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(y(this))return"0";if(R(this))return"-"+_(this).toString(v);for(var b=u(Math.pow(v,6)),N=this,f="";;){var j=k(N,b).g;N=T(N,j.j(b));var E=((0<N.g.length?N.g[0]:N.h)>>>0).toString(v);if(N=j,y(N))return E+f;for(;6>E.length;)E="0"+E;f=E+f}},t.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function y(v){if(v.h!=0)return!1;for(var b=0;b<v.g.length;b++)if(v.g[b]!=0)return!1;return!0}function R(v){return v.h==-1}t.l=function(v){return v=T(this,v),R(v)?-1:y(v)?0:1};function _(v){for(var b=v.g.length,N=[],f=0;f<b;f++)N[f]=~v.g[f];return new o(N,~v.h).add(g)}t.abs=function(){return R(this)?_(this):this},t.add=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],f=0,j=0;j<=b;j++){var E=f+(this.i(j)&65535)+(v.i(j)&65535),S=(E>>>16)+(this.i(j)>>>16)+(v.i(j)>>>16);f=S>>>16,E&=65535,S&=65535,N[j]=S<<16|E}return new o(N,N[N.length-1]&-2147483648?-1:0)};function T(v,b){return v.add(_(b))}t.j=function(v){if(y(this)||y(v))return m;if(R(this))return R(v)?_(this).j(_(v)):_(_(this).j(v));if(R(v))return _(this.j(_(v)));if(0>this.l(x)&&0>v.l(x))return u(this.m()*v.m());for(var b=this.g.length+v.g.length,N=[],f=0;f<2*b;f++)N[f]=0;for(f=0;f<this.g.length;f++)for(var j=0;j<v.g.length;j++){var E=this.i(f)>>>16,S=this.i(f)&65535,ee=v.i(j)>>>16,U=v.i(j)&65535;N[2*f+2*j]+=S*U,A(N,2*f+2*j),N[2*f+2*j+1]+=E*U,A(N,2*f+2*j+1),N[2*f+2*j+1]+=S*ee,A(N,2*f+2*j+1),N[2*f+2*j+2]+=E*ee,A(N,2*f+2*j+2)}for(f=0;f<b;f++)N[f]=N[2*f+1]<<16|N[2*f];for(f=b;f<2*b;f++)N[f]=0;return new o(N,0)};function A(v,b){for(;(v[b]&65535)!=v[b];)v[b+1]+=v[b]>>>16,v[b]&=65535,b++}function C(v,b){this.g=v,this.h=b}function k(v,b){if(y(b))throw Error("division by zero");if(y(v))return new C(m,m);if(R(v))return b=k(_(v),b),new C(_(b.g),_(b.h));if(R(b))return b=k(v,_(b)),new C(_(b.g),b.h);if(30<v.g.length){if(R(v)||R(b))throw Error("slowDivide_ only works with positive integers.");for(var N=g,f=b;0>=f.l(v);)N=D(N),f=D(f);var j=P(N,1),E=P(f,1);for(f=P(f,2),N=P(N,2);!y(f);){var S=E.add(f);0>=S.l(v)&&(j=j.add(N),E=S),f=P(f,1),N=P(N,1)}return b=T(v,j.j(b)),new C(j,b)}for(j=m;0<=v.l(b);){for(N=Math.max(1,Math.floor(v.m()/b.m())),f=Math.ceil(Math.log(N)/Math.LN2),f=48>=f?1:Math.pow(2,f-48),E=u(N),S=E.j(b);R(S)||0<S.l(v);)N-=f,E=u(N),S=E.j(b);y(E)&&(E=g),j=j.add(E),v=T(v,S)}return new C(j,v)}t.A=function(v){return k(this,v).h},t.and=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],f=0;f<b;f++)N[f]=this.i(f)&v.i(f);return new o(N,this.h&v.h)},t.or=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],f=0;f<b;f++)N[f]=this.i(f)|v.i(f);return new o(N,this.h|v.h)},t.xor=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],f=0;f<b;f++)N[f]=this.i(f)^v.i(f);return new o(N,this.h^v.h)};function D(v){for(var b=v.g.length+1,N=[],f=0;f<b;f++)N[f]=v.i(f)<<1|v.i(f-1)>>>31;return new o(N,v.h)}function P(v,b){var N=b>>5;b%=32;for(var f=v.g.length-N,j=[],E=0;E<f;E++)j[E]=0<b?v.i(E+N)>>>b|v.i(E+N+1)<<32-b:v.i(E+N);return new o(j,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Mj=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,ai=o}).apply(typeof ey<"u"?ey:typeof self<"u"?self:typeof window<"u"?window:{});var gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Lj,co,Vj,Oc,zm,Oj,Fj,$j;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,p,w){return c==Array.prototype||c==Object.prototype||(c[p]=w.value),c};function s(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof gc=="object"&&gc];for(var p=0;p<c.length;++p){var w=c[p];if(w&&w.Math==Math)return w}throw Error("Cannot find global object")}var r=s(this);function i(c,p){if(p)e:{var w=r;c=c.split(".");for(var M=0;M<c.length-1;M++){var F=c[M];if(!(F in w))break e;w=w[F]}c=c[c.length-1],M=w[c],p=p(M),p!=M&&p!=null&&e(w,c,{configurable:!0,writable:!0,value:p})}}function a(c,p){c instanceof String&&(c+="");var w=0,M=!1,F={next:function(){if(!M&&w<c.length){var G=w++;return{value:p(G,c[G]),done:!1}}return M=!0,{done:!0,value:void 0}}};return F[Symbol.iterator]=function(){return F},F}i("Array.prototype.values",function(c){return c||function(){return a(this,function(p,w){return w})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function d(c){var p=typeof c;return p=p!="object"?p:c?Array.isArray(c)?"array":p:"null",p=="array"||p=="object"&&typeof c.length=="number"}function u(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function h(c,p,w){return c.call.apply(c.bind,arguments)}function m(c,p,w){if(!c)throw Error();if(2<arguments.length){var M=Array.prototype.slice.call(arguments,2);return function(){var F=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(F,M),c.apply(p,F)}}return function(){return c.apply(p,arguments)}}function g(c,p,w){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:m,g.apply(null,arguments)}function x(c,p){var w=Array.prototype.slice.call(arguments,1);return function(){var M=w.slice();return M.push.apply(M,arguments),c.apply(this,M)}}function y(c,p){function w(){}w.prototype=p.prototype,c.aa=p.prototype,c.prototype=new w,c.prototype.constructor=c,c.Qb=function(M,F,G){for(var le=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)le[nt-2]=arguments[nt];return p.prototype[F].apply(M,le)}}function R(c){const p=c.length;if(0<p){const w=Array(p);for(let M=0;M<p;M++)w[M]=c[M];return w}return[]}function _(c,p){for(let w=1;w<arguments.length;w++){const M=arguments[w];if(d(M)){const F=c.length||0,G=M.length||0;c.length=F+G;for(let le=0;le<G;le++)c[F+le]=M[le]}else c.push(M)}}class T{constructor(p,w){this.i=p,this.j=w,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function A(c){return/^[\s\xa0]*$/.test(c)}function C(){var c=l.navigator;return c&&(c=c.userAgent)?c:""}function k(c){return k[" "](c),c}k[" "]=function(){};var D=C().indexOf("Gecko")!=-1&&!(C().toLowerCase().indexOf("webkit")!=-1&&C().indexOf("Edge")==-1)&&!(C().indexOf("Trident")!=-1||C().indexOf("MSIE")!=-1)&&C().indexOf("Edge")==-1;function P(c,p,w){for(const M in c)p.call(w,c[M],M,c)}function v(c,p){for(const w in c)p.call(void 0,c[w],w,c)}function b(c){const p={};for(const w in c)p[w]=c[w];return p}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function f(c,p){let w,M;for(let F=1;F<arguments.length;F++){M=arguments[F];for(w in M)c[w]=M[w];for(let G=0;G<N.length;G++)w=N[G],Object.prototype.hasOwnProperty.call(M,w)&&(c[w]=M[w])}}function j(c){var p=1;c=c.split(":");const w=[];for(;0<p&&c.length;)w.push(c.shift()),p--;return c.length&&w.push(c.join(":")),w}function E(c){l.setTimeout(()=>{throw c},0)}function S(){var c=oe;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class ee{constructor(){this.h=this.g=null}add(p,w){const M=U.get();M.set(p,w),this.h?this.h.next=M:this.g=M,this.h=M}}var U=new T(()=>new z,c=>c.reset());class z{constructor(){this.next=this.g=this.h=null}set(p,w){this.h=p,this.g=w,this.next=null}reset(){this.next=this.g=this.h=null}}let J,W=!1,oe=new ee,X=()=>{const c=l.Promise.resolve(void 0);J=()=>{c.then(re)}};var re=()=>{for(var c;c=S();){try{c.h.call(c.g)}catch(w){E(w)}var p=U;p.j(c),100>p.h&&(p.h++,c.next=p.g,p.g=c)}W=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}$.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const w=()=>{};l.addEventListener("test",w,p),l.removeEventListener("test",w,p)}catch{}return c}();function ue(c,p){if($.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var w=this.type=c.type,M=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget){if(D){e:{try{k(p.nodeName);var F=!0;break e}catch{}F=!1}F||(p=null)}}else w=="mouseover"?p=c.fromElement:w=="mouseout"&&(p=c.toElement);this.relatedTarget=p,M?(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:se[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&ue.aa.h.call(this)}}y(ue,$);var se={2:"touch",3:"pen",4:"mouse"};ue.prototype.h=function(){ue.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var ve="closure_listenable_"+(1e6*Math.random()|0),ke=0;function me(c,p,w,M,F){this.listener=c,this.proxy=null,this.src=p,this.type=w,this.capture=!!M,this.ha=F,this.key=++ke,this.da=this.fa=!1}function be(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function we(c){this.src=c,this.g={},this.h=0}we.prototype.add=function(c,p,w,M,F){var G=c.toString();c=this.g[G],c||(c=this.g[G]=[],this.h++);var le=pe(c,p,M,F);return-1<le?(p=c[le],w||(p.fa=!1)):(p=new me(p,this.src,G,!!M,F),p.fa=w,c.push(p)),p};function V(c,p){var w=p.type;if(w in c.g){var M=c.g[w],F=Array.prototype.indexOf.call(M,p,void 0),G;(G=0<=F)&&Array.prototype.splice.call(M,F,1),G&&(be(p),c.g[w].length==0&&(delete c.g[w],c.h--))}}function pe(c,p,w,M){for(var F=0;F<c.length;++F){var G=c[F];if(!G.da&&G.listener==p&&G.capture==!!w&&G.ha==M)return F}return-1}var Y="closure_lm_"+(1e6*Math.random()|0),Ne={};function _e(c,p,w,M,F){if(Array.isArray(p)){for(var G=0;G<p.length;G++)_e(c,p[G],w,M,F);return null}return w=$e(w),c&&c[ve]?c.K(p,w,u(M)?!!M.capture:!!M,F):B(c,p,w,!1,M,F)}function B(c,p,w,M,F,G){if(!p)throw Error("Invalid event type");var le=u(F)?!!F.capture:!!F,nt=Re(c);if(nt||(c[Y]=nt=new we(c)),w=nt.add(p,w,M,le,G),w.proxy)return w;if(M=ae(),w.proxy=M,M.src=c,M.listener=w,c.addEventListener)q||(F=le),F===void 0&&(F=!1),c.addEventListener(p.toString(),M,F);else if(c.attachEvent)c.attachEvent(Ye(p.toString()),M);else if(c.addListener&&c.removeListener)c.addListener(M);else throw Error("addEventListener and attachEvent are unavailable.");return w}function ae(){function c(w){return p.call(c.src,c.listener,w)}const p=Be;return c}function Ce(c,p,w,M,F){if(Array.isArray(p))for(var G=0;G<p.length;G++)Ce(c,p[G],w,M,F);else M=u(M)?!!M.capture:!!M,w=$e(w),c&&c[ve]?(c=c.i,p=String(p).toString(),p in c.g&&(G=c.g[p],w=pe(G,w,M,F),-1<w&&(be(G[w]),Array.prototype.splice.call(G,w,1),G.length==0&&(delete c.g[p],c.h--)))):c&&(c=Re(c))&&(p=c.g[p.toString()],c=-1,p&&(c=pe(p,w,M,F)),(w=-1<c?p[c]:null)&&ze(w))}function ze(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[ve])V(p.i,c);else{var w=c.type,M=c.proxy;p.removeEventListener?p.removeEventListener(w,M,c.capture):p.detachEvent?p.detachEvent(Ye(w),M):p.addListener&&p.removeListener&&p.removeListener(M),(w=Re(p))?(V(w,c),w.h==0&&(w.src=null,p[Y]=null)):be(c)}}}function Ye(c){return c in Ne?Ne[c]:Ne[c]="on"+c}function Be(c,p){if(c.da)c=!0;else{p=new ue(p,this);var w=c.listener,M=c.ha||c.src;c.fa&&ze(c),c=w.call(M,p)}return c}function Re(c){return c=c[Y],c instanceof we?c:null}var ct="__closure_events_fn_"+(1e9*Math.random()>>>0);function $e(c){return typeof c=="function"?c:(c[ct]||(c[ct]=function(p){return c.handleEvent(p)}),c[ct])}function We(){Z.call(this),this.i=new we(this),this.M=this,this.F=null}y(We,Z),We.prototype[ve]=!0,We.prototype.removeEventListener=function(c,p,w,M){Ce(this,c,p,w,M)};function st(c,p){var w,M=c.F;if(M)for(w=[];M;M=M.F)w.push(M);if(c=c.M,M=p.type||p,typeof p=="string")p=new $(p,c);else if(p instanceof $)p.target=p.target||c;else{var F=p;p=new $(M,c),f(p,F)}if(F=!0,w)for(var G=w.length-1;0<=G;G--){var le=p.g=w[G];F=Gr(le,M,!0,p)&&F}if(le=p.g=c,F=Gr(le,M,!0,p)&&F,F=Gr(le,M,!1,p)&&F,w)for(G=0;G<w.length;G++)le=p.g=w[G],F=Gr(le,M,!1,p)&&F}We.prototype.N=function(){if(We.aa.N.call(this),this.i){var c=this.i,p;for(p in c.g){for(var w=c.g[p],M=0;M<w.length;M++)be(w[M]);delete c.g[p],c.h--}}this.F=null},We.prototype.K=function(c,p,w,M){return this.i.add(String(c),p,!1,w,M)},We.prototype.L=function(c,p,w,M){return this.i.add(String(c),p,!0,w,M)};function Gr(c,p,w,M){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();for(var F=!0,G=0;G<p.length;++G){var le=p[G];if(le&&!le.da&&le.capture==w){var nt=le.listener,Mt=le.ha||le.src;le.fa&&V(c.i,le),F=nt.call(Mt,M)!==!1&&F}}return F&&!M.defaultPrevented}function Ml(c,p,w){if(typeof c=="function")w&&(c=g(c,w));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:l.setTimeout(c,p||0)}function cg(c){c.g=Ml(()=>{c.g=null,c.i&&(c.i=!1,cg(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class g1 extends Z{constructor(p,w){super(),this.m=p,this.l=w,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:cg(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ma(c){Z.call(this),this.h=c,this.g={}}y(Ma,Z);var dg=[];function ug(c){P(c.g,function(p,w){this.g.hasOwnProperty(w)&&ze(p)},c),c.g={}}Ma.prototype.N=function(){Ma.aa.N.call(this),ug(this)},Ma.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Du=l.JSON.stringify,x1=l.JSON.parse,y1=class{stringify(c){return l.JSON.stringify(c,void 0)}parse(c){return l.JSON.parse(c,void 0)}};function Mu(){}Mu.prototype.h=null;function hg(c){return c.h||(c.h=c.i())}function mg(){}var La={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Lu(){$.call(this,"d")}y(Lu,$);function Vu(){$.call(this,"c")}y(Vu,$);var Wr={},pg=null;function Ll(){return pg=pg||new We}Wr.La="serverreachability";function fg(c){$.call(this,Wr.La,c)}y(fg,$);function Va(c){const p=Ll();st(p,new fg(p))}Wr.STAT_EVENT="statevent";function gg(c,p){$.call(this,Wr.STAT_EVENT,c),this.stat=p}y(gg,$);function ns(c){const p=Ll();st(p,new gg(p,c))}Wr.Ma="timingevent";function xg(c,p){$.call(this,Wr.Ma,c),this.size=p}y(xg,$);function Oa(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){c()},p)}function Fa(){this.g=!0}Fa.prototype.xa=function(){this.g=!1};function v1(c,p,w,M,F,G){c.info(function(){if(c.g)if(G)for(var le="",nt=G.split("&"),Mt=0;Mt<nt.length;Mt++){var He=nt[Mt].split("=");if(1<He.length){var Gt=He[0];He=He[1];var Wt=Gt.split("_");le=2<=Wt.length&&Wt[1]=="type"?le+(Gt+"="+He+"&"):le+(Gt+"=redacted&")}}else le=null;else le=G;return"XMLHTTP REQ ("+M+") [attempt "+F+"]: "+p+`
`+w+`
`+le})}function b1(c,p,w,M,F,G,le){c.info(function(){return"XMLHTTP RESP ("+M+") [ attempt "+F+"]: "+p+`
`+w+`
`+G+" "+le})}function Ii(c,p,w,M){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+j1(c,w)+(M?" "+M:"")})}function w1(c,p){c.info(function(){return"TIMEOUT: "+p})}Fa.prototype.info=function(){};function j1(c,p){if(!c.g)return p;if(!p)return null;try{var w=JSON.parse(p);if(w){for(c=0;c<w.length;c++)if(Array.isArray(w[c])){var M=w[c];if(!(2>M.length)){var F=M[1];if(Array.isArray(F)&&!(1>F.length)){var G=F[0];if(G!="noop"&&G!="stop"&&G!="close")for(var le=1;le<F.length;le++)F[le]=""}}}}return Du(w)}catch{return p}}var Vl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},yg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ou;function Ol(){}y(Ol,Mu),Ol.prototype.g=function(){return new XMLHttpRequest},Ol.prototype.i=function(){return{}},Ou=new Ol;function Zn(c,p,w,M){this.j=c,this.i=p,this.l=w,this.R=M||1,this.U=new Ma(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new vg}function vg(){this.i=null,this.g="",this.h=!1}var bg={},Fu={};function $u(c,p,w){c.L=1,c.v=zl(Sn(p)),c.m=w,c.P=!0,wg(c,null)}function wg(c,p){c.F=Date.now(),Fl(c),c.A=Sn(c.v);var w=c.A,M=c.R;Array.isArray(M)||(M=[String(M)]),Mg(w.i,"t",M),c.C=0,w=c.j.J,c.h=new vg,c.g=Zg(c.j,w?p:null,!c.m),0<c.O&&(c.M=new g1(g(c.Y,c,c.g),c.O)),p=c.U,w=c.g,M=c.ca;var F="readystatechange";Array.isArray(F)||(F&&(dg[0]=F.toString()),F=dg);for(var G=0;G<F.length;G++){var le=_e(w,F[G],M||p.handleEvent,!1,p.h||p);if(!le)break;p.g[le.key]=le}p=c.H?b(c.H):{},c.m?(c.u||(c.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,p)):(c.u="GET",c.g.ea(c.A,c.u,null,p)),Va(),v1(c.i,c.u,c.A,c.l,c.R,c.m)}Zn.prototype.ca=function(c){c=c.target;const p=this.M;p&&En(c)==3?p.j():this.Y(c)},Zn.prototype.Y=function(c){try{if(c==this.g)e:{const Wt=En(this.g);var p=this.g.Ba();const Ti=this.g.Z();if(!(3>Wt)&&(Wt!=3||this.g&&(this.h.h||this.g.oa()||zg(this.g)))){this.J||Wt!=4||p==7||(p==8||0>=Ti?Va(3):Va(2)),Uu(this);var w=this.g.Z();this.X=w;t:if(jg(this)){var M=zg(this.g);c="";var F=M.length,G=En(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Hr(this),$a(this);var le="";break t}this.h.i=new l.TextDecoder}for(p=0;p<F;p++)this.h.h=!0,c+=this.h.i.decode(M[p],{stream:!(G&&p==F-1)});M.length=0,this.h.g+=c,this.C=0,le=this.h.g}else le=this.g.oa();if(this.o=w==200,b1(this.i,this.u,this.A,this.l,this.R,Wt,w),this.o){if(this.T&&!this.K){t:{if(this.g){var nt,Mt=this.g;if((nt=Mt.g?Mt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(nt)){var He=nt;break t}}He=null}if(w=He)Ii(this.i,this.l,w,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zu(this,w);else{this.o=!1,this.s=3,ns(12),Hr(this),$a(this);break e}}if(this.P){w=!0;let Gs;for(;!this.J&&this.C<le.length;)if(Gs=N1(this,le),Gs==Fu){Wt==4&&(this.s=4,ns(14),w=!1),Ii(this.i,this.l,null,"[Incomplete Response]");break}else if(Gs==bg){this.s=4,ns(15),Ii(this.i,this.l,le,"[Invalid Chunk]"),w=!1;break}else Ii(this.i,this.l,Gs,null),zu(this,Gs);if(jg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Wt!=4||le.length!=0||this.h.h||(this.s=1,ns(16),w=!1),this.o=this.o&&w,!w)Ii(this.i,this.l,le,"[Invalid Chunked Response]"),Hr(this),$a(this);else if(0<le.length&&!this.W){this.W=!0;var Gt=this.j;Gt.g==this&&Gt.ba&&!Gt.M&&(Gt.j.info("Great, no buffering proxy detected. Bytes received: "+le.length),Ku(Gt),Gt.M=!0,ns(11))}}else Ii(this.i,this.l,le,null),zu(this,le);Wt==4&&Hr(this),this.o&&!this.J&&(Wt==4?Qg(this.j,this):(this.o=!1,Fl(this)))}else $1(this.g),w==400&&0<le.indexOf("Unknown SID")?(this.s=3,ns(12)):(this.s=0,ns(13)),Hr(this),$a(this)}}}catch{}finally{}};function jg(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function N1(c,p){var w=c.C,M=p.indexOf(`
`,w);return M==-1?Fu:(w=Number(p.substring(w,M)),isNaN(w)?bg:(M+=1,M+w>p.length?Fu:(p=p.slice(M,M+w),c.C=M+w,p)))}Zn.prototype.cancel=function(){this.J=!0,Hr(this)};function Fl(c){c.S=Date.now()+c.I,Ng(c,c.I)}function Ng(c,p){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Oa(g(c.ba,c),p)}function Uu(c){c.B&&(l.clearTimeout(c.B),c.B=null)}Zn.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(w1(this.i,this.A),this.L!=2&&(Va(),ns(17)),Hr(this),this.s=2,$a(this)):Ng(this,this.S-c)};function $a(c){c.j.G==0||c.J||Qg(c.j,c)}function Hr(c){Uu(c);var p=c.M;p&&typeof p.ma=="function"&&p.ma(),c.M=null,ug(c.U),c.g&&(p=c.g,c.g=null,p.abort(),p.ma())}function zu(c,p){try{var w=c.j;if(w.G!=0&&(w.g==c||Bu(w.h,c))){if(!c.K&&Bu(w.h,c)&&w.G==3){try{var M=w.Da.g.parse(p)}catch{M=null}if(Array.isArray(M)&&M.length==3){var F=M;if(F[0]==0){e:if(!w.u){if(w.g)if(w.g.F+3e3<c.F)Kl(w),Wl(w);else break e;Hu(w),ns(18)}}else w.za=F[1],0<w.za-w.T&&37500>F[2]&&w.F&&w.v==0&&!w.C&&(w.C=Oa(g(w.Za,w),6e3));if(1>=Eg(w.h)&&w.ca){try{w.ca()}catch{}w.ca=void 0}}else Qr(w,11)}else if((c.K||w.g==c)&&Kl(w),!A(p))for(F=w.Da.g.parse(p),p=0;p<F.length;p++){let He=F[p];if(w.T=He[0],He=He[1],w.G==2)if(He[0]=="c"){w.K=He[1],w.ia=He[2];const Gt=He[3];Gt!=null&&(w.la=Gt,w.j.info("VER="+w.la));const Wt=He[4];Wt!=null&&(w.Aa=Wt,w.j.info("SVER="+w.Aa));const Ti=He[5];Ti!=null&&typeof Ti=="number"&&0<Ti&&(M=1.5*Ti,w.L=M,w.j.info("backChannelRequestTimeoutMs_="+M)),M=w;const Gs=c.g;if(Gs){const Yl=Gs.g?Gs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Yl){var G=M.h;G.g||Yl.indexOf("spdy")==-1&&Yl.indexOf("quic")==-1&&Yl.indexOf("h2")==-1||(G.j=G.l,G.g=new Set,G.h&&(qu(G,G.h),G.h=null))}if(M.D){const Qu=Gs.g?Gs.g.getResponseHeader("X-HTTP-Session-Id"):null;Qu&&(M.ya=Qu,it(M.I,M.D,Qu))}}w.G=3,w.l&&w.l.ua(),w.ba&&(w.R=Date.now()-c.F,w.j.info("Handshake RTT: "+w.R+"ms")),M=w;var le=c;if(M.qa=Jg(M,M.J?M.ia:null,M.W),le.K){Ag(M.h,le);var nt=le,Mt=M.L;Mt&&(nt.I=Mt),nt.B&&(Uu(nt),Fl(nt)),M.g=le}else Hg(M);0<w.i.length&&Hl(w)}else He[0]!="stop"&&He[0]!="close"||Qr(w,7);else w.G==3&&(He[0]=="stop"||He[0]=="close"?He[0]=="stop"?Qr(w,7):Wu(w):He[0]!="noop"&&w.l&&w.l.ta(He),w.v=0)}}Va(4)}catch{}}var _1=class{constructor(c,p){this.g=c,this.map=p}};function _g(c){this.l=c||10,l.PerformanceNavigationTiming?(c=l.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Sg(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Eg(c){return c.h?1:c.g?c.g.size:0}function Bu(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function qu(c,p){c.g?c.g.add(p):c.h=p}function Ag(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}_g.prototype.cancel=function(){if(this.i=Ig(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Ig(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const w of c.g.values())p=p.concat(w.D);return p}return R(c.i)}function S1(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(d(c)){for(var p=[],w=c.length,M=0;M<w;M++)p.push(c[M]);return p}p=[],w=0;for(M in c)p[w++]=c[M];return p}function E1(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(d(c)||typeof c=="string"){var p=[];c=c.length;for(var w=0;w<c;w++)p.push(w);return p}p=[],w=0;for(const M in c)p[w++]=M;return p}}}function kg(c,p){if(c.forEach&&typeof c.forEach=="function")c.forEach(p,void 0);else if(d(c)||typeof c=="string")Array.prototype.forEach.call(c,p,void 0);else for(var w=E1(c),M=S1(c),F=M.length,G=0;G<F;G++)p.call(void 0,M[G],w&&w[G],c)}var Cg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function A1(c,p){if(c){c=c.split("&");for(var w=0;w<c.length;w++){var M=c[w].indexOf("="),F=null;if(0<=M){var G=c[w].substring(0,M);F=c[w].substring(M+1)}else G=c[w];p(G,F?decodeURIComponent(F.replace(/\+/g," ")):"")}}}function Kr(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Kr){this.h=c.h,$l(this,c.j),this.o=c.o,this.g=c.g,Ul(this,c.s),this.l=c.l;var p=c.i,w=new Ba;w.i=p.i,p.g&&(w.g=new Map(p.g),w.h=p.h),Tg(this,w),this.m=c.m}else c&&(p=String(c).match(Cg))?(this.h=!1,$l(this,p[1]||"",!0),this.o=Ua(p[2]||""),this.g=Ua(p[3]||"",!0),Ul(this,p[4]),this.l=Ua(p[5]||"",!0),Tg(this,p[6]||"",!0),this.m=Ua(p[7]||"")):(this.h=!1,this.i=new Ba(null,this.h))}Kr.prototype.toString=function(){var c=[],p=this.j;p&&c.push(za(p,Rg,!0),":");var w=this.g;return(w||p=="file")&&(c.push("//"),(p=this.o)&&c.push(za(p,Rg,!0),"@"),c.push(encodeURIComponent(String(w)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),w=this.s,w!=null&&c.push(":",String(w))),(w=this.l)&&(this.g&&w.charAt(0)!="/"&&c.push("/"),c.push(za(w,w.charAt(0)=="/"?C1:k1,!0))),(w=this.i.toString())&&c.push("?",w),(w=this.m)&&c.push("#",za(w,R1)),c.join("")};function Sn(c){return new Kr(c)}function $l(c,p,w){c.j=w?Ua(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function Ul(c,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);c.s=p}else c.s=null}function Tg(c,p,w){p instanceof Ba?(c.i=p,P1(c.i,c.h)):(w||(p=za(p,T1)),c.i=new Ba(p,c.h))}function it(c,p,w){c.i.set(p,w)}function zl(c){return it(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Ua(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function za(c,p,w){return typeof c=="string"?(c=encodeURI(c).replace(p,I1),w&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function I1(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Rg=/[#\/\?@]/g,k1=/[#\?:]/g,C1=/[#\?]/g,T1=/[#\?@]/g,R1=/#/g;function Ba(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function er(c){c.g||(c.g=new Map,c.h=0,c.i&&A1(c.i,function(p,w){c.add(decodeURIComponent(p.replace(/\+/g," ")),w)}))}t=Ba.prototype,t.add=function(c,p){er(this),this.i=null,c=ki(this,c);var w=this.g.get(c);return w||this.g.set(c,w=[]),w.push(p),this.h+=1,this};function Pg(c,p){er(c),p=ki(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function Dg(c,p){return er(c),p=ki(c,p),c.g.has(p)}t.forEach=function(c,p){er(this),this.g.forEach(function(w,M){w.forEach(function(F){c.call(p,F,M,this)},this)},this)},t.na=function(){er(this);const c=Array.from(this.g.values()),p=Array.from(this.g.keys()),w=[];for(let M=0;M<p.length;M++){const F=c[M];for(let G=0;G<F.length;G++)w.push(p[M])}return w},t.V=function(c){er(this);let p=[];if(typeof c=="string")Dg(this,c)&&(p=p.concat(this.g.get(ki(this,c))));else{c=Array.from(this.g.values());for(let w=0;w<c.length;w++)p=p.concat(c[w])}return p},t.set=function(c,p){return er(this),this.i=null,c=ki(this,c),Dg(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},t.get=function(c,p){return c?(c=this.V(c),0<c.length?String(c[0]):p):p};function Mg(c,p,w){Pg(c,p),0<w.length&&(c.i=null,c.g.set(ki(c,p),R(w)),c.h+=w.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(var w=0;w<p.length;w++){var M=p[w];const G=encodeURIComponent(String(M)),le=this.V(M);for(M=0;M<le.length;M++){var F=G;le[M]!==""&&(F+="="+encodeURIComponent(String(le[M]))),c.push(F)}}return this.i=c.join("&")};function ki(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function P1(c,p){p&&!c.j&&(er(c),c.i=null,c.g.forEach(function(w,M){var F=M.toLowerCase();M!=F&&(Pg(this,M),Mg(this,F,w))},c)),c.j=p}function D1(c,p){const w=new Fa;if(l.Image){const M=new Image;M.onload=x(tr,w,"TestLoadImage: loaded",!0,p,M),M.onerror=x(tr,w,"TestLoadImage: error",!1,p,M),M.onabort=x(tr,w,"TestLoadImage: abort",!1,p,M),M.ontimeout=x(tr,w,"TestLoadImage: timeout",!1,p,M),l.setTimeout(function(){M.ontimeout&&M.ontimeout()},1e4),M.src=c}else p(!1)}function M1(c,p){const w=new Fa,M=new AbortController,F=setTimeout(()=>{M.abort(),tr(w,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:M.signal}).then(G=>{clearTimeout(F),G.ok?tr(w,"TestPingServer: ok",!0,p):tr(w,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(F),tr(w,"TestPingServer: error",!1,p)})}function tr(c,p,w,M,F){try{F&&(F.onload=null,F.onerror=null,F.onabort=null,F.ontimeout=null),M(w)}catch{}}function L1(){this.g=new y1}function V1(c,p,w){const M=w||"";try{kg(c,function(F,G){let le=F;u(F)&&(le=Du(F)),p.push(M+G+"="+encodeURIComponent(le))})}catch(F){throw p.push(M+"type="+encodeURIComponent("_badmap")),F}}function Bl(c){this.l=c.Ub||null,this.j=c.eb||!1}y(Bl,Mu),Bl.prototype.g=function(){return new ql(this.l,this.j)},Bl.prototype.i=function(c){return function(){return c}}({});function ql(c,p){We.call(this),this.D=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(ql,We),t=ql.prototype,t.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=p,this.readyState=1,Ga(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(p.body=c),(this.D||l).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qa(this)),this.readyState=0},t.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Ga(this)),this.g&&(this.readyState=3,Ga(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lg(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function Lg(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}t.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?qa(this):Ga(this),this.readyState==3&&Lg(this)}},t.Ra=function(c){this.g&&(this.response=this.responseText=c,qa(this))},t.Qa=function(c){this.g&&(this.response=c,qa(this))},t.ga=function(){this.g&&qa(this)};function qa(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Ga(c)}t.setRequestHeader=function(c,p){this.u.append(c,p)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var w=p.next();!w.done;)w=w.value,c.push(w[0]+": "+w[1]),w=p.next();return c.join(`\r
`)};function Ga(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(ql.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Vg(c){let p="";return P(c,function(w,M){p+=M,p+=":",p+=w,p+=`\r
`}),p}function Gu(c,p,w){e:{for(M in w){var M=!1;break e}M=!0}M||(w=Vg(w),typeof c=="string"?w!=null&&encodeURIComponent(String(w)):it(c,p,w))}function gt(c){We.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(gt,We);var O1=/^https?$/i,F1=["POST","PUT"];t=gt.prototype,t.Ha=function(c){this.J=c},t.ea=function(c,p,w,M){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ou.g(),this.v=this.o?hg(this.o):hg(Ou),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(G){Og(this,G);return}if(c=w||"",w=new Map(this.headers),M)if(Object.getPrototypeOf(M)===Object.prototype)for(var F in M)w.set(F,M[F]);else if(typeof M.keys=="function"&&typeof M.get=="function")for(const G of M.keys())w.set(G,M.get(G));else throw Error("Unknown input type for opt_headers: "+String(M));M=Array.from(w.keys()).find(G=>G.toLowerCase()=="content-type"),F=l.FormData&&c instanceof l.FormData,!(0<=Array.prototype.indexOf.call(F1,p,void 0))||M||F||w.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,le]of w)this.g.setRequestHeader(G,le);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ug(this),this.u=!0,this.g.send(c),this.u=!1}catch(G){Og(this,G)}};function Og(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.m=5,Fg(c),Gl(c)}function Fg(c){c.A||(c.A=!0,st(c,"complete"),st(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,st(this,"complete"),st(this,"abort"),Gl(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gl(this,!0)),gt.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?$g(this):this.bb())},t.bb=function(){$g(this)};function $g(c){if(c.h&&typeof o<"u"&&(!c.v[1]||En(c)!=4||c.Z()!=2)){if(c.u&&En(c)==4)Ml(c.Ea,0,c);else if(st(c,"readystatechange"),En(c)==4){c.h=!1;try{const le=c.Z();e:switch(le){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var w;if(!(w=p)){var M;if(M=le===0){var F=String(c.D).match(Cg)[1]||null;!F&&l.self&&l.self.location&&(F=l.self.location.protocol.slice(0,-1)),M=!O1.test(F?F.toLowerCase():"")}w=M}if(w)st(c,"complete"),st(c,"success");else{c.m=6;try{var G=2<En(c)?c.g.statusText:""}catch{G=""}c.l=G+" ["+c.Z()+"]",Fg(c)}}finally{Gl(c)}}}}function Gl(c,p){if(c.g){Ug(c);const w=c.g,M=c.v[0]?()=>{}:null;c.g=null,c.v=null,p||st(c,"ready");try{w.onreadystatechange=M}catch{}}}function Ug(c){c.I&&(l.clearTimeout(c.I),c.I=null)}t.isActive=function(){return!!this.g};function En(c){return c.g?c.g.readyState:0}t.Z=function(){try{return 2<En(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),x1(p)}};function zg(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function $1(c){const p={};c=(c.g&&2<=En(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let M=0;M<c.length;M++){if(A(c[M]))continue;var w=j(c[M]);const F=w[0];if(w=w[1],typeof w!="string")continue;w=w.trim();const G=p[F]||[];p[F]=G,G.push(w)}v(p,function(M){return M.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wa(c,p,w){return w&&w.internalChannelParams&&w.internalChannelParams[c]||p}function Bg(c){this.Aa=0,this.i=[],this.j=new Fa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wa("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wa("baseRetryDelayMs",5e3,c),this.cb=Wa("retryDelaySeedMs",1e4,c),this.Wa=Wa("forwardChannelMaxRetries",2,c),this.wa=Wa("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new _g(c&&c.concurrentRequestLimit),this.Da=new L1,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Bg.prototype,t.la=8,t.G=1,t.connect=function(c,p,w,M){ns(0),this.W=c,this.H=p||{},w&&M!==void 0&&(this.H.OSID=w,this.H.OAID=M),this.F=this.X,this.I=Jg(this,null,this.W),Hl(this)};function Wu(c){if(qg(c),c.G==3){var p=c.U++,w=Sn(c.I);if(it(w,"SID",c.K),it(w,"RID",p),it(w,"TYPE","terminate"),Ha(c,w),p=new Zn(c,c.j,p),p.L=2,p.v=zl(Sn(w)),w=!1,l.navigator&&l.navigator.sendBeacon)try{w=l.navigator.sendBeacon(p.v.toString(),"")}catch{}!w&&l.Image&&(new Image().src=p.v,w=!0),w||(p.g=Zg(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Fl(p)}Xg(c)}function Wl(c){c.g&&(Ku(c),c.g.cancel(),c.g=null)}function qg(c){Wl(c),c.u&&(l.clearTimeout(c.u),c.u=null),Kl(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&l.clearTimeout(c.s),c.s=null)}function Hl(c){if(!Sg(c.h)&&!c.s){c.s=!0;var p=c.Ga;J||X(),W||(J(),W=!0),oe.add(p,c),c.B=0}}function U1(c,p){return Eg(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=p.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Oa(g(c.Ga,c,p),Yg(c,c.B)),c.B++,!0)}t.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const F=new Zn(this,this.j,c);let G=this.o;if(this.S&&(G?(G=b(G),f(G,this.S)):G=this.S),this.m!==null||this.O||(F.H=G,G=null),this.P)e:{for(var p=0,w=0;w<this.i.length;w++){t:{var M=this.i[w];if("__data__"in M.map&&(M=M.map.__data__,typeof M=="string")){M=M.length;break t}M=void 0}if(M===void 0)break;if(p+=M,4096<p){p=w;break e}if(p===4096||w===this.i.length-1){p=w+1;break e}}p=1e3}else p=1e3;p=Wg(this,F,p),w=Sn(this.I),it(w,"RID",c),it(w,"CVER",22),this.D&&it(w,"X-HTTP-Session-Id",this.D),Ha(this,w),G&&(this.O?p="headers="+encodeURIComponent(String(Vg(G)))+"&"+p:this.m&&Gu(w,this.m,G)),qu(this.h,F),this.Ua&&it(w,"TYPE","init"),this.P?(it(w,"$req",p),it(w,"SID","null"),F.T=!0,$u(F,w,null)):$u(F,w,p),this.G=2}}else this.G==3&&(c?Gg(this,c):this.i.length==0||Sg(this.h)||Gg(this))};function Gg(c,p){var w;p?w=p.l:w=c.U++;const M=Sn(c.I);it(M,"SID",c.K),it(M,"RID",w),it(M,"AID",c.T),Ha(c,M),c.m&&c.o&&Gu(M,c.m,c.o),w=new Zn(c,c.j,w,c.B+1),c.m===null&&(w.H=c.o),p&&(c.i=p.D.concat(c.i)),p=Wg(c,w,1e3),w.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),qu(c.h,w),$u(w,M,p)}function Ha(c,p){c.H&&P(c.H,function(w,M){it(p,M,w)}),c.l&&kg({},function(w,M){it(p,M,w)})}function Wg(c,p,w){w=Math.min(c.i.length,w);var M=c.l?g(c.l.Na,c.l,c):null;e:{var F=c.i;let G=-1;for(;;){const le=["count="+w];G==-1?0<w?(G=F[0].g,le.push("ofs="+G)):G=0:le.push("ofs="+G);let nt=!0;for(let Mt=0;Mt<w;Mt++){let He=F[Mt].g;const Gt=F[Mt].map;if(He-=G,0>He)G=Math.max(0,F[Mt].g-100),nt=!1;else try{V1(Gt,le,"req"+He+"_")}catch{M&&M(Gt)}}if(nt){M=le.join("&");break e}}}return c=c.i.splice(0,w),p.D=c,M}function Hg(c){if(!c.g&&!c.u){c.Y=1;var p=c.Fa;J||X(),W||(J(),W=!0),oe.add(p,c),c.v=0}}function Hu(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Oa(g(c.Fa,c),Yg(c,c.v)),c.v++,!0)}t.Fa=function(){if(this.u=null,Kg(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Oa(g(this.ab,this),c)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ns(10),Wl(this),Kg(this))};function Ku(c){c.A!=null&&(l.clearTimeout(c.A),c.A=null)}function Kg(c){c.g=new Zn(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var p=Sn(c.qa);it(p,"RID","rpc"),it(p,"SID",c.K),it(p,"AID",c.T),it(p,"CI",c.F?"0":"1"),!c.F&&c.ja&&it(p,"TO",c.ja),it(p,"TYPE","xmlhttp"),Ha(c,p),c.m&&c.o&&Gu(p,c.m,c.o),c.L&&(c.g.I=c.L);var w=c.g;c=c.ia,w.L=1,w.v=zl(Sn(p)),w.m=null,w.P=!0,wg(w,c)}t.Za=function(){this.C!=null&&(this.C=null,Wl(this),Hu(this),ns(19))};function Kl(c){c.C!=null&&(l.clearTimeout(c.C),c.C=null)}function Qg(c,p){var w=null;if(c.g==p){Kl(c),Ku(c),c.g=null;var M=2}else if(Bu(c.h,p))w=p.D,Ag(c.h,p),M=1;else return;if(c.G!=0){if(p.o)if(M==1){w=p.m?p.m.length:0,p=Date.now()-p.F;var F=c.B;M=Ll(),st(M,new xg(M,w)),Hl(c)}else Hg(c);else if(F=p.s,F==3||F==0&&0<p.X||!(M==1&&U1(c,p)||M==2&&Hu(c)))switch(w&&0<w.length&&(p=c.h,p.i=p.i.concat(w)),F){case 1:Qr(c,5);break;case 4:Qr(c,10);break;case 3:Qr(c,6);break;default:Qr(c,2)}}}function Yg(c,p){let w=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(w*=2),w*p}function Qr(c,p){if(c.j.info("Error code "+p),p==2){var w=g(c.fb,c),M=c.Xa;const F=!M;M=new Kr(M||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||$l(M,"https"),zl(M),F?D1(M.toString(),w):M1(M.toString(),w)}else ns(2);c.G=0,c.l&&c.l.sa(p),Xg(c),qg(c)}t.fb=function(c){c?(this.j.info("Successfully pinged google.com"),ns(2)):(this.j.info("Failed to ping google.com"),ns(1))};function Xg(c){if(c.G=0,c.ka=[],c.l){const p=Ig(c.h);(p.length!=0||c.i.length!=0)&&(_(c.ka,p),_(c.ka,c.i),c.h.i.length=0,R(c.i),c.i.length=0),c.l.ra()}}function Jg(c,p,w){var M=w instanceof Kr?Sn(w):new Kr(w);if(M.g!="")p&&(M.g=p+"."+M.g),Ul(M,M.s);else{var F=l.location;M=F.protocol,p=p?p+"."+F.hostname:F.hostname,F=+F.port;var G=new Kr(null);M&&$l(G,M),p&&(G.g=p),F&&Ul(G,F),w&&(G.l=w),M=G}return w=c.D,p=c.ya,w&&p&&it(M,w,p),it(M,"VER",c.la),Ha(c,M),M}function Zg(c,p,w){if(p&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Ca&&!c.pa?new gt(new Bl({eb:w})):new gt(c.pa),p.Ha(c.J),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function ex(){}t=ex.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Ql(){}Ql.prototype.g=function(c,p){return new ws(c,p)};function ws(c,p){We.call(this),this.g=new Bg(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(c?c["X-WebChannel-Client-Profile"]=p.va:c={"X-WebChannel-Client-Profile":p.va}),this.g.S=c,(c=p&&p.Sb)&&!A(c)&&(this.g.m=c),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!A(p)&&(this.g.D=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new Ci(this)}y(ws,We),ws.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ws.prototype.close=function(){Wu(this.g)},ws.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var w={};w.__data__=c,c=w}else this.u&&(w={},w.__data__=Du(c),c=w);p.i.push(new _1(p.Ya++,c)),p.G==3&&Hl(p)},ws.prototype.N=function(){this.g.l=null,delete this.j,Wu(this.g),delete this.g,ws.aa.N.call(this)};function tx(c){Lu.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const w in p){c=w;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}y(tx,Lu);function sx(){Vu.call(this),this.status=1}y(sx,Vu);function Ci(c){this.g=c}y(Ci,ex),Ci.prototype.ua=function(){st(this.g,"a")},Ci.prototype.ta=function(c){st(this.g,new tx(c))},Ci.prototype.sa=function(c){st(this.g,new sx)},Ci.prototype.ra=function(){st(this.g,"b")},Ql.prototype.createWebChannel=Ql.prototype.g,ws.prototype.send=ws.prototype.o,ws.prototype.open=ws.prototype.m,ws.prototype.close=ws.prototype.close,$j=function(){return new Ql},Fj=function(){return Ll()},Oj=Wr,zm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vl.NO_ERROR=0,Vl.TIMEOUT=8,Vl.HTTP_ERROR=6,Oc=Vl,yg.COMPLETE="complete",Vj=yg,mg.EventType=La,La.OPEN="a",La.CLOSE="b",La.ERROR="c",La.MESSAGE="d",We.prototype.listen=We.prototype.K,co=mg,gt.prototype.listenOnce=gt.prototype.L,gt.prototype.getLastError=gt.prototype.Ka,gt.prototype.getLastErrorCode=gt.prototype.Ba,gt.prototype.getStatus=gt.prototype.Z,gt.prototype.getResponseJson=gt.prototype.Oa,gt.prototype.getResponseText=gt.prototype.oa,gt.prototype.send=gt.prototype.ea,gt.prototype.setWithCredentials=gt.prototype.Ha,Lj=gt}).apply(typeof gc<"u"?gc:typeof self<"u"?self:typeof window<"u"?window:{});const ty="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Xt.UNAUTHENTICATED=new Xt(null),Xt.GOOGLE_CREDENTIALS=new Xt("google-credentials-uid"),Xt.FIRST_PARTY=new Xt("first-party-uid"),Xt.MOCK_USER=new Xt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ta="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pi=new af("@firebase/firestore");function so(){return pi.logLevel}function ye(t,...e){if(pi.logLevel<=Oe.DEBUG){const s=e.map(vf);pi.debug(`Firestore (${Ta}): ${t}`,...s)}}function Wn(t,...e){if(pi.logLevel<=Oe.ERROR){const s=e.map(vf);pi.error(`Firestore (${Ta}): ${t}`,...s)}}function ga(t,...e){if(pi.logLevel<=Oe.WARN){const s=e.map(vf);pi.warn(`Firestore (${Ta}): ${t}`,...s)}}function vf(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Te(t="Unexpected state"){const e=`FIRESTORE (${Ta}) INTERNAL ASSERTION FAILED: `+t;throw Wn(e),new Error(e)}function et(t,e){t||Te()}function De(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fe extends jn{constructor(e,s){super(e,s),this.code=e,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(){this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(e,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _T{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,s){e.enqueueRetryable(()=>s(Xt.UNAUTHENTICATED))}shutdown(){}}class ST{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,s){this.changeListener=s,e.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class ET{constructor(e){this.t=e,this.currentUser=Xt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,s){et(this.o===void 0);let r=this.i;const i=d=>this.i!==r?(r=this.i,s(d)):Promise.resolve();let a=new Vn;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Vn,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const d=a;e.enqueueRetryable(async()=>{await d.promise,await i(this.currentUser)})},l=d=>{ye("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>l(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?l(d):(ye("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Vn)}},0),o()}getToken(){const e=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(r=>this.i!==e?(ye("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(et(typeof r.accessToken=="string"),new Uj(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return et(e===null||typeof e=="string"),new Xt(e)}}class AT{constructor(e,s,r){this.l=e,this.h=s,this.P=r,this.type="FirstParty",this.user=Xt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class IT{constructor(e,s,r){this.l=e,this.h=s,this.P=r}getToken(){return Promise.resolve(new AT(this.l,this.h,this.P))}start(e,s){e.enqueueRetryable(()=>s(Xt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class CT{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,s){et(this.o===void 0);const r=a=>{a.error!=null&&ye("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.R;return this.R=a.token,ye("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?s(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>r(a))};const i=a=>{ye("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(a=>i(a)),setTimeout(()=>{if(!this.appCheck){const a=this.A.getImmediate({optional:!0});a?i(a):ye("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(s=>s?(et(typeof s.token=="string"),this.R=s.token,new kT(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TT(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(s);else for(let r=0;r<t;r++)s[r]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=TT(40);for(let a=0;a<i.length;++a)r.length<20&&i[a]<s&&(r+=e.charAt(i[a]%e.length))}return r}}function Ke(t,e){return t<e?-1:t>e?1:0}function xa(t,e,s){return t.length===e.length&&t.every((r,i)=>s(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e,s){if(this.seconds=e,this.nanoseconds=s,s<0)throw new fe(te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new fe(te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(e<-62135596800)throw new fe(te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new fe(te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Q.fromMillis(Date.now())}static fromDate(e){return Q.fromMillis(e.getTime())}static fromMillis(e){const s=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*s));return new Q(s,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ke(this.nanoseconds,e.nanoseconds):Ke(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Pe(e)}static min(){return new Pe(new Q(0,0))}static max(){return new Pe(new Q(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e,s,r){s===void 0?s=0:s>e.length&&Te(),r===void 0?r=e.length-s:r>e.length-s&&Te(),this.segments=e,this.offset=s,this.len=r}get length(){return this.len}isEqual(e){return sl.comparator(this,e)===0}child(e){const s=this.segments.slice(this.offset,this.limit());return e instanceof sl?e.forEach(r=>{s.push(r)}):s.push(e),this.construct(s)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}forEach(e){for(let s=this.offset,r=this.limit();s<r;s++)e(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,s){const r=Math.min(e.length,s.length);for(let i=0;i<r;i++){const a=e.get(i),o=s.get(i);if(a<o)return-1;if(a>o)return 1}return e.length<s.length?-1:e.length>s.length?1:0}}class ot extends sl{construct(e,s,r){return new ot(e,s,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const s=[];for(const r of e){if(r.indexOf("//")>=0)throw new fe(te.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);s.push(...r.split("/").filter(i=>i.length>0))}return new ot(s)}static emptyPath(){return new ot([])}}const RT=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ot extends sl{construct(e,s,r){return new Ot(e,s,r)}static isValidIdentifier(e){return RT.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ot.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ot(["__name__"])}static fromServerFormat(e){const s=[];let r="",i=0;const a=()=>{if(r.length===0)throw new fe(te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(r),r=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new fe(te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new fe(te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(r+=l,i++):(a(),i++)}if(a(),o)throw new fe(te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ot(s)}static emptyPath(){return new Ot([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{constructor(e){this.path=e}static fromPath(e){return new je(ot.fromString(e))}static fromName(e){return new je(ot.fromString(e).popFirst(5))}static empty(){return new je(ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ot.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,s){return ot.comparator(e.path,s.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new je(new ot(e.slice()))}}function PT(t,e){const s=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Pe.fromTimestamp(r===1e9?new Q(s+1,0):new Q(s,r));return new Dr(i,je.empty(),e)}function DT(t){return new Dr(t.readTime,t.key,-1)}class Dr{constructor(e,s,r){this.readTime=e,this.documentKey=s,this.largestBatchId=r}static min(){return new Dr(Pe.min(),je.empty(),-1)}static max(){return new Dr(Pe.max(),je.empty(),-1)}}function MT(t,e){let s=t.readTime.compareTo(e.readTime);return s!==0?s:(s=je.comparator(t.documentKey,e.documentKey),s!==0?s:Ke(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class VT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _l(t){if(t.code!==te.FAILED_PRECONDITION||t.message!==LT)throw t;ye("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(e){return this.next(void 0,e)}next(e,s){return this.callbackAttached&&Te(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(e,this.result):new ne((r,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,i)},this.catchCallback=a=>{this.wrapFailure(s,a).next(r,i)}})}toPromise(){return new Promise((e,s)=>{this.next(e,s)})}wrapUserFunction(e){try{const s=e();return s instanceof ne?s:ne.resolve(s)}catch(s){return ne.reject(s)}}wrapSuccess(e,s){return e?this.wrapUserFunction(()=>e(s)):ne.resolve(s)}wrapFailure(e,s){return e?this.wrapUserFunction(()=>e(s)):ne.reject(s)}static resolve(e){return new ne((s,r)=>{s(e)})}static reject(e){return new ne((s,r)=>{r(e)})}static waitFor(e){return new ne((s,r)=>{let i=0,a=0,o=!1;e.forEach(l=>{++i,l.next(()=>{++a,o&&a===i&&s()},d=>r(d))}),o=!0,a===i&&s()})}static or(e){let s=ne.resolve(!1);for(const r of e)s=s.next(i=>i?ne.resolve(i):r());return s}static forEach(e,s){const r=[];return e.forEach((i,a)=>{r.push(s.call(this,i,a))}),this.waitFor(r)}static mapArray(e,s){return new ne((r,i)=>{const a=e.length,o=new Array(a);let l=0;for(let d=0;d<a;d++){const u=d;s(e[u]).next(h=>{o[u]=h,++l,l===a&&r(o)},h=>i(h))}})}static doWhile(e,s){return new ne((r,i)=>{const a=()=>{e()===!0?s().next(()=>{a()},i):r()};a()})}}function OT(t){const e=t.match(/Android ([\d.]+)/i),s=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function Sl(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e,s){this.previousValue=e,s&&(s.sequenceNumberHandler=r=>this.ie(r),this.se=r=>s.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}bf.oe=-1;function hu(t){return t==null}function Sd(t){return t===0&&1/t==-1/0}function FT(t){return typeof t=="number"&&Number.isInteger(t)&&!Sd(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sy(t){let e=0;for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e++;return e}function Ei(t,e){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e(s,t[s])}function Bj(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,s){this.comparator=e,this.root=s||Vt.EMPTY}insert(e,s){return new ft(this.comparator,this.root.insert(e,s,this.comparator).copy(null,null,Vt.BLACK,null,null))}remove(e){return new ft(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vt.BLACK,null,null))}get(e){let s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return s.value;r<0?s=s.left:r>0&&(s=s.right)}return null}indexOf(e){let s=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return s+r.left.size;i<0?r=r.left:(s+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((s,r)=>(e(s,r),!1))}toString(){const e=[];return this.inorderTraversal((s,r)=>(e.push(`${s}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xc(this.root,e,this.comparator,!1)}getReverseIterator(){return new xc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xc(this.root,e,this.comparator,!0)}}class xc{constructor(e,s,r,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=s?r(e.key,s):1,s&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const s={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vt{constructor(e,s,r,i,a){this.key=e,this.value=s,this.color=r??Vt.RED,this.left=i??Vt.EMPTY,this.right=a??Vt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,s,r,i,a){return new Vt(e??this.key,s??this.value,r??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,r){let i=this;const a=r(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,s,r),null):a===0?i.copy(null,s,null,null,null):i.copy(null,null,null,null,i.right.insert(e,s,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Vt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,s){let r,i=this;if(s(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,s),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),s(e,i.key)===0){if(i.right.isEmpty())return Vt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,s))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Te();const e=this.left.check();if(e!==this.right.check())throw Te();return e+(this.isRed()?0:1)}}Vt.EMPTY=null,Vt.RED=!0,Vt.BLACK=!1;Vt.EMPTY=new class{constructor(){this.size=0}get key(){throw Te()}get value(){throw Te()}get color(){throw Te()}get left(){throw Te()}get right(){throw Te()}copy(e,s,r,i,a){return this}insert(e,s,r){return new Vt(e,s)}remove(e,s){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.comparator=e,this.data=new ft(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((s,r)=>(e(s),!1))}forEachInRange(e,s){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;s(i.key)}}forEachWhile(e,s){let r;for(r=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const s=this.data.getIteratorFrom(e);return s.hasNext()?s.getNext().key:null}getIterator(){return new ny(this.data.getIterator())}getIteratorFrom(e){return new ny(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let s=this;return s.size<e.size&&(s=e,e=this),e.forEach(r=>{s=s.add(r)}),s}isEqual(e){if(!(e instanceof Ut)||this.size!==e.size)return!1;const s=this.data.getIterator(),r=e.data.getIterator();for(;s.hasNext();){const i=s.getNext().key,a=r.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(s=>{e.push(s)}),e}toString(){const e=[];return this.forEach(s=>e.push(s)),"SortedSet("+e.toString()+")"}copy(e){const s=new Ut(this.comparator);return s.data=e,s}}class ny{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e){this.fields=e,e.sort(Ot.comparator)}static empty(){return new Es([])}unionWith(e){let s=new Ut(Ot.comparator);for(const r of this.fields)s=s.add(r);for(const r of e)s=s.add(r);return new Es(s.toArray())}covers(e){for(const s of this.fields)if(s.isPrefixOf(e))return!0;return!1}isEqual(e){return xa(this.fields,e.fields,(s,r)=>s.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.binaryString=e}static fromBase64String(e){const s=function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new qj("Invalid base64 string: "+a):a}}(e);return new qt(s)}static fromUint8Array(e){const s=function(i){let a="";for(let o=0;o<i.length;++o)a+=String.fromCharCode(i[o]);return a}(e);return new qt(s)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const r=new Uint8Array(s.length);for(let i=0;i<s.length;i++)r[i]=s.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ke(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qt.EMPTY_BYTE_STRING=new qt("");const $T=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mr(t){if(et(!!t),typeof t=="string"){let e=0;const s=$T.exec(t);if(et(!!s),s[1]){let i=s[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:bt(t.seconds),nanos:bt(t.nanos)}}function bt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function fi(t){return typeof t=="string"?qt.fromBase64String(t):qt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wf(t){var e,s;return((s=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="server_timestamp"}function jf(t){const e=t.mapValue.fields.__previous_value__;return wf(e)?jf(e):e}function nl(t){const e=Mr(t.mapValue.fields.__local_write_time__.timestampValue);return new Q(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{constructor(e,s,r,i,a,o,l,d,u){this.databaseId=e,this.appId=s,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=u}}class rl{constructor(e,s){this.projectId=e,this.database=s||"(default)"}static empty(){return new rl("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof rl&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yc={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function gi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?wf(t)?4:BT(t)?9007199254740991:zT(t)?10:11:Te()}function gn(t,e){if(t===e)return!0;const s=gi(t);if(s!==gi(e))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return nl(t).isEqual(nl(e));case 3:return function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const o=Mr(i.timestampValue),l=Mr(a.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,a){return fi(i.bytesValue).isEqual(fi(a.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,a){return bt(i.geoPointValue.latitude)===bt(a.geoPointValue.latitude)&&bt(i.geoPointValue.longitude)===bt(a.geoPointValue.longitude)}(t,e);case 2:return function(i,a){if("integerValue"in i&&"integerValue"in a)return bt(i.integerValue)===bt(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const o=bt(i.doubleValue),l=bt(a.doubleValue);return o===l?Sd(o)===Sd(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return xa(t.arrayValue.values||[],e.arrayValue.values||[],gn);case 10:case 11:return function(i,a){const o=i.mapValue.fields||{},l=a.mapValue.fields||{};if(sy(o)!==sy(l))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(l[d]===void 0||!gn(o[d],l[d])))return!1;return!0}(t,e);default:return Te()}}function il(t,e){return(t.values||[]).find(s=>gn(s,e))!==void 0}function ya(t,e){if(t===e)return 0;const s=gi(t),r=gi(e);if(s!==r)return Ke(s,r);switch(s){case 0:case 9007199254740991:return 0;case 1:return Ke(t.booleanValue,e.booleanValue);case 2:return function(a,o){const l=bt(a.integerValue||a.doubleValue),d=bt(o.integerValue||o.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1}(t,e);case 3:return ry(t.timestampValue,e.timestampValue);case 4:return ry(nl(t),nl(e));case 5:return Ke(t.stringValue,e.stringValue);case 6:return function(a,o){const l=fi(a),d=fi(o);return l.compareTo(d)}(t.bytesValue,e.bytesValue);case 7:return function(a,o){const l=a.split("/"),d=o.split("/");for(let u=0;u<l.length&&u<d.length;u++){const h=Ke(l[u],d[u]);if(h!==0)return h}return Ke(l.length,d.length)}(t.referenceValue,e.referenceValue);case 8:return function(a,o){const l=Ke(bt(a.latitude),bt(o.latitude));return l!==0?l:Ke(bt(a.longitude),bt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return iy(t.arrayValue,e.arrayValue);case 10:return function(a,o){var l,d,u,h;const m=a.fields||{},g=o.fields||{},x=(l=m.value)===null||l===void 0?void 0:l.arrayValue,y=(d=g.value)===null||d===void 0?void 0:d.arrayValue,R=Ke(((u=x==null?void 0:x.values)===null||u===void 0?void 0:u.length)||0,((h=y==null?void 0:y.values)===null||h===void 0?void 0:h.length)||0);return R!==0?R:iy(x,y)}(t.mapValue,e.mapValue);case 11:return function(a,o){if(a===yc.mapValue&&o===yc.mapValue)return 0;if(a===yc.mapValue)return 1;if(o===yc.mapValue)return-1;const l=a.fields||{},d=Object.keys(l),u=o.fields||{},h=Object.keys(u);d.sort(),h.sort();for(let m=0;m<d.length&&m<h.length;++m){const g=Ke(d[m],h[m]);if(g!==0)return g;const x=ya(l[d[m]],u[h[m]]);if(x!==0)return x}return Ke(d.length,h.length)}(t.mapValue,e.mapValue);default:throw Te()}}function ry(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ke(t,e);const s=Mr(t),r=Mr(e),i=Ke(s.seconds,r.seconds);return i!==0?i:Ke(s.nanos,r.nanos)}function iy(t,e){const s=t.values||[],r=e.values||[];for(let i=0;i<s.length&&i<r.length;++i){const a=ya(s[i],r[i]);if(a)return a}return Ke(s.length,r.length)}function va(t){return Bm(t)}function Bm(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(s){const r=Mr(s);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(s){return fi(s).toBase64()}(t.bytesValue):"referenceValue"in t?function(s){return je.fromName(s).toString()}(t.referenceValue):"geoPointValue"in t?function(s){return`geo(${s.latitude},${s.longitude})`}(t.geoPointValue):"arrayValue"in t?function(s){let r="[",i=!0;for(const a of s.values||[])i?i=!1:r+=",",r+=Bm(a);return r+"]"}(t.arrayValue):"mapValue"in t?function(s){const r=Object.keys(s.fields||{}).sort();let i="{",a=!0;for(const o of r)a?a=!1:i+=",",i+=`${o}:${Bm(s.fields[o])}`;return i+"}"}(t.mapValue):Te()}function ay(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function qm(t){return!!t&&"integerValue"in t}function Nf(t){return!!t&&"arrayValue"in t}function oy(t){return!!t&&"nullValue"in t}function ly(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Fc(t){return!!t&&"mapValue"in t}function zT(t){var e,s;return((s=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="__vector__"}function So(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ei(t.mapValue.fields,(s,r)=>e.mapValue.fields[s]=So(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let s=0;s<(t.arrayValue.values||[]).length;++s)e.arrayValue.values[s]=So(t.arrayValue.values[s]);return e}return Object.assign({},t)}function BT(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e){this.value=e}static empty(){return new ms({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let s=this.value;for(let r=0;r<e.length-1;++r)if(s=(s.mapValue.fields||{})[e.get(r)],!Fc(s))return null;return s=(s.mapValue.fields||{})[e.lastSegment()],s||null}}set(e,s){this.getFieldsMap(e.popLast())[e.lastSegment()]=So(s)}setAll(e){let s=Ot.emptyPath(),r={},i=[];e.forEach((o,l)=>{if(!s.isImmediateParentOf(l)){const d=this.getFieldsMap(s);this.applyChanges(d,r,i),r={},i=[],s=l.popLast()}o?r[l.lastSegment()]=So(o):i.push(l.lastSegment())});const a=this.getFieldsMap(s);this.applyChanges(a,r,i)}delete(e){const s=this.field(e.popLast());Fc(s)&&s.mapValue.fields&&delete s.mapValue.fields[e.lastSegment()]}isEqual(e){return gn(this.value,e.value)}getFieldsMap(e){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=s.mapValue.fields[e.get(r)];Fc(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},s.mapValue.fields[e.get(r)]=i),s=i}return s.mapValue.fields}applyChanges(e,s,r){Ei(s,(i,a)=>e[i]=a);for(const i of r)delete e[i]}clone(){return new ms(So(this.value))}}function Gj(t){const e=[];return Ei(t.fields,(s,r)=>{const i=new Ot([s]);if(Fc(r)){const a=Gj(r.mapValue).fields;if(a.length===0)e.push(i);else for(const o of a)e.push(i.child(o))}else e.push(i)}),new Es(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e,s,r,i,a,o,l){this.key=e,this.documentType=s,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Zt(e,0,Pe.min(),Pe.min(),Pe.min(),ms.empty(),0)}static newFoundDocument(e,s,r,i){return new Zt(e,1,s,Pe.min(),r,i,0)}static newNoDocument(e,s){return new Zt(e,2,s,Pe.min(),Pe.min(),ms.empty(),0)}static newUnknownDocument(e,s){return new Zt(e,3,s,Pe.min(),Pe.min(),ms.empty(),2)}convertToFoundDocument(e,s){return!this.createTime.isEqual(Pe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ms.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ms.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Pe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Zt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e,s){this.position=e,this.inclusive=s}}function cy(t,e,s){let r=0;for(let i=0;i<t.position.length;i++){const a=e[i],o=t.position[i];if(a.field.isKeyField()?r=je.comparator(je.fromName(o.referenceValue),s.key):r=ya(o,s.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function dy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let s=0;s<t.position.length;s++)if(!gn(t.position[s],e.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e,s="asc"){this.field=e,this.dir=s}}function qT(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wj=class{};class St extends Wj{constructor(e,s,r){super(),this.field=e,this.op=s,this.value=r}static create(e,s,r){return e.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(e,s,r):new WT(e,s,r):s==="array-contains"?new QT(e,r):s==="in"?new YT(e,r):s==="not-in"?new XT(e,r):s==="array-contains-any"?new JT(e,r):new St(e,s,r)}static createKeyFieldInFilter(e,s,r){return s==="in"?new HT(e,r):new KT(e,r)}matches(e){const s=e.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(ya(s,this.value)):s!==null&&gi(this.value)===gi(s)&&this.matchesComparison(ya(s,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Te()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sn extends Wj{constructor(e,s){super(),this.filters=e,this.op=s,this.ae=null}static create(e,s){return new sn(e,s)}matches(e){return Hj(this)?this.filters.find(s=>!s.matches(e))===void 0:this.filters.find(s=>s.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,s)=>e.concat(s.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Hj(t){return t.op==="and"}function Kj(t){return GT(t)&&Hj(t)}function GT(t){for(const e of t.filters)if(e instanceof sn)return!1;return!0}function Gm(t){if(t instanceof St)return t.field.canonicalString()+t.op.toString()+va(t.value);if(Kj(t))return t.filters.map(e=>Gm(e)).join(",");{const e=t.filters.map(s=>Gm(s)).join(",");return`${t.op}(${e})`}}function Qj(t,e){return t instanceof St?function(r,i){return i instanceof St&&r.op===i.op&&r.field.isEqual(i.field)&&gn(r.value,i.value)}(t,e):t instanceof sn?function(r,i){return i instanceof sn&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((a,o,l)=>a&&Qj(o,i.filters[l]),!0):!1}(t,e):void Te()}function Yj(t){return t instanceof St?function(s){return`${s.field.canonicalString()} ${s.op} ${va(s.value)}`}(t):t instanceof sn?function(s){return s.op.toString()+" {"+s.getFilters().map(Yj).join(" ,")+"}"}(t):"Filter"}class WT extends St{constructor(e,s,r){super(e,s,r),this.key=je.fromName(r.referenceValue)}matches(e){const s=je.comparator(e.key,this.key);return this.matchesComparison(s)}}class HT extends St{constructor(e,s){super(e,"in",s),this.keys=Xj("in",s)}matches(e){return this.keys.some(s=>s.isEqual(e.key))}}class KT extends St{constructor(e,s){super(e,"not-in",s),this.keys=Xj("not-in",s)}matches(e){return!this.keys.some(s=>s.isEqual(e.key))}}function Xj(t,e){var s;return(((s=e.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(r=>je.fromName(r.referenceValue))}class QT extends St{constructor(e,s){super(e,"array-contains",s)}matches(e){const s=e.data.field(this.field);return Nf(s)&&il(s.arrayValue,this.value)}}class YT extends St{constructor(e,s){super(e,"in",s)}matches(e){const s=e.data.field(this.field);return s!==null&&il(this.value.arrayValue,s)}}class XT extends St{constructor(e,s){super(e,"not-in",s)}matches(e){if(il(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=e.data.field(this.field);return s!==null&&!il(this.value.arrayValue,s)}}class JT extends St{constructor(e,s){super(e,"array-contains-any",s)}matches(e){const s=e.data.field(this.field);return!(!Nf(s)||!s.arrayValue.values)&&s.arrayValue.values.some(r=>il(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT{constructor(e,s=null,r=[],i=[],a=null,o=null,l=null){this.path=e,this.collectionGroup=s,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=l,this.ue=null}}function uy(t,e=null,s=[],r=[],i=null,a=null,o=null){return new ZT(t,e,s,r,i,a,o)}function _f(t){const e=De(t);if(e.ue===null){let s=e.path.canonicalString();e.collectionGroup!==null&&(s+="|cg:"+e.collectionGroup),s+="|f:",s+=e.filters.map(r=>Gm(r)).join(","),s+="|ob:",s+=e.orderBy.map(r=>function(a){return a.field.canonicalString()+a.dir}(r)).join(","),hu(e.limit)||(s+="|l:",s+=e.limit),e.startAt&&(s+="|lb:",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map(r=>va(r)).join(",")),e.endAt&&(s+="|ub:",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map(r=>va(r)).join(",")),e.ue=s}return e.ue}function Sf(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!qT(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(!Qj(t.filters[s],e.filters[s]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!dy(t.startAt,e.startAt)&&dy(t.endAt,e.endAt)}function Wm(t){return je.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e,s=null,r=[],i=[],a=null,o="F",l=null,d=null){this.path=e,this.collectionGroup=s,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=l,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function e4(t,e,s,r,i,a,o,l){return new Ra(t,e,s,r,i,a,o,l)}function mu(t){return new Ra(t)}function hy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Jj(t){return t.collectionGroup!==null}function Eo(t){const e=De(t);if(e.ce===null){e.ce=[];const s=new Set;for(const a of e.explicitOrderBy)e.ce.push(a),s.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Ut(Ot.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(u=>{u.isInequality()&&(l=l.add(u.field))})}),l})(e).forEach(a=>{s.has(a.canonicalString())||a.isKeyField()||e.ce.push(new al(a,r))}),s.has(Ot.keyField().canonicalString())||e.ce.push(new al(Ot.keyField(),r))}return e.ce}function mn(t){const e=De(t);return e.le||(e.le=t4(e,Eo(t))),e.le}function t4(t,e){if(t.limitType==="F")return uy(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const a=i.dir==="desc"?"asc":"desc";return new al(i.field,a)});const s=t.endAt?new Ed(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ed(t.startAt.position,t.startAt.inclusive):null;return uy(t.path,t.collectionGroup,e,t.filters,t.limit,s,r)}}function Hm(t,e){const s=t.filters.concat([e]);return new Ra(t.path,t.collectionGroup,t.explicitOrderBy.slice(),s,t.limit,t.limitType,t.startAt,t.endAt)}function Ad(t,e,s){return new Ra(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,s,t.startAt,t.endAt)}function pu(t,e){return Sf(mn(t),mn(e))&&t.limitType===e.limitType}function Zj(t){return`${_f(mn(t))}|lt:${t.limitType}`}function Pi(t){return`Query(target=${function(s){let r=s.path.canonicalString();return s.collectionGroup!==null&&(r+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(r+=`, filters: [${s.filters.map(i=>Yj(i)).join(", ")}]`),hu(s.limit)||(r+=", limit: "+s.limit),s.orderBy.length>0&&(r+=`, orderBy: [${s.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),s.startAt&&(r+=", startAt: ",r+=s.startAt.inclusive?"b:":"a:",r+=s.startAt.position.map(i=>va(i)).join(",")),s.endAt&&(r+=", endAt: ",r+=s.endAt.inclusive?"a:":"b:",r+=s.endAt.position.map(i=>va(i)).join(",")),`Target(${r})`}(mn(t))}; limitType=${t.limitType})`}function fu(t,e){return e.isFoundDocument()&&function(r,i){const a=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):je.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)}(t,e)&&function(r,i){for(const a of Eo(r))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const a of r.filters)if(!a.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,l,d){const u=cy(o,l,d);return o.inclusive?u<=0:u<0}(r.startAt,Eo(r),i)||r.endAt&&!function(o,l,d){const u=cy(o,l,d);return o.inclusive?u>=0:u>0}(r.endAt,Eo(r),i))}(t,e)}function s4(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function eN(t){return(e,s)=>{let r=!1;for(const i of Eo(t)){const a=n4(i,e,s);if(a!==0)return a;r=r||i.field.isKeyField()}return 0}}function n4(t,e,s){const r=t.field.isKeyField()?je.comparator(e.key,s.key):function(a,o,l){const d=o.data.field(a),u=l.data.field(a);return d!==null&&u!==null?ya(d,u):Te()}(t.field,e,s);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Te()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(e,s){this.mapKeyFn=e,this.equalsFn=s,this.inner={},this.innerSize=0}get(e){const s=this.mapKeyFn(e),r=this.inner[s];if(r!==void 0){for(const[i,a]of r)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,s){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,s]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,s]);i.push([e,s]),this.innerSize++}delete(e){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[s]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ei(this.inner,(s,r)=>{for(const[i,a]of r)e(i,a)})}isEmpty(){return Bj(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r4=new ft(je.comparator);function Hn(){return r4}const tN=new ft(je.comparator);function uo(...t){let e=tN;for(const s of t)e=e.insert(s.key,s);return e}function sN(t){let e=tN;return t.forEach((s,r)=>e=e.insert(s,r.overlayedDocument)),e}function ni(){return Ao()}function nN(){return Ao()}function Ao(){return new Pa(t=>t.toString(),(t,e)=>t.isEqual(e))}const i4=new ft(je.comparator),a4=new Ut(je.comparator);function Ve(...t){let e=a4;for(const s of t)e=e.add(s);return e}const o4=new Ut(Ke);function l4(){return o4}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Sd(e)?"-0":e}}function rN(t){return{integerValue:""+t}}function c4(t,e){return FT(e)?rN(e):Ef(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(){this._=void 0}}function d4(t,e,s){return t instanceof Id?function(i,a){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&wf(a)&&(a=jf(a)),a&&(o.fields.__previous_value__=a),{mapValue:o}}(s,e):t instanceof ol?aN(t,e):t instanceof ll?oN(t,e):function(i,a){const o=iN(i,a),l=my(o)+my(i.Pe);return qm(o)&&qm(i.Pe)?rN(l):Ef(i.serializer,l)}(t,e)}function u4(t,e,s){return t instanceof ol?aN(t,e):t instanceof ll?oN(t,e):s}function iN(t,e){return t instanceof kd?function(r){return qm(r)||function(a){return!!a&&"doubleValue"in a}(r)}(e)?e:{integerValue:0}:null}class Id extends gu{}class ol extends gu{constructor(e){super(),this.elements=e}}function aN(t,e){const s=lN(e);for(const r of t.elements)s.some(i=>gn(i,r))||s.push(r);return{arrayValue:{values:s}}}class ll extends gu{constructor(e){super(),this.elements=e}}function oN(t,e){let s=lN(e);for(const r of t.elements)s=s.filter(i=>!gn(i,r));return{arrayValue:{values:s}}}class kd extends gu{constructor(e,s){super(),this.serializer=e,this.Pe=s}}function my(t){return bt(t.integerValue||t.doubleValue)}function lN(t){return Nf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function h4(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof ol&&i instanceof ol||r instanceof ll&&i instanceof ll?xa(r.elements,i.elements,gn):r instanceof kd&&i instanceof kd?gn(r.Pe,i.Pe):r instanceof Id&&i instanceof Id}(t.transform,e.transform)}class m4{constructor(e,s){this.version=e,this.transformResults=s}}class vs{constructor(e,s){this.updateTime=e,this.exists=s}static none(){return new vs}static exists(e){return new vs(void 0,e)}static updateTime(e){return new vs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $c(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class xu{}function cN(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new yu(t.key,vs.none()):new El(t.key,t.data,vs.none());{const s=t.data,r=ms.empty();let i=new Ut(Ot.comparator);for(let a of e.fields)if(!i.has(a)){let o=s.field(a);o===null&&a.length>1&&(a=a.popLast(),o=s.field(a)),o===null?r.delete(a):r.set(a,o),i=i.add(a)}return new qr(t.key,r,new Es(i.toArray()),vs.none())}}function p4(t,e,s){t instanceof El?function(i,a,o){const l=i.value.clone(),d=fy(i.fieldTransforms,a,o.transformResults);l.setAll(d),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,s):t instanceof qr?function(i,a,o){if(!$c(i.precondition,a))return void a.convertToUnknownDocument(o.version);const l=fy(i.fieldTransforms,a,o.transformResults),d=a.data;d.setAll(dN(i)),d.setAll(l),a.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(t,e,s):function(i,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,s)}function Io(t,e,s,r){return t instanceof El?function(a,o,l,d){if(!$c(a.precondition,o))return l;const u=a.value.clone(),h=gy(a.fieldTransforms,d,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,s,r):t instanceof qr?function(a,o,l,d){if(!$c(a.precondition,o))return l;const u=gy(a.fieldTransforms,d,o),h=o.data;return h.setAll(dN(a)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(m=>m.field))}(t,e,s,r):function(a,o,l){return $c(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,s)}function f4(t,e){let s=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),a=iN(r.transform,i||null);a!=null&&(s===null&&(s=ms.empty()),s.set(r.field,a))}return s||null}function py(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&xa(r,i,(a,o)=>h4(a,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class El extends xu{constructor(e,s,r,i=[]){super(),this.key=e,this.value=s,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class qr extends xu{constructor(e,s,r,i,a=[]){super(),this.key=e,this.data=s,this.fieldMask=r,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function dN(t){const e=new Map;return t.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const r=t.data.field(s);e.set(s,r)}}),e}function fy(t,e,s){const r=new Map;et(t.length===s.length);for(let i=0;i<s.length;i++){const a=t[i],o=a.transform,l=e.data.field(a.field);r.set(a.field,u4(o,l,s[i]))}return r}function gy(t,e,s){const r=new Map;for(const i of t){const a=i.transform,o=s.data.field(i.field);r.set(i.field,d4(a,o,e))}return r}class yu extends xu{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class g4 extends xu{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{constructor(e,s,r,i){this.batchId=e,this.localWriteTime=s,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,s){const r=s.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&p4(a,e,r[i])}}applyToLocalView(e,s){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(s=Io(r,e,s,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(s=Io(r,e,s,this.localWriteTime));return s}applyToLocalDocumentSet(e,s){const r=nN();return this.mutations.forEach(i=>{const a=e.get(i.key),o=a.overlayedDocument;let l=this.applyToLocalView(o,a.mutatedFields);l=s.has(i.key)?null:l;const d=cN(o,l);d!==null&&r.set(i.key,d),o.isValidDocument()||o.convertToNoDocument(Pe.min())}),r}keys(){return this.mutations.reduce((e,s)=>e.add(s.key),Ve())}isEqual(e){return this.batchId===e.batchId&&xa(this.mutations,e.mutations,(s,r)=>py(s,r))&&xa(this.baseMutations,e.baseMutations,(s,r)=>py(s,r))}}class Af{constructor(e,s,r,i){this.batch=e,this.commitVersion=s,this.mutationResults=r,this.docVersions=i}static from(e,s,r){et(e.mutations.length===r.length);let i=function(){return i4}();const a=e.mutations;for(let o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new Af(e,s,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(e,s){this.largestBatchId=e,this.mutation=s}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(e,s){this.count=e,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nt,Ue;function b4(t){switch(t){default:return Te();case te.CANCELLED:case te.UNKNOWN:case te.DEADLINE_EXCEEDED:case te.RESOURCE_EXHAUSTED:case te.INTERNAL:case te.UNAVAILABLE:case te.UNAUTHENTICATED:return!1;case te.INVALID_ARGUMENT:case te.NOT_FOUND:case te.ALREADY_EXISTS:case te.PERMISSION_DENIED:case te.FAILED_PRECONDITION:case te.ABORTED:case te.OUT_OF_RANGE:case te.UNIMPLEMENTED:case te.DATA_LOSS:return!0}}function uN(t){if(t===void 0)return Wn("GRPC error has no .code"),te.UNKNOWN;switch(t){case Nt.OK:return te.OK;case Nt.CANCELLED:return te.CANCELLED;case Nt.UNKNOWN:return te.UNKNOWN;case Nt.DEADLINE_EXCEEDED:return te.DEADLINE_EXCEEDED;case Nt.RESOURCE_EXHAUSTED:return te.RESOURCE_EXHAUSTED;case Nt.INTERNAL:return te.INTERNAL;case Nt.UNAVAILABLE:return te.UNAVAILABLE;case Nt.UNAUTHENTICATED:return te.UNAUTHENTICATED;case Nt.INVALID_ARGUMENT:return te.INVALID_ARGUMENT;case Nt.NOT_FOUND:return te.NOT_FOUND;case Nt.ALREADY_EXISTS:return te.ALREADY_EXISTS;case Nt.PERMISSION_DENIED:return te.PERMISSION_DENIED;case Nt.FAILED_PRECONDITION:return te.FAILED_PRECONDITION;case Nt.ABORTED:return te.ABORTED;case Nt.OUT_OF_RANGE:return te.OUT_OF_RANGE;case Nt.UNIMPLEMENTED:return te.UNIMPLEMENTED;case Nt.DATA_LOSS:return te.DATA_LOSS;default:return Te()}}(Ue=Nt||(Nt={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w4(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j4=new ai([4294967295,4294967295],0);function xy(t){const e=w4().encode(t),s=new Mj;return s.update(e),new Uint8Array(s.digest())}function yy(t){const e=new DataView(t.buffer),s=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new ai([s,r],0),new ai([i,a],0)]}class If{constructor(e,s,r){if(this.bitmap=e,this.padding=s,this.hashCount=r,s<0||s>=8)throw new ho(`Invalid padding: ${s}`);if(r<0)throw new ho(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ho(`Invalid hash count: ${r}`);if(e.length===0&&s!==0)throw new ho(`Invalid padding when bitmap length is 0: ${s}`);this.Ie=8*e.length-s,this.Te=ai.fromNumber(this.Ie)}Ee(e,s,r){let i=e.add(s.multiply(ai.fromNumber(r)));return i.compare(j4)===1&&(i=new ai([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const s=xy(e),[r,i]=yy(s);for(let a=0;a<this.hashCount;a++){const o=this.Ee(r,i,a);if(!this.de(o))return!1}return!0}static create(e,s,r){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new If(a,i,s);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const s=xy(e),[r,i]=yy(s);for(let a=0;a<this.hashCount;a++){const o=this.Ee(r,i,a);this.Ae(o)}}Ae(e){const s=Math.floor(e/8),r=e%8;this.bitmap[s]|=1<<r}}class ho extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e,s,r,i,a){this.snapshotVersion=e,this.targetChanges=s,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,s,r){const i=new Map;return i.set(e,Al.createSynthesizedTargetChangeForCurrentChange(e,s,r)),new vu(Pe.min(),i,new ft(Ke),Hn(),Ve())}}class Al{constructor(e,s,r,i,a){this.resumeToken=e,this.current=s,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,s,r){return new Al(r,s,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,s,r,i){this.Re=e,this.removedTargetIds=s,this.key=r,this.Ve=i}}class hN{constructor(e,s){this.targetId=e,this.me=s}}class mN{constructor(e,s,r=qt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=s,this.resumeToken=r,this.cause=i}}class vy{constructor(){this.fe=0,this.ge=wy(),this.pe=qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ve(),s=Ve(),r=Ve();return this.ge.forEach((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:s=s.add(i);break;case 1:r=r.add(i);break;default:Te()}}),new Al(this.pe,this.ye,e,s,r)}Ce(){this.we=!1,this.ge=wy()}Fe(e,s){this.we=!0,this.ge=this.ge.insert(e,s)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,et(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class N4{constructor(e){this.Le=e,this.Be=new Map,this.ke=Hn(),this.qe=by(),this.Qe=new ft(Ke)}Ke(e){for(const s of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(s,e.Ve):this.Ue(s,e.key,e.Ve);for(const s of e.removedTargetIds)this.Ue(s,e.key,e.Ve)}We(e){this.forEachTarget(e,s=>{const r=this.Ge(s);switch(e.state){case 0:this.ze(s)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(s);break;case 3:this.ze(s)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(s)&&(this.je(s),r.De(e.resumeToken));break;default:Te()}})}forEachTarget(e,s){e.targetIds.length>0?e.targetIds.forEach(s):this.Be.forEach((r,i)=>{this.ze(i)&&s(i)})}He(e){const s=e.targetId,r=e.me.count,i=this.Je(s);if(i){const a=i.target;if(Wm(a))if(r===0){const o=new je(a.path);this.Ue(s,o,Zt.newNoDocument(o,Pe.min()))}else et(r===1);else{const o=this.Ye(s);if(o!==r){const l=this.Ze(e),d=l?this.Xe(l,e,o):1;if(d!==0){this.je(s);const u=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(s,u)}}}}}Ze(e){const s=e.me.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:a=0}=s;let o,l;try{o=fi(r).toUint8Array()}catch(d){if(d instanceof qj)return ga("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new If(o,i,a)}catch(d){return ga(d instanceof ho?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.Ie===0?null:l}Xe(e,s,r){return s.me.count===r-this.nt(e,s.targetId)?0:2}nt(e,s){const r=this.Le.getRemoteKeysForTarget(s);let i=0;return r.forEach(a=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.Ue(s,a,null),i++)}),i}rt(e){const s=new Map;this.Be.forEach((a,o)=>{const l=this.Je(o);if(l){if(a.current&&Wm(l.target)){const d=new je(l.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,Zt.newNoDocument(d,e))}a.be&&(s.set(o,a.ve()),a.Ce())}});let r=Ve();this.qe.forEach((a,o)=>{let l=!0;o.forEachWhile(d=>{const u=this.Je(d);return!u||u.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(a))}),this.ke.forEach((a,o)=>o.setReadTime(e));const i=new vu(e,s,this.Qe,this.ke,r);return this.ke=Hn(),this.qe=by(),this.Qe=new ft(Ke),i}$e(e,s){if(!this.ze(e))return;const r=this.it(e,s.key)?2:0;this.Ge(e).Fe(s.key,r),this.ke=this.ke.insert(s.key,s),this.qe=this.qe.insert(s.key,this.st(s.key).add(e))}Ue(e,s,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,s)?i.Fe(s,1):i.Me(s),this.qe=this.qe.insert(s,this.st(s).delete(e)),r&&(this.ke=this.ke.insert(s,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const s=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+s.addedDocuments.size-s.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let s=this.Be.get(e);return s||(s=new vy,this.Be.set(e,s)),s}st(e){let s=this.qe.get(e);return s||(s=new Ut(Ke),this.qe=this.qe.insert(e,s)),s}ze(e){const s=this.Je(e)!==null;return s||ye("WatchChangeAggregator","Detected inactive target",e),s}Je(e){const s=this.Be.get(e);return s&&s.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new vy),this.Le.getRemoteKeysForTarget(e).forEach(s=>{this.Ue(e,s,null)})}it(e,s){return this.Le.getRemoteKeysForTarget(e).has(s)}}function by(){return new ft(je.comparator)}function wy(){return new ft(je.comparator)}const _4={asc:"ASCENDING",desc:"DESCENDING"},S4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},E4={and:"AND",or:"OR"};class A4{constructor(e,s){this.databaseId=e,this.useProto3Json=s}}function Km(t,e){return t.useProto3Json||hu(e)?e:{value:e}}function Cd(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function pN(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function I4(t,e){return Cd(t,e.toTimestamp())}function pn(t){return et(!!t),Pe.fromTimestamp(function(s){const r=Mr(s);return new Q(r.seconds,r.nanos)}(t))}function kf(t,e){return Qm(t,e).canonicalString()}function Qm(t,e){const s=function(i){return new ot(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?s:s.child(e)}function fN(t){const e=ot.fromString(t);return et(bN(e)),e}function Ym(t,e){return kf(t.databaseId,e.path)}function Th(t,e){const s=fN(e);if(s.get(1)!==t.databaseId.projectId)throw new fe(te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+t.databaseId.projectId);if(s.get(3)!==t.databaseId.database)throw new fe(te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+t.databaseId.database);return new je(xN(s))}function gN(t,e){return kf(t.databaseId,e)}function k4(t){const e=fN(t);return e.length===4?ot.emptyPath():xN(e)}function Xm(t){return new ot(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function xN(t){return et(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function jy(t,e,s){return{name:Ym(t,e),fields:s.value.mapValue.fields}}function C4(t,e){let s;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Te()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=function(u,h){return u.useProto3Json?(et(h===void 0||typeof h=="string"),qt.fromBase64String(h||"")):(et(h===void 0||h instanceof Buffer||h instanceof Uint8Array),qt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(u){const h=u.code===void 0?te.UNKNOWN:uN(u.code);return new fe(h,u.message||"")}(o);s=new mN(r,i,a,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Th(t,r.document.name),a=pn(r.document.updateTime),o=r.document.createTime?pn(r.document.createTime):Pe.min(),l=new ms({mapValue:{fields:r.document.fields}}),d=Zt.newFoundDocument(i,a,o,l),u=r.targetIds||[],h=r.removedTargetIds||[];s=new Uc(u,h,d.key,d)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Th(t,r.document),a=r.readTime?pn(r.readTime):Pe.min(),o=Zt.newNoDocument(i,a),l=r.removedTargetIds||[];s=new Uc([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Th(t,r.document),a=r.removedTargetIds||[];s=new Uc([],a,i,null)}else{if(!("filter"in e))return Te();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:a}=r,o=new v4(i,a),l=r.targetId;s=new hN(l,o)}}return s}function T4(t,e){let s;if(e instanceof El)s={update:jy(t,e.key,e.value)};else if(e instanceof yu)s={delete:Ym(t,e.key)};else if(e instanceof qr)s={update:jy(t,e.key,e.data),updateMask:$4(e.fieldMask)};else{if(!(e instanceof g4))return Te();s={verify:Ym(t,e.key)}}return e.fieldTransforms.length>0&&(s.updateTransforms=e.fieldTransforms.map(r=>function(a,o){const l=o.transform;if(l instanceof Id)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ol)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ll)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof kd)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw Te()}(0,r))),e.precondition.isNone||(s.currentDocument=function(i,a){return a.updateTime!==void 0?{updateTime:I4(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Te()}(t,e.precondition)),s}function R4(t,e){return t&&t.length>0?(et(e!==void 0),t.map(s=>function(i,a){let o=i.updateTime?pn(i.updateTime):pn(a);return o.isEqual(Pe.min())&&(o=pn(a)),new m4(o,i.transformResults||[])}(s,e))):[]}function P4(t,e){return{documents:[gN(t,e.path)]}}function D4(t,e){const s={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),s.structuredQuery.from=[{collectionId:r.lastSegment()}]),s.parent=gN(t,i);const a=function(u){if(u.length!==0)return vN(sn.create(u,"and"))}(e.filters);a&&(s.structuredQuery.where=a);const o=function(u){if(u.length!==0)return u.map(h=>function(g){return{field:Di(g.field),direction:V4(g.dir)}}(h))}(e.orderBy);o&&(s.structuredQuery.orderBy=o);const l=Km(t,e.limit);return l!==null&&(s.structuredQuery.limit=l),e.startAt&&(s.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(s.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:s,parent:i}}function M4(t){let e=k4(t.parent);const s=t.structuredQuery,r=s.from?s.from.length:0;let i=null;if(r>0){et(r===1);const h=s.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let a=[];s.where&&(a=function(m){const g=yN(m);return g instanceof sn&&Kj(g)?g.getFilters():[g]}(s.where));let o=[];s.orderBy&&(o=function(m){return m.map(g=>function(y){return new al(Mi(y.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(g))}(s.orderBy));let l=null;s.limit&&(l=function(m){let g;return g=typeof m=="object"?m.value:m,hu(g)?null:g}(s.limit));let d=null;s.startAt&&(d=function(m){const g=!!m.before,x=m.values||[];return new Ed(x,g)}(s.startAt));let u=null;return s.endAt&&(u=function(m){const g=!m.before,x=m.values||[];return new Ed(x,g)}(s.endAt)),e4(e,i,o,a,l,"F",d,u)}function L4(t,e){const s=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Te()}}(e.purpose);return s==null?null:{"goog-listen-tags":s}}function yN(t){return t.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const r=Mi(s.unaryFilter.field);return St.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Mi(s.unaryFilter.field);return St.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Mi(s.unaryFilter.field);return St.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Mi(s.unaryFilter.field);return St.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Te()}}(t):t.fieldFilter!==void 0?function(s){return St.create(Mi(s.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Te()}}(s.fieldFilter.op),s.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(s){return sn.create(s.compositeFilter.filters.map(r=>yN(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Te()}}(s.compositeFilter.op))}(t):Te()}function V4(t){return _4[t]}function O4(t){return S4[t]}function F4(t){return E4[t]}function Di(t){return{fieldPath:t.canonicalString()}}function Mi(t){return Ot.fromServerFormat(t.fieldPath)}function vN(t){return t instanceof St?function(s){if(s.op==="=="){if(ly(s.value))return{unaryFilter:{field:Di(s.field),op:"IS_NAN"}};if(oy(s.value))return{unaryFilter:{field:Di(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(ly(s.value))return{unaryFilter:{field:Di(s.field),op:"IS_NOT_NAN"}};if(oy(s.value))return{unaryFilter:{field:Di(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Di(s.field),op:O4(s.op),value:s.value}}}(t):t instanceof sn?function(s){const r=s.getFilters().map(i=>vN(i));return r.length===1?r[0]:{compositeFilter:{op:F4(s.op),filters:r}}}(t):Te()}function $4(t){const e=[];return t.fields.forEach(s=>e.push(s.canonicalString())),{fieldPaths:e}}function bN(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e,s,r,i,a=Pe.min(),o=Pe.min(),l=qt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=s,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new gr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,s){return new gr(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U4{constructor(e){this.ct=e}}function z4(t){const e=M4({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ad(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4{constructor(){this.un=new q4}addToCollectionParentIndex(e,s){return this.un.add(s),ne.resolve()}getCollectionParents(e,s){return ne.resolve(this.un.getEntries(s))}addFieldIndex(e,s){return ne.resolve()}deleteFieldIndex(e,s){return ne.resolve()}deleteAllFieldIndexes(e){return ne.resolve()}createTargetIndexes(e,s){return ne.resolve()}getDocumentsMatchingTarget(e,s){return ne.resolve(null)}getIndexType(e,s){return ne.resolve(0)}getFieldIndexes(e,s){return ne.resolve([])}getNextCollectionGroupToUpdate(e){return ne.resolve(null)}getMinOffset(e,s){return ne.resolve(Dr.min())}getMinOffsetFromCollectionGroup(e,s){return ne.resolve(Dr.min())}updateCollectionGroup(e,s,r){return ne.resolve()}updateIndexEntries(e,s){return ne.resolve()}}class q4{constructor(){this.index={}}add(e){const s=e.lastSegment(),r=e.popLast(),i=this.index[s]||new Ut(ot.comparator),a=!i.has(r);return this.index[s]=i.add(r),a}has(e){const s=e.lastSegment(),r=e.popLast(),i=this.index[s];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ut(ot.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ba(0)}static kn(){return new ba(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4{constructor(){this.changes=new Pa(e=>e.toString(),(e,s)=>e.isEqual(s)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,s){this.assertNotApplied(),this.changes.set(e,Zt.newInvalidDocument(e).setReadTime(s))}getEntry(e,s){this.assertNotApplied();const r=this.changes.get(s);return r!==void 0?ne.resolve(r):this.getFromCache(e,s)}getEntries(e,s){return this.getAllFromCache(e,s)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4{constructor(e,s){this.overlayedDocument=e,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e,s,r,i){this.remoteDocumentCache=e,this.mutationQueue=s,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,s){let r=null;return this.documentOverlayCache.getOverlay(e,s).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,s))).next(i=>(r!==null&&Io(r.mutation,i,Es.empty(),Q.now()),i))}getDocuments(e,s){return this.remoteDocumentCache.getEntries(e,s).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,s,r=Ve()){const i=ni();return this.populateOverlays(e,i,s).next(()=>this.computeViews(e,s,i,r).next(a=>{let o=uo();return a.forEach((l,d)=>{o=o.insert(l,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,s){const r=ni();return this.populateOverlays(e,r,s).next(()=>this.computeViews(e,s,r,Ve()))}populateOverlays(e,s,r){const i=[];return r.forEach(a=>{s.has(a)||i.push(a)}),this.documentOverlayCache.getOverlays(e,i).next(a=>{a.forEach((o,l)=>{s.set(o,l)})})}computeViews(e,s,r,i){let a=Hn();const o=Ao(),l=function(){return Ao()}();return s.forEach((d,u)=>{const h=r.get(u.key);i.has(u.key)&&(h===void 0||h.mutation instanceof qr)?a=a.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Io(h.mutation,u,h.mutation.getFieldMask(),Q.now())):o.set(u.key,Es.empty())}),this.recalculateAndSaveOverlays(e,a).next(d=>(d.forEach((u,h)=>o.set(u,h)),s.forEach((u,h)=>{var m;return l.set(u,new W4(h,(m=o.get(u))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,s){const r=Ao();let i=new ft((o,l)=>o-l),a=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,s).next(o=>{for(const l of o)l.keys().forEach(d=>{const u=s.get(d);if(u===null)return;let h=r.get(d)||Es.empty();h=l.applyToLocalView(u,h),r.set(d,h);const m=(i.get(l.batchId)||Ve()).add(d);i=i.insert(l.batchId,m)})}).next(()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),u=d.key,h=d.value,m=nN();h.forEach(g=>{if(!a.has(g)){const x=cN(s.get(g),r.get(g));x!==null&&m.set(g,x),a=a.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,m))}return ne.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,s){return this.remoteDocumentCache.getEntries(e,s).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,s,r,i){return function(o){return je.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(e,s.path):Jj(s)?this.getDocumentsMatchingCollectionGroupQuery(e,s,r,i):this.getDocumentsMatchingCollectionQuery(e,s,r,i)}getNextDocuments(e,s,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,s,r,i).next(a=>{const o=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,s,r.largestBatchId,i-a.size):ne.resolve(ni());let l=-1,d=a;return o.next(u=>ne.forEach(u,(h,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),a.get(h)?ne.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{d=d.insert(h,g)}))).next(()=>this.populateOverlays(e,u,a)).next(()=>this.computeViews(e,d,u,Ve())).next(h=>({batchId:l,changes:sN(h)})))})}getDocumentsMatchingDocumentQuery(e,s){return this.getDocument(e,new je(s)).next(r=>{let i=uo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,s,r,i){const a=s.collectionGroup;let o=uo();return this.indexManager.getCollectionParents(e,a).next(l=>ne.forEach(l,d=>{const u=function(m,g){return new Ra(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(s,d.child(a));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(h=>{h.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,s,r,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,s.path,r.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,s,r,a,i))).next(o=>{a.forEach((d,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Zt.newInvalidDocument(h)))});let l=uo();return o.forEach((d,u)=>{const h=a.get(d);h!==void 0&&Io(h.mutation,u,Es.empty(),Q.now()),fu(s,u)&&(l=l.insert(d,u))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,s){return ne.resolve(this.hr.get(s))}saveBundleMetadata(e,s){return this.hr.set(s.id,function(i){return{id:i.id,version:i.version,createTime:pn(i.createTime)}}(s)),ne.resolve()}getNamedQuery(e,s){return ne.resolve(this.Pr.get(s))}saveNamedQuery(e,s){return this.Pr.set(s.name,function(i){return{name:i.name,query:z4(i.bundledQuery),readTime:pn(i.readTime)}}(s)),ne.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{constructor(){this.overlays=new ft(je.comparator),this.Ir=new Map}getOverlay(e,s){return ne.resolve(this.overlays.get(s))}getOverlays(e,s){const r=ni();return ne.forEach(s,i=>this.getOverlay(e,i).next(a=>{a!==null&&r.set(i,a)})).next(()=>r)}saveOverlays(e,s,r){return r.forEach((i,a)=>{this.ht(e,s,a)}),ne.resolve()}removeOverlaysForBatchId(e,s,r){const i=this.Ir.get(r);return i!==void 0&&(i.forEach(a=>this.overlays=this.overlays.remove(a)),this.Ir.delete(r)),ne.resolve()}getOverlaysForCollection(e,s,r){const i=ni(),a=s.length+1,o=new je(s.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const d=l.getNext().value,u=d.getKey();if(!s.isPrefixOf(u.path))break;u.path.length===a&&d.largestBatchId>r&&i.set(d.getKey(),d)}return ne.resolve(i)}getOverlaysForCollectionGroup(e,s,r,i){let a=new ft((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===s&&u.largestBatchId>r){let h=a.get(u.largestBatchId);h===null&&(h=ni(),a=a.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const l=ni(),d=a.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((u,h)=>l.set(u,h)),!(l.size()>=i)););return ne.resolve(l)}ht(e,s,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new y4(s,r));let a=this.Ir.get(s);a===void 0&&(a=Ve(),this.Ir.set(s,a)),this.Ir.set(s,a.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4{constructor(){this.sessionToken=qt.EMPTY_BYTE_STRING}getSessionToken(e){return ne.resolve(this.sessionToken)}setSessionToken(e,s){return this.sessionToken=s,ne.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(){this.Tr=new Ut(Rt.Er),this.dr=new Ut(Rt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,s){const r=new Rt(e,s);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,s){e.forEach(r=>this.addReference(r,s))}removeReference(e,s){this.Vr(new Rt(e,s))}mr(e,s){e.forEach(r=>this.removeReference(r,s))}gr(e){const s=new je(new ot([])),r=new Rt(s,e),i=new Rt(s,e+1),a=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),a.push(o.key)}),a}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const s=new je(new ot([])),r=new Rt(s,e),i=new Rt(s,e+1);let a=Ve();return this.dr.forEachInRange([r,i],o=>{a=a.add(o.key)}),a}containsKey(e){const s=new Rt(e,0),r=this.Tr.firstAfterOrEqual(s);return r!==null&&e.isEqual(r.key)}}class Rt{constructor(e,s){this.key=e,this.wr=s}static Er(e,s){return je.comparator(e.key,s.key)||Ke(e.wr,s.wr)}static Ar(e,s){return Ke(e.wr,s.wr)||je.comparator(e.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e,s){this.indexManager=e,this.referenceDelegate=s,this.mutationQueue=[],this.Sr=1,this.br=new Ut(Rt.Er)}checkEmpty(e){return ne.resolve(this.mutationQueue.length===0)}addMutationBatch(e,s,r,i){const a=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new x4(a,s,r,i);this.mutationQueue.push(o);for(const l of i)this.br=this.br.add(new Rt(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ne.resolve(o)}lookupMutationBatch(e,s){return ne.resolve(this.Dr(s))}getNextMutationBatchAfterBatchId(e,s){const r=s+1,i=this.vr(r),a=i<0?0:i;return ne.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return ne.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ne.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,s){const r=new Rt(s,0),i=new Rt(s,Number.POSITIVE_INFINITY),a=[];return this.br.forEachInRange([r,i],o=>{const l=this.Dr(o.wr);a.push(l)}),ne.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,s){let r=new Ut(Ke);return s.forEach(i=>{const a=new Rt(i,0),o=new Rt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([a,o],l=>{r=r.add(l.wr)})}),ne.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,s){const r=s.path,i=r.length+1;let a=r;je.isDocumentKey(a)||(a=a.child(""));const o=new Rt(new je(a),0);let l=new Ut(Ke);return this.br.forEachWhile(d=>{const u=d.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(l=l.add(d.wr)),!0)},o),ne.resolve(this.Cr(l))}Cr(e){const s=[];return e.forEach(r=>{const i=this.Dr(r);i!==null&&s.push(i)}),s}removeMutationBatch(e,s){et(this.Fr(s.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return ne.forEach(s.mutations,i=>{const a=new Rt(i.key,s.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,s){const r=new Rt(s,0),i=this.br.firstAfterOrEqual(r);return ne.resolve(s.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ne.resolve()}Fr(e,s){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const s=this.vr(e);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e){this.Mr=e,this.docs=function(){return new ft(je.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,s){const r=s.key,i=this.docs.get(r),a=i?i.size:0,o=this.Mr(s);return this.docs=this.docs.insert(r,{document:s.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const s=this.docs.get(e);s&&(this.docs=this.docs.remove(e),this.size-=s.size)}getEntry(e,s){const r=this.docs.get(s);return ne.resolve(r?r.document.mutableCopy():Zt.newInvalidDocument(s))}getEntries(e,s){let r=Hn();return s.forEach(i=>{const a=this.docs.get(i);r=r.insert(i,a?a.document.mutableCopy():Zt.newInvalidDocument(i))}),ne.resolve(r)}getDocumentsMatchingQuery(e,s,r,i){let a=Hn();const o=s.path,l=new je(o.child("")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:u,value:{document:h}}=d.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||MT(DT(h),r)<=0||(i.has(h.key)||fu(s,h))&&(a=a.insert(h.key,h.mutableCopy()))}return ne.resolve(a)}getAllFromCollectionGroup(e,s,r,i){Te()}Or(e,s){return ne.forEach(this.docs,r=>s(r))}newChangeBuffer(e){return new Z4(this)}getSize(e){return ne.resolve(this.size)}}class Z4 extends G4{constructor(e){super(),this.cr=e}applyChanges(e){const s=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?s.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),ne.waitFor(s)}getFromCache(e,s){return this.cr.getEntry(e,s)}getAllFromCache(e,s){return this.cr.getEntries(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR{constructor(e){this.persistence=e,this.Nr=new Pa(s=>_f(s),Sf),this.lastRemoteSnapshotVersion=Pe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Cf,this.targetCount=0,this.kr=ba.Bn()}forEachTarget(e,s){return this.Nr.forEach((r,i)=>s(i)),ne.resolve()}getLastRemoteSnapshotVersion(e){return ne.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ne.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ne.resolve(this.highestTargetId)}setTargetsMetadata(e,s,r){return r&&(this.lastRemoteSnapshotVersion=r),s>this.Lr&&(this.Lr=s),ne.resolve()}Kn(e){this.Nr.set(e.target,e);const s=e.targetId;s>this.highestTargetId&&(this.kr=new ba(s),this.highestTargetId=s),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,s){return this.Kn(s),this.targetCount+=1,ne.resolve()}updateTargetData(e,s){return this.Kn(s),ne.resolve()}removeTargetData(e,s){return this.Nr.delete(s.target),this.Br.gr(s.targetId),this.targetCount-=1,ne.resolve()}removeTargets(e,s,r){let i=0;const a=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=s&&r.get(l.targetId)===null&&(this.Nr.delete(o),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),ne.waitFor(a).next(()=>i)}getTargetCount(e){return ne.resolve(this.targetCount)}getTargetData(e,s){const r=this.Nr.get(s)||null;return ne.resolve(r)}addMatchingKeys(e,s,r){return this.Br.Rr(s,r),ne.resolve()}removeMatchingKeys(e,s,r){this.Br.mr(s,r);const i=this.persistence.referenceDelegate,a=[];return i&&s.forEach(o=>{a.push(i.markPotentiallyOrphaned(e,o))}),ne.waitFor(a)}removeMatchingKeysForTargetId(e,s){return this.Br.gr(s),ne.resolve()}getMatchingKeysForTargetId(e,s){const r=this.Br.yr(s);return ne.resolve(r)}containsKey(e,s){return ne.resolve(this.Br.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e,s){this.qr={},this.overlays={},this.Qr=new bf(0),this.Kr=!1,this.Kr=!0,this.$r=new Y4,this.referenceDelegate=e(this),this.Ur=new eR(this),this.indexManager=new B4,this.remoteDocumentCache=function(i){return new J4(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new U4(s),this.Gr=new K4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let s=this.overlays[e.toKey()];return s||(s=new Q4,this.overlays[e.toKey()]=s),s}getMutationQueue(e,s){let r=this.qr[e.toKey()];return r||(r=new X4(s,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,s,r){ye("MemoryPersistence","Starting transaction:",e);const i=new sR(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(a=>this.referenceDelegate.jr(i).next(()=>a)).toPromise().then(a=>(i.raiseOnCommittedEvent(),a))}Hr(e,s){return ne.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,s)))}}class sR extends VT{constructor(e){super(),this.currentSequenceNumber=e}}class Tf{constructor(e){this.persistence=e,this.Jr=new Cf,this.Yr=null}static Zr(e){return new Tf(e)}get Xr(){if(this.Yr)return this.Yr;throw Te()}addReference(e,s,r){return this.Jr.addReference(r,s),this.Xr.delete(r.toString()),ne.resolve()}removeReference(e,s,r){return this.Jr.removeReference(r,s),this.Xr.add(r.toString()),ne.resolve()}markPotentiallyOrphaned(e,s){return this.Xr.add(s.toString()),ne.resolve()}removeTarget(e,s){this.Jr.gr(s.targetId).forEach(i=>this.Xr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,s.targetId).next(i=>{i.forEach(a=>this.Xr.add(a.toString()))}).next(()=>r.removeTargetData(e,s))}zr(){this.Yr=new Set}jr(e){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ne.forEach(this.Xr,r=>{const i=je.fromPath(r);return this.ei(e,i).next(a=>{a||s.removeEntry(i,Pe.min())})}).next(()=>(this.Yr=null,s.apply(e)))}updateLimboDocument(e,s){return this.ei(e,s).next(r=>{r?this.Xr.delete(s.toString()):this.Xr.add(s.toString())})}Wr(e){return 0}ei(e,s){return ne.or([()=>ne.resolve(this.Jr.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(e,s),()=>this.persistence.Hr(e,s)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rf{constructor(e,s,r,i){this.targetId=e,this.fromCache=s,this.$i=r,this.Ui=i}static Wi(e,s){let r=Ve(),i=Ve();for(const a of s.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new Rf(e,s.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return WA()?8:OT(ss())>0?6:4}()}initialize(e,s){this.Ji=e,this.indexManager=s,this.Gi=!0}getDocumentsMatchingQuery(e,s,r,i){const a={result:null};return this.Yi(e,s).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.Zi(e,s,i,r).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new nR;return this.Xi(e,s,o).next(l=>{if(a.result=l,this.zi)return this.es(e,s,o,l.size)})}).next(()=>a.result)}es(e,s,r,i){return r.documentReadCount<this.ji?(so()<=Oe.DEBUG&&ye("QueryEngine","SDK will not create cache indexes for query:",Pi(s),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ne.resolve()):(so()<=Oe.DEBUG&&ye("QueryEngine","Query:",Pi(s),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(so()<=Oe.DEBUG&&ye("QueryEngine","The SDK decides to create cache indexes for query:",Pi(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mn(s))):ne.resolve())}Yi(e,s){if(hy(s))return ne.resolve(null);let r=mn(s);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(s.limit!==null&&i===1&&(s=Ad(s,null,"F"),r=mn(s)),this.indexManager.getDocumentsMatchingTarget(e,r).next(a=>{const o=Ve(...a);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(d=>{const u=this.ts(s,l);return this.ns(s,u,o,d.readTime)?this.Yi(e,Ad(s,null,"F")):this.rs(e,u,s,d)}))})))}Zi(e,s,r,i){return hy(s)||i.isEqual(Pe.min())?ne.resolve(null):this.Ji.getDocuments(e,r).next(a=>{const o=this.ts(s,a);return this.ns(s,o,r,i)?ne.resolve(null):(so()<=Oe.DEBUG&&ye("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Pi(s)),this.rs(e,o,s,PT(i,-1)).next(l=>l))})}ts(e,s){let r=new Ut(eN(e));return s.forEach((i,a)=>{fu(e,a)&&(r=r.add(a))}),r}ns(e,s,r,i){if(e.limit===null)return!1;if(r.size!==s.size)return!0;const a=e.limitType==="F"?s.last():s.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Xi(e,s,r){return so()<=Oe.DEBUG&&ye("QueryEngine","Using full collection scan to execute query:",Pi(s)),this.Ji.getDocumentsMatchingQuery(e,s,Dr.min(),r)}rs(e,s,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(a=>(s.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e,s,r,i){this.persistence=e,this.ss=s,this.serializer=i,this.os=new ft(Ke),this._s=new Pa(a=>_f(a),Sf),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new H4(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>e.collect(s,this.os))}}function aR(t,e,s,r){return new iR(t,e,s,r)}async function wN(t,e){const s=De(t);return await s.persistence.runTransaction("Handle user change","readonly",r=>{let i;return s.mutationQueue.getAllMutationBatches(r).next(a=>(i=a,s.ls(e),s.mutationQueue.getAllMutationBatches(r))).next(a=>{const o=[],l=[];let d=Ve();for(const u of i){o.push(u.batchId);for(const h of u.mutations)d=d.add(h.key)}for(const u of a){l.push(u.batchId);for(const h of u.mutations)d=d.add(h.key)}return s.localDocuments.getDocuments(r,d).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:l}))})})}function oR(t,e){const s=De(t);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),a=s.cs.newChangeBuffer({trackRemovals:!0});return function(l,d,u,h){const m=u.batch,g=m.keys();let x=ne.resolve();return g.forEach(y=>{x=x.next(()=>h.getEntry(d,y)).next(R=>{const _=u.docVersions.get(y);et(_!==null),R.version.compareTo(_)<0&&(m.applyToRemoteDocument(R,u),R.isValidDocument()&&(R.setReadTime(u.commitVersion),h.addEntry(R)))})}),x.next(()=>l.mutationQueue.removeMutationBatch(d,m))}(s,r,e,a).next(()=>a.apply(r)).next(()=>s.mutationQueue.performConsistencyCheck(r)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let d=Ve();for(let u=0;u<l.mutationResults.length;++u)l.mutationResults[u].transformResults.length>0&&(d=d.add(l.batch.mutations[u].key));return d}(e))).next(()=>s.localDocuments.getDocuments(r,i))})}function jN(t){const e=De(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",s=>e.Ur.getLastRemoteSnapshotVersion(s))}function lR(t,e){const s=De(t),r=e.snapshotVersion;let i=s.os;return s.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=s.cs.newChangeBuffer({trackRemovals:!0});i=s.os;const l=[];e.targetChanges.forEach((h,m)=>{const g=i.get(m);if(!g)return;l.push(s.Ur.removeMatchingKeys(a,h.removedDocuments,m).next(()=>s.Ur.addMatchingKeys(a,h.addedDocuments,m)));let x=g.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(m)!==null?x=x.withResumeToken(qt.EMPTY_BYTE_STRING,Pe.min()).withLastLimboFreeSnapshotVersion(Pe.min()):h.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(h.resumeToken,r)),i=i.insert(m,x),function(R,_,T){return R.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=3e8?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(g,x,h)&&l.push(s.Ur.updateTargetData(a,x))});let d=Hn(),u=Ve();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(s.persistence.referenceDelegate.updateLimboDocument(a,h))}),l.push(cR(a,o,e.documentUpdates).next(h=>{d=h.Ps,u=h.Is})),!r.isEqual(Pe.min())){const h=s.Ur.getLastRemoteSnapshotVersion(a).next(m=>s.Ur.setTargetsMetadata(a,a.currentSequenceNumber,r));l.push(h)}return ne.waitFor(l).next(()=>o.apply(a)).next(()=>s.localDocuments.getLocalViewOfDocuments(a,d,u)).next(()=>d)}).then(a=>(s.os=i,a))}function cR(t,e,s){let r=Ve(),i=Ve();return s.forEach(a=>r=r.add(a)),e.getEntries(t,r).next(a=>{let o=Hn();return s.forEach((l,d)=>{const u=a.get(l);d.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(Pe.min())?(e.removeEntry(l,d.readTime),o=o.insert(l,d)):!u.isValidDocument()||d.version.compareTo(u.version)>0||d.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(d),o=o.insert(l,d)):ye("LocalStore","Ignoring outdated watch update for ",l,". Current version:",u.version," Watch version:",d.version)}),{Ps:o,Is:i}})}function dR(t,e){const s=De(t);return s.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),s.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function uR(t,e){const s=De(t);return s.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return s.Ur.getTargetData(r,e).next(a=>a?(i=a,ne.resolve(i)):s.Ur.allocateTargetId(r).next(o=>(i=new gr(e,o,"TargetPurposeListen",r.currentSequenceNumber),s.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=s.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(s.os=s.os.insert(r.targetId,r),s._s.set(e,r.targetId)),r})}async function Jm(t,e,s){const r=De(t),i=r.os.get(e),a=s?"readwrite":"readwrite-primary";try{s||await r.persistence.runTransaction("Release target",a,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Sl(o))throw o;ye("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)}function Ny(t,e,s){const r=De(t);let i=Pe.min(),a=Ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(d,u,h){const m=De(d),g=m._s.get(h);return g!==void 0?ne.resolve(m.os.get(g)):m.Ur.getTargetData(u,h)}(r,o,mn(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(d=>{a=d})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,s?i:Pe.min(),s?a:Ve())).next(l=>(hR(r,s4(e),l),{documents:l,Ts:a})))}function hR(t,e,s){let r=t.us.get(e)||Pe.min();s.forEach((i,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)}),t.us.set(e,r)}class _y{constructor(){this.activeTargetIds=l4()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class mR{constructor(){this.so=new _y,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,s,r){}addLocalQueryTarget(e,s=!0){return s&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,s,r){this.oo[e]=s}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new _y,Promise.resolve()}handleUserChange(e,s,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ye("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ye("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vc=null;function Rh(){return vc===null?vc=function(){return 268435456+Math.round(2147483648*Math.random())}():vc++,"0x"+vc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qt="WebChannelConnection";class xR extends class{constructor(s){this.databaseInfo=s,this.databaseId=s.databaseId;const r=s.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+s.host,this.vo=`projects/${i}/databases/${a}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${a}`}get Fo(){return!1}Mo(s,r,i,a,o){const l=Rh(),d=this.xo(s,r.toUriEncodedString());ye("RestConnection",`Sending RPC '${s}' ${l}:`,d,i);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,a,o),this.No(s,d,u,i).then(h=>(ye("RestConnection",`Received RPC '${s}' ${l}: `,h),h),h=>{throw ga("RestConnection",`RPC '${s}' ${l} failed with error: `,h,"url: ",d,"request:",i),h})}Lo(s,r,i,a,o,l){return this.Mo(s,r,i,a,o)}Oo(s,r,i){s["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ta}(),s["Content-Type"]="text/plain",this.databaseInfo.appId&&(s["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((a,o)=>s[o]=a),i&&i.headers.forEach((a,o)=>s[o]=a)}xo(s,r){const i=fR[s];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,s,r,i){const a=Rh();return new Promise((o,l)=>{const d=new Lj;d.setWithCredentials(!0),d.listenOnce(Vj.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Oc.NO_ERROR:const h=d.getResponseJson();ye(Qt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(h)),o(h);break;case Oc.TIMEOUT:ye(Qt,`RPC '${e}' ${a} timed out`),l(new fe(te.DEADLINE_EXCEEDED,"Request time out"));break;case Oc.HTTP_ERROR:const m=d.getStatus();if(ye(Qt,`RPC '${e}' ${a} failed with status:`,m,"response text:",d.getResponseText()),m>0){let g=d.getResponseJson();Array.isArray(g)&&(g=g[0]);const x=g==null?void 0:g.error;if(x&&x.status&&x.message){const y=function(_){const T=_.toLowerCase().replace(/_/g,"-");return Object.values(te).indexOf(T)>=0?T:te.UNKNOWN}(x.status);l(new fe(y,x.message))}else l(new fe(te.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new fe(te.UNAVAILABLE,"Connection failed."));break;default:Te()}}finally{ye(Qt,`RPC '${e}' ${a} completed.`)}});const u=JSON.stringify(i);ye(Qt,`RPC '${e}' ${a} sending request:`,i),d.send(s,"POST",u,r,15)})}Bo(e,s,r){const i=Rh(),a=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=$j(),l=Fj(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(d.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,s,r),d.encodeInitMessageHeaders=!0;const h=a.join("");ye(Qt,`Creating RPC '${e}' stream ${i}: ${h}`,d);const m=o.createWebChannel(h,d);let g=!1,x=!1;const y=new gR({Io:_=>{x?ye(Qt,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(g||(ye(Qt,`Opening RPC '${e}' stream ${i} transport.`),m.open(),g=!0),ye(Qt,`RPC '${e}' stream ${i} sending:`,_),m.send(_))},To:()=>m.close()}),R=(_,T,A)=>{_.listen(T,C=>{try{A(C)}catch(k){setTimeout(()=>{throw k},0)}})};return R(m,co.EventType.OPEN,()=>{x||(ye(Qt,`RPC '${e}' stream ${i} transport opened.`),y.yo())}),R(m,co.EventType.CLOSE,()=>{x||(x=!0,ye(Qt,`RPC '${e}' stream ${i} transport closed`),y.So())}),R(m,co.EventType.ERROR,_=>{x||(x=!0,ga(Qt,`RPC '${e}' stream ${i} transport errored:`,_),y.So(new fe(te.UNAVAILABLE,"The operation could not be completed")))}),R(m,co.EventType.MESSAGE,_=>{var T;if(!x){const A=_.data[0];et(!!A);const C=A,k=C.error||((T=C[0])===null||T===void 0?void 0:T.error);if(k){ye(Qt,`RPC '${e}' stream ${i} received error:`,k);const D=k.status;let P=function(N){const f=Nt[N];if(f!==void 0)return uN(f)}(D),v=k.message;P===void 0&&(P=te.INTERNAL,v="Unknown error status: "+D+" with message "+k.message),x=!0,y.So(new fe(P,v)),m.close()}else ye(Qt,`RPC '${e}' stream ${i} received:`,A),y.bo(A)}}),R(l,Oj.STAT_EVENT,_=>{_.stat===zm.PROXY?ye(Qt,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===zm.NOPROXY&&ye(Qt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.wo()},0),y}}function Ph(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bu(t){return new A4(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN{constructor(e,s,r=1e3,i=1.5,a=6e4){this.ui=e,this.timerId=s,this.ko=r,this.qo=i,this.Qo=a,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const s=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,s-r);i>0&&ye("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${s} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _N{constructor(e,s,r,i,a,o,l,d){this.ui=e,this.Ho=r,this.Jo=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new NN(e,s)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,s){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():s&&s.code===te.RESOURCE_EXHAUSTED?(Wn(s.toString()),Wn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):s&&s.code===te.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(s)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),s=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===s&&this.P_(r,i)},r=>{e(()=>{const i=new fe(te.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,s){const r=this.h_(this.Yo);this.stream=this.T_(e,s),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ye("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return s=>{this.ui.enqueueAndForget(()=>this.Yo===e?s():(ye("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class yR extends _N{constructor(e,s,r,i,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,r,i,o),this.serializer=a}T_(e,s){return this.connection.Bo("Listen",e,s)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const s=C4(this.serializer,e),r=function(a){if(!("targetChange"in a))return Pe.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?Pe.min():o.readTime?pn(o.readTime):Pe.min()}(e);return this.listener.d_(s,r)}A_(e){const s={};s.database=Xm(this.serializer),s.addTarget=function(a,o){let l;const d=o.target;if(l=Wm(d)?{documents:P4(a,d)}:{query:D4(a,d)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=pN(a,o.resumeToken);const u=Km(a,o.expectedCount);u!==null&&(l.expectedCount=u)}else if(o.snapshotVersion.compareTo(Pe.min())>0){l.readTime=Cd(a,o.snapshotVersion.toTimestamp());const u=Km(a,o.expectedCount);u!==null&&(l.expectedCount=u)}return l}(this.serializer,e);const r=L4(this.serializer,e);r&&(s.labels=r),this.a_(s)}R_(e){const s={};s.database=Xm(this.serializer),s.removeTarget=e,this.a_(s)}}class vR extends _N{constructor(e,s,r,i,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,r,i,o),this.serializer=a}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,s){return this.connection.Bo("Write",e,s)}E_(e){return et(!!e.streamToken),this.lastStreamToken=e.streamToken,et(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){et(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const s=R4(e.writeResults,e.commitTime),r=pn(e.commitTime);return this.listener.g_(r,s)}p_(){const e={};e.database=Xm(this.serializer),this.a_(e)}m_(e){const s={streamToken:this.lastStreamToken,writes:e.map(r=>T4(this.serializer,r))};this.a_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR extends class{}{constructor(e,s,r,i){super(),this.authCredentials=e,this.appCheckCredentials=s,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new fe(te.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,s,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Mo(e,Qm(s,r),i,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new fe(te.UNKNOWN,a.toString())})}Lo(e,s,r,i,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,Qm(s,r),i,o,l,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new fe(te.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class wR{constructor(e,s){this.asyncQueue=e,this.onlineStateHandler=s,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const s=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Wn(s),this.D_=!1):ye("OnlineStateTracker",s)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e,s,r,i,a){this.localStore=e,this.datastore=s,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=a,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ai(this)&&(ye("RemoteStore","Restarting streams for network reachability change."),await async function(d){const u=De(d);u.L_.add(4),await Il(u),u.q_.set("Unknown"),u.L_.delete(4),await wu(u)}(this))})}),this.q_=new wR(r,i)}}async function wu(t){if(Ai(t))for(const e of t.B_)await e(!0)}async function Il(t){for(const e of t.B_)await e(!1)}function SN(t,e){const s=De(t);s.N_.has(e.targetId)||(s.N_.set(e.targetId,e),Lf(s)?Mf(s):Da(s).r_()&&Df(s,e))}function Pf(t,e){const s=De(t),r=Da(s);s.N_.delete(e),r.r_()&&EN(s,e),s.N_.size===0&&(r.r_()?r.o_():Ai(s)&&s.q_.set("Unknown"))}function Df(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Pe.min())>0){const s=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(s)}Da(t).A_(e)}function EN(t,e){t.Q_.xe(e),Da(t).R_(e)}function Mf(t){t.Q_=new N4({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Da(t).start(),t.q_.v_()}function Lf(t){return Ai(t)&&!Da(t).n_()&&t.N_.size>0}function Ai(t){return De(t).L_.size===0}function AN(t){t.Q_=void 0}async function NR(t){t.q_.set("Online")}async function _R(t){t.N_.forEach((e,s)=>{Df(t,e)})}async function SR(t,e){AN(t),Lf(t)?(t.q_.M_(e),Mf(t)):t.q_.set("Unknown")}async function ER(t,e,s){if(t.q_.set("Online"),e instanceof mN&&e.state===2&&e.cause)try{await async function(i,a){const o=a.cause;for(const l of a.targetIds)i.N_.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.N_.delete(l),i.Q_.removeTarget(l))}(t,e)}catch(r){ye("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Td(t,r)}else if(e instanceof Uc?t.Q_.Ke(e):e instanceof hN?t.Q_.He(e):t.Q_.We(e),!s.isEqual(Pe.min()))try{const r=await jN(t.localStore);s.compareTo(r)>=0&&await function(a,o){const l=a.Q_.rt(o);return l.targetChanges.forEach((d,u)=>{if(d.resumeToken.approximateByteSize()>0){const h=a.N_.get(u);h&&a.N_.set(u,h.withResumeToken(d.resumeToken,o))}}),l.targetMismatches.forEach((d,u)=>{const h=a.N_.get(d);if(!h)return;a.N_.set(d,h.withResumeToken(qt.EMPTY_BYTE_STRING,h.snapshotVersion)),EN(a,d);const m=new gr(h.target,d,u,h.sequenceNumber);Df(a,m)}),a.remoteSyncer.applyRemoteEvent(l)}(t,s)}catch(r){ye("RemoteStore","Failed to raise snapshot:",r),await Td(t,r)}}async function Td(t,e,s){if(!Sl(e))throw e;t.L_.add(1),await Il(t),t.q_.set("Offline"),s||(s=()=>jN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ye("RemoteStore","Retrying IndexedDB access"),await s(),t.L_.delete(1),await wu(t)})}function IN(t,e){return e().catch(s=>Td(t,s,e))}async function ju(t){const e=De(t),s=Lr(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;AR(e);)try{const i=await dR(e.localStore,r);if(i===null){e.O_.length===0&&s.o_();break}r=i.batchId,IR(e,i)}catch(i){await Td(e,i)}kN(e)&&CN(e)}function AR(t){return Ai(t)&&t.O_.length<10}function IR(t,e){t.O_.push(e);const s=Lr(t);s.r_()&&s.V_&&s.m_(e.mutations)}function kN(t){return Ai(t)&&!Lr(t).n_()&&t.O_.length>0}function CN(t){Lr(t).start()}async function kR(t){Lr(t).p_()}async function CR(t){const e=Lr(t);for(const s of t.O_)e.m_(s.mutations)}async function TR(t,e,s){const r=t.O_.shift(),i=Af.from(r,e,s);await IN(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await ju(t)}async function RR(t,e){e&&Lr(t).V_&&await async function(r,i){if(function(o){return b4(o)&&o!==te.ABORTED}(i.code)){const a=r.O_.shift();Lr(r).s_(),await IN(r,()=>r.remoteSyncer.rejectFailedWrite(a.batchId,i)),await ju(r)}}(t,e),kN(t)&&CN(t)}async function Ey(t,e){const s=De(t);s.asyncQueue.verifyOperationInProgress(),ye("RemoteStore","RemoteStore received new credentials");const r=Ai(s);s.L_.add(3),await Il(s),r&&s.q_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(e),s.L_.delete(3),await wu(s)}async function PR(t,e){const s=De(t);e?(s.L_.delete(2),await wu(s)):e||(s.L_.add(2),await Il(s),s.q_.set("Unknown"))}function Da(t){return t.K_||(t.K_=function(s,r,i){const a=De(s);return a.w_(),new yR(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(t.datastore,t.asyncQueue,{Eo:NR.bind(null,t),Ro:_R.bind(null,t),mo:SR.bind(null,t),d_:ER.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),Lf(t)?Mf(t):t.q_.set("Unknown")):(await t.K_.stop(),AN(t))})),t.K_}function Lr(t){return t.U_||(t.U_=function(s,r,i){const a=De(s);return a.w_(),new vR(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:kR.bind(null,t),mo:RR.bind(null,t),f_:CR.bind(null,t),g_:TR.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await ju(t)):(await t.U_.stop(),t.O_.length>0&&(ye("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e,s,r,i,a){this.asyncQueue=e,this.timerId=s,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Vn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,s,r,i,a){const o=Date.now()+r,l=new Vf(e,s,o,i,a);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new fe(te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Of(t,e){if(Wn("AsyncQueue",`${e}: ${t}`),Sl(t))return new fe(te.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e){this.comparator=e?(s,r)=>e(s,r)||je.comparator(s.key,r.key):(s,r)=>je.comparator(s.key,r.key),this.keyedMap=uo(),this.sortedSet=new ft(this.comparator)}static emptySet(e){return new ia(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const s=this.keyedMap.get(e);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((s,r)=>(e(s),!1))}add(e){const s=this.delete(e.key);return s.copy(s.keyedMap.insert(e.key,e),s.sortedSet.insert(e,null))}delete(e){const s=this.get(e);return s?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(s)):this}isEqual(e){if(!(e instanceof ia)||this.size!==e.size)return!1;const s=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;s.hasNext();){const i=s.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(s=>{e.push(s.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,s){const r=new ia;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=s,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(){this.W_=new ft(je.comparator)}track(e){const s=e.doc.key,r=this.W_.get(s);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(s,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(s,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(s,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(s,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(s):e.type===1&&r.type===2?this.W_=this.W_.insert(s,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(s,{type:2,doc:e.doc}):Te():this.W_=this.W_.insert(s,e)}G_(){const e=[];return this.W_.inorderTraversal((s,r)=>{e.push(r)}),e}}class wa{constructor(e,s,r,i,a,o,l,d,u){this.query=e,this.docs=s,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=u}static fromInitialDocuments(e,s,r,i,a){const o=[];return s.forEach(l=>{o.push({type:0,doc:l})}),new wa(e,s,ia.emptySet(s),o,r,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const s=this.docChanges,r=e.docChanges;if(s.length!==r.length)return!1;for(let i=0;i<s.length;i++)if(s[i].type!==r[i].type||!s[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class MR{constructor(){this.queries=Iy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(s,r){const i=De(s),a=i.queries;i.queries=Iy(),a.forEach((o,l)=>{for(const d of l.j_)d.onError(r)})})(this,new fe(te.ABORTED,"Firestore shutting down"))}}function Iy(){return new Pa(t=>Zj(t),pu)}async function Ff(t,e){const s=De(t);let r=3;const i=e.query;let a=s.queries.get(i);a?!a.H_()&&e.J_()&&(r=2):(a=new DR,r=e.J_()?0:1);try{switch(r){case 0:a.z_=await s.onListen(i,!0);break;case 1:a.z_=await s.onListen(i,!1);break;case 2:await s.onFirstRemoteStoreListen(i)}}catch(o){const l=Of(o,`Initialization of query '${Pi(e.query)}' failed`);return void e.onError(l)}s.queries.set(i,a),a.j_.push(e),e.Z_(s.onlineState),a.z_&&e.X_(a.z_)&&Uf(s)}async function $f(t,e){const s=De(t),r=e.query;let i=3;const a=s.queries.get(r);if(a){const o=a.j_.indexOf(e);o>=0&&(a.j_.splice(o,1),a.j_.length===0?i=e.J_()?0:1:!a.H_()&&e.J_()&&(i=2))}switch(i){case 0:return s.queries.delete(r),s.onUnlisten(r,!0);case 1:return s.queries.delete(r),s.onUnlisten(r,!1);case 2:return s.onLastRemoteStoreUnlisten(r);default:return}}function LR(t,e){const s=De(t);let r=!1;for(const i of e){const a=i.query,o=s.queries.get(a);if(o){for(const l of o.j_)l.X_(i)&&(r=!0);o.z_=i}}r&&Uf(s)}function VR(t,e,s){const r=De(t),i=r.queries.get(e);if(i)for(const a of i.j_)a.onError(s);r.queries.delete(e)}function Uf(t){t.Y_.forEach(e=>{e.next()})}var Zm,ky;(ky=Zm||(Zm={})).ea="default",ky.Cache="cache";class zf{constructor(e,s,r){this.query=e,this.ta=s,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new wa(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let s=!1;return this.na?this.ia(e)&&(this.ta.next(e),s=!0):this.sa(e,this.onlineState)&&(this.oa(e),s=!0),this.ra=e,s}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let s=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),s=!0),s}sa(e,s){if(!e.fromCache||!this.J_())return!0;const r=s!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||s==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const s=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}oa(e){e=wa.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Zm.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(e){this.key=e}}class RN{constructor(e){this.key=e}}class OR{constructor(e,s){this.query=e,this.Ta=s,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ve(),this.mutatedKeys=Ve(),this.Aa=eN(e),this.Ra=new ia(this.Aa)}get Va(){return this.Ta}ma(e,s){const r=s?s.fa:new Ay,i=s?s.Ra:this.Ra;let a=s?s.mutatedKeys:this.mutatedKeys,o=i,l=!1;const d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,m)=>{const g=i.get(h),x=fu(this.query,m)?m:null,y=!!g&&this.mutatedKeys.has(g.key),R=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let _=!1;g&&x?g.data.isEqual(x.data)?y!==R&&(r.track({type:3,doc:x}),_=!0):this.ga(g,x)||(r.track({type:2,doc:x}),_=!0,(d&&this.Aa(x,d)>0||u&&this.Aa(x,u)<0)&&(l=!0)):!g&&x?(r.track({type:0,doc:x}),_=!0):g&&!x&&(r.track({type:1,doc:g}),_=!0,(d||u)&&(l=!0)),_&&(x?(o=o.add(x),a=R?a.add(h):a.delete(h)):(o=o.delete(h),a=a.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),a=a.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:l,mutatedKeys:a}}ga(e,s){return e.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(e,s,r,i){const a=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,m)=>function(x,y){const R=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Te()}};return R(x)-R(y)}(h.type,m.type)||this.Aa(h.doc,m.doc)),this.pa(r),i=i!=null&&i;const l=s&&!i?this.ya():[],d=this.da.size===0&&this.current&&!i?1:0,u=d!==this.Ea;return this.Ea=d,o.length!==0||u?{snapshot:new wa(this.query,e.Ra,a,o,e.mutatedKeys,d===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ay,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(s=>this.Ta=this.Ta.add(s)),e.modifiedDocuments.forEach(s=>{}),e.removedDocuments.forEach(s=>this.Ta=this.Ta.delete(s)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ve(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const s=[];return e.forEach(r=>{this.da.has(r)||s.push(new RN(r))}),this.da.forEach(r=>{e.has(r)||s.push(new TN(r))}),s}ba(e){this.Ta=e.Ts,this.da=Ve();const s=this.ma(e.documents);return this.applyChanges(s,!0)}Da(){return wa.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class FR{constructor(e,s,r){this.query=e,this.targetId=s,this.view=r}}class $R{constructor(e){this.key=e,this.va=!1}}class UR{constructor(e,s,r,i,a,o){this.localStore=e,this.remoteStore=s,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Pa(l=>Zj(l),pu),this.Ma=new Map,this.xa=new Set,this.Oa=new ft(je.comparator),this.Na=new Map,this.La=new Cf,this.Ba={},this.ka=new Map,this.qa=ba.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function zR(t,e,s=!0){const r=ON(t);let i;const a=r.Fa.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.Da()):i=await PN(r,e,s,!0),i}async function BR(t,e){const s=ON(t);await PN(s,e,!0,!1)}async function PN(t,e,s,r){const i=await uR(t.localStore,mn(e)),a=i.targetId,o=t.sharedClientState.addLocalQueryTarget(a,s);let l;return r&&(l=await qR(t,e,a,o==="current",i.resumeToken)),t.isPrimaryClient&&s&&SN(t.remoteStore,i),l}async function qR(t,e,s,r,i){t.Ka=(m,g,x)=>async function(R,_,T,A){let C=_.view.ma(T);C.ns&&(C=await Ny(R.localStore,_.query,!1).then(({documents:v})=>_.view.ma(v,C)));const k=A&&A.targetChanges.get(_.targetId),D=A&&A.targetMismatches.get(_.targetId)!=null,P=_.view.applyChanges(C,R.isPrimaryClient,k,D);return Ty(R,_.targetId,P.wa),P.snapshot}(t,m,g,x);const a=await Ny(t.localStore,e,!0),o=new OR(e,a.Ts),l=o.ma(a.documents),d=Al.createSynthesizedTargetChangeForCurrentChange(s,r&&t.onlineState!=="Offline",i),u=o.applyChanges(l,t.isPrimaryClient,d);Ty(t,s,u.wa);const h=new FR(e,s,o);return t.Fa.set(e,h),t.Ma.has(s)?t.Ma.get(s).push(e):t.Ma.set(s,[e]),u.snapshot}async function GR(t,e,s){const r=De(t),i=r.Fa.get(e),a=r.Ma.get(i.targetId);if(a.length>1)return r.Ma.set(i.targetId,a.filter(o=>!pu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Jm(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),s&&Pf(r.remoteStore,i.targetId),ep(r,i.targetId)}).catch(_l)):(ep(r,i.targetId),await Jm(r.localStore,i.targetId,!0))}async function WR(t,e){const s=De(t),r=s.Fa.get(e),i=s.Ma.get(r.targetId);s.isPrimaryClient&&i.length===1&&(s.sharedClientState.removeLocalQueryTarget(r.targetId),Pf(s.remoteStore,r.targetId))}async function HR(t,e,s){const r=eP(t);try{const i=await function(o,l){const d=De(o),u=Q.now(),h=l.reduce((x,y)=>x.add(y.key),Ve());let m,g;return d.persistence.runTransaction("Locally write mutations","readwrite",x=>{let y=Hn(),R=Ve();return d.cs.getEntries(x,h).next(_=>{y=_,y.forEach((T,A)=>{A.isValidDocument()||(R=R.add(T))})}).next(()=>d.localDocuments.getOverlayedDocuments(x,y)).next(_=>{m=_;const T=[];for(const A of l){const C=f4(A,m.get(A.key).overlayedDocument);C!=null&&T.push(new qr(A.key,C,Gj(C.value.mapValue),vs.exists(!0)))}return d.mutationQueue.addMutationBatch(x,u,T,l)}).next(_=>{g=_;const T=_.applyToLocalDocumentSet(m,R);return d.documentOverlayCache.saveOverlays(x,_.batchId,T)})}).then(()=>({batchId:g.batchId,changes:sN(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,l,d){let u=o.Ba[o.currentUser.toKey()];u||(u=new ft(Ke)),u=u.insert(l,d),o.Ba[o.currentUser.toKey()]=u}(r,i.batchId,s),await kl(r,i.changes),await ju(r.remoteStore)}catch(i){const a=Of(i,"Failed to persist write");s.reject(a)}}async function DN(t,e){const s=De(t);try{const r=await lR(s.localStore,e);e.targetChanges.forEach((i,a)=>{const o=s.Na.get(a);o&&(et(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?et(o.va):i.removedDocuments.size>0&&(et(o.va),o.va=!1))}),await kl(s,r,e)}catch(r){await _l(r)}}function Cy(t,e,s){const r=De(t);if(r.isPrimaryClient&&s===0||!r.isPrimaryClient&&s===1){const i=[];r.Fa.forEach((a,o)=>{const l=o.view.Z_(e);l.snapshot&&i.push(l.snapshot)}),function(o,l){const d=De(o);d.onlineState=l;let u=!1;d.queries.forEach((h,m)=>{for(const g of m.j_)g.Z_(l)&&(u=!0)}),u&&Uf(d)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function KR(t,e,s){const r=De(t);r.sharedClientState.updateQueryState(e,"rejected",s);const i=r.Na.get(e),a=i&&i.key;if(a){let o=new ft(je.comparator);o=o.insert(a,Zt.newNoDocument(a,Pe.min()));const l=Ve().add(a),d=new vu(Pe.min(),new Map,new ft(Ke),o,l);await DN(r,d),r.Oa=r.Oa.remove(a),r.Na.delete(e),Bf(r)}else await Jm(r.localStore,e,!1).then(()=>ep(r,e,s)).catch(_l)}async function QR(t,e){const s=De(t),r=e.batch.batchId;try{const i=await oR(s.localStore,e);LN(s,r,null),MN(s,r),s.sharedClientState.updateMutationState(r,"acknowledged"),await kl(s,i)}catch(i){await _l(i)}}async function YR(t,e,s){const r=De(t);try{const i=await function(o,l){const d=De(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return d.mutationQueue.lookupMutationBatch(u,l).next(m=>(et(m!==null),h=m.keys(),d.mutationQueue.removeMutationBatch(u,m))).next(()=>d.mutationQueue.performConsistencyCheck(u)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(u,h,l)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>d.localDocuments.getDocuments(u,h))})}(r.localStore,e);LN(r,e,s),MN(r,e),r.sharedClientState.updateMutationState(e,"rejected",s),await kl(r,i)}catch(i){await _l(i)}}function MN(t,e){(t.ka.get(e)||[]).forEach(s=>{s.resolve()}),t.ka.delete(e)}function LN(t,e,s){const r=De(t);let i=r.Ba[r.currentUser.toKey()];if(i){const a=i.get(e);a&&(s?a.reject(s):a.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function ep(t,e,s=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),s&&t.Ca.$a(r,s);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||VN(t,r)})}function VN(t,e){t.xa.delete(e.path.canonicalString());const s=t.Oa.get(e);s!==null&&(Pf(t.remoteStore,s),t.Oa=t.Oa.remove(e),t.Na.delete(s),Bf(t))}function Ty(t,e,s){for(const r of s)r instanceof TN?(t.La.addReference(r.key,e),XR(t,r)):r instanceof RN?(ye("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||VN(t,r.key)):Te()}function XR(t,e){const s=e.key,r=s.path.canonicalString();t.Oa.get(s)||t.xa.has(r)||(ye("SyncEngine","New document in limbo: "+s),t.xa.add(r),Bf(t))}function Bf(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const s=new je(ot.fromString(e)),r=t.qa.next();t.Na.set(r,new $R(s)),t.Oa=t.Oa.insert(s,r),SN(t.remoteStore,new gr(mn(mu(s.path)),r,"TargetPurposeLimboResolution",bf.oe))}}async function kl(t,e,s){const r=De(t),i=[],a=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,d)=>{o.push(r.Ka(d,e,s).then(u=>{var h;if((u||s)&&r.isPrimaryClient){const m=u?!u.fromCache:(h=s==null?void 0:s.targetChanges.get(d.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(d.targetId,m?"current":"not-current")}if(u){i.push(u);const m=Rf.Wi(d.targetId,u);a.push(m)}}))}),await Promise.all(o),r.Ca.d_(i),await async function(d,u){const h=De(d);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>ne.forEach(u,g=>ne.forEach(g.$i,x=>h.persistence.referenceDelegate.addReference(m,g.targetId,x)).next(()=>ne.forEach(g.Ui,x=>h.persistence.referenceDelegate.removeReference(m,g.targetId,x)))))}catch(m){if(!Sl(m))throw m;ye("LocalStore","Failed to update sequence numbers: "+m)}for(const m of u){const g=m.targetId;if(!m.fromCache){const x=h.os.get(g),y=x.snapshotVersion,R=x.withLastLimboFreeSnapshotVersion(y);h.os=h.os.insert(g,R)}}}(r.localStore,a))}async function JR(t,e){const s=De(t);if(!s.currentUser.isEqual(e)){ye("SyncEngine","User change. New user:",e.toKey());const r=await wN(s.localStore,e);s.currentUser=e,function(a,o){a.ka.forEach(l=>{l.forEach(d=>{d.reject(new fe(te.CANCELLED,o))})}),a.ka.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await kl(s,r.hs)}}function ZR(t,e){const s=De(t),r=s.Na.get(e);if(r&&r.va)return Ve().add(r.key);{let i=Ve();const a=s.Ma.get(e);if(!a)return i;for(const o of a){const l=s.Fa.get(o);i=i.unionWith(l.view.Va)}return i}}function ON(t){const e=De(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=DN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ZR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=KR.bind(null,e),e.Ca.d_=LR.bind(null,e.eventManager),e.Ca.$a=VR.bind(null,e.eventManager),e}function eP(t){const e=De(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=QR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=YR.bind(null,e),e}class Rd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=bu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,s){return null}Ha(e,s){return null}za(e){return aR(this.persistence,new rR,e.initialUser,this.serializer)}Ga(e){return new tR(Tf.Zr,this.serializer)}Wa(e){return new mR}async terminate(){var e,s;(e=this.gcScheduler)===null||e===void 0||e.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rd.provider={build:()=>new Rd};class tp{async initialize(e,s){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Cy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=JR.bind(null,this.syncEngine),await PR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new MR}()}createDatastore(e){const s=bu(e.databaseInfo.databaseId),r=function(a){return new xR(a)}(e.databaseInfo);return function(a,o,l,d){return new bR(a,o,l,d)}(e.authCredentials,e.appCheckCredentials,r,s)}createRemoteStore(e){return function(r,i,a,o,l){return new jR(r,i,a,o,l)}(this.localStore,this.datastore,e.asyncQueue,s=>Cy(this.syncEngine,s,0),function(){return Sy.D()?new Sy:new pR}())}createSyncEngine(e,s){return function(i,a,o,l,d,u,h){const m=new UR(i,a,o,l,d,u);return h&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,s)}async terminate(){var e,s;await async function(i){const a=De(i);ye("RemoteStore","RemoteStore shutting down."),a.L_.add(5),await Il(a),a.k_.shutdown(),a.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}tp.provider={build:()=>new tp};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Wn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,s){setTimeout(()=>{this.muted||e(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e,s,r,i,a){this.authCredentials=e,this.appCheckCredentials=s,this.asyncQueue=r,this.databaseInfo=i,this.user=Xt.UNAUTHENTICATED,this.clientId=zj.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,async o=>{ye("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ye("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(s){const r=Of(s,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Dh(t,e){t.asyncQueue.verifyOperationInProgress(),ye("FirestoreClient","Initializing OfflineComponentProvider");const s=t.configuration;await e.initialize(s);let r=s.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await wN(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Ry(t,e){t.asyncQueue.verifyOperationInProgress();const s=await sP(t);ye("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(s,t.configuration),t.setCredentialChangeListener(r=>Ey(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>Ey(e.remoteStore,i)),t._onlineComponents=e}async function sP(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ye("FirestoreClient","Using user provided OfflineComponentProvider");try{await Dh(t,t._uninitializedComponentsProvider._offline)}catch(e){const s=e;if(!function(i){return i.name==="FirebaseError"?i.code===te.FAILED_PRECONDITION||i.code===te.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(s))throw s;ga("Error using user provided cache. Falling back to memory cache: "+s),await Dh(t,new Rd)}}else ye("FirestoreClient","Using default OfflineComponentProvider"),await Dh(t,new Rd);return t._offlineComponents}async function FN(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ye("FirestoreClient","Using user provided OnlineComponentProvider"),await Ry(t,t._uninitializedComponentsProvider._online)):(ye("FirestoreClient","Using default OnlineComponentProvider"),await Ry(t,new tp))),t._onlineComponents}function nP(t){return FN(t).then(e=>e.syncEngine)}async function Pd(t){const e=await FN(t),s=e.eventManager;return s.onListen=zR.bind(null,e.syncEngine),s.onUnlisten=GR.bind(null,e.syncEngine),s.onFirstRemoteStoreListen=BR.bind(null,e.syncEngine),s.onLastRemoteStoreUnlisten=WR.bind(null,e.syncEngine),s}function rP(t,e,s={}){const r=new Vn;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,d,u){const h=new qf({next:g=>{h.Za(),o.enqueueAndForget(()=>$f(a,m));const x=g.docs.has(l);!x&&g.fromCache?u.reject(new fe(te.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&g.fromCache&&d&&d.source==="server"?u.reject(new fe(te.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),m=new zf(mu(l.path),h,{includeMetadataChanges:!0,_a:!0});return Ff(a,m)}(await Pd(t),t.asyncQueue,e,s,r)),r.promise}function iP(t,e,s={}){const r=new Vn;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,d,u){const h=new qf({next:g=>{h.Za(),o.enqueueAndForget(()=>$f(a,m)),g.fromCache&&d.source==="server"?u.reject(new fe(te.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),m=new zf(l,h,{includeMetadataChanges:!0,_a:!0});return Ff(a,m)}(await Pd(t),t.asyncQueue,e,s,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Py=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UN(t,e,s){if(!s)throw new fe(te.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function aP(t,e,s,r){if(e===!0&&r===!0)throw new fe(te.INVALID_ARGUMENT,`${t} and ${s} cannot be used together.`)}function Dy(t){if(!je.isDocumentKey(t))throw new fe(te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function My(t){if(je.isDocumentKey(t))throw new fe(te.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Nu(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Te()}function bs(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new fe(te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Nu(t);throw new fe(te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${s}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(e){var s,r;if(e.host===void 0){if(e.ssl!==void 0)throw new fe(te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(s=e.ssl)===null||s===void 0||s;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new fe(te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}aP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$N((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new fe(te.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new fe(te.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new fe(te.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class _u{constructor(e,s,r,i){this._authCredentials=e,this._appCheckCredentials=s,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ly({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new fe(te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new fe(te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ly(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new _T;switch(r.type){case"firstParty":return new IT(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new fe(te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const r=Py.get(s);r&&(ye("ComponentProvider","Removing Datastore"),Py.delete(s),r.terminate())}(this),Promise.resolve()}}function oP(t,e,s,r={}){var i;const a=(t=bs(t,_u))._getSettings(),o=`${e}:${s}`;if(a.host!=="firestore.googleapis.com"&&a.host!==o&&ga("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),r.mockUserToken){let l,d;if(typeof r.mockUserToken=="string")l=r.mockUserToken,d=Xt.MOCK_USER;else{l=Ww(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new fe(te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Xt(u)}t._authCredentials=new ST(new Uj(l,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e,s,r){this.converter=s,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Jn(this.firestore,e,this._query)}}class es{constructor(e,s,r){this.converter=s,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ir(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new es(this.firestore,e,this._key)}}class Ir extends Jn{constructor(e,s,r){super(e,s,mu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new es(this.firestore,null,new je(e))}withConverter(e){return new Ir(this.firestore,e,this._path)}}function Ee(t,e,...s){if(t=tt(t),UN("collection","path",e),t instanceof _u){const r=ot.fromString(e,...s);return My(r),new Ir(t,null,r)}{if(!(t instanceof es||t instanceof Ir))throw new fe(te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ot.fromString(e,...s));return My(r),new Ir(t.firestore,null,r)}}function he(t,e,...s){if(t=tt(t),arguments.length===1&&(e=zj.newId()),UN("doc","path",e),t instanceof _u){const r=ot.fromString(e,...s);return Dy(r),new es(t,null,new je(r))}{if(!(t instanceof es||t instanceof Ir))throw new fe(te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ot.fromString(e,...s));return Dy(r),new es(t.firestore,t instanceof Ir?t.converter:null,new je(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new NN(this,"async_queue_retry"),this.Vu=()=>{const r=Ph();r&&ye("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const s=Ph();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const s=Ph();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const s=new Vn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Sl(e))throw e;ye("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const s=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const i=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw Wn("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=s,s}enqueueAfterDelay(e,s,r){this.fu(),this.Ru.indexOf(e)>-1&&(s=0);const i=Vf.createAndSchedule(this,e,s,r,a=>this.yu(a));return this.Tu.push(i),i}fu(){this.Eu&&Te()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const s of this.Tu)if(s.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((s,r)=>s.targetTimeMs-r.targetTimeMs);for(const s of this.Tu)if(s.skipDelay(),e!=="all"&&s.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const s=this.Tu.indexOf(e);this.Tu.splice(s,1)}}function Oy(t){return function(s,r){if(typeof s!="object"||s===null)return!1;const i=s;for(const a of r)if(a in i&&typeof i[a]=="function")return!0;return!1}(t,["next","error","complete"])}class Kn extends _u{constructor(e,s,r,i){super(e,s,r,i),this.type="firestore",this._queue=new Vy,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Vy(e),this._firestoreClient=void 0,await e}}}function lP(t,e){const s=typeof t=="object"?t:lu(),r=typeof t=="string"?t:"(default)",i=vl(s,"firestore").getImmediate({identifier:r});if(!i._initialized){const a=rf("firestore");a&&oP(i,...a)}return i}function Cl(t){if(t._terminated)throw new fe(te.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||cP(t),t._firestoreClient}function cP(t){var e,s,r;const i=t._freezeSettings(),a=function(l,d,u,h){return new UT(l,d,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,$N(h.experimentalLongPollingOptions),h.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((s=i.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new tP(t._authCredentials,t._appCheckCredentials,t._queue,a,t._componentsProvider&&function(l){const d=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(d),_online:d}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ja(qt.fromBase64String(e))}catch(s){throw new fe(te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(e){return new ja(qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl{constructor(...e){for(let s=0;s<e.length;++s)if(e[s].length===0)throw new fe(te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ot(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(e,s){if(!isFinite(e)||e<-90||e>90)throw new fe(te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(s)||s<-180||s>180)throw new fe(te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=e,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ke(this._lat,e._lat)||Ke(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(e){this._values=(e||[]).map(s=>s)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==i[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=/^__.*__$/;class uP{constructor(e,s,r){this.data=e,this.fieldMask=s,this.fieldTransforms=r}toMutation(e,s){return this.fieldMask!==null?new qr(e,this.data,this.fieldMask,s,this.fieldTransforms):new El(e,this.data,s,this.fieldTransforms)}}class zN{constructor(e,s,r){this.data=e,this.fieldMask=s,this.fieldTransforms=r}toMutation(e,s){return new qr(e,this.data,this.fieldMask,s,this.fieldTransforms)}}function BN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Te()}}class Kf{constructor(e,s,r,i,a,o){this.settings=e,this.databaseId=s,this.serializer=r,this.ignoreUndefinedProperties=i,a===void 0&&this.vu(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Kf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var s;const r=(s=this.path)===null||s===void 0?void 0:s.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var s;const r=(s=this.path)===null||s===void 0?void 0:s.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Dd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(s=>e.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>e.isPrefixOf(s.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(BN(this.Cu)&&dP.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class hP{constructor(e,s,r){this.databaseId=e,this.ignoreUndefinedProperties=s,this.serializer=r||bu(e)}Qu(e,s,r,i=!1){return new Kf({Cu:e,methodName:s,qu:r,path:Ot.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Su(t){const e=t._freezeSettings(),s=bu(t._databaseId);return new hP(t._databaseId,!!e.ignoreUndefinedProperties,s)}function qN(t,e,s,r,i,a={}){const o=t.Qu(a.merge||a.mergeFields?2:0,e,s,i);Qf("Data must be an object, but it was:",o,r);const l=HN(r,o);let d,u;if(a.merge)d=new Es(o.fieldMask),u=o.fieldTransforms;else if(a.mergeFields){const h=[];for(const m of a.mergeFields){const g=sp(e,m,s);if(!o.contains(g))throw new fe(te.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);QN(h,g)||h.push(g)}d=new Es(h),u=o.fieldTransforms.filter(m=>d.covers(m.field))}else d=null,u=o.fieldTransforms;return new uP(new ms(l),d,u)}class Eu extends Gf{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Eu}}function GN(t,e,s,r){const i=t.Qu(1,e,s);Qf("Data must be an object, but it was:",i,r);const a=[],o=ms.empty();Ei(r,(d,u)=>{const h=Yf(e,d,s);u=tt(u);const m=i.Nu(h);if(u instanceof Eu)a.push(h);else{const g=Rl(u,m);g!=null&&(a.push(h),o.set(h,g))}});const l=new Es(a);return new zN(o,l,i.fieldTransforms)}function WN(t,e,s,r,i,a){const o=t.Qu(1,e,s),l=[sp(e,r,s)],d=[i];if(a.length%2!=0)throw new fe(te.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<a.length;g+=2)l.push(sp(e,a[g])),d.push(a[g+1]);const u=[],h=ms.empty();for(let g=l.length-1;g>=0;--g)if(!QN(u,l[g])){const x=l[g];let y=d[g];y=tt(y);const R=o.Nu(x);if(y instanceof Eu)u.push(x);else{const _=Rl(y,R);_!=null&&(u.push(x),h.set(x,_))}}const m=new Es(u);return new zN(h,m,o.fieldTransforms)}function mP(t,e,s,r=!1){return Rl(s,t.Qu(r?4:3,e))}function Rl(t,e){if(KN(t=tt(t)))return Qf("Unsupported field value:",e,t),HN(t,e);if(t instanceof Gf)return function(r,i){if(!BN(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(i);a&&i.fieldTransforms.push(a)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){const a=[];let o=0;for(const l of r){let d=Rl(l,i.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),a.push(d),o++}return{arrayValue:{values:a}}}(t,e)}return function(r,i){if((r=tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return c4(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=Q.fromDate(r);return{timestampValue:Cd(i.serializer,a)}}if(r instanceof Q){const a=new Q(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Cd(i.serializer,a)}}if(r instanceof Wf)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ja)return{bytesValue:pN(i.serializer,r._byteString)};if(r instanceof es){const a=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(a))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:kf(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Hf)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Bu("VectorValues must only contain numeric values.");return Ef(l.serializer,d)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${Nu(r)}`)}(t,e)}function HN(t,e){const s={};return Bj(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ei(t,(r,i)=>{const a=Rl(i,e.Mu(r));a!=null&&(s[r]=a)}),{mapValue:{fields:s}}}function KN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Q||t instanceof Wf||t instanceof ja||t instanceof es||t instanceof Gf||t instanceof Hf)}function Qf(t,e,s){if(!KN(s)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(s)){const r=Nu(s);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function sp(t,e,s){if((e=tt(e))instanceof Tl)return e._internalPath;if(typeof e=="string")return Yf(t,e);throw Dd("Field path arguments must be of type string or ",t,!1,void 0,s)}const pP=new RegExp("[~\\*/\\[\\]]");function Yf(t,e,s){if(e.search(pP)>=0)throw Dd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,s);try{return new Tl(...e.split("."))._internalPath}catch{throw Dd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,s)}}function Dd(t,e,s,r,i){const a=r&&!r.isEmpty(),o=i!==void 0;let l=`Function ${e}() called with invalid data`;s&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(a||o)&&(d+=" (found",a&&(d+=` in field ${r}`),o&&(d+=` in document ${i}`),d+=")"),new fe(te.INVALID_ARGUMENT,l+t+d)}function QN(t,e){return t.some(s=>s.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YN{constructor(e,s,r,i,a){this._firestore=e,this._userDataWriter=s,this._key=r,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new es(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const s=this._document.data.field(Au("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s)}}}class fP extends YN{data(){return super.data()}}function Au(t,e){return typeof e=="string"?Yf(t,e):e instanceof Tl?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new fe(te.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xf{}class Jf extends Xf{}function Ae(t,e,...s){let r=[];e instanceof Xf&&r.push(e),r=r.concat(s),function(a){const o=a.filter(d=>d instanceof Zf).length,l=a.filter(d=>d instanceof Iu).length;if(o>1||o>0&&l>0)throw new fe(te.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class Iu extends Jf{constructor(e,s,r){super(),this._field=e,this._op=s,this._value=r,this.type="where"}static _create(e,s,r){return new Iu(e,s,r)}_apply(e){const s=this._parse(e);return JN(e._query,s),new Jn(e.firestore,e.converter,Hm(e._query,s))}_parse(e){const s=Su(e.firestore);return function(a,o,l,d,u,h,m){let g;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new fe(te.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){$y(m,h);const x=[];for(const y of m)x.push(Fy(d,a,y));g={arrayValue:{values:x}}}else g=Fy(d,a,m)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||$y(m,h),g=mP(l,o,m,h==="in"||h==="not-in");return St.create(u,h,g)}(e._query,"where",s,e.firestore._databaseId,this._field,this._op,this._value)}}function ce(t,e,s){const r=e,i=Au("where",t);return Iu._create(i,r,s)}class Zf extends Xf{constructor(e,s){super(),this.type=e,this._queryConstraints=s}static _create(e,s){return new Zf(e,s)}_parse(e){const s=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return s.length===1?s[0]:sn.create(s,this._getOperator())}_apply(e){const s=this._parse(e);return s.getFilters().length===0?e:(function(i,a){let o=i;const l=a.getFlattenedFilters();for(const d of l)JN(o,d),o=Hm(o,d)}(e._query,s),new Jn(e.firestore,e.converter,Hm(e._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class eg extends Jf{constructor(e,s){super(),this._field=e,this._direction=s,this.type="orderBy"}static _create(e,s){return new eg(e,s)}_apply(e){const s=function(i,a,o){if(i.startAt!==null)throw new fe(te.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new fe(te.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new al(a,o)}(e._query,this._field,this._direction);return new Jn(e.firestore,e.converter,function(i,a){const o=i.explicitOrderBy.concat([a]);return new Ra(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,s))}}function Na(t,e="asc"){const s=e,r=Au("orderBy",t);return eg._create(r,s)}class tg extends Jf{constructor(e,s,r){super(),this.type=e,this._limit=s,this._limitType=r}static _create(e,s,r){return new tg(e,s,r)}_apply(e){return new Jn(e.firestore,e.converter,Ad(e._query,this._limit,this._limitType))}}function gP(t){return tg._create("limit",t,"F")}function Fy(t,e,s){if(typeof(s=tt(s))=="string"){if(s==="")throw new fe(te.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jj(e)&&s.indexOf("/")!==-1)throw new fe(te.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const r=e.path.child(ot.fromString(s));if(!je.isDocumentKey(r))throw new fe(te.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ay(t,new je(r))}if(s instanceof es)return ay(t,s._key);throw new fe(te.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nu(s)}.`)}function $y(t,e){if(!Array.isArray(t)||t.length===0)throw new fe(te.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function JN(t,e){const s=function(i,a){for(const o of i)for(const l of o.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(s!==null)throw s===e.op?new fe(te.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new fe(te.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${s.toString()}' filters.`)}class xP{convertValue(e,s="none"){switch(gi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return bt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,s);case 5:return e.stringValue;case 6:return this.convertBytes(fi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,s);case 11:return this.convertObject(e.mapValue,s);case 10:return this.convertVectorValue(e.mapValue);default:throw Te()}}convertObject(e,s){return this.convertObjectMap(e.fields,s)}convertObjectMap(e,s="none"){const r={};return Ei(e,(i,a)=>{r[i]=this.convertValue(a,s)}),r}convertVectorValue(e){var s,r,i;const a=(i=(r=(s=e.fields)===null||s===void 0?void 0:s.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>bt(o.doubleValue));return new Hf(a)}convertGeoPoint(e){return new Wf(bt(e.latitude),bt(e.longitude))}convertArray(e,s){return(e.values||[]).map(r=>this.convertValue(r,s))}convertServerTimestamp(e,s){switch(s){case"previous":const r=jf(e);return r==null?null:this.convertValue(r,s);case"estimate":return this.convertTimestamp(nl(e));default:return null}}convertTimestamp(e){const s=Mr(e);return new Q(s.seconds,s.nanos)}convertDocumentKey(e,s){const r=ot.fromString(e);et(bN(r));const i=new rl(r.get(1),r.get(3)),a=new je(r.popFirst(5));return i.isEqual(s)||Wn(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZN(t,e,s){let r;return r=t?s&&(s.merge||s.mergeFields)?t.toFirestore(e,s):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e,s){this.hasPendingWrites=e,this.fromCache=s}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class e1 extends YN{constructor(e,s,r,i,a,o){super(e,s,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const s=new zc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,s={}){if(this._document){const r=this._document.data.field(Au("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,s.serverTimestamps)}}}class zc extends e1{data(e={}){return super.data(e)}}class t1{constructor(e,s,r,i){this._firestore=e,this._userDataWriter=s,this._snapshot=i,this.metadata=new mo(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(s=>e.push(s)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,s){this._snapshot.docs.forEach(r=>{e.call(s,new zc(this._firestore,this._userDataWriter,r.key,r,new mo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const s=!!e.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new fe(te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(i,a){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(l=>{const d=new zc(i._firestore,i._userDataWriter,l.doc.key,l.doc,new mo(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>a||l.type!==3).map(l=>{const d=new zc(i._firestore,i._userDataWriter,l.doc.key,l.doc,new mo(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,h=-1;return l.type!==0&&(u=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),h=o.indexOf(l.doc.key)),{type:yP(l.type),doc:d,oldIndex:u,newIndex:h}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function yP(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Te()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rs(t){t=bs(t,es);const e=bs(t.firestore,Kn);return rP(Cl(e),t._key).then(s=>s1(e,t,s))}class sg extends xP{constructor(e){super(),this.firestore=e}convertBytes(e){return new ja(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new es(this.firestore,null,s)}}function Ie(t){t=bs(t,Jn);const e=bs(t.firestore,Kn),s=Cl(e),r=new sg(e);return XN(t._query),iP(s,t._query).then(i=>new t1(e,r,t,i))}function Je(t,e,s){t=bs(t,es);const r=bs(t.firestore,Kn),i=ZN(t.converter,e,s);return ku(r,[qN(Su(r),"setDoc",t._key,i,t.converter!==null,s).toMutation(t._key,vs.none())])}function ht(t,e,s,...r){t=bs(t,es);const i=bs(t.firestore,Kn),a=Su(i);let o;return o=typeof(e=tt(e))=="string"||e instanceof Tl?WN(a,"updateDoc",t._key,e,s,r):GN(a,"updateDoc",t._key,e),ku(i,[o.toMutation(t._key,vs.exists(!0))])}function Is(t){return ku(bs(t.firestore,Kn),[new yu(t._key,vs.none())])}function vP(t,...e){var s,r,i;t=tt(t);let a={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Oy(e[o])||(a=e[o],o++);const l={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(Oy(e[o])){const m=e[o];e[o]=(s=m.next)===null||s===void 0?void 0:s.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let d,u,h;if(t instanceof es)u=bs(t.firestore,Kn),h=mu(t._key.path),d={next:m=>{e[o]&&e[o](s1(u,t,m))},error:e[o+1],complete:e[o+2]};else{const m=bs(t,Jn);u=bs(m.firestore,Kn),h=m._query;const g=new sg(u);d={next:x=>{e[o]&&e[o](new t1(u,g,m,x))},error:e[o+1],complete:e[o+2]},XN(t._query)}return function(g,x,y,R){const _=new qf(R),T=new zf(x,_,y);return g.asyncQueue.enqueueAndForget(async()=>Ff(await Pd(g),T)),()=>{_.Za(),g.asyncQueue.enqueueAndForget(async()=>$f(await Pd(g),T))}}(Cl(u),h,l,d)}function ku(t,e){return function(r,i){const a=new Vn;return r.asyncQueue.enqueueAndForget(async()=>HR(await nP(r),i,a)),a.promise}(Cl(t),e)}function s1(t,e,s){const r=s.docs.get(e._key),i=new sg(t);return new e1(t,i,e._key,r,new mo(s.hasPendingWrites,s.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(e,s){this._firestore=e,this._commitHandler=s,this._mutations=[],this._committed=!1,this._dataReader=Su(e)}set(e,s,r){this._verifyNotCommitted();const i=Mh(e,this._firestore),a=ZN(i.converter,s,r),o=qN(this._dataReader,"WriteBatch.set",i._key,a,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,vs.none())),this}update(e,s,r,...i){this._verifyNotCommitted();const a=Mh(e,this._firestore);let o;return o=typeof(s=tt(s))=="string"||s instanceof Tl?WN(this._dataReader,"WriteBatch.update",a._key,s,r,i):GN(this._dataReader,"WriteBatch.update",a._key,s),this._mutations.push(o.toMutation(a._key,vs.exists(!0))),this}delete(e){this._verifyNotCommitted();const s=Mh(e,this._firestore);return this._mutations=this._mutations.concat(new yu(s._key,vs.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new fe(te.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Mh(t,e){if((t=tt(t)).firestore!==e)throw new fe(te.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uy(t){return Cl(t=bs(t,Kn)),new bP(t,e=>ku(t,e))}(function(e,s=!0){(function(i){Ta=i})(_i),Pr(new Bn("firestore",(r,{instanceIdentifier:i,options:a})=>{const o=r.getProvider("app").getImmediate(),l=new Kn(new ET(r.getProvider("auth-internal")),new CT(r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new fe(te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rl(u.options.projectId,h)}(o,i),o);return a=Object.assign({useFetchStreams:s},a),l._setSettings(a),l},"PUBLIC").setMultipleInstances(!0)),$s(ty,"4.7.3",e),$s(ty,"4.7.3","esm2017")})();var wP="firebase",jP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$s(wP,jP,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1="firebasestorage.googleapis.com",NP="storageBucket",_P=2*60*1e3,SP=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n extends jn{constructor(e,s,r=0){super(Lh(e),`Firebase Storage: ${s} (${Lh(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,_n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Lh(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var xn;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(xn||(xn={}));function Lh(t){return"storage/"+t}function EP(){const t="An unknown error occurred, please check the error payload for server response.";return new _n(xn.UNKNOWN,t)}function AP(){return new _n(xn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function IP(){return new _n(xn.CANCELED,"User canceled the upload/download.")}function kP(t){return new _n(xn.INVALID_URL,"Invalid URL '"+t+"'.")}function CP(t){return new _n(xn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function zy(t){return new _n(xn.INVALID_ARGUMENT,t)}function r1(){return new _n(xn.APP_DELETED,"The Firebase app was deleted.")}function TP(t){return new _n(xn.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,s){this.bucket=e,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,s){let r;try{r=Ys.makeFromUrl(e,s)}catch{return new Ys(e,"")}if(r.path==="")return r;throw CP(e)}static makeFromUrl(e,s){let r=null;const i="([A-Za-z0-9.\\-_]+)";function a(k){k.path.charAt(k.path.length-1)==="/"&&(k.path_=k.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+i+o,"i"),d={bucket:1,path:3};function u(k){k.path_=decodeURIComponent(k.path)}const h="v[A-Za-z0-9_]+",m=s.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",x=new RegExp(`^https?://${m}/${h}/b/${i}/o${g}`,"i"),y={bucket:1,path:3},R=s===n1?"(?:storage.googleapis.com|storage.cloud.google.com)":s,_="([^?#]*)",T=new RegExp(`^https?://${R}/${i}/${_}`,"i"),C=[{regex:l,indices:d,postModify:a},{regex:x,indices:y,postModify:u},{regex:T,indices:{bucket:1,path:2},postModify:u}];for(let k=0;k<C.length;k++){const D=C[k],P=D.regex.exec(e);if(P){const v=P[D.indices.bucket];let b=P[D.indices.path];b||(b=""),r=new Ys(v,b),D.postModify(r);break}}if(r==null)throw kP(e);return r}}class RP{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PP(t,e,s){let r=1,i=null,a=null,o=!1,l=0;function d(){return l===2}let u=!1;function h(..._){u||(u=!0,e.apply(null,_))}function m(_){i=setTimeout(()=>{i=null,t(x,d())},_)}function g(){a&&clearTimeout(a)}function x(_,...T){if(u){g();return}if(_){g(),h.call(null,_,...T);return}if(d()||o){g(),h.call(null,_,...T);return}r<64&&(r*=2);let C;l===1?(l=2,C=0):C=(r+Math.random())*1e3,m(C)}let y=!1;function R(_){y||(y=!0,g(),!u&&(i!==null?(_||(l=2),clearTimeout(i),m(0)):_||(l=1)))}return m(0),a=setTimeout(()=>{o=!0,R(!0)},s),R}function DP(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MP(t){return t!==void 0}function By(t,e,s,r){if(r<e)throw zy(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>s)throw zy(`Invalid value for '${t}'. Expected ${s} or less.`)}function LP(t){const e=encodeURIComponent;let s="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);s=s+i+"&"}return s=s.slice(0,-1),s}var Md;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Md||(Md={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VP(t,e){const s=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,a=e.indexOf(t)!==-1;return s||i||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OP{constructor(e,s,r,i,a,o,l,d,u,h,m,g=!0){this.url_=e,this.method_=s,this.headers_=r,this.body_=i,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=d,this.timeout_=u,this.progressCallback_=h,this.connectionFactory_=m,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,y)=>{this.resolve_=x,this.reject_=y,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new bc(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=l=>{const d=l.loaded,u=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,u)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const l=a.getErrorCode()===Md.NO_ERROR,d=a.getStatus();if(!l||VP(d,this.additionalRetryCodes_)&&this.retry){const h=a.getErrorCode()===Md.ABORT;r(!1,new bc(!1,null,h));return}const u=this.successCodes_.indexOf(d)!==-1;r(!0,new bc(u,a))})},s=(r,i)=>{const a=this.resolve_,o=this.reject_,l=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(l,l.getResponse());MP(d)?a(d):a()}catch(d){o(d)}else if(l!==null){const d=EP();d.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,d)):o(d)}else if(i.canceled){const d=this.appDelete_?r1():IP();o(d)}else{const d=AP();o(d)}};this.canceled_?s(!1,new bc(!1,null,!0)):this.backoffId_=PP(e,s,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&DP(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class bc{constructor(e,s,r){this.wasSuccessCode=e,this.connection=s,this.canceled=!!r}}function FP(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function $P(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function UP(t,e){e&&(t["X-Firebase-GMPID"]=e)}function zP(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function BP(t,e,s,r,i,a,o=!0){const l=LP(t.urlParams),d=t.url+l,u=Object.assign({},t.headers);return UP(u,e),FP(u,s),$P(u,a),zP(u,r),new OP(d,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qP(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function GP(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(e,s){this._service=e,s instanceof Ys?this._location=s:this._location=Ys.makeFromUrl(s,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,s){return new Ld(e,s)}get root(){const e=new Ys(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GP(this._location.path)}get storage(){return this._service}get parent(){const e=qP(this._location.path);if(e===null)return null;const s=new Ys(this._location.bucket,e);return new Ld(this._service,s)}_throwIfRoot(e){if(this._location.path==="")throw TP(e)}}function qy(t,e){const s=e==null?void 0:e[NP];return s==null?null:Ys.makeFromBucketSpec(s,t)}function WP(t,e,s,r={}){t.host=`${e}:${s}`,t._protocol="http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:Ww(i,t.app.options.projectId))}class HP{constructor(e,s,r,i,a){this.app=e,this._authProvider=s,this._appCheckProvider=r,this._url=i,this._firebaseVersion=a,this._bucket=null,this._host=n1,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=_P,this._maxUploadRetryTime=SP,this._requests=new Set,i!=null?this._bucket=Ys.makeFromBucketSpec(i,this._host):this._bucket=qy(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ys.makeFromBucketSpec(this._url,e):this._bucket=qy(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){By("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){By("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const s=await e.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ld(this,e)}_makeRequest(e,s,r,i,a=!0){if(this._deleted)return new RP(r1());{const o=BP(e,this._appId,r,i,s,this._firebaseVersion,a);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,s){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,s,r,i).getPromise()}}const Gy="@firebase/storage",Wy="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1="storage";function KP(t=lu(),e){t=tt(t);const r=vl(t,i1).getImmediate({identifier:e}),i=rf("storage");return i&&QP(r,...i),r}function QP(t,e,s,r={}){WP(t,e,s,r)}function YP(t,{instanceIdentifier:e}){const s=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new HP(s,r,i,e,_i)}function XP(){Pr(new Bn(i1,YP,"PUBLIC").setMultipleInstances(!0)),$s(Gy,Wy,""),$s(Gy,Wy,"esm2017")}XP();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a1="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e,s,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||s.get().then(i=>this.messaging=i,()=>{}),this.appCheck||r.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const s=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return s.error?null:s.token}return null}async getContext(e){const s=await this.getAuthToken(),r=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:s,messagingToken:r,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const np="us-central1";class ZP{constructor(e,s,r,i,a=np,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new JP(s,r,i),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=np}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const s=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${s}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${s}.cloudfunctions.net/${e}`}}function e5(t,e,s){t.emulatorOrigin=`http://${e}:${s}`}const Hy="@firebase/functions",Ky="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5="auth-internal",s5="app-check-internal",n5="messaging-internal";function r5(t,e){const s=(r,{instanceIdentifier:i})=>{const a=r.getProvider("app").getImmediate(),o=r.getProvider(t5),l=r.getProvider(n5),d=r.getProvider(s5);return new ZP(a,o,l,d,i,t)};Pr(new Bn(a1,s,"PUBLIC").setMultipleInstances(!0)),$s(Hy,Ky,e),$s(Hy,Ky,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i5(t=lu(),e=np){const r=vl(tt(t),a1).getImmediate({identifier:e}),i=rf("functions");return i&&a5(r,...i),r}function a5(t,e,s){e5(tt(t),e,s)}r5(fetch.bind(self));const o5={apiKey:"AIzaSyBS9dLh1WJEpeMpqqday6I4ptNelQVvmrs",authDomain:"saas-915ec.firebaseapp.com",projectId:"saas-915ec",storageBucket:"saas-915ec.appspot.com",messagingSenderId:"1029638100897",appId:"1:1029638100897:web:acb7e6fe5453e0872b5de0"},Cu=Qw(o5),H=lP(Cu),qe=Dj(Cu);KP(Cu);i5(Cu);qe.useDeviceLanguage();const ng=t=>["superadmin@saaspos.mg","admin@saaspos.mg","manager@saaspos.mg","cashier@saaspos.mg","reader@saaspos.mg"].includes(t.toLowerCase()),l5=t=>t==="demo-establishment-main",rg=t=>t.toLowerCase()==="superadmin@saaspos.mg",c5=async t=>{console.log("🔧 Création d'un document utilisateur par défaut pour:",t.uid);const e=t.email||"";let s="reader",r=!1,i=!1,a=!1,o="";e==="superadmin@saaspos.mg"?(s="superadmin",r=!0,i=!0,o="SYSTEM_ADMIN"):e==="admin@saaspos.mg"?(s="admin",a=!0,o="demo-establishment-main"):e==="manager@saaspos.mg"?(s="manager",o="demo-establishment-main"):e==="cashier@saaspos.mg"?(s="cashier",o="demo-establishment-main"):e==="reader@saaspos.mg"?(s="reader",o="demo-establishment-main"):(s="admin",a=!0,o=`establishment_${t.uid}`);const l={id:t.uid,email:e,name:t.displayName||e.split("@")[0],role:s,establishmentId:o,isActive:!0,isSuperAdmin:r,isSystemAdmin:i,isClientAdmin:a,lastLogin:Q.now(),createdAt:Q.now(),updatedAt:Q.now()};try{await Je(he(H,"users",t.uid),l),console.log("✅ Document utilisateur créé avec succès:",t.uid)}catch(u){throw console.error("❌ Erreur lors de la création du document utilisateur:",u),new Error("Impossible de créer le profil utilisateur")}return{id:t.uid,email:e,name:l.name,role:s,establishmentId:o,isActive:!0,isSuperAdmin:r,isSystemAdmin:i,isClientAdmin:a,lastLogin:new Date,createdAt:new Date,updatedAt:new Date}},o1=async t=>{var e,s,r;try{console.log("🔍 Récupération des données utilisateur pour:",t);const i=await Rs(he(H,"users",t));if(!i.exists())return console.log("ℹ️ Données utilisateur non trouvées dans Firestore pour:",t),null;const a=i.data(),o={id:t,email:a.email,name:a.name,role:a.role,establishmentId:a.establishmentId,isActive:a.isActive??!0,lastLogin:((e=a.lastLogin)==null?void 0:e.toDate())||null,createdAt:((s=a.createdAt)==null?void 0:s.toDate())||new Date,updatedAt:((r=a.updatedAt)==null?void 0:r.toDate())||new Date,isSuperAdmin:a.isSuperAdmin||!1,isSystemAdmin:a.isSystemAdmin||!1,isClientAdmin:a.isClientAdmin||!1};return console.log("✅ Données utilisateur récupérées:",t,{role:o.role,isSystemAdmin:o.isSystemAdmin,establishmentId:o.establishmentId}),o}catch(i){return console.error("❌ Erreur lors de la récupération des données utilisateur:",i),null}},d5=async(t,e)=>{try{if(!qe)throw new Error("Firebase Auth n'est pas initialisé");console.log("🔑 Tentative de connexion pour:",t),await cC(qe,gf);const s=await el(qe,t,e);if(!s.user)throw new Error("Aucun utilisateur retourné");let r=await o1(s.user.uid);r||(console.log("🔧 Aucun document utilisateur trouvé, création d'un document par défaut..."),r=await c5(s.user));try{await Je(he(H,"users",s.user.uid),{lastLogin:Q.now(),updatedAt:Q.now()},{merge:!0})}catch(i){console.warn("⚠️ Impossible de mettre à jour la dernière connexion:",i)}return console.log("✅ Connexion réussie:",s.user.uid,{role:r.role,isSystemAdmin:r.isSystemAdmin,establishmentId:r.establishmentId}),r}catch(s){console.error("❌ Erreur lors de la connexion:",s);const r=s.code,i=s.message||"";let a;if(r==="auth/invalid-credential"||i.includes("auth/invalid-credential"))a="Email ou mot de passe incorrect";else switch(r){case"auth/user-not-found":a="Cet email n'est pas enregistré. Créez d'abord un compte.";break;case"auth/wrong-password":a="Mot de passe incorrect.";break;case"auth/invalid-email":a="Format d'email invalide.";break;case"auth/user-disabled":a="Ce compte a été désactivé.";break;case"auth/too-many-requests":a="Trop de tentatives. Veuillez réessayez plus tard.";break;case"auth/network-request-failed":a="Problème de connexion réseau.";break;default:i.includes("invalid-credential")||i.includes("wrong-password")||i.includes("user-not-found")?a="Email ou mot de passe incorrect":a=`Erreur de connexion: ${s.message}`;break}throw new Error(a)}},u5=async t=>{try{if(console.log("📝 Tentative d'inscription pour:",t.email),ng(t.email))throw new Error("Cet email est réservé pour la démonstration. Veuillez utiliser une autre adresse email.");if(rg(t.email))throw new Error("Cet email est réservé pour l'administration système. Veuillez utiliser une autre adresse email.");const e=await Zo(qe,t.email,t.password);if(!e.user)throw new Error("Aucun utilisateur créé");await tl(e.user,{displayName:t.name});const s=`establishment_${Date.now()}`,r={id:s,name:t.establishmentName,address:"",phone:"",email:t.email,currency:"MGA",taxRate:20,authorizedUsers:[e.user.uid],createdAt:Q.now(),updatedAt:Q.now()};await Je(he(H,"establishments",s),r);const i={id:e.user.uid,email:t.email,name:t.name,role:"admin",establishmentId:s,isActive:!0,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:!0,lastLogin:null,createdAt:Q.now(),updatedAt:Q.now()};await Je(he(H,"users",e.user.uid),i);const a=[{id:"beverages",name:"Boissons",color:"blue"},{id:"food",name:"Alimentation",color:"green"},{id:"household",name:"Ménage",color:"purple"},{id:"electronics",name:"Électronique",color:"yellow"},{id:"clothing",name:"Vêtements",color:"pink"},{id:"health",name:"Santé & Beauté",color:"indigo"}];for(const l of a){const d={...l,establishmentId:s,createdAt:Q.now()};await Je(he(H,"categories",`${s}_${l.id}`),d)}const o={id:e.user.uid,email:t.email,name:t.name,role:"admin",establishmentId:s,isActive:!0,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:!0,lastLogin:null,createdAt:new Date,updatedAt:new Date};return console.log("✅ Inscription réussie:",e.user.uid),o}catch(e){console.error("❌ Erreur lors de l'inscription:",e);let s;switch(e.code){case"auth/email-already-in-use":s="Cet email est déjà utilisé.";break;case"auth/weak-password":s="Mot de passe trop faible (min 6 caractères).";break;case"auth/invalid-email":s="Format d'email invalide.";break;case"auth/operation-not-allowed":s="Inscription par email/mot de passe non activée.";break;default:s=e.message||"Erreur d'inscription";break}throw new Error(s)}},h5=async()=>{try{await ra(qe),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"}catch(t){throw console.error("Erreur lors de la déconnexion:",t),t}},m5=async(t,e)=>{try{if(console.log("🗑️ Tentative de suppression complète de l'utilisateur:",t,e),ng(e))throw new Error("Les comptes de démonstration ne peuvent pas être supprimés.");if(rg(e))throw new Error("Les comptes Super Admin système ne peuvent pas être supprimés par cette méthode.");await Is(he(H,"users",t)),console.log("✅ Document Firestore supprimé"),console.log("⚠️ La suppression complète de Firebase Auth nécessite la console Firebase");try{const s=Ae(Ee(H,"users"),ce("email","==",e)),r=await Ie(s);if(!r.empty){console.log("⚠️ Des documents utilisateur avec cet email existent encore:",r.size);for(const i of r.docs)await Is(i.ref),console.log("✅ Document supplémentaire supprimé:",i.id)}}catch(s){console.error("❌ Erreur lors de la recherche de documents supplémentaires:",s)}}catch(s){throw console.error("❌ Erreur lors de la suppression complète de l'utilisateur:",s),s}},p5=()=>qe.currentUser,f5=t=>hC(qe,t),g5=()=>!!qe.currentUser,is={signIn:d5,signUp:u5,logout:h5,getCurrentUser:p5,onAuthStateChange:f5,isAuthenticated:g5,getUserById:o1,deleteUserCompletely:m5,isDemoEmail:ng,isDemoEstablishment:l5,isSuperAdminEmail:rg},Fe=TA((t,e)=>({user:null,isLoading:!0,error:null,isInitialized:!1,signIn:async s=>{t({isLoading:!0,error:null});try{const r=await is.signIn(s.email,s.password);t({user:r,isLoading:!1})}catch(r){throw t({error:r.message||"Erreur de connexion",isLoading:!1}),r}},signUp:async s=>{t({isLoading:!0,error:null});try{const r=await is.signUp(s);t({user:r,isLoading:!1})}catch(r){throw t({error:r.message||"Erreur d'inscription",isLoading:!1}),r}},signOut:async()=>{t({isLoading:!0});try{await is.logout(),t({user:null,isLoading:!1})}catch(s){throw t({error:s.message||"Erreur de déconnexion",isLoading:!1}),s}},clearError:()=>t({error:null}),setLoading:s=>t({isLoading:s}),setUser:s=>t({user:s}),initialize:()=>{e().isInitialized||(t({isInitialized:!0}),is.onAuthStateChange(async s=>{if(s)try{const r=await is.getUserById(s.uid);r===null?(console.log("ℹ️ Données utilisateur en cours de création..."),t({user:null,isLoading:!1,error:null})):t({user:r,isLoading:!1,error:null})}catch(r){console.error("❌ Erreur lors de la récupération des données utilisateur:",r),t({user:null,isLoading:!1,error:null})}else t({user:null,isLoading:!1,error:null})}))}}));/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var x5={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y5=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),de=(t,e)=>{const s=I.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:l="",children:d,...u},h)=>I.createElement("svg",{ref:h,...x5,width:i,height:i,stroke:r,strokeWidth:o?Number(a)*24/Number(i):a,className:["lucide",`lucide-${y5(t)}`,l].join(" "),...u},[...e.map(([m,g])=>I.createElement(m,g)),...Array.isArray(d)?d:[d]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=de("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=de("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v5=de("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b5=de("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1=de("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rp=de("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pl=de("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tu=de("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c1=de("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w5=de("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j5=de("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=de("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qy=de("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=de("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N5=de("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=de("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d1=de("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=de("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ip=de("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=de("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=de("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _5=de("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=de("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1=de("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=de("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=de("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=de("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vd=de("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=de("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=de("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m1=de("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S5=de("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E5=de("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A5=de("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p1=de("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=de("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=de("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I5=de("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yy=de("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=de("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=de("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=de("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Od=de("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k5=de("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fd=de("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=de("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C5=de("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $d=de("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xy=de("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=de("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=de("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=de("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=de("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=de("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=de("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xi=de("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=de("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sa=de("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=de("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=de("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=de("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=de("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=de("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=de("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yi=de("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=de("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vi=de("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=de("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jy=de("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pu=de("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T5=de("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=de("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=de("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R5=de("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P5=de("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D5=de("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=de("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=de("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cl=de("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Zy=[{id:"dashboard",label:"Dashboard",path:"/",icon:I5,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",requiredRoles:["admin","manager","cashier","reader"]},{id:"pos",label:"Point de Vente",path:"/pos",icon:vn,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",requiredRoles:["admin","manager","cashier"]},{id:"cash-register",label:"Caisse",path:"/cash-register",icon:Tt,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",requiredRoles:["admin","manager","cashier"]},{id:"products",label:"Produits",path:"/products",icon:yt,color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",requiredRoles:["admin","manager","reader"]},{id:"categories",label:"Catégories",path:"/categories",icon:yi,color:"text-pink-600",bgColor:"bg-pink-50",borderColor:"border-pink-200",requiredRoles:["admin","manager"]},{id:"stores",label:"Magasins",path:"/stores",icon:Qn,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",requiredRoles:["admin","manager","reader"]},{id:"customers",label:"Clients",path:"/customers",icon:Xe,color:"text-indigo-600",bgColor:"bg-indigo-50",borderColor:"border-indigo-200",requiredRoles:["admin","manager","reader"]},{id:"sales",label:"Ventes",path:"/sales",icon:nn,color:"text-teal-600",bgColor:"bg-teal-50",borderColor:"border-teal-200",requiredRoles:["admin","manager","cashier","reader"]},{id:"expenses",label:"Dépenses",path:"/expenses",icon:vi,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",requiredRoles:["admin","manager","reader"]},{id:"reports",label:"Rapports",path:"/reports",icon:Tu,color:"text-cyan-600",bgColor:"bg-cyan-50",borderColor:"border-cyan-200",requiredRoles:["admin","manager","reader"]},{id:"settings",label:"Paramètres",path:"/settings",icon:Sa,color:"text-gray-600",bgColor:"bg-gray-50",borderColor:"border-gray-200",requiredRoles:["admin"]}],M5=[{id:"subscription",label:"Abonnement",path:"/subscription",icon:h1,color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",requiredRoles:["admin"]}],L5=[{id:"admin-payments",label:"Validation Paiements",path:"/admin/payments",icon:zt,color:"text-emerald-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200",requiredRoles:["admin"]}],V5=({collapsed:t,onToggleCollapse:e,mobileOpen:s,onMobileToggle:r})=>{const i=ji(),a=fl(),{user:o,signOut:l}=Fe(),[d,u]=I.useState(!1),h=(v,b)=>{a(v),window.innerWidth<1024&&r(),L.success(`Navigation vers ${b}`,{duration:2e3,icon:"🚀"})},m=()=>{l(),L.success("À bientôt ! Déconnexion réussie",{duration:3e3,icon:"👋"})},g=v=>v==="/"?i.pathname==="/":i.pathname.startsWith(v),y=(v=>{switch(v){case"admin":return{label:"Administrateur",color:"bg-gradient-to-r from-red-500 to-red-600 text-white",icon:Qe,description:"Accès complet"};case"manager":return{label:"Gérant",color:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",icon:Xe,description:"Gestion établissement"};case"cashier":return{label:"Caissier",color:"bg-gradient-to-r from-green-500 to-green-600 text-white",icon:vn,description:"Ventes et caisse"};case"reader":return{label:"Lecteur",color:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",icon:Bs,description:"Consultation seule"};default:return{label:v,color:"bg-gradient-to-r from-gray-500 to-gray-600 text-white",icon:Xe,description:"Utilisateur"}}})((o==null?void 0:o.role)||""),R=y.icon,T=(()=>{if((o==null?void 0:o.isSystemAdmin)===!0)return[...L5];if(o!=null&&o.establishmentId&&(o==null?void 0:o.establishmentId)!=="SYSTEM_ADMIN"){const v=Zy.filter(N=>{var f;return(f=N.requiredRoles)==null?void 0:f.includes((o==null?void 0:o.role)||"")}),b=M5.filter(N=>{var f;return(f=N.requiredRoles)==null?void 0:f.includes((o==null?void 0:o.role)||"")});return[...v,...b]}return Zy.filter(v=>{var b;return(b=v.requiredRoles)==null?void 0:b.includes((o==null?void 0:o.role)||"")})})(),C=(o==null?void 0:o.isSystemAdmin)===!0?{title:"SaaS POS Admin",subtitle:"Système"}:{title:"Nirina Nirina Pos",subtitle:"Madagascar"},D=(o==null?void 0:o.isSystemAdmin)===!0?{background:"bg-gradient-to-b from-gray-900 to-gray-800",border:"border-gray-700",header:"border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900",text:"text-gray-300",hoverBg:"hover:bg-gray-700",hoverText:"hover:text-white",activeText:"text-white",activeBg:"bg-gray-700",activeBorder:"border-gray-600",iconText:"text-gray-400",iconHover:"group-hover:text-white",titleGradient:"from-gray-200 to-gray-100",subtitleText:"text-gray-400",userProfileBg:"border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900",userCardBg:"bg-gray-700 border-gray-600",userCardText:"text-white",userCardSubtext:"text-gray-400",userBadgeBg:"bg-red-600",userBadgeText:"text-red-100",logoutText:"text-gray-300",logoutHoverBg:"hover:bg-gray-700",logoutHoverText:"hover:text-white"}:{background:"bg-white",border:"border-gray-200",header:"border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",text:"text-gray-600",hoverBg:"hover:bg-gray-100",hoverText:"hover:text-gray-900",activeText:"text-blue-600",activeBg:"bg-blue-50",activeBorder:"border-blue-200",iconText:"text-gray-400",iconHover:"group-hover:text-blue-600",titleGradient:"from-blue-600 to-blue-800",subtitleText:"text-gray-500",userProfileBg:"border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100",userCardBg:"bg-white border-gray-100",userCardText:"text-gray-900",userCardSubtext:"text-gray-500",userBadgeBg:"bg-blue-100",userBadgeText:"text-blue-800",logoutText:"text-red-600",logoutHoverBg:"hover:bg-red-50",logoutHoverText:"hover:text-red-700"},P=()=>n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-sm w-full",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Confirmer la déconnexion"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Êtes-vous sûr de vouloir vous déconnecter ?"}),n.jsxs("div",{className:"flex justify-end space-x-3",children:[n.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md",children:"Annuler"}),n.jsx("button",{onClick:()=>{u(!1),m()},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md",children:"Déconnexion"})]})]})});return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`hidden lg:flex lg:flex-col lg:fixed lg:inset-y-0 ${D.background} ${D.border} shadow-xl transition-all duration-300 z-30 ${t?"lg:w-16":"lg:w-64"}`,children:[n.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${D.header}`,children:[!t&&n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-lg transform hover:scale-105 transition-transform overflow-hidden",children:(o==null?void 0:o.isSystemAdmin)===!0?n.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center",children:n.jsx(Qe,{className:"w-6 h-6 text-white"})}):n.jsxs(n.Fragment,{children:[n.jsx("img",{src:"/nirina.jpg",alt:"Logo Nirina Nirina Pos",className:"w-full h-full object-cover",onError:v=>{var b;v.currentTarget.style.display="none",(b=v.currentTarget.nextElementSibling)==null||b.classList.remove("hidden")}}),n.jsx("div",{className:"hidden w-full h-full bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center",children:n.jsx(Cs,{className:"w-6 h-6 text-white"})})]})}),n.jsxs("div",{children:[n.jsx("h1",{className:`text-lg font-bold bg-gradient-to-r ${D.titleGradient} text-transparent bg-clip-text`,children:C.title}),n.jsx("p",{className:`text-xs font-medium ${D.subtitleText}`,children:C.subtitle})]})]}),n.jsx("button",{onClick:e,className:`p-2 rounded-lg transition-all duration-200 group ${D.hoverBg} hover:shadow-md`,title:t?"Étendre le menu":"Réduire le menu",children:t?n.jsx(Ru,{className:`w-5 h-5 transition-colors ${D.iconText} ${D.iconHover}`}):n.jsx(ip,{className:`w-5 h-5 transition-colors ${D.iconText} ${D.iconHover}`})})]}),n.jsx("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:T.map(v=>{const b=v.icon,N=g(v.path);return n.jsxs("button",{onClick:()=>h(v.path,v.label),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 group relative ${N?`${D.activeBg} ${D.activeText} shadow-md border ${D.activeBorder} transform scale-105`:`${D.text} ${D.hoverBg} ${D.hoverText} hover:shadow-sm`}`,title:t?v.label:"",children:[n.jsx(b,{className:`w-5 h-5 flex-shrink-0 transition-all duration-200 ${N?`${D.activeText} transform scale-110`:`${D.iconText} ${D.iconHover} group-hover:scale-105`}`}),!t&&n.jsx("span",{className:"font-medium text-sm transition-all duration-200",children:v.label}),N&&!t&&n.jsx("div",{className:"ml-auto",children:n.jsx(cl,{className:"w-4 h-4 text-current opacity-60"})}),N&&n.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-8 bg-current rounded-r-full opacity-80"})]},v.id)})}),n.jsx("div",{className:`p-4 border-t ${D.userProfileBg}`,children:t?n.jsxs("div",{className:"space-y-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center mx-auto shadow-md ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-gradient-to-r from-red-500 to-red-600 text-white":y.color}`,children:(o==null?void 0:o.isSystemAdmin)===!0?n.jsx(Qe,{className:"w-5 h-5"}):n.jsx(R,{className:"w-5 h-5"})}),n.jsx("button",{onClick:()=>u(!0),className:`w-full p-2 rounded-lg transition-all duration-200 hover:shadow-sm ${D.logoutText} ${D.logoutHoverBg} ${D.logoutHoverText}`,title:"Déconnexion",children:n.jsx(Co,{className:"w-5 h-5 mx-auto hover:scale-110 transition-transform"})})]}):n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-xl shadow-sm border ${D.userCardBg}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shadow-md ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-gradient-to-r from-red-500 to-red-600 text-white":y.color}`,children:(o==null?void 0:o.isSystemAdmin)===!0?n.jsx(Qe,{className:"w-5 h-5"}):n.jsx(R,{className:"w-5 h-5"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-sm font-medium truncate ${D.userCardText}`,children:o==null?void 0:o.name}),n.jsx("p",{className:`text-xs truncate ${D.userCardSubtext}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin Système":y.description}),n.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full mt-1 ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-red-600 text-red-100":`${D.userBadgeBg} ${D.userBadgeText}`}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin":y.label})]})]}),n.jsxs("button",{onClick:()=>u(!0),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 group hover:shadow-sm ${D.logoutText} ${D.logoutHoverBg} ${D.logoutHoverText}`,children:[n.jsx(Co,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"font-medium text-sm",children:"Déconnexion"})]})]})})]}),n.jsxs("div",{className:`lg:hidden fixed inset-y-0 left-0 z-50 w-64 ${D.background} ${D.border} shadow-2xl transform transition-transform duration-300 ${s?"translate-x-0":"-translate-x-full"}`,children:[n.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${D.header}`,children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-lg overflow-hidden",children:(o==null?void 0:o.isSystemAdmin)===!0?n.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center",children:n.jsx(Qe,{className:"w-6 h-6 text-white"})}):n.jsxs(n.Fragment,{children:[n.jsx("img",{src:"/nirina.jpg",alt:"Logo Nirina Nirina Pos",className:"w-full h-full object-cover",onError:v=>{var b;v.currentTarget.style.display="none",(b=v.currentTarget.nextElementSibling)==null||b.classList.remove("hidden")}}),n.jsx("div",{className:"hidden w-full h-full bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center",children:n.jsx(Cs,{className:"w-6 h-6 text-white"})})]})}),n.jsxs("div",{children:[n.jsx("h1",{className:`text-lg font-bold bg-gradient-to-r ${D.titleGradient} text-transparent bg-clip-text`,children:C.title}),n.jsx("p",{className:`text-xs font-medium ${D.subtitleText}`,children:C.subtitle})]})]}),n.jsx("button",{onClick:r,className:`p-2 rounded-lg transition-all duration-200 ${D.hoverBg} hover:shadow-md`,children:n.jsx(ip,{className:`w-5 h-5 ${D.iconText}`})})]}),n.jsx("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:T.map(v=>{const b=v.icon,N=g(v.path);return n.jsxs("button",{onClick:()=>h(v.path,v.label),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 relative ${N?`${D.activeBg} ${D.activeText} shadow-md border ${D.activeBorder}`:`${D.text} ${D.hoverBg} ${D.hoverText} hover:shadow-sm`}`,children:[n.jsx(b,{className:`w-5 h-5 transition-all duration-200 ${N?`${D.activeText} transform scale-110`:D.iconText}`}),n.jsx("span",{className:"font-medium text-sm",children:v.label}),N&&n.jsx("div",{className:"ml-auto",children:n.jsx(cl,{className:"w-4 h-4 text-current opacity-60"})}),N&&n.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-8 bg-current rounded-r-full opacity-80"})]},v.id)})}),n.jsx("div",{className:`p-4 border-t ${D.userProfileBg}`,children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-xl shadow-sm border ${D.userCardBg}`,children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shadow-md ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-gradient-to-r from-red-500 to-red-600 text-white":y.color}`,children:(o==null?void 0:o.isSystemAdmin)===!0?n.jsx(Qe,{className:"w-5 h-5"}):n.jsx(R,{className:"w-5 h-5"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:`text-sm font-medium truncate ${D.userCardText}`,children:o==null?void 0:o.name}),n.jsx("p",{className:`text-xs truncate ${D.userCardSubtext}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin Système":y.description}),n.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full mt-1 ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-red-600 text-red-100":`${D.userBadgeBg} ${D.userBadgeText}`}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin":y.label})]})]}),n.jsxs("button",{onClick:()=>u(!0),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 hover:shadow-sm ${D.logoutText} ${D.logoutHoverBg} ${D.logoutHoverText}`,children:[n.jsx(Co,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium text-sm",children:"Déconnexion"})]})]})})]}),d&&n.jsx(P,{})]})},O5={"/":"Tableau de bord","/pos":"Point de Vente","/cash-register":"Gestion de Caisse","/products":"Gestion des Produits","/categories":"Gestion des Catégories","/stores":"Gestion des Magasins","/customers":"Gestion des Clients","/sales":"Historique des Ventes","/expenses":"Gestion des Dépenses","/reports":"Rapports & Analytics","/settings":"Paramètres","/subscription":"Gestion de l'Abonnement","/admin/payments":"Validation des Paiements"},F5=({onMenuToggle:t,onSidebarToggle:e,sidebarCollapsed:s})=>{const r=ji(),i=fl(),{user:a,signOut:o}=Fe(),[l,d]=I.useState(!1),[u,h]=I.useState(""),[m,g]=I.useState(!1),x=O5[r.pathname]||"Page",y=[{id:1,type:"warning",message:"Stock faible: Coca Cola 50cl (5 restants)",time:"5 min"},{id:2,type:"info",message:"Nouvelle vente: 15,800 Ar",time:"12 min"},{id:3,type:"success",message:"Sauvegarde automatique effectuée",time:"1h"}],_=(P=>{switch(P){case"admin":return{label:"Administrateur",color:"bg-red-100 text-red-800",icon:Qe};case"manager":return{label:"Gérant",color:"bg-blue-100 text-blue-800",icon:Xe};case"cashier":return{label:"Caissier",color:"bg-green-100 text-green-800",icon:vn};case"reader":return{label:"Lecteur",color:"bg-purple-100 text-purple-800",icon:Tu};default:return{label:P,color:"bg-gray-100 text-gray-800",icon:At}}})((a==null?void 0:a.role)||""),T=_.icon,A=P=>{P.preventDefault(),u.trim()&&L.success(`Recherche: "${u}"`)},C=()=>{o(),d(!1),L.success("Déconnexion réussie")},k=P=>{switch(P){case"warning":return"⚠️";case"info":return"ℹ️";case"success":return"✅";default:return"📢"}},D=P=>{switch(P){case"warning":return"border-l-orange-500 bg-orange-50";case"info":return"border-l-blue-500 bg-blue-50";case"success":return"border-l-green-500 bg-green-50";default:return"border-l-gray-500 bg-gray-50"}};return n.jsxs("header",{className:"bg-white border-b border-gray-200 shadow-sm relative z-20",children:[n.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("button",{onClick:t,className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Menu",children:n.jsx(k5,{className:"w-5 h-5 text-gray-600"})}),n.jsx("button",{onClick:e,className:"hidden lg:block p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Réduire/Étendre le menu",children:s?n.jsx(Ru,{className:"w-5 h-5 text-gray-600"}):n.jsx(ip,{className:"w-5 h-5 text-gray-600"})}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:x}),n.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),n.jsx("div",{className:"hidden md:flex flex-1 max-w-md mx-8",children:n.jsxs("form",{onSubmit:A,className:"relative w-full",children:[n.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),n.jsx("input",{type:"text",value:u,onChange:P=>h(P.target.value),placeholder:"Rechercher produits, clients, ventes...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]})}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>g(!m),className:"relative p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Notifications",children:[n.jsx(w5,{className:"w-5 h-5 text-gray-600"}),y.length>0&&n.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-medium",children:y.length})]}),m&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[n.jsx("div",{className:"px-4 py-2 border-b border-gray-100",children:n.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"})}),n.jsx("div",{className:"max-h-64 overflow-y-auto",children:y.map(P=>n.jsx("div",{className:`px-4 py-3 border-l-4 ${D(P.type)} hover:bg-gray-50 cursor-pointer`,children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("span",{className:"text-lg",children:k(P.type)}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm text-gray-900",children:P.message}),n.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Il y a ",P.time]})]})]})},P.id))}),n.jsx("div",{className:"px-4 py-2 border-t border-gray-100",children:n.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Voir toutes les notifications"})})]})]}),n.jsx("button",{onClick:()=>i("/settings"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Paramètres",children:n.jsx(Sa,{className:"w-5 h-5 text-gray-600"})}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>d(!l),className:"flex items-center space-x-3 pl-4 border-l border-gray-200 hover:bg-gray-50 rounded-lg p-2 transition-colors",children:[n.jsxs("div",{className:"hidden sm:block text-right",children:[n.jsx("p",{className:"text-sm font-medium text-gray-900",children:a==null?void 0:a.name}),n.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full ${_.color}`,children:_.label})]}),n.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:n.jsx(T,{className:"w-4 h-4 text-white"})})]}),l&&n.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[n.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:n.jsx(T,{className:"w-5 h-5 text-white"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:a==null?void 0:a.name}),n.jsx("p",{className:"text-sm text-gray-600",children:a==null?void 0:a.email}),n.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full ${_.color} mt-1`,children:_.label})]})]})}),n.jsxs("div",{className:"py-2",children:[n.jsxs("button",{onClick:()=>{i("/settings"),d(!1)},className:"w-full flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[n.jsx(Sa,{className:"w-4 h-4"}),n.jsx("span",{children:"Paramètres du compte"})]}),n.jsxs("button",{onClick:C,className:"w-full flex items-center space-x-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors",children:[n.jsx(Co,{className:"w-4 h-4"}),n.jsx("span",{children:"Déconnexion"})]})]})]})]})]})]}),n.jsx("div",{className:"md:hidden px-6 pb-4",children:n.jsxs("form",{onSubmit:A,className:"relative",children:[n.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),n.jsx("input",{type:"text",value:u,onChange:P=>h(P.target.value),placeholder:"Rechercher...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(l||m)&&n.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{d(!1),g(!1)}})]})},js=({children:t})=>{const[e,s]=I.useState(!1),[r,i]=I.useState(!1);return I.useEffect(()=>(r?document.body.classList.add("mobile-sidebar-open"):document.body.classList.remove("mobile-sidebar-open"),()=>{document.body.classList.remove("mobile-sidebar-open")}),[r]),I.useEffect(()=>{const a=()=>{window.innerWidth>=1024&&r&&i(!1)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[r]),n.jsxs("div",{className:"h-screen flex bg-gray-50",children:[n.jsx(V5,{collapsed:e,onToggleCollapse:()=>s(!e),mobileOpen:r,onMobileToggle:()=>i(!r)}),n.jsxs("div",{className:`flex-1 flex flex-col overflow-hidden transition-all duration-300 ${e?"lg:ml-16":"lg:ml-64"}`,children:[n.jsx(F5,{onMenuToggle:()=>i(!r),onSidebarToggle:()=>s(!e),sidebarCollapsed:e}),n.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",children:n.jsx("div",{className:"p-4 md:p-6 pb-16 md:pb-6",children:t})})]}),r&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>i(!1)})]})},O=({variant:t="primary",size:e="md",fullWidth:s=!1,children:r,className:i="",disabled:a,...o})=>{const l="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",d={primary:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500",secondary:"bg-gray-600 hover:bg-gray-700 text-white focus:ring-gray-500",success:"bg-green-600 hover:bg-green-700 text-white focus:ring-green-500",warning:"bg-orange-600 hover:bg-orange-700 text-white focus:ring-orange-500",danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",ghost:"bg-transparent hover:bg-gray-100 text-gray-700 focus:ring-gray-500",outline:"bg-transparent border border-gray-300 hover:bg-gray-50 text-gray-700 focus:ring-blue-500"},u={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},h=s?"w-full":"";return n.jsx("button",{className:`${l} ${d[t]} ${u[e]} ${h} ${i}`,disabled:a,...o,children:r})},xe=({label:t,error:e,leftIcon:s,rightIcon:r,className:i="",...a})=>n.jsxs("div",{className:"w-full",children:[t&&n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),n.jsxs("div",{className:"relative",children:[s&&n.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s}),n.jsx("input",{className:`block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${s?"pl-10":""} ${r?"pr-10":""} ${e?"border-red-300":""} ${i}`,...a}),r&&n.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:r})]}),e&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:e})]}),K=({children:t,className:e="",padding:s="md"})=>{const r={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return n.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 ${r[s]} ${e}`,children:t})},$5=({onSubmit:t,onSwitchToSignUp:e,onForgotPassword:s,isLoading:r=!1})=>{const[i,a]=I.useState(""),[o,l]=I.useState(""),[d,u]=I.useState(!1),[h,m]=I.useState({}),[g,x]=I.useState(!1),[y,R]=I.useState(""),[_,T]=I.useState(!1),A=async k=>{k.preventDefault(),m({});const D={};if(i||(D.email="L'email est requis"),o||(D.password="Le mot de passe est requis"),Object.keys(D).length>0){m(D);return}try{await t(i,o)}catch{}},C=async k=>{if(k.preventDefault(),!y.trim()){m({email:"L'email est requis pour réinitialiser le mot de passe"});return}if(!/\S+@\S+\.\S+/.test(y)){m({email:"Format d'email invalide"});return}T(!0);try{s&&await s(y),x(!1)}catch{}finally{T(!1)}};return n.jsxs(K,{className:"w-full max-w-md mx-auto",padding:"lg",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:n.jsx(Qe,{className:"w-8 h-8 text-white"})}),n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Connexion Sécurisée"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Accédez à votre espace SaaS POS"})]}),g?n.jsxs("form",{onSubmit:C,className:"space-y-6",children:[n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:n.jsx("p",{className:"text-sm text-blue-800",children:"Entrez votre adresse email ci-dessous. Nous vous enverrons un lien pour réinitialiser votre mot de passe."})}),n.jsx(xe,{label:"Adresse email",type:"email",value:y,onChange:k=>R(k.target.value),leftIcon:n.jsx(Ft,{className:"w-5 h-5 text-gray-400"}),placeholder:"votre@email.com",error:h.email,required:!0,disabled:_}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(O,{type:"button",variant:"ghost",fullWidth:!0,disabled:_,onClick:()=>x(!1),children:"Annuler"}),n.jsx(O,{type:"submit",fullWidth:!0,disabled:_,children:_?"Envoi en cours...":"Envoyer le lien"})]})]}):n.jsxs("form",{onSubmit:A,className:"space-y-6",children:[n.jsx(xe,{label:"Adresse email",type:"email",value:i,onChange:k=>a(k.target.value),leftIcon:n.jsx(Ft,{className:"w-5 h-5 text-gray-400"}),placeholder:"votre@email.com",error:h.email,required:!0,disabled:r}),n.jsx(xe,{label:"Mot de passe",type:d?"text":"password",value:o,onChange:k=>l(k.target.value),leftIcon:n.jsx(os,{className:"w-5 h-5 text-gray-400"}),rightIcon:n.jsx("button",{type:"button",onClick:()=>u(!d),className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:r,children:d?n.jsx(Vd,{className:"w-5 h-5"}):n.jsx(Bs,{className:"w-5 h-5"})}),placeholder:"••••••••",error:h.password,required:!0,disabled:r}),n.jsx(O,{type:"submit",fullWidth:!0,disabled:r,className:"mt-8",children:r?"Connexion en cours...":"Se connecter"})]}),n.jsx("div",{className:"mt-6 text-center",children:!g&&n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 font-medium",disabled:r,onClick:()=>{x(!0),R(i)},children:"Mot de passe oublié ?"})}),e&&!g&&n.jsx("div",{className:"mt-4 text-center",children:n.jsxs("p",{className:"text-sm text-gray-600",children:["Pas encore de compte ?"," ",n.jsx("button",{type:"button",onClick:e,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:r,children:"Créer un compte"})]})}),n.jsx("div",{className:"mt-4 text-center text-xs text-gray-500",children:n.jsx("p",{children:"🔒 Connexion sécurisée avec Firebase Authentication"})})]})},U5=({onSubmit:t,onSwitchToLogin:e,isLoading:s=!1})=>{const[r,i]=I.useState({email:"",password:"",confirmPassword:"",name:"",establishmentName:""}),[a,o]=I.useState(!1),[l,d]=I.useState(!1),[u,h]=I.useState({}),m=(y,R)=>{i(_=>({..._,[y]:R})),u[y]&&h(_=>({..._,[y]:""}))},g=()=>{const y={};return r.name.trim()||(y.name="Le nom est requis"),r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(y.email="Format d'email invalide"):y.email="L'email est requis",r.password?r.password.length<6&&(y.password="Le mot de passe doit contenir au moins 6 caractères"):y.password="Le mot de passe est requis",r.confirmPassword?r.password!==r.confirmPassword&&(y.confirmPassword="Les mots de passe ne correspondent pas"):y.confirmPassword="Confirmez votre mot de passe",r.establishmentName.trim()||(y.establishmentName="Le nom de l'établissement est requis"),h(y),Object.keys(y).length===0},x=async y=>{if(y.preventDefault(),!!g())try{await t(r.email,r.password,r.name,r.establishmentName)}catch{}};return n.jsxs(K,{className:"w-full max-w-md mx-auto",padding:"lg",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-600 to-green-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:n.jsx(Qe,{className:"w-8 h-8 text-white"})}),n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Créer votre compte"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Démarrez avec SaaS POS Madagascar"})]}),n.jsxs("form",{onSubmit:x,className:"space-y-6",children:[n.jsx(xe,{label:"Nom complet *",type:"text",value:r.name,onChange:y=>m("name",y.target.value),leftIcon:n.jsx(At,{className:"w-5 h-5 text-gray-400"}),placeholder:"Votre nom complet",error:u.name,required:!0,disabled:s}),n.jsx(xe,{label:"Nom de l'établissement *",type:"text",value:r.establishmentName,onChange:y=>m("establishmentName",y.target.value),leftIcon:n.jsx(Qn,{className:"w-5 h-5 text-gray-400"}),placeholder:"Ex: Mon Commerce",error:u.establishmentName,required:!0,disabled:s}),n.jsx(xe,{label:"Adresse email *",type:"email",value:r.email,onChange:y=>m("email",y.target.value),leftIcon:n.jsx(Ft,{className:"w-5 h-5 text-gray-400"}),placeholder:"votre@email.com",error:u.email,required:!0,disabled:s}),n.jsx(xe,{label:"Mot de passe *",type:a?"text":"password",value:r.password,onChange:y=>m("password",y.target.value),leftIcon:n.jsx(os,{className:"w-5 h-5 text-gray-400"}),rightIcon:n.jsx("button",{type:"button",onClick:()=>o(!a),className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:s,children:a?n.jsx(Vd,{className:"w-5 h-5"}):n.jsx(Bs,{className:"w-5 h-5"})}),placeholder:"••••••••",error:u.password,required:!0,disabled:s}),n.jsx(xe,{label:"Confirmer le mot de passe *",type:l?"text":"password",value:r.confirmPassword,onChange:y=>m("confirmPassword",y.target.value),leftIcon:n.jsx(os,{className:"w-5 h-5 text-gray-400"}),rightIcon:n.jsx("button",{type:"button",onClick:()=>d(!l),className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:s,children:l?n.jsx(Vd,{className:"w-5 h-5"}):n.jsx(Bs,{className:"w-5 h-5"})}),placeholder:"••••••••",error:u.confirmPassword,required:!0,disabled:s}),n.jsx(O,{type:"submit",fullWidth:!0,disabled:s,className:"mt-8",children:s?"Création du compte...":"Créer mon compte"})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("p",{className:"text-sm text-gray-600",children:["Vous avez déjà un compte ?"," ",n.jsx("button",{type:"button",onClick:e,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:s,children:"Se connecter"})]})}),n.jsxs("div",{className:"mt-4 text-center text-xs text-gray-500",children:[n.jsx("p",{children:"🔒 Données sécurisées avec Firebase"}),n.jsx("p",{className:"mt-1",children:"En créant un compte, vous acceptez nos conditions d'utilisation"})]})]})},z5=()=>{const{user:t,signIn:e,signUp:s,error:r,isLoading:i,clearError:a}=Fe(),[o,l]=I.useState(!1),[d,u]=I.useState(!1),[h,m]=I.useState(!1),[g,x]=I.useState(!1),[y,R]=I.useState(null),[_,T]=I.useState(""),[A,C]=I.useState(!1);if(t)return n.jsx(Cw,{to:"/",replace:!0});const k=async(N,f)=>{a();try{await e({email:N,password:f}),L.success("Connexion réussie !"),u(!1)}catch(j){j.message.includes("auth/invalid-credential")||j.message.includes("Email ou mot de passe incorrect")?["superadmin@saaspos.mg","admin@saaspos.mg","manager@saaspos.mg","cashier@saaspos.mg","reader@saaspos.mg"].includes(N)?(u(!0),L.error("Comptes de démonstration non configurés. Veuillez configurer le système d'abord.")):L.error("Email ou mot de passe incorrect"):L.error(j.message||"Erreur de connexion")}},D=async(N,f,j,E)=>{a();try{await s({email:N,password:f,name:j,establishmentName:E}),L.success("Compte créé avec succès ! Bienvenue !")}catch(S){L.error(S.message||"Erreur lors de la création du compte")}},P=async N=>{a(),m(!0);try{const f={url:window.location.origin+"/login",handleCodeInApp:!1};await ff(qe,N,f),console.log(`Email de réinitialisation envoyé à: ${N}`),L.success("Email de réinitialisation envoyé ! Vérifiez votre boîte de réception et vos spams.")}catch(f){console.error("Erreur lors de l'envoi de l'email de réinitialisation:",f);let j="Erreur lors de l'envoi de l'email";switch(f.code){case"auth/user-not-found":j="Aucun compte trouvé avec cette adresse email";break;case"auth/invalid-email":j="Format d'email invalide";break;case"auth/too-many-requests":j="Trop de tentatives. Veuillez réessayer plus tard.";break;default:j=f.message||"Erreur lors de l'envoi de l'email"}L.error(j)}finally{m(!1)}},v=N=>{R(N),C(!0),T("")},b=()=>{if(!y)return;if(_!=="demo2025"){L.error("Mot de passe de démonstration incorrect");return}const j={admin:{email:"admin@saaspos.mg",password:"admin123"},manager:{email:"manager@saaspos.mg",password:"manager123"},cashier:{email:"cashier@saaspos.mg",password:"cashier123"},reader:{email:"reader@saaspos.mg",password:"reader123"}}[y];j&&k(j.email,j.password),C(!1),R(null)};return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"w-full max-w-md",children:[o?n.jsx(U5,{onSubmit:D,onSwitchToLogin:()=>l(!1),isLoading:i}):n.jsx($5,{onSubmit:k,onSwitchToSignUp:()=>l(!0),onForgotPassword:P,isLoading:i||h}),d&&n.jsx("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-2",children:"Configuration requise"}),n.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Les comptes de démonstration n'existent pas encore dans votre projet Firebase. Vous devez d'abord configurer le système pour créer ces comptes."}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(y0,{to:"/setup",className:"inline-flex items-center px-3 py-2 border border-amber-300 shadow-sm text-sm leading-4 font-medium rounded-md text-amber-700 bg-amber-50 hover:bg-amber-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors",children:[n.jsx(Sa,{className:"w-4 h-4 mr-2"}),"Configurer le système"]}),n.jsx("button",{onClick:()=>u(!1),className:"text-sm text-amber-600 hover:text-amber-800 px-2 py-1",children:"Fermer"})]})]})]})}),r&&!d&&n.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[n.jsx("p",{className:"text-sm text-red-600",children:r}),(r.includes("auth/invalid-credential")||r.includes("Email ou mot de passe incorrect"))&&n.jsx("div",{className:"mt-3",children:n.jsxs(y0,{to:"/setup",className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[n.jsx(Sa,{className:"w-4 h-4 mr-2"}),"Configurer le système"]})})]}),!o&&n.jsx("div",{className:"mt-6 text-center",children:n.jsx("button",{onClick:()=>x(!0),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Accéder à la démonstration"})}),g&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Qe,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Accès à la démonstration"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Sélectionnez un rôle pour explorer les fonctionnalités du système"})]}),n.jsxs("div",{className:"space-y-3 mb-6",children:[n.jsxs("button",{onClick:()=>v("admin"),className:"w-full flex justify-between items-center p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[n.jsxs("div",{className:"text-left",children:[n.jsx("p",{className:"font-medium text-blue-900",children:"Admin Client"}),n.jsx("p",{className:"text-sm text-blue-700",children:"Gestion complète"})]}),n.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:"Accès sécurisé"})]}),n.jsxs("button",{onClick:()=>v("manager"),className:"w-full flex justify-between items-center p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors",children:[n.jsxs("div",{className:"text-left",children:[n.jsx("p",{className:"font-medium text-green-900",children:"Gérant"}),n.jsx("p",{className:"text-sm text-green-700",children:"Gestion établissement"})]}),n.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium",children:"Accès sécurisé"})]}),n.jsxs("button",{onClick:()=>v("cashier"),className:"w-full flex justify-between items-center p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors",children:[n.jsxs("div",{className:"text-left",children:[n.jsx("p",{className:"font-medium text-yellow-900",children:"Caissier"}),n.jsx("p",{className:"text-sm text-yellow-700",children:"Ventes uniquement"})]}),n.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium",children:"Accès sécurisé"})]}),n.jsxs("button",{onClick:()=>v("reader"),className:"w-full flex justify-between items-center p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors",children:[n.jsxs("div",{className:"text-left",children:[n.jsx("p",{className:"font-medium text-purple-900",children:"Lecteur"}),n.jsx("p",{className:"text-sm text-purple-700",children:"Consultation seule"})]}),n.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium",children:"Accès sécurisé"})]})]}),n.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-gray-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-gray-700",children:[n.jsx("p",{className:"font-medium",children:"Environnement de démonstration"}),n.jsx("p",{className:"mt-1",children:"Ces comptes vous permettent d'explorer les fonctionnalités du système dans un environnement isolé et sécurisé."})]})]})}),n.jsx("div",{className:"flex justify-end",children:n.jsx(O,{variant:"ghost",onClick:()=>x(!1),children:"Fermer"})})]})}),A&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(os,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Authentification requise"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Veuillez saisir le mot de passe de démonstration pour accéder au compte"})]}),n.jsxs("div",{className:"space-y-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mot de passe de démonstration"}),n.jsx("input",{type:"password",value:_,onChange:N=>T(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Entrez le mot de passe de démonstration"})]}),n.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-blue-700",children:[n.jsx("p",{className:"font-medium",children:"Information"}),n.jsxs("p",{className:"mt-1",children:["Le mot de passe de démonstration est : ",n.jsx("strong",{children:"demo2025"})]}),n.jsx("p",{className:"mt-1",children:"Ce mot de passe est requis pour protéger l'accès aux comptes de démonstration."})]})]})})]}),n.jsxs("div",{className:"flex justify-end gap-3",children:[n.jsx(O,{variant:"ghost",onClick:()=>{C(!1),R(null)},children:"Annuler"}),n.jsx(O,{onClick:b,disabled:!_,children:"Accéder à la démo"})]})]})})]})})},B5=()=>{const[t,e]=I.useState(!1),[s,r]=I.useState(null),i=async(l,d=1e4)=>{const u=new Promise((h,m)=>{setTimeout(()=>m(new Error(`Opération expirée après ${d}ms`)),d)});return Promise.race([l,u])},a=async()=>{var l,d,u;e(!0),r(null);try{console.log("🚀 Début de la configuration des comptes..."),r({success:!1,message:"Initialisation de la configuration...",step:"init"}),r({success:!1,message:"Création du Super Admin système...",step:"super-admin"});let h="",m=!1;try{qe.currentUser&&(await i(ra(qe),5e3),console.log("🔓 Déconnexion de l'utilisateur actuel")),console.log("🔐 Tentative de création du Super Admin...");const k=await i(Zo(qe,"superadmin@saaspos.mg","superadmin123"),1e4);await i(tl(k.user,{displayName:"Super Administrateur Système"}),5e3),h=k.user.uid,m=!0,console.log("✅ Nouveau Super Admin créé:",h)}catch(k){if(k.code==="auth/email-already-in-use"){console.log("⚠️ Le Super Admin existe déjà, tentative de connexion...");try{await new Promise(P=>setTimeout(P,1e3)),h=(await i(el(qe,"superadmin@saaspos.mg","superadmin123"),1e4)).user.uid,console.log("✅ Connexion Super Admin réussie:",h)}catch(D){if(console.error("❌ Erreur de connexion Super Admin:",D),D.code==="auth/invalid-credential"){r({success:!1,message:"Le compte superadmin@saaspos.mg existe déjà avec un mot de passe différent. Veuillez supprimer ce compte de la console Firebase Authentication et réessayer.",requiresManualAction:!0,error:"Compte existant avec mot de passe différent"}),e(!1);return}else throw D}}else throw(l=k.message)!=null&&l.includes("expirée")?new Error("Timeout lors de la création du Super Admin. Vérifiez votre connexion internet et les règles Firestore."):k}const g={id:h,email:"superadmin@saaspos.mg",name:"Super Administrateur Système",role:"admin",establishmentId:"SYSTEM_ADMIN",isActive:!0,isSuperAdmin:!0,isSystemAdmin:!0,isClientAdmin:!1,lastLogin:null,createdAt:Q.now(),updatedAt:Q.now()};try{(await i(Rs(he(H,"users",h)),8e3)).exists()?(console.log("⚠️ Document Super Admin existe déjà"),await i(ht(he(H,"users",h),{isSuperAdmin:!0,isSystemAdmin:!0,updatedAt:Q.now()}),1e4),console.log("✅ Document Super Admin mis à jour avec les flags corrects")):(await i(Je(he(H,"users",h),g),1e4),console.log("✅ Document Super Admin créé"))}catch(k){throw console.error("❌ Erreur lors de la création du document Super Admin:",k),new Error(`Impossible de créer le document Super Admin: ${k.message}`)}r({success:!1,message:"Création de l'établissement de démonstration...",step:"establishment"});const x="demo-establishment-main",y={id:x,name:"SaaS POS Madagascar - Demo Client",address:"Antananarivo, Madagascar",nif:"1234567890",stat:"12345678901234",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",currency:"MGA",taxRate:20,authorizedUsers:[],isDemo:!0,createdAt:Q.now(),updatedAt:Q.now()};try{console.log("📝 Tentative de création de l'établissement..."),(await i(Rs(he(H,"establishments",x)),8e3)).exists()?(console.log("⚠️ Établissement existe déjà, mise à jour..."),await i(Je(he(H,"establishments",x),y,{merge:!0}),1e4),console.log("✅ Établissement mis à jour")):(console.log("🏢 Création du nouvel établissement..."),await i(Je(he(H,"establishments",x),y),15e3),console.log("✅ Établissement créé avec succès"))}catch(k){console.error("❌ Erreur lors de la création de l'établissement:",k),console.log("⚠️ Continuons malgré l'erreur d'établissement...")}r({success:!1,message:"Création des comptes clients de démonstration...",step:"client-users"});const R=[{email:"admin@saaspos.mg",password:"admin123",name:"Admin Client Demo",role:"admin",isClientAdmin:!0},{email:"manager@saaspos.mg",password:"manager123",name:"Gérant Principal",role:"manager",isClientAdmin:!1},{email:"cashier@saaspos.mg",password:"cashier123",name:"Marie Caissière",role:"cashier",isClientAdmin:!1},{email:"reader@saaspos.mg",password:"reader123",name:"Jean Lecteur",role:"reader",isClientAdmin:!1}],_=["superadmin@saaspos.mg"];for(const k of R)try{console.log(`🔐 Création du compte client: ${k.email}`),qe.currentUser&&await i(ra(qe),5e3);const D=await i(Zo(qe,k.email,k.password),1e4);await i(tl(D.user,{displayName:k.name}),5e3);const P={id:D.user.uid,email:k.email,name:k.name,role:k.role,establishmentId:x,isActive:!0,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:k.isClientAdmin,lastLogin:null,createdAt:Q.now(),updatedAt:Q.now()};await i(Je(he(H,"users",D.user.uid),P),1e4),_.push(k.email),console.log(`✅ Compte client créé: ${k.email}`)}catch(D){D.code==="auth/email-already-in-use"?(console.log(`⚠️ Le compte ${k.email} existe déjà`),_.push(k.email)):D.code==="auth/invalid-credential"?(console.log(`⚠️ Le compte ${k.email} existe avec un mot de passe différent`),_.push(k.email)):console.error(`❌ Erreur création ${k.email}:`,D)}r({success:!1,message:"Création de l'abonnement d'essai pour le client...",step:"subscription"});try{const k=new Date(Date.now()+12096e5),D={id:`sub_${x}`,establishmentId:x,establishmentName:"SaaS POS Madagascar - Demo Client",plan:"trial",status:"trial",startDate:Q.now(),endDate:Q.fromDate(k),trialEndDate:Q.fromDate(k),monthlyPrice:0,nextPaymentDate:Q.fromDate(k),createdAt:Q.now(),updatedAt:Q.now()};await Je(he(H,"subscriptions",`sub_${x}`),D),console.log("✅ Abonnement d'essai créé pour le client")}catch{console.log("⚠️ Erreur lors de la création de l'abonnement, continuons...")}qe.currentUser&&await i(ra(qe),5e3),r({success:!1,message:"Création des données de démonstration...",step:"demo-data"});const T=[{id:"beverages",name:"Boissons",color:"blue"},{id:"food",name:"Alimentation",color:"green"},{id:"household",name:"Ménage",color:"purple"},{id:"electronics",name:"Électronique",color:"yellow"},{id:"clothing",name:"Vêtements",color:"pink"},{id:"health",name:"Santé & Beauté",color:"indigo"}];for(const k of T)try{const D={id:k.id,name:k.name,color:k.color,establishmentId:x,createdAt:Q.now()};await i(Je(he(H,"categories",`${x}_${k.id}`),D),8e3)}catch{console.log(`⚠️ Catégorie ${k.name} existe peut-être déjà ou timeout`)}console.log("✅ Catégories créées");const A=[{name:"Coca Cola 50cl",reference:"CC001",salePrice:1500,purchasePrice:1200,stock:50,minStock:10,categoryId:`${x}_beverages`,taxRate:20,unit:"piece",brand:"Coca-Cola",barcode:"123456789012",description:"Boisson gazeuse rafraîchissante"},{name:"Pain de mie complet",reference:"PM001",salePrice:2500,purchasePrice:2e3,stock:5,minStock:15,categoryId:`${x}_food`,taxRate:20,unit:"piece",brand:"Boulangerie Locale",barcode:"234567890123",description:"Pain de mie aux céréales complètes"},{name:"Savon de Marseille",reference:"SM001",salePrice:1200,purchasePrice:800,stock:30,minStock:10,categoryId:`${x}_household`,taxRate:20,unit:"piece",brand:"Le Petit Marseillais",barcode:"678901234567",description:"Savon naturel à l'huile d'olive"}];for(let k=0;k<A.length;k++)try{const P={...A[k],establishmentId:x,isActive:!0,createdAt:Q.now(),updatedAt:Q.now()};await i(Je(he(H,"products",`${x}_product_${k+1}`),P),8e3)}catch{console.log(`⚠️ Produit ${A[k].name} existe peut-être déjà ou timeout`)}console.log("✅ Produits créés");const C=[{name:"Rakoto Jean",email:"rakoto.jean@email.mg",phone:"+261 34 12 345 67",address:"Antananarivo, Madagascar",loyaltyPoints:150,totalSpent:125e3},{name:"Rasoa Marie",email:"rasoa.marie@email.mg",phone:"+261 33 98 765 43",address:"Fianarantsoa, Madagascar",loyaltyPoints:89,totalSpent:89300}];for(let k=0;k<C.length;k++)try{const P={...C[k],establishmentId:x,isActive:!0,lastPurchase:Q.now(),createdAt:Q.now(),updatedAt:Q.now()};await i(Je(he(H,"customers",`${x}_customer_${k+1}`),P),8e3)}catch{console.log(`⚠️ Client ${C[k].name} existe peut-être déjà ou timeout`)}console.log("✅ Clients créés"),r({success:!0,message:"Configuration terminée avec succès !",createdUsers:_}),console.log("🎉 Configuration complète terminée !")}catch(h){console.error("❌ Erreur lors de la configuration:",h);let m=h.message||"Une erreur inattendue s'est produite";((d=h.message)!=null&&d.includes("Timeout")||(u=h.message)!=null&&u.includes("expirée"))&&(m=`${h.message}

Suggestions :
• Vérifiez votre connexion internet
• Vérifiez les règles Firestore dans la console Firebase
• Assurez-vous que les règles permettent les opérations d'écriture`),r({success:!1,message:`Erreur: ${m}`,error:h.message})}finally{e(!1)}},o=()=>{r(null),a()};return n.jsx("div",{className:"max-w-2xl mx-auto p-6",children:n.jsxs(K,{className:"p-8",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(Xe,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Configuration du Système SaaS POS"}),n.jsx("p",{className:"text-gray-600",children:"Configurez le Super Admin système et les comptes clients de démonstration"})]}),!s&&n.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(kr,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-amber-800",children:[n.jsx("p",{className:"font-medium mb-2",children:"Comptes qui seront créés :"}),n.jsxs("div",{className:"mb-4",children:[n.jsx("p",{className:"font-semibold text-amber-900 mb-1",children:"🔧 Super Admin Système :"}),n.jsxs("ul",{className:"space-y-1 ml-4",children:[n.jsxs("li",{children:["• ",n.jsx("strong",{children:"superadmin@saaspos.mg"})," - Super Admin (mot de passe: superadmin123)"]}),n.jsx("li",{className:"text-xs",children:"→ Gère tous les paiements et validations du système"})]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-amber-900 mb-1",children:"👥 Comptes Clients Demo :"}),n.jsxs("ul",{className:"space-y-1 ml-4",children:[n.jsxs("li",{children:["• ",n.jsx("strong",{children:"admin@saaspos.mg"})," - Admin Client (mot de passe: admin123)"]}),n.jsxs("li",{children:["• ",n.jsx("strong",{children:"manager@saaspos.mg"})," - Gérant (mot de passe: manager123)"]}),n.jsxs("li",{children:["• ",n.jsx("strong",{children:"cashier@saaspos.mg"})," - Caissier (mot de passe: cashier123)"]}),n.jsxs("li",{children:["• ",n.jsx("strong",{children:"reader@saaspos.mg"})," - Lecteur (mot de passe: reader123)"]}),n.jsx("li",{className:"text-xs",children:"→ Ont un abonnement d'essai et gèrent leur établissement"})]})]}),n.jsx("p",{className:"mt-3 text-xs",children:"⚠️ Cette opération créera également des données de démonstration (produits, catégories, clients)."})]})]})}),s&&n.jsx("div",{className:`border rounded-lg p-4 mb-6 ${s.success?"bg-green-50 border-green-200":s.requiresManualAction?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:n.jsxs("div",{className:"flex items-start",children:[s.success?n.jsx(zt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}):s.requiresManualAction?n.jsx(kr,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}):n.jsx(kr,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:`text-sm ${s.success?"text-green-800":s.requiresManualAction?"text-yellow-800":"text-red-800"}`,children:[n.jsx("p",{className:"font-medium whitespace-pre-line",children:s.message}),s.success&&s.createdUsers&&n.jsxs("div",{className:"mt-3",children:[n.jsx("p",{className:"mb-2 font-medium",children:"✅ Comptes configurés :"}),n.jsx("ul",{className:"ml-4 space-y-1",children:s.createdUsers.map(l=>n.jsxs("li",{children:["• ",l]},l))}),n.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[n.jsx("p",{className:"text-blue-800 font-medium text-xs mb-2",children:"🎉 Configuration terminée !"}),n.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Super Admin :"})," superadmin@saaspos.mg (gère les validations)"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Client Demo :"})," admin@saaspos.mg (a un abonnement d'essai)"]})]})]})]}),s.requiresManualAction&&n.jsxs("div",{className:"mt-3 p-3 bg-yellow-100 border border-yellow-300 rounded",children:[n.jsx("p",{className:"text-yellow-800 font-medium text-xs mb-2",children:"🔧 Action manuelle requise :"}),n.jsxs("ol",{className:"text-yellow-800 text-xs ml-4 space-y-1",children:[n.jsxs("li",{children:["1. Allez dans la ",n.jsx("a",{href:"https://console.firebase.google.com",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"console Firebase"})]}),n.jsx("li",{children:"2. Sélectionnez votre projet"}),n.jsx("li",{children:'3. Allez dans "Authentication" → "Users"'}),n.jsx("li",{children:"4. Supprimez l'utilisateur problématique"}),n.jsx("li",{children:'5. Revenez ici et cliquez sur "Réessayer"'})]})]}),!s.success&&!s.requiresManualAction&&s.error&&n.jsx("div",{className:"mt-2 p-2 bg-red-100 border border-red-200 rounded text-xs",children:n.jsxs("p",{children:[n.jsx("strong",{children:"Détail de l'erreur :"})," ",s.error]})}),t&&s.step&&n.jsxs("div",{className:"mt-2 flex items-center",children:[n.jsx(Yy,{className:"w-4 h-4 animate-spin mr-2"}),n.jsxs("span",{className:"text-xs",children:["Étape en cours: ",s.step]})]})]})]})}),n.jsxs("div",{className:"flex justify-center gap-3",children:[n.jsx(O,{onClick:a,disabled:t||(s==null?void 0:s.success)===!0,className:"px-8 py-3",children:t?n.jsxs(n.Fragment,{children:[n.jsx(Yy,{className:"w-4 h-4 mr-2 animate-spin"}),"Configuration en cours..."]}):s!=null&&s.success?n.jsxs(n.Fragment,{children:[n.jsx(zt,{className:"w-4 h-4 mr-2"}),"Configuration terminée"]}):n.jsxs(n.Fragment,{children:[n.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Configurer le système"]})}),s&&!s.success&&!t&&n.jsxs(O,{onClick:o,variant:"ghost",className:"px-6 py-3",children:[n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Réessayer"]})]}),(s==null?void 0:s.success)&&n.jsxs("div",{className:"mt-6 text-center",children:[n.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Vous pouvez maintenant vous connecter avec les comptes configurés !"}),n.jsx(O,{onClick:()=>window.location.href="/login",variant:"ghost",className:"mt-3",children:"Aller à la page de connexion"})]}),n.jsx("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Qe,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"🔧 Architecture du système"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-2",children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Super Admin :"})," Gère les validations de paiements de tous les clients"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Admin Client :"})," Gère son établissement et a un abonnement"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Séparation claire :"}),` Le menu "Validation Paiements" n'apparaît que pour le Super Admin`]})]})]})]})})]})})},q5=()=>{const{user:t,isLoading:e,signOut:s}=Fe();return I.useEffect(()=>{t&&!e&&s()},[t,e,s]),n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12",children:n.jsx(B5,{})})},og=({indexUrl:t,title:e="Index de base de données requis",description:s="Pour des performances optimales, un index composite doit être créé dans Firebase. Les données sont actuellement chargées avec une méthode alternative."})=>n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[n.jsx(kr,{className:"w-5 h-5 text-amber-600 mr-3 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"text-sm font-medium text-amber-800",children:e}),n.jsx("p",{className:"text-sm text-amber-700 mt-1",children:s}),n.jsxs(O,{variant:"ghost",size:"sm",className:"mt-2 text-amber-800 hover:text-amber-900 hover:bg-amber-100",onClick:()=>window.open(t,"_blank"),children:["Créer l'index maintenant",n.jsx(rp,{className:"w-4 h-4 ml-1"})]})]})]})}),G5=()=>{const[t,e]=I.useState({dailySales:0,totalProfit:0,products:0}),[s,r]=I.useState(!0),[i,a]=I.useState(!1),{user:o}=Fe();I.useEffect(()=>{(async()=>{if(o!=null&&o.establishmentId){r(!0),a(!1);try{const u=new Date;u.setHours(0,0,0,0);let h=0,m=0;try{const R=Ae(Ee(H,"sales"),ce("establishmentId","==",o.establishmentId),ce("status","==","completed"),ce("createdAt",">=",Q.fromDate(u))),_=await Ie(R);h=_.docs.reduce((T,A)=>T+A.data().total,0);for(const T of _.docs){const A=T.data();if(A.items&&Array.isArray(A.items))for(const C of A.items)try{const k=he(H,"products",C.productId),D=await Rs(k);if(D.exists()){const v=D.data().purchasePrice||0,b=C.unitPrice,N=C.quantity,f=(b-v)*N;m+=f}}catch{console.warn("Erreur lors de la récupération du produit:",C.productId)}}}catch(R){if(R.code==="failed-precondition"&&R.message.includes("index")){a(!0),console.warn("Index composite requis pour les ventes. Chargement des données alternatives...");const _=Ae(Ee(H,"sales"),ce("establishmentId","==",o.establishmentId)),T=await Ie(_),A=Q.fromDate(u),C=T.docs.filter(k=>{const D=k.data();return D.status==="completed"&&D.createdAt&&D.createdAt.toMillis()>=A.toMillis()});h=C.reduce((k,D)=>k+(D.data().total||0),0);for(const k of C){const D=k.data();if(D.items&&Array.isArray(D.items))for(const P of D.items)try{const v=he(H,"products",P.productId),b=await Rs(v);if(b.exists()){const f=b.data().purchasePrice||0,j=P.unitPrice,E=P.quantity,S=(j-f)*E;m+=S}}catch{console.warn("Erreur lors de la récupération du produit:",P.productId)}}}else throw R}const g=Ae(Ee(H,"products"),ce("establishmentId","==",o.establishmentId)),y=(await Ie(g)).size;e({dailySales:h,totalProfit:m,products:y})}catch(u){console.error("Erreur lors du chargement des statistiques:",u)}finally{r(!1)}}})()},[o==null?void 0:o.establishmentId]);const l=d=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(d).replace("MGA","Ar");return s?n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((d,u)=>n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"animate-pulse flex items-center",children:[n.jsx("div",{className:"p-3 rounded-lg bg-gray-200 mr-4"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),n.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})]})]})},u))}):n.jsxs("div",{className:"space-y-6",children:[i&&n.jsx(og,{indexUrl:"https://console.firebase.google.com/v1/r/project/saas-915ec/firestore/indexes?create_composite=Ckhwcm9qZWN0cy9zYWFzLTkxNWVjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9zYWxlcy9pbmRleGVzL18QARoTCg9lc3RhYmxpc2htZW50SWQQARoKCgZzdGF0dXMQARoNCgljcmVhdGVkQXQQARoMCghfX25hbWVfXxAB"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 rounded-lg bg-blue-100",children:n.jsx(Tt,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{className:"ml-4 flex-1",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ventes du jour"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l(t.dailySales)}),n.jsxs("div",{className:"ml-2 flex items-center text-sm text-green-600",children:[n.jsx(rp,{className:"w-4 h-4"}),n.jsx("span",{className:"ml-1",children:"+12.5%"})]})]})]})]})}),n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 rounded-lg bg-purple-100",children:n.jsx(wn,{className:"w-6 h-6 text-purple-600"})}),n.jsxs("div",{className:"ml-4 flex-1",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bénéfices"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l(t.totalProfit)}),n.jsxs("div",{className:"ml-2 flex items-center text-sm text-green-600",children:[n.jsx(rp,{className:"w-4 h-4"}),n.jsx("span",{className:"ml-1",children:"+8.2%"})]})]})]})]})}),n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 rounded-lg bg-orange-100",children:n.jsx(yt,{className:"w-6 h-6 text-orange-600"})}),n.jsxs("div",{className:"ml-4 flex-1",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Produits en stock"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.products}),n.jsxs("div",{className:"ml-2 flex items-center text-sm text-red-600",children:[n.jsx(v5,{className:"w-4 h-4"}),n.jsx("span",{className:"ml-1",children:"-3.2%"})]})]})]})]})})]})]})},W5=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(!0),[i,a]=I.useState(!1),{user:o}=Fe();return I.useEffect(()=>{(async()=>{if(o!=null&&o.establishmentId){r(!0),a(!1);try{const d=new Date;d.setHours(0,0,0,0);try{const u=Ae(Ee(H,"sales"),ce("establishmentId","==",o.establishmentId),ce("status","==","completed"),ce("createdAt",">=",Q.fromDate(d)),Na("createdAt","desc"),gP(5)),h=await Ie(u);if(h.empty){e([]),r(!1);return}const m=h.docs.map(g=>{const x=g.data();return{id:g.id.substring(g.id.length-3),customer:x.customerName||"Client anonyme",amount:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x.total).replace("MGA","Ar"),time:x.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),method:x.paymentMethod==="cash"?"Espèces":x.paymentMethod==="card"?"Carte":x.paymentMethod==="mvola"?"MVola":x.paymentMethod==="orange_money"?"Orange Money":x.paymentMethod==="airtel_money"?"Airtel Money":"Autre"}});e(m)}catch(u){if(u.code==="failed-precondition"&&u.message.includes("index")){a(!0),console.warn("Index composite requis pour les ventes récentes. Chargement des données alternatives...");const h=Ae(Ee(H,"sales"),ce("establishmentId","==",o.establishmentId)),m=await Ie(h),g=Q.fromDate(d),x=m.docs.filter(R=>{const _=R.data();return _.status==="completed"&&_.createdAt&&_.createdAt.toMillis()>=g.toMillis()}).sort((R,_)=>_.data().createdAt.toMillis()-R.data().createdAt.toMillis()).slice(0,5);if(x.length===0){e([]),r(!1);return}const y=x.map(R=>{const _=R.data();return{id:R.id.substring(R.id.length-3),customer:_.customerName||"Client anonyme",amount:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(_.total).replace("MGA","Ar"),time:_.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),method:_.paymentMethod==="cash"?"Espèces":_.paymentMethod==="card"?"Carte":_.paymentMethod==="mvola"?"MVola":_.paymentMethod==="orange_money"?"Orange Money":_.paymentMethod==="airtel_money"?"Airtel Money":"Autre"}});e(y)}else throw u}}catch(d){console.error("Erreur lors du chargement des ventes récentes:",d),e([])}finally{r(!1)}}})()},[o==null?void 0:o.establishmentId]),s?n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ventes récentes"}),n.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(5)].map((l,d)=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),n.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),n.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]})]},d))})]}):n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ventes récentes"}),i&&n.jsx("div",{className:"mb-4",children:n.jsx(og,{indexUrl:"https://console.firebase.google.com/v1/r/project/saas-915ec/firestore/indexes?create_composite=Ckhwcm9qZWN0cy9zYWFzLTkxNWVjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9zYWxlcy9pbmRleGVzL18QARoTCg9lc3RhYmxpc2htZW50SWQQARoKCgZzdGF0dXMQARoNCgljcmVhdGVkQXQQAhoMCghfX25hbWVfXxAC"})}),t.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(vn,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),n.jsx("p",{className:"text-gray-500",children:"Aucune vente aujourd'hui"}),n.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Les ventes du jour apparaîtront ici"})]}):n.jsx("div",{className:"overflow-hidden",children:n.jsx("div",{className:"space-y-3",children:t.map(l=>n.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:n.jsxs("span",{className:"text-sm font-medium text-blue-700",children:["#",l.id]})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:l.customer}),n.jsx("p",{className:"text-sm text-gray-500",children:l.time})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"font-semibold text-gray-900",children:l.amount}),n.jsx("p",{className:"text-sm text-gray-500",children:l.method})]})]},l.id))})})]})},H5=()=>{const t=fl(),e=[{label:"Nouvelle vente",icon:vn,color:"blue",onClick:()=>t("/pos")},{label:"Ajouter produit",icon:yt,color:"green",onClick:()=>t("/products")},{label:"Nouveau client",icon:Xe,color:"purple",onClick:()=>t("/customers")}];return n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Actions rapides"}),n.jsx("div",{className:"space-y-3",children:e.map((s,r)=>n.jsx("button",{onClick:s.onClick,className:`w-full p-3 text-left bg-${s.color}-50 hover:bg-${s.color}-100 rounded-lg transition-colors`,children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(s.icon,{className:`w-5 h-5 text-${s.color}-600`}),n.jsx("span",{className:`ml-3 font-medium text-${s.color}-700`,children:s.label})]})},r))})]})},K5=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tableau de bord"}),n.jsxs("div",{className:"text-sm text-gray-500",children:["Aujourd'hui, ",new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),n.jsx(G5,{}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsx(W5,{})}),n.jsx("div",{children:n.jsx(H5,{})})]})]}),f1=({onStoreSelect:t,selectedStore:e,onClose:s})=>{const[r,i]=I.useState([]),[a,o]=I.useState(!0),{user:l}=Fe();I.useEffect(()=>{(async()=>{if(l!=null&&l.establishmentId)try{o(!0);const h=Ae(Ee(H,"stores"),ce("establishmentId","==",l.establishmentId),ce("isActive","==",!0)),g=(await Ie(h)).docs.map(x=>{var R,_;const y=x.data();return{id:x.id,name:y.name,address:y.address,phone:y.phone||"",email:y.email||"",establishmentId:y.establishmentId,isActive:y.isActive!==!1,isMainStore:y.isMainStore||!1,createdAt:((R=y.createdAt)==null?void 0:R.toDate())||new Date,updatedAt:((_=y.updatedAt)==null?void 0:_.toDate())||new Date}});if(i(g),!e&&g.length>0){const x=g.find(y=>y.isMainStore);t(x?x.id:g[0].id)}}catch(h){console.error("Erreur lors du chargement des magasins:",h)}finally{o(!1)}})()},[l==null?void 0:l.establishmentId,e,t]);const d=u=>{t(u),s&&s()};return a?n.jsxs("div",{className:"text-center p-4",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des magasins..."})]}):r.length===0?n.jsxs("div",{className:"text-center p-4",children:[n.jsx(Qn,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),n.jsx("p",{className:"text-gray-600 font-medium",children:"Aucun magasin disponible"}),n.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Créez d'abord un magasin dans les paramètres"})]}):n.jsxs("div",{className:"space-y-4",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Qn,{className:"w-5 h-5 mr-2 text-blue-600"}),"Sélectionner un magasin"]}),n.jsx("div",{className:"space-y-3",children:r.map(u=>n.jsxs("button",{onClick:()=>d(u.id),className:`w-full flex items-center justify-between p-3 rounded-lg border-2 transition-colors ${e===u.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u.isMainStore?"bg-blue-100":"bg-gray-100"}`,children:n.jsx(Cs,{className:`w-5 h-5 ${u.isMainStore?"text-blue-600":"text-gray-600"}`})}),n.jsxs("div",{className:"ml-3 text-left",children:[n.jsx("p",{className:"font-medium text-gray-900",children:u.name}),n.jsx("p",{className:"text-sm text-gray-500",children:u.address}),u.isMainStore&&n.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-800 mt-1",children:"Magasin principal"})]})]}),e===u.id&&n.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:n.jsx(d1,{className:"w-4 h-4 text-white"})})]},u.id))}),s&&n.jsx("div",{className:"flex justify-end",children:n.jsx(O,{variant:"ghost",onClick:s,children:"Fermer"})})]})},Q5=({receiptData:t,onClose:e,onPrint:s,onEmailSend:r})=>{const[i,a]=To.useState(t.customerEmail||""),[o,l]=To.useState(!1),d=x=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x).replace("MGA","Ar"),u=x=>x.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),h=x=>({cash:"Espèces",card:"Carte bancaire",mvola:"MVola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[x]||x,m=()=>{if(!i.trim()){alert("Veuillez saisir une adresse email");return}if(!/\S+@\S+\.\S+/.test(i)){alert("Format d'email invalide");return}r&&(r(i),l(!1))},g=()=>{const x=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Reçu ${t.receiptNumber}</title>
        <style>
          body { font-family: 'Courier New', monospace; max-width: 300px; margin: 0 auto; padding: 20px; }
          .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
          .company-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
          .company-info { font-size: 12px; line-height: 1.4; }
          .receipt-info { margin: 15px 0; }
          .items-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
          .items-table th, .items-table td { text-align: left; padding: 5px 0; border-bottom: 1px dashed #ccc; }
          .items-table th { font-weight: bold; }
          .total-section { border-top: 2px solid #000; padding-top: 10px; margin-top: 15px; }
          .total-line { display: flex; justify-content: space-between; margin: 3px 0; }
          .grand-total { font-weight: bold; font-size: 16px; border-top: 1px solid #000; padding-top: 5px; margin-top: 5px; }
          .footer { text-align: center; margin-top: 20px; border-top: 2px solid #000; padding-top: 10px; font-size: 12px; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="company-name">${t.establishmentInfo.name}</div>
          <div class="company-info">
            ${t.establishmentInfo.address}<br>
            Tél: ${t.establishmentInfo.phone}<br>
            Email: ${t.establishmentInfo.email}
            ${t.establishmentInfo.nif?`<br>NIF: ${t.establishmentInfo.nif}`:""}
            ${t.establishmentInfo.stat?`<br>STAT: ${t.establishmentInfo.stat}`:""}
          </div>
        </div>
        
        <div class="receipt-info">
          <div><strong>Reçu N°:</strong> ${t.receiptNumber}</div>
          <div><strong>Date:</strong> ${u(t.date)}</div>
          <div><strong>Caissier:</strong> ${t.cashierName}</div>
          ${t.customerName?`<div><strong>Client:</strong> ${t.customerName}</div>`:""}
        </div>
        
        <table class="items-table">
          <thead>
            <tr>
              <th>Article</th>
              <th>Qté</th>
              <th>P.U.</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            ${t.items.map(T=>`
              <tr>
                <td>${T.name}</td>
                <td>${T.quantity}</td>
                <td>${d(T.unitPrice)}</td>
                <td>${d(T.total)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
        
        <div class="total-section">
          <div class="total-line">
            <span>Sous-total (HT):</span>
            <span>${d(t.subtotal)}</span>
          </div>
          <div class="total-line">
            <span>TVA (20%):</span>
            <span>${d(t.taxAmount)}</span>
          </div>
          <div class="total-line grand-total">
            <span>TOTAL TTC:</span>
            <span>${d(t.total)}</span>
          </div>
          
          <div style="margin-top: 15px;">
            <div class="total-line">
              <span>Paiement (${h(t.paymentMethod)}):</span>
              <span>${d(t.paymentAmount)}</span>
            </div>
            ${t.changeAmount>0?`
              <div class="total-line">
                <span>Rendu:</span>
                <span>${d(t.changeAmount)}</span>
              </div>
            `:""}
          </div>
        </div>
        
        <div class="footer">
          <div>Merci de votre visite !</div>
          <div style="margin-top: 10px; font-size: 10px;">
            Conservez ce reçu pour tout échange ou remboursement
          </div>
        </div>
      </body>
      </html>
    `,y=new Blob([x],{type:"text/html"}),R=window.URL.createObjectURL(y),_=document.createElement("a");_.href=R,_.download=`recu_${t.receiptNumber}.html`,_.click(),window.URL.revokeObjectURL(R)};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[n.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(nn,{className:"w-5 h-5 mr-2"}),"Reçu de vente"]}),n.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-4 bg-gray-50 font-mono text-sm",children:[n.jsxs("div",{className:"text-center border-b-2 border-black pb-3 mb-4",children:[n.jsx("div",{className:"font-bold text-lg",children:t.establishmentInfo.name}),n.jsxs("div",{className:"text-xs mt-1",children:[t.establishmentInfo.address,n.jsx("br",{}),"Tél: ",t.establishmentInfo.phone,n.jsx("br",{}),"Email: ",t.establishmentInfo.email,t.establishmentInfo.nif&&n.jsxs(n.Fragment,{children:[n.jsx("br",{}),"NIF: ",t.establishmentInfo.nif]}),t.establishmentInfo.stat&&n.jsxs(n.Fragment,{children:[n.jsx("br",{}),"STAT: ",t.establishmentInfo.stat]})]})]}),n.jsxs("div",{className:"mb-4 text-xs",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Reçu N°:"}),n.jsx("span",{className:"font-bold",children:t.receiptNumber})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Date:"}),n.jsx("span",{children:u(t.date)})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Caissier:"}),n.jsx("span",{children:t.cashierName})]}),t.customerName&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Client:"}),n.jsx("span",{children:t.customerName})]})]}),n.jsxs("div",{className:"border-t border-dashed border-gray-400 pt-2 mb-4",children:[n.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs font-bold mb-2",children:[n.jsx("span",{children:"Article"}),n.jsx("span",{className:"text-center",children:"Qté"}),n.jsx("span",{className:"text-right",children:"P.U."}),n.jsx("span",{className:"text-right",children:"Total"})]}),t.items.map((x,y)=>n.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mb-1",children:[n.jsx("span",{className:"truncate",children:x.name}),n.jsx("span",{className:"text-center",children:x.quantity}),n.jsx("span",{className:"text-right",children:d(x.unitPrice)}),n.jsx("span",{className:"text-right font-semibold",children:d(x.total)})]},y))]}),n.jsxs("div",{className:"border-t-2 border-black pt-2 text-xs",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Sous-total (HT):"}),n.jsx("span",{children:d(t.subtotal)})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"TVA (20%):"}),n.jsx("span",{children:d(t.taxAmount)})]}),n.jsxs("div",{className:"flex justify-between font-bold text-base border-t border-dashed border-gray-400 pt-1 mt-1",children:[n.jsx("span",{children:"TOTAL TTC:"}),n.jsx("span",{children:d(t.total)})]}),n.jsxs("div",{className:"mt-3 pt-2 border-t border-dashed border-gray-400",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("span",{children:["Paiement (",h(t.paymentMethod),"):"]}),n.jsx("span",{children:d(t.paymentAmount)})]}),t.changeAmount>0&&n.jsxs("div",{className:"flex justify-between font-semibold",children:[n.jsx("span",{children:"Rendu:"}),n.jsx("span",{children:d(t.changeAmount)})]})]})]}),n.jsxs("div",{className:"text-center mt-4 pt-3 border-t-2 border-black text-xs",children:[n.jsx("div",{className:"font-semibold",children:"Merci de votre visite !"}),n.jsx("div",{className:"mt-2 text-xs",children:"Conservez ce reçu pour tout échange ou remboursement"})]})]}),n.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs(O,{variant:"ghost",onClick:s,className:"flex items-center justify-center",children:[n.jsx(Dl,{className:"w-4 h-4 mr-2"}),"Imprimer"]}),n.jsxs(O,{variant:"ghost",onClick:g,className:"flex items-center justify-center",children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]}),o?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email du client"}),n.jsx("input",{type:"email",value:i,onChange:x=>a(x.target.value),placeholder:"client@email.com",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(O,{variant:"ghost",onClick:()=>l(!1),className:"flex-1",children:"Annuler"}),n.jsx(O,{onClick:m,className:"flex-1",children:"Envoyer"})]})]}):n.jsxs(O,{fullWidth:!0,variant:"outline",onClick:()=>l(!0),className:"flex items-center justify-center",children:[n.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Envoyer par email"]}),n.jsx(O,{variant:"ghost",fullWidth:!0,onClick:e,children:"Fermer"})]})]})})},Y5=[{id:"cash",name:"Espèces",icon:Pl,color:"green"},{id:"card",name:"Carte",icon:yn,color:"blue"},{id:"mvola",name:"Mvola",icon:fn,color:"red"},{id:"orange_money",name:"Orange Money",icon:fn,color:"orange"},{id:"airtel_money",name:"Airtel Money",icon:fn,color:"red"}],X5=()=>{var _e;const[t,e]=I.useState("all"),[s,r]=I.useState(""),[i,a]=I.useState([]),[o,l]=I.useState(!1),[d,u]=I.useState("cash"),[h,m]=I.useState(0),[g,x]=I.useState(!1),[y,R]=I.useState([]),[_,T]=I.useState(""),[A,C]=I.useState(!1),[k,D]=I.useState(!1),[P,v]=I.useState(null),[b,N]=I.useState(null),[f,j]=I.useState([]),[E,S]=I.useState([]),[ee,U]=I.useState(!0),{user:z}=Fe(),J=async()=>{if(z!=null&&z.establishmentId)try{const B=Ae(Ee(H,"stores"),ce("establishmentId","==",z.establishmentId),ce("isActive","==",!0)),Ce=(await Ie(B)).docs.map(Ye=>{var Re,ct;const Be=Ye.data();return{id:Ye.id,name:Be.name,address:Be.address,phone:Be.phone||"",email:Be.email||"",establishmentId:Be.establishmentId,isActive:Be.isActive!==!1,isMainStore:Be.isMainStore||!1,createdAt:((Re=Be.createdAt)==null?void 0:Re.toDate())||new Date,updatedAt:((ct=Be.updatedAt)==null?void 0:ct.toDate())||new Date}});R(Ce);const ze=Ce.find(Ye=>Ye.isMainStore);ze?T(ze.id):Ce.length>0&&T(Ce[0].id),Ce.length>1&&C(!0)}catch(B){console.error("Erreur lors du chargement des magasins:",B)}},W=async()=>{if(z!=null&&z.establishmentId)try{const B=Ae(Ee(H,"categories"),ce("establishmentId","==",z.establishmentId)),Ce=(await Ie(B)).docs.map(ze=>{const Ye=ze.data();return{id:ze.id,name:Ye.name,color:Ye.color}});S(Ce)}catch(B){console.error("Erreur lors du chargement des catégories:",B)}},oe=async()=>{if(z!=null&&z.establishmentId)try{const B=Ae(Ee(H,"products"),ce("establishmentId","==",z.establishmentId),ce("isActive","==",!0)),Ce=(await Ie(B)).docs.map(ze=>{const Ye=ze.data(),Be=E.find(Re=>Re.id===Ye.categoryId);return{id:ze.id,name:Ye.name,salePrice:Ye.salePrice,stock:Ye.stock,storeStock:Ye.storeStock||{},categoryId:Ye.categoryId,category:(Be==null?void 0:Be.name)||"Autre",taxRate:Ye.taxRate||0,image:"📦",unit:Ye.unit||"pièce"}});j(Ce)}catch(B){console.error("Erreur lors du chargement des produits:",B),L.error("Erreur lors du chargement des produits")}};I.useEffect(()=>{const B=async()=>{U(!0),await J(),await W(),await X(),U(!1)};z!=null&&z.establishmentId&&B()},[z==null?void 0:z.establishmentId]);const X=async()=>{if(z!=null&&z.establishmentId)try{const B=await Rs(he(H,"establishments",z.establishmentId));if(B.exists()){const ae=B.data();N({name:ae.name||"Nirina Nirina Pos Madagascar",address:ae.address||"Antananarivo, Madagascar",phone:ae.phone||"+261 34 12 345 67",email:ae.email||"contact@saaspos.mg",nif:ae.nif||"",stat:ae.stat||""})}else N({name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""})}catch(B){console.error("Erreur lors du chargement des informations établissement:",B),N({name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""})}};I.useEffect(()=>{E.length>0&&oe()},[E]),I.useEffect(()=>{_&&E.length>0&&oe()},[_]);const re=B=>{if(!_)return B.stock;if(B.storeStock&&B.storeStock[_]!==void 0)return B.storeStock[_];const ae=y.find(Ce=>Ce.isMainStore);return ae&&ae.id===_?B.stock:0},Z=f.filter(B=>{const ae=t==="all"||B.categoryId===t,Ce=B.name.toLowerCase().includes(s.toLowerCase()),Ye=re(B)>0;return ae&&Ce&&Ye}),$=B=>{const ae=re(B);if(ae<=0){L.error("Produit en rupture de stock dans ce magasin");return}const Ce=i.find(ze=>ze.productId===B.id);if(Ce){if(Ce.quantity>=ae){L.error("Stock insuffisant dans ce magasin");return}a(i.map(ze=>ze.productId===B.id?{...ze,quantity:ze.quantity+1}:ze))}else a([...i,{id:`cart_${Date.now()}`,productId:B.id,name:B.name,price:B.salePrice,quantity:1,image:B.image||"📦",taxRate:B.taxRate,unit:B.unit}]);L.success(`${B.name} ajouté au panier`)},q=B=>{a(i.filter(ae=>ae.productId!==B))},ue=(B,ae)=>{if(ae===0)q(B);else{const Ce=f.find(ze=>ze.id===B);if(Ce){const ze=re(Ce);if(ae>ze){L.error("Stock insuffisant dans ce magasin");return}a(i.map(Ye=>Ye.productId===B?{...Ye,quantity:ae}:Ye))}}},se=()=>i.reduce((B,ae)=>{const Ce=ae.taxRate>0?ae.price/(1+ae.taxRate/100):ae.price;return B+Ce*ae.quantity},0),ve=()=>i.reduce((B,ae)=>{if(ae.taxRate<=0)return B;const Ce=ae.price/(1+ae.taxRate/100),ze=(ae.price-Ce)*ae.quantity;return B+ze},0),ke=()=>i.reduce((B,ae)=>B+ae.price*ae.quantity,0),me=()=>d==="cash"&&h>0?Math.max(0,h-ke()):0,be=()=>{const B=new Date,ae=B.getFullYear(),Ce=String(B.getMonth()+1).padStart(2,"0"),ze=String(B.getDate()).padStart(2,"0"),Ye=B.getTime().toString().slice(-6);return`REC-${ae}${Ce}${ze}-${Ye}`},we=async()=>{var B,ae;if(i.length===0){L.error("Le panier est vide");return}if(d==="cash"&&h<ke()){L.error("Montant insuffisant");return}if(!(z!=null&&z.establishmentId)){L.error("Établissement non trouvé");return}if(!_){L.error("Veuillez sélectionner un magasin");return}x(!0);try{const Ce=be(),ze={receiptNumber:Ce,cashierId:z.id,cashierName:z.name,customerId:null,customerName:"Client anonyme",establishmentId:z.establishmentId,storeId:_,items:i.map(Re=>({id:`item_${Date.now()}_${Math.random()}`,productId:Re.productId,productName:Re.name,quantity:Re.quantity,unitPrice:Re.price,taxRate:Re.taxRate,discount:0,total:Re.price*Re.quantity})),subtotal:se(),taxAmount:ve(),discount:0,total:ke(),paymentMethod:d,paymentAmount:d==="cash"?h:ke(),changeAmount:me(),status:"completed",createdAt:Q.now()},Ye=`sale_${Date.now()}`;await Je(he(H,"sales",Ye),ze);for(const Re of i){const ct=f.find($e=>$e.id===Re.productId);if(ct){const $e={...ct.storeStock||{}};$e[_]!==void 0?$e[_]=Math.max(0,$e[_]-Re.quantity):((B=y.find(Ml=>Ml.id===_))==null?void 0:B.isMainStore)?$e[_]=Math.max(0,ct.stock-Re.quantity):$e[_]=0;const st=((ae=y.find(Gr=>Gr.id===_))==null?void 0:ae.isMainStore)?Math.max(0,ct.stock-Re.quantity):ct.stock;await ht(he(H,"products",Re.productId),{stock:st,storeStock:$e,updatedAt:Q.now()})}}await oe();const Be={receiptNumber:Ce,date:new Date,cashierName:z.name,customerName:"Client anonyme",items:i.map(Re=>({name:Re.name,quantity:Re.quantity,unitPrice:Re.price,total:Re.price*Re.quantity})),subtotal:se(),taxAmount:ve(),total:ke(),paymentMethod:d,paymentAmount:d==="cash"?h:ke(),changeAmount:me(),establishmentInfo:b||{name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""}};v(Be),a([]),l(!1),m(0),L.success(`Vente ${Ce} enregistrée avec succès !`,{duration:5e3,icon:"🎉"}),setTimeout(()=>{L(Re=>n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("span",{children:"Vente terminée ! Voulez-vous afficher le reçu ?"}),n.jsx("button",{onClick:()=>{D(!0),L.dismiss(Re.id)},className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"Voir le reçu"})]}),{duration:6e3})},1e3)}catch(Ce){console.error("Erreur lors du traitement de la vente:",Ce),L.error("Erreur lors du traitement de la vente")}finally{x(!1)}},V=B=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(B).replace("MGA","Ar"),pe=B=>{i.length>0?window.confirm("Changer de magasin videra votre panier actuel. Continuer ?")&&(a([]),T(B),C(!1)):(T(B),C(!1))},Y=()=>{if(P){const B=window.open("","_blank");B&&(B.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>Reçu ${P.receiptNumber}</title>
            <style>
              body { font-family: 'Courier New', monospace; max-width: 300px; margin: 0; padding: 10px; }
              .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
              .company-name { font-size: 16px; font-weight: bold; margin-bottom: 5px; }
              .company-info { font-size: 10px; line-height: 1.4; }
              .receipt-info { margin: 10px 0; font-size: 10px; }
              .items { margin: 10px 0; }
              .item { display: flex; justify-content: space-between; font-size: 10px; margin: 2px 0; }
              .totals { border-top: 2px solid #000; padding-top: 10px; margin-top: 15px; font-size: 10px; }
              .total-line { display: flex; justify-content: space-between; margin: 2px 0; }
              .grand-total { font-weight: bold; font-size: 12px; border-top: 1px solid #000; padding-top: 5px; margin-top: 5px; }
              .footer { text-align: center; margin-top: 15px; border-top: 2px solid #000; padding-top: 10px; font-size: 10px; }
              @media print { body { margin: 0; padding: 5px; } }
            </style>
          </head>
          <body>
            <div class="header">
              <div class="company-name">${P.establishmentInfo.name}</div>
              <div class="company-info">
                ${P.establishmentInfo.address}<br>
                Tél: ${P.establishmentInfo.phone}<br>
                Email: ${P.establishmentInfo.email}
              </div>
            </div>
            
            <div class="receipt-info">
              <div><strong>Reçu N°:</strong> ${P.receiptNumber}</div>
              <div><strong>Date:</strong> ${P.date.toLocaleDateString("fr-FR")} ${P.date.toLocaleTimeString("fr-FR")}</div>
              <div><strong>Caissier:</strong> ${P.cashierName}</div>
            </div>
            
            <div class="items">
              ${P.items.map(ae=>`
                <div class="item">
                  <span>${ae.name} x${ae.quantity}</span>
                  <span>${V(ae.total)}</span>
                </div>
              `).join("")}
            </div>
            
            <div class="totals">
              <div class="total-line">
                <span>Sous-total:</span>
                <span>${V(P.subtotal)}</span>
              </div>
              <div class="total-line">
                <span>TVA:</span>
                <span>${V(P.taxAmount)}</span>
              </div>
              <div class="total-line grand-total">
                <span>TOTAL:</span>
                <span>${V(P.total)}</span>
              </div>
              <div class="total-line">
                <span>Payé:</span>
                <span>${V(P.paymentAmount)}</span>
              </div>
              ${P.changeAmount>0?`
                <div class="total-line">
                  <span>Rendu:</span>
                  <span>${V(P.changeAmount)}</span>
                </div>
              `:""}
            </div>
            
            <div class="footer">
              Merci de votre visite !
            </div>
          </body>
          </html>
        `),B.document.close(),B.print())}},Ne=B=>{L.success(`Reçu envoyé à ${B}`),console.log("Envoi du reçu par email à:",B),console.log("Données du reçu:",P)};return ee?n.jsx("div",{className:"h-full flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement du point de vente..."})]})}):n.jsxs("div",{className:"h-full flex flex-col gap-6",children:[n.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-4 rounded-lg border border-blue-200",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Cs,{className:"w-5 h-5 text-blue-600 mr-2"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Magasin actuel:"}),n.jsx("p",{className:"font-semibold text-blue-900",children:_?((_e=y.find(B=>B.id===_))==null?void 0:_e.name)||"Magasin inconnu":"Aucun magasin sélectionné"})]})]}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"text-blue-600 hover:bg-blue-100",children:"Changer de magasin"})]}),n.jsxs("div",{className:"flex-1 flex gap-6",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Point de Vente"}),n.jsx("div",{className:"w-80",children:n.jsx(xe,{placeholder:"Rechercher produit...",value:s,onChange:B=>r(B.target.value),leftIcon:n.jsx(Ps,{className:"w-5 h-5 text-gray-400"})})})]}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>e("all"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${t==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Tous (",f.filter(B=>re(B)>0).length,")"]}),E.map(B=>{const ae=f.filter(Ce=>Ce.categoryId===B.id&&re(Ce)>0);return n.jsxs("button",{onClick:()=>e(B.id),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${t===B.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[B.name," (",ae.length,")"]},B.id)})]}),Z.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(yt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun produit disponible"}),n.jsx("p",{className:"text-gray-500",children:f.length===0?'Ajoutez des produits dans la section "Produits"':"Aucun produit ne correspond à votre recherche ou n'est disponible dans ce magasin"})]}):n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:Z.map(B=>{const ae=re(B);return n.jsx(K,{padding:"sm",className:"cursor-pointer hover:shadow-md transition-shadow",children:n.jsxs("div",{onClick:()=>$(B),children:[n.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:n.jsx("span",{className:"text-4xl",children:B.image})}),n.jsx("h3",{className:"font-medium text-sm text-gray-900 mb-1 line-clamp-2",children:B.name}),n.jsx("p",{className:"text-xs text-gray-500 mb-2",children:B.category}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-bold text-blue-600",children:V(B.salePrice)}),n.jsxs("span",{className:`text-xs ${ae<=5?"text-red-500":"text-gray-500"}`,children:["Stock: ",ae]})]})]})},B.id)})})]})}),n.jsx("div",{className:"w-96",children:n.jsxs(K,{padding:"none",className:"h-full flex flex-col",children:[n.jsx("div",{className:"p-4 border-b border-gray-200",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(vn,{className:"w-5 h-5 mr-2"}),"Panier (",i.length,")"]}),i.length>0&&n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a([]),children:"Vider"})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:i.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(vn,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"Panier vide"}),n.jsx("p",{className:"text-sm",children:"Ajoutez des produits pour commencer"})]}):n.jsx("div",{className:"space-y-3",children:i.map(B=>n.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[n.jsx("div",{className:"text-2xl",children:B.image}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-medium text-sm text-gray-900",children:B.name}),n.jsxs("p",{className:"text-xs text-gray-500",children:[V(B.price)," / ",B.unit]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>ue(B.productId,B.quantity-1),className:"w-6 h-6 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center",children:n.jsx(Fd,{className:"w-3 h-3"})}),n.jsx("span",{className:"w-8 text-center text-sm font-medium",children:B.quantity}),n.jsx("button",{onClick:()=>ue(B.productId,B.quantity+1),className:"w-6 h-6 rounded-full bg-blue-100 hover:bg-blue-200 flex items-center justify-center text-blue-600",children:n.jsx(Ct,{className:"w-3 h-3"})})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"font-semibold text-sm",children:V(B.price*B.quantity)}),B.taxRate>0&&n.jsxs("button",{onClick:()=>toggleItemTax(B.productId),className:`text-xs px-2 py-1 rounded-full mt-1 transition-colors ${B.applyTax?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:B.applyTax?"Cliquer pour désactiver la TVA":"Cliquer pour activer la TVA",children:["TVA ",B.taxRate,"% ",B.applyTax?"✓":"✗"]}),n.jsx("button",{onClick:()=>q(B.productId),className:"text-red-500 hover:text-red-700 mt-1",children:n.jsx(vt,{className:"w-3 h-3"})})]})]},B.id))})}),i.length>0&&n.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Sous-total:"}),n.jsx("span",{children:V(se())})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"TVA:"}),n.jsx("span",{children:V(ve())})]}),n.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[n.jsx("span",{children:"Total:"}),n.jsx("span",{className:"text-blue-600",children:V(ke())})]})]}),o?n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"grid grid-cols-2 gap-2",children:Y5.map(B=>n.jsxs("button",{onClick:()=>u(B.id),className:`p-3 rounded-lg border-2 transition-colors flex items-center justify-center ${d===B.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[n.jsx(B.icon,{className:"w-4 h-4 mr-2"}),n.jsx("span",{className:"text-sm",children:B.name})]},B.id))}),d==="cash"&&n.jsxs("div",{children:[n.jsx(xe,{label:"Montant reçu (Ar)",type:"number",value:h||"",onChange:B=>m(Number(B.target.value)),placeholder:"0"}),h>0&&n.jsx("div",{className:"mt-2 p-2 bg-green-50 rounded text-sm",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{children:"Rendu:"}),n.jsx("span",{className:"font-bold",children:V(me())})]})})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>l(!1),children:"Retour"}),n.jsx(O,{variant:"success",fullWidth:!0,onClick:we,disabled:g||d==="cash"&&h<ke()||!_,children:g?"Traitement...":"Finaliser"})]})]}):n.jsx(O,{fullWidth:!0,size:"lg",onClick:()=>l(!0),children:"Procéder au paiement"})]})]})})]}),A&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-md",padding:"lg",children:n.jsx(f1,{onStoreSelect:pe,selectedStore:_,onClose:()=>C(!1)})})}),k&&P&&n.jsx(Q5,{receiptData:P,onClose:()=>D(!1),onPrint:Y,onEmailSend:Ne})]})},J5=()=>n.jsx("div",{className:"h-full",children:n.jsx(X5,{})}),ev=[{id:"piece",name:"Pièce"},{id:"kg",name:"Kilogramme"},{id:"g",name:"Gramme"},{id:"l",name:"Litre"},{id:"ml",name:"Millilitre"},{id:"box",name:"Boîte"},{id:"pack",name:"Pack"}],Z5=({product:t,onSubmit:e,onCancel:s,isLoading:r=!1})=>{const[i,a]=I.useState([]),[o,l]=I.useState([]),[d,u]=I.useState(!0),[h,m]=I.useState(!0),{user:g}=Fe(),[x,y]=I.useState({}),[R,_]=I.useState({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",reference:(t==null?void 0:t.reference)||"",barcode:(t==null?void 0:t.barcode)||"",categoryId:(t==null?void 0:t.categoryId)||"",brand:(t==null?void 0:t.brand)||"",salePrice:(t==null?void 0:t.salePrice)||"",purchasePrice:(t==null?void 0:t.purchasePrice)||"",taxRate:(t==null?void 0:t.taxRate)||20,stock:(t==null?void 0:t.stock)||"",minStock:(t==null?void 0:t.minStock)||"",unit:(t==null?void 0:t.unit)||"piece",isActive:(t==null?void 0:t.isActive)!==!1}),[T,A]=I.useState({});I.useEffect(()=>{(async()=>{if(g!=null&&g.establishmentId)try{u(!0);const E=Ae(Ee(H,"categories"),ce("establishmentId","==",g.establishmentId)),ee=(await Ie(E)).docs.map(U=>{const z=U.data();return{id:U.id,name:z.name,color:z.color}});a(ee)}catch(E){console.error("Erreur lors du chargement des catégories:",E)}finally{u(!1)}})()},[g==null?void 0:g.establishmentId]),I.useEffect(()=>{(async()=>{if(g!=null&&g.establishmentId)try{m(!0);const E=Ae(Ee(H,"stores"),ce("establishmentId","==",g.establishmentId),ce("isActive","==",!0)),ee=(await Ie(E)).docs.map(U=>{const z=U.data();return{id:U.id,name:z.name,isMainStore:z.isMainStore||!1}});l(ee)}catch(E){console.error("Erreur lors du chargement des magasins:",E)}finally{m(!1)}})()},[g==null?void 0:g.establishmentId]),I.useEffect(()=>{if(t&&o.length>0){const j={};t.storeStock?o.forEach(E=>{j[E.id]=t.storeStock[E.id]||0}):o.forEach(E=>{j[E.id]=E.isMainStore?t.stock:0}),y(j)}else if(o.length>0){const j={};o.forEach(E=>{j[E.id]=0}),y(j)}},[t,o]);const C=(j,E)=>{_(S=>({...S,[j]:E})),T[j]&&A(S=>({...S,[j]:""}))},k=(j,E)=>{const S=parseInt(E),ee=isNaN(S)?0:S;y(U=>({...U,[j]:ee}))},D=()=>{const j=i.find(ee=>ee.id===R.categoryId),E=j?j.name.substring(0,2).toUpperCase():"PR",S=Math.floor(Math.random()*1e3).toString().padStart(3,"0");C("reference",`${E}${S}`)},P=()=>{const j=Math.floor(Math.random()*1e12).toString().padStart(12,"0");C("barcode",j)},v=()=>{const j={};return R.name.trim()||(j.name="Le nom est requis"),R.reference.trim()||(j.reference="La référence est requise"),R.categoryId||(j.categoryId="La catégorie est requise"),(!R.salePrice||Number(R.salePrice)<=0)&&(j.salePrice="Le prix de vente doit être supérieur à 0"),(!R.purchasePrice||Number(R.purchasePrice)<=0)&&(j.purchasePrice="Le prix d'achat doit être supérieur à 0"),Number(R.salePrice)<=Number(R.purchasePrice)&&(j.salePrice="Le prix de vente doit être supérieur au prix d'achat"),o.length===0?(!R.stock||Number(R.stock)<0)&&(j.stock="Le stock doit être supérieur ou égal à 0"):Object.values(x).reduce((S,ee)=>S+ee,0)<0&&(j.storeStock="Le stock total doit être supérieur ou égal à 0"),(!R.minStock||Number(R.minStock)<0)&&(j.minStock="Le stock minimum doit être supérieur ou égal à 0"),A(j),Object.keys(j).length===0},b=j=>{if(j.preventDefault(),v()){let E=0;o.length>0?E=Object.values(x).reduce((ee,U)=>ee+U,0):E=Number(R.stock);const S={...R,salePrice:Number(R.salePrice),purchasePrice:Number(R.purchasePrice),taxRate:Number(R.taxRate),stock:E,minStock:Number(R.minStock),storeStock:x};e(S)}},N=()=>{const j=Number(R.salePrice)||0,E=Number(R.purchasePrice)||0;return E>0?((j-E)/E*100).toFixed(1):"0"},f=()=>Object.values(x).reduce((j,E)=>j+E,0);return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Modifier le produit":"Ajouter un produit"}),n.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:b,className:"p-6",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx(yt,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Image du produit"}),n.jsxs(O,{variant:"ghost",size:"sm",className:"mt-2",children:[n.jsx(Pu,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]})}),n.jsx("div",{className:"space-y-3",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"isActive",checked:R.isActive,onChange:j=>C("isActive",j.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Produit actif"})]})})]})}),n.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations générales"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx("div",{className:"md:col-span-2",children:n.jsx(xe,{label:"Nom du produit *",value:R.name,onChange:j=>C("name",j.target.value),error:T.name,placeholder:"Ex: MacBook Pro 13 pouces"})}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n.jsx("textarea",{value:R.description,onChange:j=>C("description",j.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description détaillée du produit..."})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(xe,{label:"Référence *",value:R.reference,onChange:j=>C("reference",j.target.value),error:T.reference,placeholder:"REF001"}),n.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:D,className:"mt-6",children:"Générer"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(xe,{label:"Code-barres",value:R.barcode,onChange:j=>C("barcode",j.target.value),leftIcon:n.jsx(c1,{className:"w-4 h-4"}),placeholder:"123456789012"}),n.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:P,className:"mt-6",children:"Générer"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Catégorie *"}),d?n.jsx("div",{className:"px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:"Chargement des catégories..."}):n.jsxs("select",{value:R.categoryId,onChange:j=>C("categoryId",j.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${T.categoryId?"border-red-300":"border-gray-300"}`,children:[n.jsx("option",{value:"",children:"Sélectionner une catégorie"}),i.map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))]}),T.categoryId&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:T.categoryId}),i.length===0&&!d&&n.jsx("p",{className:"mt-1 text-sm text-orange-600",children:`Aucune catégorie trouvée. Créez d'abord des catégories dans la section "Catégories".`})]}),n.jsx(xe,{label:"Marque",value:R.brand,onChange:j=>C("brand",j.target.value),placeholder:"Ex: Apple, Samsung, HP..."})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Tarification"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(xe,{label:"Prix d'achat (Ar) *",type:"number",value:R.purchasePrice,onChange:j=>C("purchasePrice",j.target.value),error:T.purchasePrice,placeholder:"1000000"}),n.jsx(xe,{label:"Prix de vente (Ar) *",type:"number",value:R.salePrice,onChange:j=>C("salePrice",j.target.value),error:T.salePrice,placeholder:"1200000"}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marge bénéficiaire"}),n.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-md",children:n.jsxs("span",{className:"text-lg font-semibold text-green-600",children:[N(),"%"]})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Taux de TVA (%)"}),n.jsxs("select",{value:R.taxRate,onChange:j=>C("taxRate",Number(j.target.value)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:0,children:"0% (Exonéré)"}),n.jsx("option",{value:20,children:"20% (Standard Madagascar)"}),n.jsx("option",{value:5,children:"5% (Taux réduit)"}),n.jsx("option",{value:10,children:"10% (Taux intermédiaire)"})]}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ce taux peut être modifié lors de la vente"})]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Gestion des stocks"}),o.length>0?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[n.jsxs("div",{className:"flex items-start mb-3",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Gestion multi-magasins"}),n.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Définissez le stock pour chaque magasin. Le stock total sera calculé automatiquement."})]})]}),n.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Stock par magasin"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(j=>n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3",children:n.jsx(Cs,{className:"w-4 h-4 text-blue-600"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("label",{className:"block text-sm font-medium text-blue-700",children:[j.name," ",j.isMainStore&&"(Principal)"]}),n.jsxs("div",{className:"mt-1 flex items-center",children:[n.jsx("input",{type:"number",min:"0",value:x[j.id]||0,onChange:E=>k(j.id,E.target.value),className:"block w-full px-3 py-2 border border-blue-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white"}),n.jsx("span",{className:"ml-2 text-sm text-blue-600",children:R.unit})]})]})]},j.id))}),n.jsxs("p",{className:"text-sm text-blue-600 mt-3",children:["Stock total: ",n.jsxs("strong",{children:[f()," ",R.unit]})]}),T.storeStock&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:T.storeStock})]}),n.jsx(xe,{label:"Stock minimum *",type:"number",value:R.minStock,onChange:j=>C("minStock",j.target.value),error:T.minStock,placeholder:"2"}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unité de mesure"}),n.jsx("select",{value:R.unit,onChange:j=>C("unit",j.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:ev.map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))})]})]}):n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(xe,{label:"Stock actuel *",type:"number",value:R.stock,onChange:j=>C("stock",j.target.value),error:T.stock,placeholder:"10"}),n.jsx(xe,{label:"Stock minimum *",type:"number",value:R.minStock,onChange:j=>C("minStock",j.target.value),error:T.minStock,placeholder:"2"}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unité de mesure"}),n.jsx("select",{value:R.unit,onChange:j=>C("unit",j.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:ev.map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))})]}),n.jsx("div",{className:"md:col-span-3",children:n.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Gestion de stock simplifiée"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:`Vous n'avez pas encore configuré de magasins. Pour une gestion avancée des stocks par magasin, créez d'abord des magasins dans la section "Magasins".`})]})]})})})]})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:s,disabled:r,children:"Annuler"}),n.jsx(O,{type:"submit",disabled:r||i.length===0,children:r?"Enregistrement...":t?"Modifier":"Ajouter"})]})]})]})})},eD=[{id:"all",name:"Tous les statuts"},{id:"active",name:"Actifs"},{id:"inactive",name:"Inactifs"},{id:"low_stock",name:"Stock faible"},{id:"out_of_stock",name:"Rupture de stock"}],tD=({searchTerm:t,onSearchChange:e,selectedCategory:s,onCategoryChange:r,selectedStatus:i,onStatusChange:a,onExport:o,stats:l})=>{const[d,u]=I.useState([]),{user:h}=Fe();return I.useEffect(()=>{(async()=>{if(h!=null&&h.establishmentId)try{const g=Ae(Ee(H,"categories"),ce("establishmentId","==",h.establishmentId)),y=(await Ie(g)).docs.map(R=>{const _=R.data();return{id:R.id,name:_.name}});u(y)}catch(g){console.error("Erreur lors du chargement des catégories:",g)}})()},[h==null?void 0:h.establishmentId]),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(yt,{className:"w-8 h-8 text-blue-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total produits"}),n.jsx("p",{className:"text-2xl font-bold text-blue-900",children:l.total})]})]})}),n.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(yt,{className:"w-8 h-8 text-green-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-green-600",children:"Actifs"}),n.jsx("p",{className:"text-2xl font-bold text-green-900",children:l.active})]})]})}),n.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Me,{className:"w-8 h-8 text-orange-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Stock faible"}),n.jsx("p",{className:"text-2xl font-bold text-orange-900",children:l.lowStock})]})]})}),n.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Me,{className:"w-8 h-8 text-red-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-red-600",children:"Rupture"}),n.jsx("p",{className:"text-2xl font-bold text-red-900",children:l.outOfStock})]})]})})]}),n.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"md:col-span-2",children:n.jsx(xe,{placeholder:"Rechercher par nom, référence ou code-barres...",value:t,onChange:m=>e(m.target.value),leftIcon:n.jsx(Ps,{className:"w-5 h-5 text-gray-400"})})}),n.jsxs("select",{value:s,onChange:m=>r(m.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"all",children:"Toutes les catégories"}),d.map(m=>n.jsx("option",{value:m.id,children:m.name},m.id))]}),n.jsx("select",{value:i,onChange:m=>a(m.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:eD.map(m=>n.jsx("option",{value:m.id,children:m.name},m.id))})]}),n.jsxs("div",{className:"flex justify-between items-center mt-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>a("low_stock"),className:i==="low_stock"?"bg-orange-100 text-orange-700":"",children:[n.jsx(Me,{className:"w-4 h-4 mr-1"}),"Stock faible (",l.lowStock,")"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>a("out_of_stock"),className:i==="out_of_stock"?"bg-red-100 text-red-700":"",children:[n.jsx(Me,{className:"w-4 h-4 mr-1"}),"Rupture (",l.outOfStock,")"]})]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:o,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]})]})},sD=({products:t,onEdit:e,onDelete:s,onView:r,isLoading:i=!1,userRole:a})=>{const o=m=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(m).replace("MGA","Ar"),l=(m,g)=>m===0?{status:"out",color:"red",text:"Rupture",icon:Me}:m<=g?{status:"low",color:"orange",text:"Stock faible",icon:Me}:{status:"good",color:"green",text:"En stock",icon:yt},d=(m,g)=>g>0?((m-g)/g*100).toFixed(1):"0",u=m=>({beverages:"bg-blue-100 text-blue-800",food:"bg-green-100 text-green-800",household:"bg-purple-100 text-purple-800",electronics:"bg-yellow-100 text-yellow-800",clothing:"bg-pink-100 text-pink-800",health:"bg-indigo-100 text-indigo-800"})[m]||"bg-gray-100 text-gray-800",h=a==="reader";return i?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:n.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((m,g)=>n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),n.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),n.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},g))})}):t.length===0?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:n.jsxs("div",{className:"text-center",children:[n.jsx(yt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun produit trouvé"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Commencez par ajouter votre premier produit"}),!h&&n.jsxs(O,{children:[n.jsx(yt,{className:"w-4 h-4 mr-2"}),"Ajouter un produit"]})]})}):n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Référence"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Catégorie"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix & Marge"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(m=>{const g=l(m.stock,m.minStock),x=d(m.salePrice,m.purchasePrice),y=parseFloat(x);return n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-4",children:n.jsx(yt,{className:"w-6 h-6 text-gray-400"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.name}),n.jsxs("div",{className:"text-sm text-gray-500",children:[m.brand&&`${m.brand} • `,m.unit]}),m.barcode&&n.jsx("div",{className:"text-xs text-gray-400 font-mono",children:m.barcode})]})]})}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.reference}),n.jsxs("div",{className:"text-sm text-gray-500",children:["TVA ",m.taxRate,"%"]})]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${u(m.categoryId)}`,children:m.category})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsxs("div",{className:"font-medium text-gray-900",children:["Vente: ",o(m.salePrice)]}),n.jsxs("div",{className:"text-gray-500",children:["Achat: ",o(m.purchasePrice)]}),n.jsxs("div",{className:`flex items-center text-xs ${y>=30?"text-green-600":y>=15?"text-orange-600":"text-red-600"}`,children:[y>=15?n.jsx(wn,{className:"w-3 h-3 mr-1"}):n.jsx(vi,{className:"w-3 h-3 mr-1"}),"Marge: ",x,"%"]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-medium text-gray-900",children:m.stock}),n.jsxs("div",{className:"text-gray-500 text-xs",children:["Min: ",m.minStock]})]}),(g.status==="low"||g.status==="out")&&n.jsx(Me,{className:`w-4 h-4 ml-2 text-${g.color}-500`})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"space-y-1",children:[n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${m.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:m.isActive?"Actif":"Inactif"}),n.jsx("div",{children:n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-${g.color}-100 text-${g.color}-800`,children:g.text})})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(m),title:"Voir les détails",children:n.jsx(Bs,{className:"w-4 h-4"})}),!h&&n.jsxs(n.Fragment,{children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(m),title:"Modifier",children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(m.id),title:"Supprimer",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(cs,{className:"w-4 h-4"})})]})]})})]},m.id)})})]})})})},nD=({product:t,onClose:e,onEdit:s})=>{const r=h=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(h).replace("MGA","Ar"),i=h=>h.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),a=(h,m)=>m>0?((h-m)/m*100).toFixed(1):"0",l=t.stock===0?{label:"Rupture de stock",color:"bg-red-100 text-red-800 border-red-200",icon:n.jsx(Me,{className:"w-4 h-4 text-red-600 mr-2"})}:t.stock<=t.minStock?{label:"Stock faible",color:"bg-orange-100 text-orange-800 border-orange-200",icon:n.jsx(Me,{className:"w-4 h-4 text-orange-600 mr-2"})}:{label:"En stock",color:"bg-green-100 text-green-800 border-green-200",icon:n.jsx(vn,{className:"w-4 h-4 text-green-600 mr-2"})},d=a(t.salePrice,t.purchasePrice),u=parseFloat(d);return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[n.jsx(yt,{className:"w-6 h-6 mr-2"}),"Détails du produit"]}),n.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"flex items-start gap-6",children:[n.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center",children:n.jsx(yt,{className:"w-12 h-12 text-gray-400"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:t.name}),n.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.category}),n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.isActive?"Actif":"Inactif"})]}),t.description&&n.jsx("p",{className:"text-gray-600 mt-2",children:t.description})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(yi,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Référence"}),n.jsx("p",{className:"font-semibold text-gray-900",children:t.reference})]})]}),t.barcode&&n.jsxs("div",{className:"flex items-center",children:[n.jsx(c1,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Code-barres"}),n.jsx("p",{className:"font-semibold text-gray-900 font-mono",children:t.barcode})]})]}),t.brand&&n.jsxs("div",{className:"flex items-center",children:[n.jsx(qs,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Marque"}),n.jsx("p",{className:"font-semibold text-gray-900",children:t.brand})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(kt,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Créé le"}),n.jsx("p",{className:"font-semibold text-gray-900",children:i(t.createdAt)})]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Tt,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Prix de vente"}),n.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:r(t.salePrice)})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(Tt,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Prix d'achat"}),n.jsx("p",{className:"font-semibold text-gray-900",children:r(t.purchasePrice)})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(wn,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Marge bénéficiaire"}),n.jsxs("p",{className:`font-semibold ${u>=30?"text-green-600":u>=15?"text-orange-600":"text-red-600"}`,children:[d,"%"]})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(qs,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"TVA"}),n.jsxs("p",{className:"font-semibold text-gray-900",children:[t.taxRate,"%"]})]})]})]})]}),n.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[n.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Informations de stock"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Stock actuel"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.stock}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Unité: ",t.unit]})]}),n.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Stock minimum"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.minStock}),n.jsx("p",{className:"text-xs text-gray-500",children:"Seuil d'alerte"})]}),n.jsxs("div",{className:`bg-white p-3 rounded-lg border ${l.color}`,children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Statut"}),n.jsxs("p",{className:"text-lg font-bold flex items-center",children:[l.icon,l.label]}),t.stock<=t.minStock&&t.stock>0&&n.jsx("p",{className:"text-xs text-orange-600",children:"Commander bientôt"}),t.stock===0&&n.jsx("p",{className:"text-xs text-red-600",children:"Commander immédiatement"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[n.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Valeur d'achat du stock"}),n.jsx("p",{className:"text-2xl font-bold text-blue-700",children:r(t.purchasePrice*t.stock)}),n.jsxs("p",{className:"text-sm text-blue-600",children:[t.stock," × ",r(t.purchasePrice)]})]}),n.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[n.jsx("h4",{className:"font-semibold text-green-900 mb-2",children:"Valeur de vente du stock"}),n.jsx("p",{className:"text-2xl font-bold text-green-700",children:r(t.salePrice*t.stock)}),n.jsxs("p",{className:"text-sm text-green-600",children:[t.stock," × ",r(t.salePrice)]})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:e,children:"Fermer"}),n.jsx(O,{onClick:s,children:"Modifier"})]})]})})},rD=()=>{const[t,e]=I.useState([]),[s,r]=I.useState([]),[i,a]=I.useState([]),[o,l]=I.useState(""),[d,u]=I.useState("all"),[h,m]=I.useState("all"),[g,x]=I.useState(!1),[y,R]=I.useState(null),[_,T]=I.useState(!1),[A,C]=I.useState(!0),[k,D]=I.useState(null),[P,v]=I.useState(!1),{user:b}=Fe(),N=async()=>{if(b!=null&&b.establishmentId)try{const X=Ae(Ee(H,"stores"),ce("establishmentId","==",b.establishmentId),ce("isActive","==",!0)),Z=(await Ie(X)).docs.map($=>{const q=$.data();return{id:$.id,name:q.name,isMainStore:q.isMainStore||!1}});a(Z)}catch(X){console.error("Erreur lors du chargement des magasins:",X)}},f=async()=>{if(b!=null&&b.establishmentId)try{const X=Ae(Ee(H,"categories"),ce("establishmentId","==",b.establishmentId)),Z=(await Ie(X)).docs.map($=>{const q=$.data();return{id:$.id,name:q.name,color:q.color}});r(Z)}catch(X){console.error("Erreur lors du chargement des catégories:",X)}},j=async()=>{if(b!=null&&b.establishmentId)try{const X=Ae(Ee(H,"products"),ce("establishmentId","==",b.establishmentId)),Z=(await Ie(X)).docs.map($=>{var se,ve;const q=$.data(),ue=s.find(ke=>ke.id===q.categoryId);return{id:$.id,name:q.name,reference:q.reference,salePrice:q.salePrice,purchasePrice:q.purchasePrice,stock:q.stock,minStock:q.minStock,categoryId:q.categoryId,category:(ue==null?void 0:ue.name)||"Catégorie inconnue",taxRate:q.taxRate,isActive:q.isActive,unit:q.unit,brand:q.brand,barcode:q.barcode,description:q.description,establishmentId:q.establishmentId,storeStock:q.storeStock||{},createdAt:((se=q.createdAt)==null?void 0:se.toDate())||new Date,updatedAt:((ve=q.updatedAt)==null?void 0:ve.toDate())||new Date}});e(Z)}catch(X){console.error("Erreur lors du chargement des produits:",X),L.error("Erreur lors du chargement des produits")}};I.useEffect(()=>{const X=async()=>{C(!0),await N(),await f(),await j(),C(!1)};b!=null&&b.establishmentId&&X()},[b==null?void 0:b.establishmentId]),I.useEffect(()=>{s.length>0&&j()},[s]);const E=I.useMemo(()=>t.filter(X=>{const re=X.name.toLowerCase().includes(o.toLowerCase())||X.reference.toLowerCase().includes(o.toLowerCase())||X.barcode&&X.barcode.includes(o)||X.brand&&X.brand.toLowerCase().includes(o.toLowerCase()),Z=d==="all"||X.categoryId===d;let $=!0;switch(h){case"active":$=X.isActive;break;case"inactive":$=!X.isActive;break;case"low_stock":$=X.stock>0&&X.stock<=X.minStock;break;case"out_of_stock":$=X.stock===0;break;default:$=!0}return re&&Z&&$}),[t,o,d,h]),S=I.useMemo(()=>({total:t.length,active:t.filter(X=>X.isActive).length,lowStock:t.filter(X=>X.stock>0&&X.stock<=X.minStock).length,outOfStock:t.filter(X=>X.stock===0).length}),[t]),ee=()=>{if(s.length===0){L.error("Créez d'abord des catégories avant d'ajouter des produits");return}if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des produits");return}R(null),x(!0)},U=X=>{if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour modifier des produits");return}R(X),x(!0)},z=async X=>{if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des produits");return}if(window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ?"))try{await Is(he(H,"products",X)),await j(),L.success("Produit supprimé avec succès")}catch(re){console.error("Erreur lors de la suppression:",re),L.error("Erreur lors de la suppression")}},J=X=>{D(X),v(!0)},W=async X=>{if(!(b!=null&&b.establishmentId)){L.error("Établissement non trouvé");return}if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour modifier des produits");return}T(!0);try{if(y)await ht(he(H,"products",y.id),{...X,establishmentId:b.establishmentId,updatedAt:Q.now()}),L.success("Produit modifié avec succès");else{const re=`product_${Date.now()}`;await Je(he(H,"products",re),{...X,establishmentId:b.establishmentId,createdAt:Q.now(),updatedAt:Q.now()}),L.success("Produit ajouté avec succès")}await j(),x(!1),R(null)}catch(re){console.error("Erreur lors de l'enregistrement:",re),L.error("Erreur lors de l'enregistrement")}finally{T(!1)}},oe=()=>{const X=[["Nom","Référence","Catégorie","Prix de vente","Prix d'achat","Stock","Stock min","Statut"],...E.map(q=>[q.name,q.reference,q.category,q.salePrice,q.purchasePrice,q.stock,q.minStock,q.isActive?"Actif":"Inactif"])].map(q=>q.join(",")).join(`
`),re=new Blob([X],{type:"text/csv"}),Z=window.URL.createObjectURL(re),$=document.createElement("a");$.href=Z,$.download=`produits_${new Date().toISOString().split("T")[0]}.csv`,$.click(),window.URL.revokeObjectURL(Z),L.success("Export réalisé avec succès")};return A?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des données..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des Produits"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez votre catalogue de produits et suivez vos stocks"})]}),(b==null?void 0:b.role)!=="reader"&&n.jsxs(O,{onClick:ee,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Ajouter un produit"]})]}),(b==null?void 0:b.role)==="reader"&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les produits mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),s.length===0&&n.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("svg",{className:"h-5 w-5 text-orange-400",viewBox:"0 0 20 20",fill:"currentColor",children:n.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),n.jsxs("div",{className:"ml-3",children:[n.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Aucune catégorie trouvée"}),n.jsx("div",{className:"mt-2 text-sm text-orange-700",children:n.jsxs("p",{children:["Vous devez d'abord créer des catégories avant d'ajouter des produits."," ",n.jsx("button",{onClick:()=>window.location.href="/categories",className:"font-medium underline hover:text-orange-600",children:"Créer des catégories maintenant"})]})})]})]})}),n.jsx(tD,{searchTerm:o,onSearchChange:l,selectedCategory:d,onCategoryChange:u,selectedStatus:h,onStatusChange:m,onExport:oe,stats:S}),n.jsx(sD,{products:E,onEdit:U,onDelete:z,onView:J,isLoading:!1,userRole:(b==null?void 0:b.role)||""}),g&&n.jsx(Z5,{product:y,onSubmit:W,onCancel:()=>{x(!1),R(null)},isLoading:_}),P&&k&&n.jsx(nD,{product:k,onClose:()=>{v(!1),D(null)},onEdit:()=>{v(!1),U(k)}})]})},tv=[{id:"blue",name:"Bleu",class:"bg-blue-500"},{id:"green",name:"Vert",class:"bg-green-500"},{id:"purple",name:"Violet",class:"bg-purple-500"},{id:"orange",name:"Orange",class:"bg-orange-500"},{id:"red",name:"Rouge",class:"bg-red-500"},{id:"yellow",name:"Jaune",class:"bg-yellow-500"},{id:"pink",name:"Rose",class:"bg-pink-500"},{id:"indigo",name:"Indigo",class:"bg-indigo-500"},{id:"teal",name:"Sarcelle",class:"bg-teal-500"},{id:"gray",name:"Gris",class:"bg-gray-500"}],sv=({readOnly:t=!1})=>{const[e,s]=I.useState([]),[r,i]=I.useState(!0),[a,o]=I.useState(!1),[l,d]=I.useState(null),[u,h]=I.useState({name:"",description:"",color:"blue"}),[m,g]=I.useState({}),{user:x}=Fe(),y=async()=>{if(x!=null&&x.establishmentId)try{i(!0);const D=Ae(Ee(H,"categories"),ce("establishmentId","==",x.establishmentId)),v=(await Ie(D)).docs.map(b=>{var f;const N=b.data();return{id:b.id,name:N.name,description:N.description||"",color:N.color,establishmentId:N.establishmentId,createdAt:((f=N.createdAt)==null?void 0:f.toDate())||new Date,productCount:0}});s(v)}catch(D){console.error("Erreur lors du chargement des catégories:",D),L.error("Erreur lors du chargement des catégories")}finally{i(!1)}};I.useEffect(()=>{y()},[x==null?void 0:x.establishmentId]);const R=()=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des catégories");return}d(null),h({name:"",description:"",color:"blue"}),g({}),o(!0)},_=D=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour modifier des catégories");return}d(D),h({name:D.name,description:D.description||"",color:D.color}),g({}),o(!0)},T=()=>{const D={};return u.name.trim()||(D.name="Le nom de la catégorie est requis"),e.find(v=>v.name.toLowerCase()===u.name.toLowerCase()&&v.id!==(l==null?void 0:l.id))&&(D.name="Une catégorie avec ce nom existe déjà"),g(D),Object.keys(D).length===0},A=async D=>{if(D.preventDefault(),!(!T()||!(x!=null&&x.establishmentId)))try{if(l)await ht(he(H,"categories",l.id),{name:u.name.trim(),description:u.description.trim(),color:u.color,updatedAt:Q.now()}),L.success("Catégorie modifiée avec succès");else{const P=`${x.establishmentId}_${Date.now()}`;await Je(he(H,"categories",P),{name:u.name.trim(),description:u.description.trim(),color:u.color,establishmentId:x.establishmentId,createdAt:Q.now()}),L.success("Catégorie créée avec succès")}await y(),o(!1),d(null)}catch(P){console.error("Erreur lors de la sauvegarde:",P),L.error("Erreur lors de la sauvegarde")}},C=async D=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des catégories");return}const P=e.find(v=>v.id===D);if(P){if(P.productCount&&P.productCount>0){L.error(`Impossible de supprimer: ${P.productCount} produit(s) utilisent cette catégorie`);return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer la catégorie "${P.name}" ?`))try{await Is(he(H,"categories",D)),await y(),L.success("Catégorie supprimée avec succès")}catch(v){console.error("Erreur lors de la suppression:",v),L.error("Erreur lors de la suppression")}}},k=D=>{const P=tv.find(v=>v.id===D);return P?P.class:"bg-gray-500"};return r?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des catégories..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestion des Catégories"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Organisez vos produits avec des catégories personnalisées"})]}),!t&&n.jsxs(O,{onClick:R,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Nouvelle catégorie"]})]}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"💡 Suggestions de catégories"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🖥️ Matériel Informatique"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[n.jsx("li",{children:"• Ordinateurs portables"}),n.jsx("li",{children:"• Ordinateurs de bureau"}),n.jsx("li",{children:"• Composants PC"}),n.jsx("li",{children:"• Périphériques"}),n.jsx("li",{children:"• Accessoires"})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🏪 Commerce Général"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[n.jsx("li",{children:"• Alimentation"}),n.jsx("li",{children:"• Boissons"}),n.jsx("li",{children:"• Produits ménagers"}),n.jsx("li",{children:"• Hygiène & Beauté"}),n.jsx("li",{children:"• Papeterie"})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"👕 Mode & Textile"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[n.jsx("li",{children:"• Vêtements Homme"}),n.jsx("li",{children:"• Vêtements Femme"}),n.jsx("li",{children:"• Vêtements Enfant"}),n.jsx("li",{children:"• Chaussures"}),n.jsx("li",{children:"• Accessoires"})]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(D=>n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:`w-4 h-4 rounded-full ${k(D.color)}`}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:D.name}),D.description&&n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:D.description}),n.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[D.productCount||0," produit(s)"]})]})]}),!t&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>_(D),children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>C(D.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(cs,{className:"w-4 h-4"})})]})]})},D.id)),e.length===0&&n.jsxs("div",{className:"col-span-full text-center py-12",children:[n.jsx(yi,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune catégorie"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Créez votre première catégorie pour organiser vos produits"}),!t&&n.jsxs(O,{onClick:R,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Créer une catégorie"]})]})]}),a&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier la catégorie":"Nouvelle catégorie"}),n.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:A,className:"space-y-4",children:[n.jsx(xe,{label:"Nom de la catégorie *",value:u.name,onChange:D=>h({...u,name:D.target.value}),error:m.name,placeholder:"Ex: Matériel Informatique",leftIcon:n.jsx(yi,{className:"w-4 h-4"})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optionnel)"}),n.jsx("textarea",{value:u.description,onChange:D=>h({...u,description:D.target.value}),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description de la catégorie..."})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[n.jsx(C5,{className:"w-4 h-4 inline mr-1"}),"Couleur de la catégorie"]}),n.jsx("div",{className:"grid grid-cols-5 gap-2",children:tv.map(D=>n.jsx("button",{type:"button",onClick:()=>h({...u,color:D.id}),className:`w-10 h-10 rounded-lg ${D.class} border-2 transition-all ${u.color===D.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"}`,title:D.name},D.id))})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>o(!1),children:"Annuler"}),n.jsxs(O,{type:"submit",children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),l?"Modifier":"Créer"]})]})]})]})})]})},iD=()=>{const{user:t}=Fe();return(t==null?void 0:t.role)==="reader"?n.jsxs("div",{className:"space-y-6",children:[n.jsx(K,{className:"p-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(yi,{className:"w-8 h-8 text-yellow-600"})}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès en lecture seule"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"En tant que Lecteur, vous pouvez uniquement consulter les catégories mais pas les modifier."}),n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-yellow-800",children:[n.jsx("p",{className:"font-medium",children:"Permissions limitées"}),n.jsx("p",{className:"mt-1",children:"Votre rôle actuel ne permet pas de créer, modifier ou supprimer des catégories. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})})]})}),n.jsx(sv,{readOnly:!0})]}):n.jsx("div",{className:"space-y-6",children:n.jsx(sv,{readOnly:!1})})},aD=({customer:t,onSubmit:e,onCancel:s,isLoading:r=!1})=>{const[i,a]=I.useState({name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",address:(t==null?void 0:t.address)||"",isActive:(t==null?void 0:t.isActive)!==!1}),[o,l]=I.useState({}),d=(m,g)=>{a(x=>({...x,[m]:g})),o[m]&&l(x=>({...x,[m]:""}))},u=()=>{const m={};return i.name.trim()||(m.name="Le nom est requis"),i.email.trim()?/\S+@\S+\.\S+/.test(i.email)||(m.email="Format d'email invalide"):m.email="L'email est requis",i.phone.trim()?/^\+?[\d\s-()]+$/.test(i.phone)||(m.phone="Format de téléphone invalide"):m.phone="Le téléphone est requis",i.address.trim()||(m.address="L'adresse est requise"),l(m),Object.keys(m).length===0},h=m=>{m.preventDefault(),u()&&e(i)};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Modifier le client":"Ajouter un client"}),n.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:h,className:"p-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations personnelles"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx("div",{className:"md:col-span-2",children:n.jsx(xe,{label:"Nom complet *",value:i.name,onChange:m=>d("name",m.target.value),error:o.name,leftIcon:n.jsx(Xe,{className:"w-4 h-4"}),placeholder:"Ex: Rakoto Jean"})}),n.jsx(xe,{label:"Adresse email *",type:"email",value:i.email,onChange:m=>d("email",m.target.value),error:o.email,leftIcon:n.jsx(Ft,{className:"w-4 h-4"}),placeholder:"Ex: rakoto@email.mg"}),n.jsx(xe,{label:"Téléphone *",type:"tel",value:i.phone,onChange:m=>d("phone",m.target.value),error:o.phone,leftIcon:n.jsx($d,{className:"w-4 h-4"}),placeholder:"Ex: +261 34 12 345 67"}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adresse complète *"}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:n.jsx(Od,{className:"w-4 h-4 text-gray-400"})}),n.jsx("textarea",{value:i.address,onChange:m=>d("address",m.target.value),rows:3,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${o.address?"border-red-300":"border-gray-300"}`,placeholder:"Ex: Lot 123, Quartier ABC, Antananarivo, Madagascar"})]}),o.address&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.address})]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Statut"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"isActive",checked:i.isActive,onChange:m=>d("isActive",m.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Client actif"})]}),n.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Les clients inactifs n'apparaîtront pas dans les recherches par défaut"})]}),t&&n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations fidélité"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[n.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Points fidélité"}),n.jsx("div",{className:"text-2xl font-bold text-purple-900",children:t.loyaltyPoints})]}),n.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[n.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Total dépensé"}),n.jsx("div",{className:"text-2xl font-bold text-green-900",children:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(t.totalSpent).replace("MGA","Ar")})]}),n.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[n.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Dernier achat"}),n.jsx("div",{className:"text-lg font-bold text-blue-900",children:t.lastPurchase?new Date(t.lastPurchase).toLocaleDateString("fr-FR"):"Jamais"})]})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:s,disabled:r,children:"Annuler"}),n.jsx(O,{type:"submit",disabled:r,children:r?"Enregistrement...":t?"Modifier":"Ajouter"})]})]})]})})},oD=({customers:t,onEdit:e,onDelete:s,onView:r,isLoading:i=!1,userRole:a})=>{const o=h=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(h).replace("MGA","Ar"),l=h=>h?new Date(h).toLocaleDateString("fr-FR"):"Jamais",d=h=>h>=200?{tier:"VIP",color:"purple"}:h>=100?{tier:"Gold",color:"yellow"}:h>=50?{tier:"Silver",color:"gray"}:{tier:"Bronze",color:"orange"},u=a==="reader";return i?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:n.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((h,m)=>n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),n.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),n.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},m))})}):t.length===0?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun client trouvé"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Commencez par ajouter votre premier client"}),!u&&n.jsxs(O,{children:[n.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Ajouter un client"]})]})}):n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fidélité"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Achats"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(h=>{const m=d(h.loyaltyPoints);return n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:n.jsx(Xe,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.name}),n.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[n.jsx(Od,{className:"w-3 h-3 mr-1"}),h.address]})]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsxs("div",{className:"flex items-center text-gray-900 mb-1",children:[n.jsx(Ft,{className:"w-3 h-3 mr-1"}),h.email]}),n.jsxs("div",{className:"flex items-center text-gray-500",children:[n.jsx($d,{className:"w-3 h-3 mr-1"}),h.phone]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx(Ud,{className:`w-4 h-4 mr-1 text-${m.color}-500`}),n.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full bg-${m.color}-100 text-${m.color}-800`,children:m.tier})]}),n.jsxs("div",{className:"text-gray-600",children:[h.loyaltyPoints," points"]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-medium text-gray-900",children:o(h.totalSpent)}),n.jsxs("div",{className:"text-gray-500",children:["Dernier: ",l(h.lastPurchase)]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${h.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:h.isActive?"Actif":"Inactif"})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(h),title:"Voir les détails",children:n.jsx(Bs,{className:"w-4 h-4"})}),!u&&n.jsxs(n.Fragment,{children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(h),title:"Modifier",children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(h.id),title:"Supprimer",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(cs,{className:"w-4 h-4"})})]})]})})]},h.id)})})]})})})},lD=[{id:"all",name:"Tous les clients"},{id:"active",name:"Clients actifs"},{id:"inactive",name:"Clients inactifs"},{id:"vip",name:"Clients VIP (200+ points)"}],cD=({searchTerm:t,onSearchChange:e,selectedStatus:s,onStatusChange:r,onExport:i,stats:a})=>{const o=l=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l).replace("MGA","Ar");return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Xe,{className:"w-8 h-8 text-blue-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total clients"}),n.jsx("p",{className:"text-2xl font-bold text-blue-900",children:a.total})]})]})}),n.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Xe,{className:"w-8 h-8 text-green-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-green-600",children:"Clients actifs"}),n.jsx("p",{className:"text-2xl font-bold text-green-900",children:a.active})]})]})}),n.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Ud,{className:"w-8 h-8 text-purple-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Clients VIP"}),n.jsx("p",{className:"text-2xl font-bold text-purple-900",children:a.vip})]})]})}),n.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(wn,{className:"w-8 h-8 text-orange-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-orange-600",children:"CA total"}),n.jsx("p",{className:"text-2xl font-bold text-orange-900",children:o(a.totalSpent)})]})]})})]}),n.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx("div",{className:"md:col-span-2",children:n.jsx(xe,{placeholder:"Rechercher par nom, email ou téléphone...",value:t,onChange:l=>e(l.target.value),leftIcon:n.jsx(Ps,{className:"w-5 h-5 text-gray-400"})})}),n.jsx("select",{value:s,onChange:l=>r(l.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:lD.map(l=>n.jsx("option",{value:l.id,children:l.name},l.id))})]}),n.jsxs("div",{className:"flex justify-between items-center mt-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>r("vip"),className:s==="vip"?"bg-purple-100 text-purple-700":"",children:[n.jsx(Ud,{className:"w-4 h-4 mr-1"}),"Clients VIP (",a.vip,")"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>r("active"),className:s==="active"?"bg-green-100 text-green-700":"",children:[n.jsx(Xe,{className:"w-4 h-4 mr-1"}),"Actifs (",a.active,")"]})]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:i,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]})]})},dD=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(""),[i,a]=I.useState("all"),[o,l]=I.useState(!1),[d,u]=I.useState(null),[h,m]=I.useState(!1),[g,x]=I.useState(!0),{user:y}=Fe(),R=(y==null?void 0:y.role)==="reader",_=async()=>{if(y!=null&&y.establishmentId)try{x(!0);const N=Ae(Ee(H,"customers"),ce("establishmentId","==",y.establishmentId)),j=(await Ie(N)).docs.map(E=>{const S=E.data();return{id:E.id,name:S.name,email:S.email||"",phone:S.phone||"",address:S.address||"",loyaltyPoints:S.loyaltyPoints||0,totalSpent:S.totalSpent||0,lastPurchase:S.lastPurchase?S.lastPurchase.toDate().toISOString():null,createdAt:S.createdAt?S.createdAt.toDate().toISOString():new Date().toISOString(),isActive:S.isActive!==!1,establishmentId:S.establishmentId}});e(j)}catch(N){console.error("Erreur lors du chargement des clients:",N),L.error("Erreur lors du chargement des clients")}finally{x(!1)}};I.useEffect(()=>{_()},[y==null?void 0:y.establishmentId]);const T=I.useMemo(()=>t.filter(N=>{const f=N.name.toLowerCase().includes(s.toLowerCase())||N.email.toLowerCase().includes(s.toLowerCase())||N.phone.includes(s);let j=!0;switch(i){case"active":j=N.isActive;break;case"inactive":j=!N.isActive;break;case"vip":j=N.loyaltyPoints>=200;break;default:j=!0}return f&&j}),[t,s,i]),A=I.useMemo(()=>({total:t.length,active:t.filter(N=>N.isActive).length,vip:t.filter(N=>N.loyaltyPoints>=200).length,totalSpent:t.reduce((N,f)=>N+f.totalSpent,0)}),[t]),C=()=>{if(R){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des clients");return}u(null),l(!0)},k=N=>{if(R){L.error("Vous n'avez pas les permissions nécessaires pour modifier des clients");return}u(N),l(!0)},D=async N=>{if(R){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des clients");return}if(window.confirm("Êtes-vous sûr de vouloir supprimer ce client ?"))try{await Is(he(H,"customers",N)),e(f=>f.filter(j=>j.id!==N)),L.success("Client supprimé avec succès")}catch(f){console.error("Erreur lors de la suppression du client:",f),L.error("Erreur lors de la suppression du client")}},P=N=>{L.success(`Affichage des détails de ${N.name}`)},v=async N=>{if(R){L.error("Vous n'avez pas les permissions nécessaires pour cette action");return}if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}m(!0);try{if(d)await ht(he(H,"customers",d.id),{...N,updatedAt:Q.now()}),e(f=>f.map(j=>j.id===d.id?{...j,...N,updatedAt:new Date().toISOString()}:j)),L.success("Client modifié avec succès");else{const f=`customer_${Date.now()}`,j={...N,id:f,loyaltyPoints:0,totalSpent:0,lastPurchase:null,establishmentId:y.establishmentId,createdAt:Q.now(),updatedAt:Q.now()};await Je(he(H,"customers",f),j),e(E=>[...E,{...j,id:f,lastPurchase:null,createdAt:new Date().toISOString(),isActive:N.isActive}]),L.success("Client ajouté avec succès")}l(!1),u(null)}catch(f){console.error("Erreur lors de l'enregistrement du client:",f),L.error("Erreur lors de l'enregistrement")}finally{m(!1)}},b=()=>{const N=[["Nom","Email","Téléphone","Adresse","Points fidélité","Total dépensé","Statut"],...T.map(S=>[S.name,S.email,S.phone,S.address,S.loyaltyPoints,S.totalSpent,S.isActive?"Actif":"Inactif"])].map(S=>S.join(",")).join(`
`),f=new Blob([N],{type:"text/csv"}),j=window.URL.createObjectURL(f),E=document.createElement("a");E.href=j,E.download=`clients_${new Date().toISOString().split("T")[0]}.csv`,E.click(),window.URL.revokeObjectURL(j),L.success("Export réalisé avec succès")};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des Clients"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez votre base clients et programme de fidélité"})]}),!R&&n.jsxs(O,{onClick:C,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Ajouter un client"]})]}),R&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les clients mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),n.jsx(cD,{searchTerm:s,onSearchChange:r,selectedStatus:i,onStatusChange:a,onExport:b,stats:A}),g?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des clients..."})]}):n.jsx(oD,{customers:T,onEdit:k,onDelete:D,onView:P,isLoading:!1,userRole:(y==null?void 0:y.role)||""}),o&&n.jsx(aD,{customer:d,onSubmit:v,onCancel:()=>{l(!1),u(null)},isLoading:h})]})},uD=[{id:"all",name:"Tous les statuts"},{id:"completed",name:"Terminées"},{id:"refunded",name:"Remboursées"}],hD=[{id:"all",name:"Tous les paiements"},{id:"cash",name:"Espèces"},{id:"card",name:"Carte"},{id:"mvola",name:"Mvola"},{id:"orange_money",name:"Orange Money"},{id:"airtel_money",name:"Airtel Money"}],mD=({searchTerm:t,onSearchChange:e,selectedStatus:s,onStatusChange:r,selectedPaymentMethod:i,onPaymentMethodChange:a,dateRange:o,onDateRangeChange:l,stats:d})=>{const u=x=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x).replace("MGA","Ar"),h=()=>{const x=new Date().toISOString().split("T")[0];l({start:x,end:x})},m=()=>{const x=new Date,y=new Date(x.getTime()-7*24*60*60*1e3);l({start:y.toISOString().split("T")[0],end:x.toISOString().split("T")[0]})},g=()=>{const x=new Date,y=new Date(x.getFullYear(),x.getMonth()-1,x.getDate());l({start:y.toISOString().split("T")[0],end:x.toISOString().split("T")[0]})};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[n.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(nn,{className:"w-8 h-8 text-blue-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total ventes"}),n.jsx("p",{className:"text-2xl font-bold text-blue-900",children:d.total})]})]})}),n.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(wn,{className:"w-8 h-8 text-green-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-green-600",children:"Aujourd'hui"}),n.jsx("p",{className:"text-2xl font-bold text-green-900",children:d.today})]})]})}),n.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(wn,{className:"w-8 h-8 text-purple-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-purple-600",children:"CA du jour"}),n.jsx("p",{className:"text-xl font-bold text-purple-900",children:u(d.todayRevenue)})]})]})}),n.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(nn,{className:"w-8 h-8 text-orange-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Terminées"}),n.jsx("p",{className:"text-2xl font-bold text-orange-900",children:d.completed})]})]})}),n.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(ag,{className:"w-8 h-8 text-red-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-red-600",children:"Remboursées"}),n.jsx("p",{className:"text-2xl font-bold text-red-900",children:d.refunded})]})]})})]}),n.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[n.jsx(xe,{placeholder:"Rechercher par reçu, client ou caissier...",value:t,onChange:x=>e(x.target.value),leftIcon:n.jsx(Ps,{className:"w-5 h-5 text-gray-400"})}),n.jsx("select",{value:s,onChange:x=>r(x.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:uD.map(x=>n.jsx("option",{value:x.id,children:x.name},x.id))}),n.jsx("select",{value:i,onChange:x=>a(x.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:hD.map(x=>n.jsx("option",{value:x.id,children:x.name},x.id))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",value:o.start,onChange:x=>l({...o,start:x.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),n.jsx("input",{type:"date",value:o.end,onChange:x=>l({...o,end:x.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(O,{variant:"ghost",size:"sm",onClick:h,children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),"Aujourd'hui"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:m,children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),"7 derniers jours"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:g,children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),"30 derniers jours"]})]}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>{l({start:"",end:""}),r("all"),a("all"),e("")},children:"Réinitialiser filtres"})]})]})]})},pD=({sales:t,onView:e,onPrint:s,onRefund:r,isLoading:i=!1})=>{const a=u=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(u).replace("MGA","Ar"),o=u=>new Date(u).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=u=>{switch(u){case"cash":return Pl;case"card":return yn;case"mvola":case"orange_money":case"airtel_money":return fn;default:return yn}},d=u=>({cash:"Espèces",card:"Carte",mvola:"Mvola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[u]||u;return i?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:n.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((u,h)=>n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),n.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),n.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},h))})}):t.length===0?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:n.jsxs("div",{className:"text-center",children:[n.jsx(nn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune vente trouvée"}),n.jsx("p",{className:"text-gray-500",children:"Aucune vente ne correspond à vos critères de recherche"})]})}):n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vente"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client & Caissier"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paiement"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(u=>{const h=l(u.paymentMethod);return n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:n.jsx(nn,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.receiptNumber}),n.jsx("div",{className:"text-sm text-gray-500",children:o(u.date)})]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-medium text-gray-900",children:u.customerName}),n.jsxs("div",{className:"text-gray-500",children:["par ",u.cashierName]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsxs("div",{className:"font-medium text-gray-900",children:[u.items.reduce((m,g)=>m+g.quantity,0)," articles"]}),n.jsxs("div",{className:"text-gray-500 text-xs",children:[u.items.slice(0,2).map(m=>m.name).join(", "),u.items.length>2&&"..."]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center text-sm",children:[n.jsx(h,{className:"w-4 h-4 mr-2 text-gray-400"}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium text-gray-900",children:d(u.paymentMethod)}),u.changeAmount>0&&n.jsxs("div",{className:"text-gray-500 text-xs",children:["Rendu: ",a(u.changeAmount)]})]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-bold text-gray-900",children:a(u.total)}),n.jsxs("div",{className:"text-gray-500 text-xs",children:["HT: ",a(u.subtotal)]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${u.status==="completed"?"bg-green-100 text-green-800":u.status==="refunded"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:u.status==="completed"?"Terminée":u.status==="refunded"?"Remboursée":u.status})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(u),title:"Voir les détails",children:n.jsx(Bs,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(u),title:"Imprimer le reçu",children:n.jsx(Dl,{className:"w-4 h-4"})}),u.status==="completed"&&n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(u.id),title:"Rembourser",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(ag,{className:"w-4 h-4"})})]})})]},u.id)})})]})})})},fD=({sale:t,onClose:e,onPrint:s,onRefund:r})=>{const i=l=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l).replace("MGA","Ar"),a=l=>new Date(l).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),o=l=>({cash:"Espèces",card:"Carte bancaire",mvola:"Mvola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[l]||l;return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[n.jsx(nn,{className:"w-6 h-6 mr-2"}),"Détails de la vente"]}),n.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(nn,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Numéro de reçu"}),n.jsx("p",{className:"font-semibold text-gray-900",children:t.receiptNumber})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(kt,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Date et heure"}),n.jsx("p",{className:"font-semibold text-gray-900",children:a(t.date)})]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(At,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Client"}),n.jsx("p",{className:"font-semibold text-gray-900",children:t.customerName})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(At,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Caissier"}),n.jsx("p",{className:"font-semibold text-gray-900",children:t.cashierName})]})]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Articles vendus"}),n.jsx("div",{className:"bg-gray-50 rounded-lg overflow-hidden",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Article"}),n.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Qté"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Prix unit."}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200",children:t.items.map((l,d)=>n.jsxs("tr",{children:[n.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:l.name}),n.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 text-center",children:l.quantity}),n.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 text-right",children:i(l.unitPrice)}),n.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right",children:i(l.total)})]},d))})]})})]}),n.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-gray-600",children:"Sous-total (HT):"}),n.jsx("span",{className:"font-medium",children:i(t.subtotal)})]}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-gray-600",children:"TVA (20%):"}),n.jsx("span",{className:"font-medium",children:i(t.taxAmount)})]}),n.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[n.jsx("span",{children:"Total TTC:"}),n.jsx("span",{className:"text-blue-600",children:i(t.total)})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(yn,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Méthode de paiement"}),n.jsx("p",{className:"font-semibold text-gray-900",children:o(t.paymentMethod)})]})]}),t.paymentMethod==="cash"&&t.changeAmount>0&&n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Montant reçu"}),n.jsx("p",{className:"font-semibold text-gray-900",children:i(t.paymentAmount)}),n.jsxs("p",{className:"text-sm text-green-600",children:["Rendu: ",i(t.changeAmount)]})]})]}),n.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Statut de la vente"}),n.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="refunded"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status==="completed"?"Terminée":t.status==="refunded"?"Remboursée":t.status})]})})]}),n.jsxs("div",{className:"flex justify-between gap-3 p-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:e,children:"Fermer"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(O,{variant:"ghost",onClick:s,children:[n.jsx(Dl,{className:"w-4 h-4 mr-2"}),"Imprimer"]}),t.status==="completed"&&n.jsxs(O,{variant:"danger",onClick:r,children:[n.jsx(ag,{className:"w-4 h-4 mr-2"}),"Rembourser"]})]})]})]})})},gD=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(""),[i,a]=I.useState("all"),[o,l]=I.useState("all"),[d,u]=I.useState({start:"",end:""}),[h,m]=I.useState(null),[g,x]=I.useState(!1),[y,R]=I.useState(!0),{user:_}=Fe(),T=async()=>{if(_!=null&&_.establishmentId)try{R(!0);const b=Ae(Ee(H,"sales"),ce("establishmentId","==",_.establishmentId),Na("createdAt","desc")),f=(await Ie(b)).docs.map(j=>{var S,ee;const E=j.data();return{id:j.id,receiptNumber:E.receiptNumber,date:((ee=(S=E.createdAt)==null?void 0:S.toDate())==null?void 0:ee.toISOString())||new Date().toISOString(),cashierName:E.cashierName,customerName:E.customerName||"Client anonyme",items:E.items.map(U=>({name:U.productName,quantity:U.quantity,unitPrice:U.unitPrice,total:U.total})),subtotal:E.subtotal,taxAmount:E.taxAmount,total:E.total,paymentMethod:E.paymentMethod,paymentAmount:E.paymentAmount,changeAmount:E.changeAmount,status:E.status}});e(f)}catch(b){console.error("Erreur lors du chargement des ventes:",b),L.error("Erreur lors du chargement des ventes")}finally{R(!1)}};I.useEffect(()=>{T()},[_==null?void 0:_.establishmentId]);const A=I.useMemo(()=>t.filter(b=>{const N=b.receiptNumber.toLowerCase().includes(s.toLowerCase())||b.customerName.toLowerCase().includes(s.toLowerCase())||b.cashierName.toLowerCase().includes(s.toLowerCase()),f=i==="all"||b.status===i,j=o==="all"||b.paymentMethod===o;let E=!0;if(d.start&&d.end){const S=new Date(b.date).toISOString().split("T")[0];E=S>=d.start&&S<=d.end}return N&&f&&j&&E}),[t,s,i,o,d]),C=I.useMemo(()=>{const b=new Date().toISOString().split("T")[0],N=t.filter(f=>f.date.startsWith(b)&&f.status==="completed");return{total:t.length,today:N.length,todayRevenue:N.reduce((f,j)=>f+j.total,0),completed:t.filter(f=>f.status==="completed").length,refunded:t.filter(f=>f.status==="refunded").length}},[t]),k=b=>{m(b),x(!0)},D=b=>{L.success(`Impression du reçu ${b.receiptNumber}`)},P=async b=>{if(window.confirm("Êtes-vous sûr de vouloir rembourser cette vente ?"))try{await ht(he(H,"sales",b),{status:"refunded",updatedAt:Q.now()}),await T(),L.success("Vente remboursée avec succès")}catch(N){console.error("Erreur lors du remboursement:",N),L.error("Erreur lors du remboursement")}},v=()=>{const b=[["N° Reçu","Date","Client","Caissier","Total","Paiement","Statut"],...A.map(E=>[E.receiptNumber,new Date(E.date).toLocaleDateString("fr-FR"),E.customerName,E.cashierName,E.total,E.paymentMethod,E.status])].map(E=>E.join(",")).join(`
`),N=new Blob([b],{type:"text/csv"}),f=window.URL.createObjectURL(N),j=document.createElement("a");j.href=f,j.download=`ventes_${new Date().toISOString().split("T")[0]}.csv`,j.click(),window.URL.revokeObjectURL(f),L.success("Export réalisé avec succès")};return y?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des ventes..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Historique des Ventes"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Consultez et gérez toutes vos transactions"})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(O,{variant:"ghost",onClick:v,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]}),n.jsxs(O,{children:[n.jsx(_a,{className:"w-4 h-4 mr-2"}),"Rapport détaillé"]})]})]}),n.jsx(mD,{searchTerm:s,onSearchChange:r,selectedStatus:i,onStatusChange:a,selectedPaymentMethod:o,onPaymentMethodChange:l,dateRange:d,onDateRangeChange:u,stats:C}),n.jsx(pD,{sales:A,onView:k,onPrint:D,onRefund:P,isLoading:!1}),g&&h&&n.jsx(fD,{sale:h,onClose:()=>{x(!1),m(null)},onPrint:()=>D(h),onRefund:()=>{P(h.id),x(!1),m(null)}})]})},xD=[{id:"all",name:"Tous les statuts"},{id:"paid",name:"Payées"},{id:"pending",name:"En attente"},{id:"cancelled",name:"Annulées"}],yD=[{id:"all",name:"Tous les paiements"},{id:"cash",name:"Espèces"},{id:"card",name:"Carte"},{id:"bank_transfer",name:"Virement bancaire"},{id:"check",name:"Chèque"}],vD=({searchTerm:t,onSearchChange:e,selectedCategory:s,onCategoryChange:r,selectedStatus:i,onStatusChange:a,selectedPaymentMethod:o,onPaymentMethodChange:l,dateRange:d,onDateRangeChange:u,onExport:h,stats:m})=>{const[g,x]=I.useState([]),{user:y}=Fe();I.useEffect(()=>{(async()=>{if(y!=null&&y.establishmentId)try{const k=Ae(Ee(H,"expense_categories"),ce("establishmentId","==",y.establishmentId)),P=(await Ie(k)).docs.map(v=>{const b=v.data();return{id:v.id,name:b.name}});x(P)}catch(k){console.error("Erreur lors du chargement des catégories:",k)}})()},[y==null?void 0:y.establishmentId]);const R=C=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(C).replace("MGA","Ar"),_=()=>{const C=new Date().toISOString().split("T")[0];u({start:C,end:C})},T=()=>{const C=new Date,k=new Date(C.getTime()-7*24*60*60*1e3);u({start:k.toISOString().split("T")[0],end:C.toISOString().split("T")[0]})},A=()=>{const C=new Date,k=new Date(C.getFullYear(),C.getMonth()-1,C.getDate());u({start:k.toISOString().split("T")[0],end:C.toISOString().split("T")[0]})};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Tt,{className:"w-8 h-8 text-red-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-red-600",children:"Total dépenses"}),n.jsx("p",{className:"text-2xl font-bold text-red-900",children:m.total})]})]})}),n.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(kt,{className:"w-8 h-8 text-orange-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Ce mois"}),n.jsx("p",{className:"text-xl font-bold text-orange-900",children:m.thisMonth}),n.jsx("p",{className:"text-xs text-orange-700",children:R(m.thisMonthAmount)})]})]})}),n.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Me,{className:"w-8 h-8 text-yellow-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"En attente"}),n.jsx("p",{className:"text-xl font-bold text-yellow-900",children:m.pending}),n.jsx("p",{className:"text-xs text-yellow-700",children:R(m.pendingAmount)})]})]})}),n.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(wn,{className:"w-8 h-8 text-purple-600"}),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Moyenne/mois"}),n.jsx("p",{className:"text-xl font-bold text-purple-900",children:R(m.thisMonthAmount)})]})]})})]}),n.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4",children:[n.jsx(xe,{placeholder:"Rechercher par titre, fournisseur...",value:t,onChange:C=>e(C.target.value),leftIcon:n.jsx(Ps,{className:"w-5 h-5 text-gray-400"})}),n.jsxs("select",{value:s,onChange:C=>r(C.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"all",children:"Toutes les catégories"}),g.map(C=>n.jsx("option",{value:C.id,children:C.name},C.id))]}),n.jsx("select",{value:i,onChange:C=>a(C.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:xD.map(C=>n.jsx("option",{value:C.id,children:C.name},C.id))}),n.jsx("select",{value:o,onChange:C=>l(C.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:yD.map(C=>n.jsx("option",{value:C.id,children:C.name},C.id))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",value:d.start,onChange:C=>u({...d,start:C.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),n.jsx("input",{type:"date",value:d.end,onChange:C=>u({...d,end:C.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(O,{variant:"ghost",size:"sm",onClick:_,children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),"Aujourd'hui"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:T,children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),"7 derniers jours"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:A,children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),"30 derniers jours"]})]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:h,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]})]})},bD=({expenses:t,onEdit:e,onDelete:s,onView:r,isLoading:i=!1,userRole:a})=>{const o=x=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x).replace("MGA","Ar"),l=x=>x.toLocaleDateString("fr-FR"),d=x=>({cash:"Espèces",card:"Carte",bank_transfer:"Virement",check:"Chèque"})[x]||x,u=x=>{switch(x){case"paid":return n.jsx(zt,{className:"w-4 h-4 text-green-600"});case"pending":return n.jsx(ks,{className:"w-4 h-4 text-yellow-600"});case"cancelled":return n.jsx(aa,{className:"w-4 h-4 text-red-600"});default:return n.jsx(ks,{className:"w-4 h-4 text-gray-600"})}},h=x=>({paid:"Payée",pending:"En attente",cancelled:"Annulée"})[x]||x,m=x=>{switch(x){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=a==="reader";return i?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:n.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((x,y)=>n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),n.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),n.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},y))})}):t.length===0?n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:n.jsxs("div",{className:"text-center",children:[n.jsx(Tt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune dépense trouvée"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Commencez par enregistrer votre première dépense"}),!g&&n.jsxs(O,{children:[n.jsx(Tt,{className:"w-4 h-4 mr-2"}),"Ajouter une dépense"]})]})}):n.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dépense"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Catégorie"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(x=>n.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-4",children:n.jsx(Tt,{className:"w-6 h-6 text-red-600"})}),n.jsxs("div",{children:[n.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[x.title,x.isRecurring&&n.jsx(ig,{className:"w-4 h-4 ml-2 text-blue-500",title:"Dépense récurrente"})]}),n.jsx("div",{className:"text-sm text-gray-500",children:x.description&&x.description.length>50?`${x.description.substring(0,50)}...`:x.description}),x.invoiceNumber&&n.jsxs("div",{className:"text-xs text-gray-400 flex items-center mt-1",children:[n.jsx(_a,{className:"w-3 h-3 mr-1"}),x.invoiceNumber]})]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:x.categoryName})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-bold text-red-600 text-lg",children:o(x.amount)}),n.jsx("div",{className:"text-gray-500 text-xs",children:d(x.paymentMethod)})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-sm",children:x.supplier?n.jsxs("div",{className:"flex items-center",children:[n.jsx(At,{className:"w-4 h-4 mr-1 text-gray-400"}),n.jsx("span",{className:"font-medium text-gray-900",children:x.supplier})]}):n.jsx("span",{className:"text-gray-500",children:"-"})})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-medium text-gray-900",children:x.paidAt?l(x.paidAt):l(x.createdAt)}),n.jsxs("div",{className:"text-gray-500 text-xs",children:["par ",x.userName]}),x.isRecurring&&x.nextDueDate&&n.jsxs("div",{className:"text-xs text-blue-600 flex items-center mt-1",children:[n.jsx(kt,{className:"w-3 h-3 mr-1"}),"Prochaine: ",l(x.nextDueDate)]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[u(x.status),n.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${m(x.status)}`,children:h(x.status)})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>r(x),title:"Voir les détails",children:n.jsx(Bs,{className:"w-4 h-4"})}),!g&&n.jsxs(n.Fragment,{children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(x),title:"Modifier",children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(x.id),title:"Supprimer",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(cs,{className:"w-4 h-4"})})]})]})})]},x.id))})]})})})},wD=[{id:"cash",name:"Espèces"},{id:"card",name:"Carte bancaire"},{id:"bank_transfer",name:"Virement bancaire"},{id:"check",name:"Chèque"}],jD=[{id:"daily",name:"Quotidien"},{id:"weekly",name:"Hebdomadaire"},{id:"monthly",name:"Mensuel"},{id:"yearly",name:"Annuel"}],ND=({expense:t,onSubmit:e,onCancel:s,isLoading:r=!1})=>{const[i,a]=I.useState([]),[o,l]=I.useState(!0),{user:d}=Fe(),[u,h]=I.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",amount:(t==null?void 0:t.amount)||"",categoryId:(t==null?void 0:t.categoryId)||"",paymentMethod:(t==null?void 0:t.paymentMethod)||"cash",supplier:(t==null?void 0:t.supplier)||"",invoiceNumber:(t==null?void 0:t.invoiceNumber)||"",isRecurring:(t==null?void 0:t.isRecurring)||!1,recurringFrequency:(t==null?void 0:t.recurringFrequency)||"monthly",nextDueDate:t!=null&&t.nextDueDate?t.nextDueDate.toISOString().split("T")[0]:"",status:(t==null?void 0:t.status)||"paid",paidAt:t!=null&&t.paidAt?t.paidAt.toISOString().split("T")[0]:new Date().toISOString().split("T")[0]}),[m,g]=I.useState({});I.useEffect(()=>{(async()=>{if(d!=null&&d.establishmentId)try{l(!0);const T=Ae(Ee(H,"expense_categories"),ce("establishmentId","==",d.establishmentId)),C=(await Ie(T)).docs.map(k=>{const D=k.data();return{id:k.id,name:D.name,icon:D.icon,color:D.color}});a(C)}catch(T){console.error("Erreur lors du chargement des catégories:",T)}finally{l(!1)}})()},[d==null?void 0:d.establishmentId]);const x=(_,T)=>{h(A=>({...A,[_]:T})),m[_]&&g(A=>({...A,[_]:""}))},y=()=>{const _={};return u.title.trim()||(_.title="Le titre est requis"),(!u.amount||Number(u.amount)<=0)&&(_.amount="Le montant doit être supérieur à 0"),u.categoryId||(_.categoryId="La catégorie est requise"),u.paidAt||(_.paidAt="La date est requise"),u.isRecurring&&!u.nextDueDate&&(_.nextDueDate="La prochaine échéance est requise pour les dépenses récurrentes"),g(_),Object.keys(_).length===0},R=_=>{if(_.preventDefault(),y()){const T={...u,amount:Number(u.amount),paidAt:u.status==="paid"?new Date(u.paidAt):null,nextDueDate:u.isRecurring&&u.nextDueDate?new Date(u.nextDueDate):null};e(T)}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Modifier la dépense":"Nouvelle dépense"}),n.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:R,className:"p-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations générales"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx("div",{className:"md:col-span-2",children:n.jsx(xe,{label:"Titre de la dépense *",value:u.title,onChange:_=>x("title",_.target.value),error:m.title,leftIcon:n.jsx(_a,{className:"w-4 h-4"}),placeholder:"Ex: Loyer du magasin"})}),n.jsxs("div",{className:"md:col-span-2",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),n.jsx("textarea",{value:u.description,onChange:_=>x("description",_.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description détaillée de la dépense..."})]}),n.jsx(xe,{label:"Montant (Ar) *",type:"number",value:u.amount,onChange:_=>x("amount",_.target.value),error:m.amount,leftIcon:n.jsx(Tt,{className:"w-4 h-4"}),placeholder:"50000"}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Catégorie *"}),o?n.jsx("div",{className:"px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:"Chargement des catégories..."}):n.jsxs("select",{value:u.categoryId,onChange:_=>x("categoryId",_.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${m.categoryId?"border-red-300":"border-gray-300"}`,children:[n.jsx("option",{value:"",children:"Sélectionner une catégorie"}),i.map(_=>n.jsxs("option",{value:_.id,children:[_.icon," ",_.name]},_.id))]}),m.categoryId&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.categoryId})]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Détails du paiement"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Méthode de paiement"}),n.jsx("select",{value:u.paymentMethod,onChange:_=>x("paymentMethod",_.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:wD.map(_=>n.jsx("option",{value:_.id,children:_.name},_.id))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),n.jsxs("select",{value:u.status,onChange:_=>x("status",_.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"paid",children:"Payée"}),n.jsx("option",{value:"pending",children:"En attente"}),n.jsx("option",{value:"cancelled",children:"Annulée"})]})]}),n.jsx(xe,{label:"Fournisseur",value:u.supplier,onChange:_=>x("supplier",_.target.value),leftIcon:n.jsx(At,{className:"w-4 h-4"}),placeholder:"Nom du fournisseur"}),n.jsx(xe,{label:"N° de facture",value:u.invoiceNumber,onChange:_=>x("invoiceNumber",_.target.value),leftIcon:n.jsx(_a,{className:"w-4 h-4"}),placeholder:"FAC-2024-001"}),u.status==="paid"&&n.jsx(xe,{label:"Date de paiement *",type:"date",value:u.paidAt,onChange:_=>x("paidAt",_.target.value),error:m.paidAt,leftIcon:n.jsx(kt,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Récurrence"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"isRecurring",checked:u.isRecurring,onChange:_=>x("isRecurring",_.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsxs("label",{htmlFor:"isRecurring",className:"ml-2 text-sm text-gray-700",children:[n.jsx(ig,{className:"w-4 h-4 inline mr-1"}),"Dépense récurrente"]})]}),u.isRecurring&&n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pl-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fréquence"}),n.jsx("select",{value:u.recurringFrequency,onChange:_=>x("recurringFrequency",_.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:jD.map(_=>n.jsx("option",{value:_.id,children:_.name},_.id))})]}),n.jsx(xe,{label:"Prochaine échéance *",type:"date",value:u.nextDueDate,onChange:_=>x("nextDueDate",_.target.value),error:m.nextDueDate,leftIcon:n.jsx(kt,{className:"w-4 h-4"})})]})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Justificatif"}),n.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[n.jsx(Pu,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Téléchargez une photo de la facture ou du reçu"}),n.jsx(O,{variant:"ghost",size:"sm",children:"Choisir un fichier"}),n.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formats acceptés: JPG, PNG, PDF (max 5MB)"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:s,disabled:r,children:"Annuler"}),n.jsx(O,{type:"submit",disabled:r||i.length===0,children:r?"Enregistrement...":t?"Modifier":"Ajouter"})]})]})]})})},nv=[{id:"red",name:"Rouge",class:"bg-red-500"},{id:"orange",name:"Orange",class:"bg-orange-500"},{id:"yellow",name:"Jaune",class:"bg-yellow-500"},{id:"green",name:"Vert",class:"bg-green-500"},{id:"blue",name:"Bleu",class:"bg-blue-500"},{id:"purple",name:"Violet",class:"bg-purple-500"},{id:"pink",name:"Rose",class:"bg-pink-500"},{id:"gray",name:"Gris",class:"bg-gray-500"}],_D=[{id:"🏠",name:"Maison",component:p1},{id:"🚗",name:"Transport",component:N5},{id:"⚡",name:"Électricité",component:cl},{id:"👥",name:"Personnel",component:Xe},{id:"💼",name:"Bureau",component:j5},{id:"🛒",name:"Achats",component:vn},{id:"🔧",name:"Maintenance",component:D5},{id:"📶",name:"Internet",component:P5},{id:"☕",name:"Restauration",component:_5}],SD=({readOnly:t=!1})=>{const[e,s]=I.useState([]),[r,i]=I.useState(!0),[a,o]=I.useState(!1),[l,d]=I.useState(null),[u,h]=I.useState({name:"",description:"",color:"red",icon:"🏠"}),[m,g]=I.useState({}),{user:x}=Fe(),y=async()=>{if(x!=null&&x.establishmentId)try{i(!0);const P=Ae(Ee(H,"expense_categories"),ce("establishmentId","==",x.establishmentId)),b=(await Ie(P)).docs.map(N=>{var j;const f=N.data();return{id:N.id,name:f.name,description:f.description||"",color:f.color,icon:f.icon,isDefault:f.isDefault||!1,establishmentId:f.establishmentId,createdAt:((j=f.createdAt)==null?void 0:j.toDate())||new Date,expenseCount:0}});s(b)}catch(P){console.error("Erreur lors du chargement des catégories:",P),L.error("Erreur lors du chargement des catégories")}finally{i(!1)}},R=async()=>{if(!(x!=null&&x.establishmentId)||t){L.error("Vous n'avez pas les permissions nécessaires pour cette action");return}const P=[{name:"Loyer",description:"Loyer du local commercial",color:"red",icon:"🏠"},{name:"Électricité",description:"Factures d'électricité",color:"yellow",icon:"⚡"},{name:"Carburant",description:"Essence et transport",color:"blue",icon:"🚗"},{name:"Salaires",description:"Rémunération du personnel",color:"green",icon:"👥"},{name:"Fournitures",description:"Matériel et fournitures",color:"purple",icon:"🛒"},{name:"Maintenance",description:"Réparations et entretien",color:"orange",icon:"🔧"},{name:"Internet & Téléphone",description:"Frais de communication",color:"blue",icon:"📶"},{name:"Restauration",description:"Repas et collations",color:"pink",icon:"☕"}];try{for(const v of P){const b=`${x.establishmentId}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await Je(he(H,"expense_categories",b),{...v,establishmentId:x.establishmentId,isDefault:!0,createdAt:Q.now()})}await y(),L.success("Catégories par défaut créées")}catch(v){console.error("Erreur lors de la création des catégories par défaut:",v),L.error("Erreur lors de la création des catégories par défaut")}};I.useEffect(()=>{y()},[x==null?void 0:x.establishmentId]);const _=()=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des catégories");return}d(null),h({name:"",description:"",color:"red",icon:"🏠"}),g({}),o(!0)},T=P=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour modifier des catégories");return}d(P),h({name:P.name,description:P.description||"",color:P.color,icon:P.icon}),g({}),o(!0)},A=()=>{const P={};return u.name.trim()||(P.name="Le nom de la catégorie est requis"),e.find(b=>b.name.toLowerCase()===u.name.toLowerCase()&&b.id!==(l==null?void 0:l.id))&&(P.name="Une catégorie avec ce nom existe déjà"),g(P),Object.keys(P).length===0},C=async P=>{if(P.preventDefault(),!(!A()||!(x!=null&&x.establishmentId)||t))try{if(l)await ht(he(H,"expense_categories",l.id),{name:u.name.trim(),description:u.description.trim(),color:u.color,icon:u.icon,updatedAt:Q.now()}),L.success("Catégorie modifiée avec succès");else{const v=`${x.establishmentId}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await Je(he(H,"expense_categories",v),{name:u.name.trim(),description:u.description.trim(),color:u.color,icon:u.icon,establishmentId:x.establishmentId,isDefault:!1,createdAt:Q.now()}),L.success("Catégorie créée avec succès")}await y(),o(!1),d(null)}catch(v){console.error("Erreur lors de la sauvegarde:",v),L.error("Erreur lors de la sauvegarde")}},k=async P=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des catégories");return}const v=e.find(b=>b.id===P);if(v){if(v.isDefault){L.error("Impossible de supprimer une catégorie par défaut");return}if(v.expenseCount&&v.expenseCount>0){L.error(`Impossible de supprimer: ${v.expenseCount} dépense(s) utilisent cette catégorie`);return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer la catégorie "${v.name}" ?`))try{await Is(he(H,"expense_categories",P)),await y(),L.success("Catégorie supprimée avec succès")}catch(b){console.error("Erreur lors de la suppression:",b),L.error("Erreur lors de la suppression")}}},D=P=>{const v=nv.find(b=>b.id===P);return v?v.class:"bg-gray-500"};return r?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des catégories..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Catégories de dépenses"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Organisez vos dépenses par catégories"})]}),!t&&n.jsxs("div",{className:"flex gap-2",children:[e.length===0&&n.jsx(O,{variant:"ghost",onClick:R,children:"Créer catégories par défaut"}),n.jsxs(O,{onClick:_,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Nouvelle catégorie"]})]})]}),t&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les catégories mais pas les modifier."})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(P=>n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg ${D(P.color)} flex items-center justify-center text-white text-lg`,children:P.icon}),n.jsxs("div",{children:[n.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center",children:[P.name,P.isDefault&&n.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Défaut"})]}),P.description&&n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:P.description}),n.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[P.expenseCount||0," dépense(s)"]})]})]}),!t&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>T(P),children:n.jsx(bn,{className:"w-4 h-4"})}),!P.isDefault&&n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>k(P.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(cs,{className:"w-4 h-4"})})]})]})},P.id)),e.length===0&&n.jsxs("div",{className:"col-span-full text-center py-12",children:[n.jsx(yi,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune catégorie de dépense"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Créez des catégories pour organiser vos dépenses"}),!t&&n.jsxs("div",{className:"flex justify-center gap-3",children:[n.jsx(O,{variant:"ghost",onClick:R,children:"Catégories par défaut"}),n.jsxs(O,{onClick:_,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Créer une catégorie"]})]})]})]}),a&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier la catégorie":"Nouvelle catégorie"}),n.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:C,className:"space-y-4",children:[n.jsx(xe,{label:"Nom de la catégorie *",value:u.name,onChange:P=>h({...u,name:P.target.value}),error:m.name,placeholder:"Ex: Loyer",leftIcon:n.jsx(yi,{className:"w-4 h-4"})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optionnel)"}),n.jsx("textarea",{value:u.description,onChange:P=>h({...u,description:P.target.value}),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description de la catégorie..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Icône"}),n.jsx("div",{className:"grid grid-cols-3 gap-2",children:_D.map(P=>n.jsx("button",{type:"button",onClick:()=>h({...u,icon:P.id}),className:`p-3 rounded-lg border-2 transition-all flex items-center justify-center ${u.icon===P.id?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,title:P.name,children:n.jsx("span",{className:"text-2xl",children:P.id})},P.id))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Couleur"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:nv.map(P=>n.jsx("button",{type:"button",onClick:()=>h({...u,color:P.id}),className:`w-12 h-12 rounded-lg ${P.class} border-2 transition-all ${u.color===P.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"}`,title:P.name},P.id))})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>o(!1),children:"Annuler"}),n.jsxs(O,{type:"submit",children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),l?"Modifier":"Créer"]})]})]})]})})]})},ED=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(""),[i,a]=I.useState("all"),[o,l]=I.useState("all"),[d,u]=I.useState("all"),[h,m]=I.useState({start:"",end:""}),[g,x]=I.useState(!1),[y,R]=I.useState(!1),[_,T]=I.useState(null),[A,C]=I.useState(!1),[k,D]=I.useState(!0),[P,v]=I.useState(null),[b,N]=I.useState(!1),{user:f}=Fe(),j=(f==null?void 0:f.role)==="reader",E=async()=>{if(f!=null&&f.establishmentId)try{D(!0);const Z=Ae(Ee(H,"expenses"),ce("establishmentId","==",f.establishmentId),Na("createdAt","desc")),q=(await Ie(Z)).docs.map(ue=>{var ve,ke,me,be;const se=ue.data();return{id:ue.id,title:se.title,description:se.description,amount:se.amount,categoryId:se.categoryId,categoryName:se.categoryName,paymentMethod:se.paymentMethod,supplier:se.supplier,invoiceNumber:se.invoiceNumber,isRecurring:se.isRecurring||!1,recurringFrequency:se.recurringFrequency,nextDueDate:(ve=se.nextDueDate)==null?void 0:ve.toDate(),establishmentId:se.establishmentId,userId:se.userId,userName:se.userName,status:se.status,paidAt:(ke=se.paidAt)==null?void 0:ke.toDate(),createdAt:((me=se.createdAt)==null?void 0:me.toDate())||new Date,updatedAt:((be=se.updatedAt)==null?void 0:be.toDate())||new Date}});e(q)}catch(Z){console.error("Erreur lors du chargement des dépenses:",Z),L.error("Erreur lors du chargement des dépenses")}finally{D(!1)}};I.useEffect(()=>{E()},[f==null?void 0:f.establishmentId]);const S=I.useMemo(()=>t.filter(Z=>{const $=Z.title.toLowerCase().includes(s.toLowerCase())||Z.supplier&&Z.supplier.toLowerCase().includes(s.toLowerCase())||Z.description&&Z.description.toLowerCase().includes(s.toLowerCase()),q=i==="all"||Z.categoryId===i,ue=o==="all"||Z.status===o,se=d==="all"||Z.paymentMethod===d;let ve=!0;if(h.start&&h.end){const me=(Z.paidAt||Z.createdAt).toISOString().split("T")[0];ve=me>=h.start&&me<=h.end}return $&&q&&ue&&se&&ve}),[t,s,i,o,d,h]),ee=I.useMemo(()=>{const Z=new Date,$=new Date(Z.getFullYear(),Z.getMonth(),1),q=t.filter(se=>(se.paidAt||se.createdAt)>=$&&se.status==="paid"),ue=t.filter(se=>se.status==="pending");return{total:t.length,thisMonth:q.length,thisMonthAmount:q.reduce((se,ve)=>se+ve.amount,0),pending:ue.length,pendingAmount:ue.reduce((se,ve)=>se+ve.amount,0)}},[t]),U=()=>{if(j){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des dépenses");return}T(null),x(!0)},z=Z=>{if(j){L.error("Vous n'avez pas les permissions nécessaires pour modifier des dépenses");return}T(Z),x(!0)},J=async Z=>{if(j){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des dépenses");return}if(window.confirm("Êtes-vous sûr de vouloir supprimer cette dépense ?"))try{await Is(he(H,"expenses",Z)),await E(),L.success("Dépense supprimée avec succès")}catch($){console.error("Erreur lors de la suppression:",$),L.error("Erreur lors de la suppression")}},W=Z=>{v(Z),N(!0)},oe=async Z=>{if(!(f!=null&&f.establishmentId)){L.error("Établissement non trouvé");return}if(j){L.error("Vous n'avez pas les permissions nécessaires pour cette action");return}C(!0);try{const $=await Ie(Ae(Ee(H,"expense_categories"),ce("__name__","==",Z.categoryId)));let q="Catégorie inconnue";if($.empty||(q=$.docs[0].data().name),_)await ht(he(H,"expenses",_.id),{...Z,categoryName:q,establishmentId:f.establishmentId,userId:f.id,userName:f.name,updatedAt:Q.now()}),L.success("Dépense modifiée avec succès");else{const ue=`expense_${Date.now()}`;await Je(he(H,"expenses",ue),{...Z,categoryName:q,establishmentId:f.establishmentId,userId:f.id,userName:f.name,paidAt:Z.paidAt?Q.fromDate(Z.paidAt):null,nextDueDate:Z.nextDueDate?Q.fromDate(Z.nextDueDate):null,createdAt:Q.now(),updatedAt:Q.now()}),L.success("Dépense ajoutée avec succès")}await E(),x(!1),T(null)}catch($){console.error("Erreur lors de l'enregistrement:",$),L.error("Erreur lors de l'enregistrement")}finally{C(!1)}},X=()=>{const Z=[["Titre","Catégorie","Montant","Fournisseur","Date","Statut","Méthode de paiement"],...S.map(se=>[se.title,se.categoryName,se.amount,se.supplier||"",(se.paidAt||se.createdAt).toLocaleDateString("fr-FR"),se.status,se.paymentMethod])].map(se=>se.join(",")).join(`
`),$=new Blob([Z],{type:"text/csv"}),q=window.URL.createObjectURL($),ue=document.createElement("a");ue.href=q,ue.download=`depenses_${new Date().toISOString().split("T")[0]}.csv`,ue.click(),window.URL.revokeObjectURL(q),L.success("Export réalisé avec succès")},re=({expense:Z,onClose:$})=>{const q=ke=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(ke).replace("MGA","Ar"),ue=ke=>ke?ke.toLocaleDateString("fr-FR"):"Non défini",se=ke=>{switch(ke){case"paid":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ve=ke=>({cash:"Espèces",card:"Carte bancaire",bank_transfer:"Virement bancaire",check:"Chèque"})[ke]||ke;return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[n.jsx(Tt,{className:"w-6 h-6 mr-2 text-red-600"}),"Détails de la dépense"]}),n.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:Z.title}),Z.description&&n.jsx("p",{className:"text-gray-700 mb-3",children:Z.description}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:Z.categoryName}),n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${se(Z.status)}`,children:Z.status==="paid"?"Payée":Z.status==="pending"?"En attente":"Annulée"})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[n.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Montant"}),n.jsx("p",{className:"text-2xl font-bold text-red-700",children:q(Z.amount)})]}),n.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[n.jsx("h4",{className:"font-medium text-blue-800 mb-1",children:"Méthode de paiement"}),n.jsx("p",{className:"text-lg font-semibold text-blue-700",children:ve(Z.paymentMethod)})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[Z.supplier&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Fournisseur"}),n.jsx("p",{className:"text-gray-900",children:Z.supplier})]}),Z.invoiceNumber&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"N° de facture"}),n.jsx("p",{className:"text-gray-900 font-mono",children:Z.invoiceNumber})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Créée par"}),n.jsx("p",{className:"text-gray-900",children:Z.userName})]})]}),n.jsxs("div",{className:"space-y-4",children:[Z.paidAt&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Date de paiement"}),n.jsx("p",{className:"text-gray-900",children:ue(Z.paidAt)})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Date de création"}),n.jsx("p",{className:"text-gray-900",children:ue(Z.createdAt)})]}),Z.isRecurring&&n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Récurrence"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(ig,{className:"w-4 h-4 mr-1 text-blue-600"}),n.jsx("p",{className:"text-gray-900",children:Z.recurringFrequency==="daily"?"Quotidienne":Z.recurringFrequency==="weekly"?"Hebdomadaire":Z.recurringFrequency==="monthly"?"Mensuelle":"Annuelle"})]}),Z.nextDueDate&&n.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Prochaine échéance: ",ue(Z.nextDueDate)]})]})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:$,children:"Fermer"}),!j&&n.jsx(O,{onClick:()=>{$(),z(Z)},children:"Modifier"})]})]})})};return k?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des dépenses..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[n.jsx(vi,{className:"w-8 h-8 mr-3 text-red-600"}),"Gestion des Dépenses"]}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Suivez et contrôlez toutes vos dépenses d'entreprise"})]}),n.jsx("div",{className:"flex gap-3",children:!j&&n.jsxs(n.Fragment,{children:[n.jsxs(O,{variant:"ghost",onClick:()=>R(!0),children:[n.jsx(Sa,{className:"w-4 h-4 mr-2"}),"Catégories"]}),n.jsxs(O,{onClick:U,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Nouvelle dépense"]})]})})]}),j&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les dépenses mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),n.jsx(K,{children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl font-bold text-red-600",children:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(ee.thisMonthAmount).replace("MGA","Ar")}),n.jsx("p",{className:"text-gray-600",children:"Dépenses ce mois"})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(ee.pendingAmount).replace("MGA","Ar")}),n.jsx("p",{className:"text-gray-600",children:"En attente de paiement"})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-3xl font-bold text-blue-600",children:ee.total}),n.jsx("p",{className:"text-gray-600",children:"Total des dépenses"})]})]})}),n.jsx(vD,{searchTerm:s,onSearchChange:r,selectedCategory:i,onCategoryChange:a,selectedStatus:o,onStatusChange:l,selectedPaymentMethod:d,onPaymentMethodChange:u,dateRange:h,onDateRangeChange:m,onExport:X,stats:ee}),n.jsx(bD,{expenses:S,onEdit:z,onDelete:J,onView:W,isLoading:!1,userRole:(f==null?void 0:f.role)||""}),g&&n.jsx(ND,{expense:_,onSubmit:oe,onCancel:()=>{x(!1),T(null)},isLoading:A}),y&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Gestion des catégories"}),n.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsx(SD,{readOnly:j})]})}),b&&P&&n.jsx(re,{expense:P,onClose:()=>{N(!1),v(null)}})]})},AD=({readOnly:t=!1})=>{const[e,s]=I.useState([]),[r,i]=I.useState(!0),[a,o]=I.useState(!1),[l,d]=I.useState(null),[u,h]=I.useState({name:"",address:"",phone:"",email:"",isMainStore:!1,isActive:!0}),[m,g]=I.useState({}),{user:x}=Fe(),y=async()=>{if(x!=null&&x.establishmentId)try{i(!0);const k=Ae(Ee(H,"stores"),ce("establishmentId","==",x.establishmentId)),P=(await Ie(k)).docs.map(v=>{var N,f;const b=v.data();return{id:v.id,name:b.name,address:b.address,phone:b.phone||"",email:b.email||"",establishmentId:b.establishmentId,isActive:b.isActive!==!1,isMainStore:b.isMainStore||!1,createdAt:((N=b.createdAt)==null?void 0:N.toDate())||new Date,updatedAt:((f=b.updatedAt)==null?void 0:f.toDate())||new Date}});s(P)}catch(k){console.error("Erreur lors du chargement des magasins:",k),L.error("Erreur lors du chargement des magasins")}finally{i(!1)}};I.useEffect(()=>{y()},[x==null?void 0:x.establishmentId]);const R=()=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des magasins");return}d(null),h({name:"",address:"",phone:"",email:"",isMainStore:e.length===0,isActive:!0}),g({}),o(!0)},_=k=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour modifier des magasins");return}d(k),h({name:k.name,address:k.address,phone:k.phone||"",email:k.email||"",isMainStore:k.isMainStore,isActive:k.isActive}),g({}),o(!0)},T=()=>{const k={};return u.name.trim()||(k.name="Le nom du magasin est requis"),u.address.trim()||(k.address="L'adresse est requise"),e.find(P=>P.name.toLowerCase()===u.name.toLowerCase()&&P.id!==(l==null?void 0:l.id))&&(k.name="Un magasin avec ce nom existe déjà"),g(k),Object.keys(k).length===0},A=async k=>{if(k.preventDefault(),!(!T()||!(x!=null&&x.establishmentId)))try{if(l){if(l.isMainStore&&!u.isMainStore&&!e.find(P=>P.id!==l.id&&P.isMainStore)){L.error("Vous devez avoir au moins un magasin principal");return}if(!l.isMainStore&&u.isMainStore)for(const D of e)D.id!==l.id&&D.isMainStore&&await ht(he(H,"stores",D.id),{isMainStore:!1,updatedAt:Q.now()});await ht(he(H,"stores",l.id),{name:u.name.trim(),address:u.address.trim(),phone:u.phone.trim(),email:u.email.trim(),isMainStore:u.isMainStore,isActive:u.isActive,updatedAt:Q.now()}),L.success("Magasin modifié avec succès")}else{if(u.isMainStore)for(const P of e)P.isMainStore&&await ht(he(H,"stores",P.id),{isMainStore:!1,updatedAt:Q.now()});const D=`store_${Date.now()}`;await Je(he(H,"stores",D),{name:u.name.trim(),address:u.address.trim(),phone:u.phone.trim(),email:u.email.trim(),establishmentId:x.establishmentId,isMainStore:u.isMainStore,isActive:u.isActive,createdAt:Q.now(),updatedAt:Q.now()}),L.success("Magasin créé avec succès")}await y(),o(!1),d(null)}catch(D){console.error("Erreur lors de la sauvegarde:",D),L.error("Erreur lors de la sauvegarde")}},C=async k=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des magasins");return}const D=e.find(P=>P.id===k);if(D){if(D.isMainStore){L.error("Vous ne pouvez pas supprimer le magasin principal");return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer le magasin "${D.name}" ?`))try{await Is(he(H,"stores",k)),await y(),L.success("Magasin supprimé avec succès")}catch(P){console.error("Erreur lors de la suppression:",P),L.error("Erreur lors de la suppression")}}};return r?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des magasins..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestion des Magasins"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos différents points de vente et emplacements"})]}),!t&&n.jsxs(O,{onClick:R,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Nouveau magasin"]})]}),t&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les magasins mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),n.jsx(K,{children:n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Qn,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Gestion multi-magasins"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsx("p",{children:"• Créez plusieurs magasins ou points de vente pour votre établissement"}),n.jsx("p",{children:"• Suivez le stock par magasin et effectuez des transferts entre eux"}),n.jsx("p",{children:"• Désignez un magasin principal qui servira de référence"}),n.jsx("p",{children:"• Chaque magasin peut avoir ses propres ventes et statistiques"})]})]})]})})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(k=>n.jsxs(K,{padding:"md",className:k.isMainStore?"border-blue-300":"",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${k.isMainStore?"bg-blue-100":"bg-gray-100"}`,children:k.isMainStore?n.jsx(p1,{className:"w-5 h-5 text-blue-600"}):n.jsx(Cs,{className:"w-5 h-5 text-gray-600"})}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("h3",{className:"font-semibold text-gray-900",children:k.name}),k.isMainStore&&n.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Principal"})]}),n.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[n.jsx(Od,{className:"w-3 h-3 mr-1"}),k.address]}),k.phone&&n.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[n.jsx($d,{className:"w-3 h-3 mr-1"}),k.phone]}),k.email&&n.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[n.jsx(Ft,{className:"w-3 h-3 mr-1"}),k.email]})]})]}),!t&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>_(k),children:n.jsx(bn,{className:"w-4 h-4"})}),!k.isMainStore&&n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>C(k.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:n.jsx(cs,{className:"w-4 h-4"})})]})]}),n.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:k.isActive?"Actif":"Inactif"}),n.jsxs("span",{className:"text-xs text-gray-500",children:["Créé le ",k.createdAt.toLocaleDateString()]})]})})]},k.id)),e.length===0&&n.jsxs("div",{className:"col-span-full text-center py-12",children:[n.jsx(Cs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun magasin"}),n.jsx("p",{className:"text-gray-500 mb-6",children:"Créez votre premier magasin pour commencer à gérer vos points de vente"}),!t&&n.jsxs(O,{onClick:R,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Créer un magasin"]})]})]}),a&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier le magasin":"Nouveau magasin"}),n.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:A,className:"space-y-4",children:[n.jsx(xe,{label:"Nom du magasin *",value:u.name,onChange:k=>h({...u,name:k.target.value}),error:m.name,placeholder:"Ex: Magasin Principal",leftIcon:n.jsx(Cs,{className:"w-4 h-4"})}),n.jsx(xe,{label:"Adresse *",value:u.address,onChange:k=>h({...u,address:k.target.value}),error:m.address,placeholder:"Ex: 123 Rue Principale, Antananarivo",leftIcon:n.jsx(Od,{className:"w-4 h-4"})}),n.jsx(xe,{label:"Téléphone",value:u.phone,onChange:k=>h({...u,phone:k.target.value}),placeholder:"Ex: +261 34 12 345 67",leftIcon:n.jsx($d,{className:"w-4 h-4"})}),n.jsx(xe,{label:"Email",type:"email",value:u.email,onChange:k=>h({...u,email:k.target.value}),placeholder:"Ex: magasin@example.com",leftIcon:n.jsx(Ft,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"isMainStore",checked:u.isMainStore,onChange:k=>h({...u,isMainStore:k.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"isMainStore",className:"ml-2 text-sm text-gray-700",children:"Magasin principal"})]}),n.jsx("p",{className:"text-xs text-gray-500 -mt-2",children:"Le magasin principal est le magasin de référence pour votre établissement."}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"isActive",checked:u.isActive,onChange:k=>h({...u,isActive:k.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Magasin actif"})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>o(!1),children:"Annuler"}),n.jsxs(O,{type:"submit",children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),l?"Modifier":"Créer"]})]})]})]})})]})},ID=({onClose:t,onSuccess:e,existingTransfer:s})=>{var Z;const[r,i]=I.useState([]),[a,o]=I.useState([]),[l,d]=I.useState(""),[u,h]=I.useState(""),[m,g]=I.useState([]),[x,y]=I.useState(""),[R,_]=I.useState(!1),[T,A]=I.useState(!1),[C,k]=I.useState({}),[D,P]=I.useState(""),[v,b]=I.useState(!1),[N,f]=I.useState(!1),{user:j}=Fe();I.useEffect(()=>{(async()=>{if(j!=null&&j.establishmentId){_(!0);try{console.log("🔄 Chargement des données pour le transfert...");const q=Ae(Ee(H,"stores"),ce("establishmentId","==",j.establishmentId),ce("isActive","==",!0)),se=(await Ie(q)).docs.map(we=>{var pe,Y;const V=we.data();return{id:we.id,name:V.name,address:V.address,phone:V.phone||"",email:V.email||"",establishmentId:V.establishmentId,isActive:V.isActive!==!1,isMainStore:V.isMainStore||!1,createdAt:((pe=V.createdAt)==null?void 0:pe.toDate())||new Date,updatedAt:((Y=V.updatedAt)==null?void 0:Y.toDate())||new Date}});i(se),console.log("✅ Magasins chargés:",se.length);const ve=se.find(we=>we.isMainStore);ve&&!s&&(d(ve.id),console.log("📍 Magasin principal sélectionné comme source:",ve.name));const ke=Ae(Ee(H,"products"),ce("establishmentId","==",j.establishmentId),ce("isActive","==",!0)),be=(await Ie(ke)).docs.map(we=>{const V=we.data();return{id:we.id,name:V.name,reference:V.reference,barcode:V.barcode,stock:V.stock||0,unit:V.unit||"pièce",storeStock:V.storeStock||{},categoryId:V.categoryId,establishmentId:V.establishmentId,isActive:V.isActive!==!1,salePrice:V.salePrice||0,purchasePrice:V.purchasePrice||0}});o(be),console.log("✅ Produits chargés:",be.length),s&&(d(s.sourceStoreId),h(s.destinationStoreId),g(s.items||[]),y(s.notes||""),console.log("📝 Transfert existant chargé:",s.id))}catch(q){console.error("❌ Erreur lors du chargement des données:",q),L.error("Erreur lors du chargement des données")}finally{_(!1)}}})()},[j==null?void 0:j.establishmentId,s]);const E=($,q)=>{const ue=a.find(ve=>ve.id===$);if(!ue||!q)return 0;if(ue.storeStock&&ue.storeStock[q]!==void 0)return ue.storeStock[q];const se=r.find(ve=>ve.id===q);return se!=null&&se.isMainStore?ue.stock:0},S=()=>{if(!l)return console.log("⚠️ Aucun magasin source sélectionné"),[];const $=a.filter(q=>{const ue=!D||q.name.toLowerCase().includes(D.toLowerCase())||q.reference.toLowerCase().includes(D.toLowerCase())||q.barcode&&q.barcode.includes(D),se=!m.some(be=>be.productId===q.id),ve=E(q.id,l),ke=ve>0,me=ue&&se&&ke;return(q.name.toLowerCase().includes("coca")||q.name.toLowerCase().includes("pain"))&&console.log(`🔍 Produit ${q.name}:`,{matchesSearch:ue,notInTransfer:se,hasStock:ke,stockInStore:ve,isAvailable:me}),me});return console.log(`📦 Produits disponibles pour transfert: ${$.length}/${a.length}`),$},ee=$=>{const q=a.find(ve=>ve.id===$);if(!q){L.error("Produit non trouvé");return}if(!l){L.error("Veuillez sélectionner un magasin source");return}if(E(q.id,l)<=0){L.error("Aucun stock disponible pour ce produit dans le magasin source");return}const se={id:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,productId:q.id,productName:q.name,quantity:1,unit:q.unit,notes:""};g(ve=>[...ve,se]),b(!1),P(""),console.log("✅ Produit ajouté au transfert:",q.name),L.success(`${q.name} ajouté au transfert`)},U=($,q)=>{if(q<=0){z($);return}const ue=m.find(ke=>ke.id===$);if(!ue)return;const se=a.find(ke=>ke.id===ue.productId);if(!se)return;const ve=E(se.id,l);if(q>ve){L.error(`Stock insuffisant. Disponible: ${ve} ${se.unit}`);return}g(ke=>ke.map(me=>me.id===$?{...me,quantity:q}:me)),console.log(`📝 Quantité mise à jour pour ${ue.productName}: ${q}`)},z=$=>{const q=m.find(ue=>ue.id===$);g(ue=>ue.filter(se=>se.id!==$)),q&&(console.log("🗑️ Produit retiré du transfert:",q.productName),L.success("Produit retiré du transfert"))},J=()=>{const $={};l||($.sourceStore="Le magasin source est requis"),u||($.destinationStore="Le magasin destination est requis"),l===u&&($.destinationStore="Les magasins source et destination doivent être différents"),m.length===0&&($.items="Ajoutez au moins un produit au transfert");for(const q of m){const ue=E(q.productId,l);if(q.quantity>ue){$.items=`Stock insuffisant pour ${q.productName}. Disponible: ${ue}`;break}}return k($),Object.keys($).length===0},W=async $=>{if($.preventDefault(),!(!J()||!(j!=null&&j.establishmentId))){A(!0);try{const q=r.find(ke=>ke.id===l),ue=r.find(ke=>ke.id===u);if(!q||!ue){L.error("Magasin non trouvé");return}const se=s?s.id:`transfer_${Date.now()}`,ve={id:se,establishmentId:j.establishmentId,sourceStoreId:l,sourceStoreName:q.name,destinationStoreId:u,destinationStoreName:ue.name,items:m,status:s?s.status:"pending",notes:x,createdById:s?s.createdById:j.id,createdByName:s?s.createdByName:j.name,createdAt:s?s.createdAt:Q.now(),updatedAt:Q.now()};console.log("💾 Sauvegarde du transfert:",ve),s?(await ht(he(H,"stock_transfers",se),ve),L.success("Transfert mis à jour avec succès")):(await Je(he(H,"stock_transfers",se),ve),L.success("Transfert créé avec succès")),e(),t()}catch(q){console.error("❌ Erreur lors de la sauvegarde du transfert:",q),L.error("Erreur lors de la sauvegarde du transfert")}finally{A(!1)}}},oe=async()=>{var $,q,ue;if(!(!(j!=null&&j.establishmentId)||!s)&&window.confirm("Êtes-vous sûr de vouloir compléter ce transfert ? Cette action mettra à jour les stocks et ne pourra pas être annulée.")){A(!0);try{console.log("🚀 Début de la complétion du transfert...");for(const se of m){const ve=he(H,"products",se.productId),ke=await Rs(ve);if(ke.exists()){const me=ke.data(),be=me.storeStock||{},we=be[l]!==void 0?be[l]:($=r.find(B=>B.id===l))!=null&&$.isMainStore?me.stock:0,V=be[u]!==void 0?be[u]:0,pe={...be,[l]:Math.max(0,we-se.quantity),[u]:V+se.quantity},Y=(q=r.find(B=>B.id===l))==null?void 0:q.isMainStore,Ne=(ue=r.find(B=>B.id===u))==null?void 0:ue.isMainStore;let _e=me.stock;Y&&!Ne?_e=Math.max(0,_e-se.quantity):!Y&&Ne&&(_e=_e+se.quantity),await ht(ve,{storeStock:pe,stock:_e,updatedAt:Q.now()}),console.log(`📦 Stock mis à jour pour ${se.productName}:`,{source:`${we} → ${pe[l]}`,destination:`${V} → ${pe[u]}`,global:`${me.stock} → ${_e}`})}}await ht(he(H,"stock_transfers",s.id),{status:"completed",completedById:j.id,completedByName:j.name,completedAt:Q.now(),updatedAt:Q.now()}),console.log("✅ Transfert complété avec succès"),L.success("Transfert complété avec succès ! Les stocks ont été mis à jour."),e(),t()}catch(se){console.error("❌ Erreur lors de la complétion du transfert:",se),L.error("Erreur lors de la complétion du transfert")}finally{A(!1)}}},X=async()=>{if(!l||!u){L.error("Veuillez sélectionner les magasins source et destination");return}f(!0),b(!0),setTimeout(()=>{f(!1)},500)},re=S();return R?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-2xl",padding:"lg",children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des données..."})]})})}):n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-5xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[n.jsx(yt,{className:"w-6 h-6 mr-2 text-blue-600"}),s?"Détails du transfert de stock":"Nouveau transfert de stock"]}),n.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:W,className:"p-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(_a,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"État du système"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsxs("p",{children:["• Magasins disponibles: ",r.length]}),n.jsxs("p",{children:["• Produits actifs: ",a.length]}),n.jsxs("p",{children:["• Produits avec stock: ",a.filter($=>E($.id,l)>0).length]}),n.jsxs("p",{children:["• Produits disponibles pour transfert: ",re.length]})]})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin source *"}),n.jsxs("select",{value:l,onChange:$=>{d($.target.value),m.length>0&&(g([]),L.info("Produits retirés du transfert suite au changement de magasin source"))},className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${C.sourceStore?"border-red-300":"border-gray-300"}`,disabled:(s==null?void 0:s.status)==="completed",children:[n.jsx("option",{value:"",children:"Sélectionner un magasin source"}),r.map($=>n.jsxs("option",{value:$.id,children:[$.name," ",$.isMainStore?"(Principal)":""]},$.id))]}),C.sourceStore&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:C.sourceStore})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin destination *"}),n.jsxs("select",{value:u,onChange:$=>h($.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${C.destinationStore?"border-red-300":"border-gray-300"}`,disabled:(s==null?void 0:s.status)==="completed",children:[n.jsx("option",{value:"",children:"Sélectionner un magasin destination"}),r.filter($=>$.id!==l).map($=>n.jsxs("option",{value:$.id,children:[$.name," ",$.isMainStore?"(Principal)":""]},$.id))]}),C.destinationStore&&n.jsx("p",{className:"mt-1 text-sm text-red-600",children:C.destinationStore})]}),n.jsx("div",{className:"mx-4 flex items-center justify-center",children:n.jsx(l1,{className:"w-6 h-6 text-blue-500"})})]})]}),(!l||!u)&&n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Sélection requise"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Veuillez sélectionner les magasins source et destination avant d'ajouter des produits au transfert."})]})]})}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Produits à transférer (",m.length,")"]}),l&&u&&(s==null?void 0:s.status)!=="completed"&&n.jsxs(O,{type:"button",variant:"primary",size:"sm",onClick:X,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Ajouter un produit"]})]}),C.items&&n.jsx("p",{className:"mt-1 text-sm text-red-600 mb-4",children:C.items}),m.length===0?n.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[n.jsx(yt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun produit sélectionné"}),n.jsx("p",{className:"text-gray-500 mb-4",children:!l||!u?"Sélectionnez d'abord les magasins source et destination":'Cliquez sur "Ajouter un produit" pour commencer le transfert'}),l&&u&&(s==null?void 0:s.status)!=="completed"&&n.jsxs(O,{type:"button",onClick:X,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Sélectionner des produits"]})]}):n.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),n.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock source"}),n.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité à transférer"}),n.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map($=>{const q=a.find(se=>se.id===$.productId),ue=q?E(q.id,l):0;return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:n.jsx(yt,{className:"h-5 w-5 text-blue-600"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:$.productName}),n.jsxs("div",{className:"text-sm text-gray-500",children:["Réf: ",q==null?void 0:q.reference]})]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:n.jsxs("span",{className:`text-sm font-medium ${ue>0?"text-green-600":"text-red-600"}`,children:[ue," ",$.unit]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:(s==null?void 0:s.status)==="completed"?n.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[$.quantity," ",$.unit]}):n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("button",{type:"button",onClick:()=>U($.id,Math.max(1,$.quantity-1)),className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",disabled:$.quantity<=1,children:n.jsx(Fd,{className:"w-4 h-4 text-gray-600"})}),n.jsx("input",{type:"number",min:"1",max:ue,value:$.quantity,onChange:se=>U($.id,parseInt(se.target.value)||1),className:"w-20 px-2 py-1 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),n.jsx("button",{type:"button",onClick:()=>U($.id,Math.min(ue,$.quantity+1)),className:"p-1 rounded-full bg-blue-100 hover:bg-blue-200 transition-colors",disabled:$.quantity>=ue,children:n.jsx(Ct,{className:"w-4 h-4 text-blue-600"})}),n.jsx("span",{className:"text-sm text-gray-500 ml-2",children:$.unit})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:(s==null?void 0:s.status)!=="completed"&&n.jsx("button",{type:"button",onClick:()=>z($.id),className:"text-red-600 hover:text-red-900 transition-colors p-2 hover:bg-red-50 rounded-lg",title:"Supprimer ce produit",children:n.jsx(cs,{className:"w-4 h-4"})})})]},$.id)})})]})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optionnel)"}),n.jsx("textarea",{value:x,onChange:$=>y($.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Informations supplémentaires sur ce transfert...",disabled:(s==null?void 0:s.status)==="completed"})]}),s&&n.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center",children:[s.status==="pending"?n.jsx(ks,{className:"w-5 h-5 text-yellow-600 mr-2"}):s.status==="completed"?n.jsx(zt,{className:"w-5 h-5 text-green-600 mr-2"}):n.jsx(vt,{className:"w-5 h-5 text-red-600 mr-2"}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Statut du transfert"}),n.jsx("p",{className:"text-sm text-gray-500",children:s.status==="pending"?"En attente de validation":s.status==="completed"?"Transfert complété avec succès":"Transfert annulé"})]})]}),n.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="completed"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="pending"?"En attente":s.status==="completed"?"Complété":"Annulé"})]}),s.status==="completed"&&s.completedAt&&n.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Complété le ",new Date(s.completedAt.seconds*1e3).toLocaleDateString(),"par ",s.completedByName]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:t,disabled:T,children:"Fermer"}),(s==null?void 0:s.status)==="pending"&&m.length>0&&n.jsx(O,{type:"button",variant:"success",onClick:oe,disabled:T,children:T?"Traitement...":"Compléter le transfert"}),!s&&n.jsx(O,{type:"submit",disabled:T||!l||!u||m.length===0,children:T?"Enregistrement...":"Créer le transfert"})]})]}),v&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-4xl max-h-[80vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Ps,{className:"w-5 h-5 mr-2 text-blue-600"}),"Sélectionner des produits à transférer"]}),n.jsx("button",{onClick:()=>{b(!1),P("")},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-6",children:[n.jsx("div",{className:"mb-6",children:n.jsx(xe,{placeholder:"Rechercher par nom, référence ou code-barres...",value:D,onChange:$=>P($.target.value),leftIcon:n.jsx(Ps,{className:"w-4 h-4 text-gray-400"})})}),n.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:N?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des produits..."})]}):re.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(yt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:l?a.length===0?"Aucun produit disponible":D?"Aucun produit trouvé":"Aucun produit avec stock disponible":"Magasin source requis"}),n.jsx("p",{className:"text-gray-500 mb-4",children:l?a.length===0?'Créez des produits dans la section "Produits"':D?"Aucun produit ne correspond à votre recherche":"Aucun produit n'a de stock disponible dans le magasin source":"Sélectionnez d'abord un magasin source"}),n.jsxs("div",{className:"mt-4 text-sm text-gray-400 space-y-1",children:[n.jsx("p",{children:n.jsx("strong",{children:"Statistiques :"})}),n.jsxs("p",{children:["• Magasins actifs: ",r.length]}),n.jsxs("p",{children:["• Produits actifs: ",a.length]}),n.jsxs("p",{children:["• Magasin source: ",((Z=r.find($=>$.id===l))==null?void 0:Z.name)||"Non sélectionné"]}),l&&n.jsxs("p",{children:["• Produits avec stock dans ce magasin: ",a.filter($=>E($.id,l)>0).length]})]})]}):re.map($=>{const q=E($.id,l);return n.jsxs("div",{className:"flex items-center justify-between p-4 bg-white hover:bg-blue-50 rounded-lg cursor-pointer transition-all duration-200 border border-gray-200 hover:border-blue-300 hover:shadow-md",onClick:()=>ee($.id),children:[n.jsxs("div",{className:"flex items-center flex-1",children:[n.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:n.jsx(yt,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-medium text-gray-900",children:$.name}),n.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[n.jsxs("span",{children:["Réf: ",$.reference]}),$.barcode&&n.jsxs("span",{className:"font-mono",children:["Code: ",$.barcode]})]})]})]}),n.jsx("div",{className:"text-right",children:n.jsxs("div",{className:"flex items-center",children:[n.jsxs("div",{className:"text-right mr-4",children:[n.jsx("p",{className:"text-lg font-bold text-green-600",children:q}),n.jsxs("p",{className:"text-xs text-gray-500",children:[$.unit," disponible(s)"]})]}),n.jsxs(O,{type:"button",size:"sm",onClick:ue=>{ue.stopPropagation(),ee($.id)},className:"ml-2",children:[n.jsx(Ct,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]})})]},$.id)})}),n.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-gray-200",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:[re.length," produit(s) disponible(s) pour le transfert",D&&` (recherche: "${D}")`]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(O,{variant:"ghost",onClick:()=>P(""),disabled:!D,children:"Effacer recherche"}),n.jsx(O,{variant:"ghost",onClick:()=>{b(!1),P("")},children:"Fermer"})]})]})]})]})})]})})},kD=({readOnly:t=!1})=>{const[e,s]=I.useState([]),[r,i]=I.useState(!0),[a,o]=I.useState(""),[l,d]=I.useState("all"),[u,h]=I.useState(!1),[m,g]=I.useState(null),[x,y]=I.useState(!1),{user:R}=Fe(),_=async()=>{if(R!=null&&R.establishmentId)try{i(!0),y(!1);try{const v=Ae(Ee(H,"stock_transfers"),ce("establishmentId","==",R.establishmentId),Na("createdAt","desc")),N=(await Ie(v)).docs.map(f=>{var E;const j=f.data();return{id:f.id,establishmentId:j.establishmentId,sourceStoreId:j.sourceStoreId,sourceStoreName:j.sourceStoreName,destinationStoreId:j.destinationStoreId,destinationStoreName:j.destinationStoreName,items:j.items,status:j.status,notes:j.notes,createdById:j.createdById,createdByName:j.createdByName,completedById:j.completedById,completedByName:j.completedByName,createdAt:j.createdAt.toDate(),completedAt:(E=j.completedAt)==null?void 0:E.toDate(),updatedAt:j.updatedAt.toDate()}});s(N)}catch(v){if(v.code==="failed-precondition"&&v.message.includes("index")){y(!0),console.warn("Index composite requis pour les transferts. Chargement des données alternatives...");const b=Ae(Ee(H,"stock_transfers"),ce("establishmentId","==",R.establishmentId)),f=(await Ie(b)).docs.map(j=>{var S;const E=j.data();return{id:j.id,establishmentId:E.establishmentId,sourceStoreId:E.sourceStoreId,sourceStoreName:E.sourceStoreName,destinationStoreId:E.destinationStoreId,destinationStoreName:E.destinationStoreName,items:E.items,status:E.status,notes:E.notes,createdById:E.createdById,createdByName:E.createdByName,completedById:E.completedById,completedByName:E.completedByName,createdAt:E.createdAt.toDate(),completedAt:(S=E.completedAt)==null?void 0:S.toDate(),updatedAt:E.updatedAt.toDate()}});f.sort((j,E)=>E.createdAt.getTime()-j.createdAt.getTime()),s(f)}else throw v}}catch(v){console.error("Erreur lors du chargement des transferts:",v),L.error("Erreur lors du chargement des transferts")}finally{i(!1)}};I.useEffect(()=>{_()},[R==null?void 0:R.establishmentId]);const T=e.filter(v=>{const b=v.sourceStoreName.toLowerCase().includes(a.toLowerCase())||v.destinationStoreName.toLowerCase().includes(a.toLowerCase())||v.createdByName.toLowerCase().includes(a.toLowerCase()),N=l==="all"||v.status===l;return b&&N}),A=v=>{switch(v){case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=v=>{switch(v){case"pending":return n.jsx(ks,{className:"w-4 h-4 text-yellow-600"});case"completed":return n.jsx(zt,{className:"w-4 h-4 text-green-600"});case"cancelled":return n.jsx(aa,{className:"w-4 h-4 text-red-600"});default:return n.jsx(ks,{className:"w-4 h-4 text-gray-600"})}},k=v=>{switch(v){case"pending":return"En attente";case"completed":return"Complété";case"cancelled":return"Annulé";default:return v}},D=v=>{g(v),h(!0)},P=()=>{g(null),h(!0)};return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transferts de Stock"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez les mouvements de stock entre vos différents magasins"})]}),!t&&n.jsxs(O,{onClick:P,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Nouveau transfert"]})]}),t&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les transferts mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),n.jsxs(K,{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx("div",{className:"md:col-span-2",children:n.jsx(xe,{placeholder:"Rechercher par magasin ou créateur...",value:a,onChange:v=>o(v.target.value),leftIcon:n.jsx(Ps,{className:"w-5 h-5 text-gray-400"})})}),n.jsxs("select",{value:l,onChange:v=>d(v.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"all",children:"Tous les statuts"}),n.jsx("option",{value:"pending",children:"En attente"}),n.jsx("option",{value:"completed",children:"Complétés"}),n.jsx("option",{value:"cancelled",children:"Annulés"})]})]}),n.jsxs("div",{className:"flex justify-between items-center mt-4",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:[T.length," transfert(s) trouvé(s)"]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:_,disabled:r,children:[n.jsx(Zs,{className:`w-4 h-4 mr-2 ${r?"animate-spin":""}`}),"Actualiser"]})]})]}),r?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des transferts..."})]})}):T.length===0?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Cs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun transfert trouvé"}),n.jsx("p",{className:"text-gray-500 mb-6",children:a||l!=="all"?"Aucun transfert ne correspond à vos critères de recherche":"Commencez par créer votre premier transfert de stock"}),!t&&n.jsxs(O,{onClick:P,children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Créer un transfert"]})]})}):n.jsx("div",{className:"space-y-4",children:T.map(v=>n.jsxs(K,{padding:"md",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[n.jsxs("div",{className:"flex items-start space-x-4",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:n.jsx(Cs,{className:"w-6 h-6 text-blue-600"})})}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("h3",{className:"font-medium text-gray-900",children:v.sourceStoreName}),n.jsx(l1,{className:"mx-2 text-gray-400"}),n.jsx("h3",{className:"font-medium text-gray-900",children:v.destinationStoreName})]}),n.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[n.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${A(v.status)}`,children:[C(v.status),n.jsx("span",{className:"ml-1",children:k(v.status)})]}),n.jsxs("span",{className:"text-sm text-gray-500",children:[v.items.length," produit(s)"]})]}),n.jsxs("div",{className:"flex items-center mt-1 text-xs text-gray-500",children:[n.jsx(kt,{className:"w-3 h-3 mr-1"}),"Créé le ",v.createdAt.toLocaleDateString()," par ",v.createdByName]})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>D(v),children:[n.jsx(Bs,{className:"w-4 h-4 mr-2"}),"Détails"]}),v.status==="pending"&&!t&&n.jsxs(O,{variant:"success",size:"sm",onClick:()=>D(v),children:[n.jsx(zt,{className:"w-4 h-4 mr-2"}),"Compléter"]})]})]}),n.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[n.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Produits transférés:"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:[v.items.slice(0,3).map(b=>n.jsxs("div",{className:"flex items-center p-2 bg-gray-50 rounded-lg",children:[n.jsx(yt,{className:"w-4 h-4 text-gray-500 mr-2"}),n.jsxs("div",{className:"flex-1 truncate",children:[n.jsx("span",{className:"font-medium text-gray-900",children:b.productName}),n.jsxs("span",{className:"ml-2 text-gray-500",children:[b.quantity," ",b.unit]})]})]},b.id)),v.items.length>3&&n.jsx("div",{className:"flex items-center p-2 bg-gray-50 rounded-lg",children:n.jsxs("span",{className:"text-sm text-gray-500",children:["+",v.items.length-3," autres produits"]})})]})]})]},v.id))}),u&&n.jsx(ID,{onClose:()=>{h(!1),g(null)},onSuccess:_,existingTransfer:m})]})},lg=I.createContext(null),CD=({value:t,onValueChange:e,children:s,className:r=""})=>n.jsx(lg.Provider,{value:{activeValue:t,onChange:e},children:n.jsx("div",{className:r,children:s})}),TD=({children:t,className:e=""})=>n.jsx("div",{className:`inline-flex p-1 bg-gray-100 rounded-lg ${e}`,children:t}),rv=({value:t,children:e,className:s="",disabled:r=!1})=>{const i=I.useContext(lg);if(!i)throw new Error("TabsTrigger must be used within a Tabs component");const{activeValue:a,onChange:o}=i,l=a===t;return n.jsx("button",{type:"button",role:"tab","aria-selected":l,disabled:r,onClick:()=>o(t),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${l?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"} ${r?"opacity-50 cursor-not-allowed":""} ${s}`,children:e})},iv=({value:t,children:e,className:s=""})=>{const r=I.useContext(lg);if(!r)throw new Error("TabsContent must be used within a Tabs component");const{activeValue:i}=r;return i!==t?null:n.jsx("div",{role:"tabpanel",className:s,children:e})},RD=()=>{const[t,e]=I.useState("stores"),{user:s}=Fe(),r=(s==null?void 0:s.role)==="reader";return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion Multi-Magasins"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos différents points de vente et les transferts de stock entre eux"})]}),r&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les magasins et les transferts mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),n.jsxs(CD,{value:t,onValueChange:e,children:[n.jsxs(TD,{children:[n.jsxs(rv,{value:"stores",className:"flex items-center",children:[n.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Magasins"]}),n.jsxs(rv,{value:"transfers",className:"flex items-center",children:[n.jsx(b5,{className:"w-4 h-4 mr-2"}),"Transferts de stock"]})]}),n.jsx(iv,{value:"stores",className:"mt-6",children:n.jsx(AD,{readOnly:r})}),n.jsx(iv,{value:"transfers",className:"mt-6",children:n.jsx(kD,{readOnly:r})})]})]})},PD=({isOpen:t,onToggleRegister:e})=>{var pe;const[s,r]=I.useState(1e5),[i,a]=I.useState(245500),[o,l]=I.useState(""),[d,u]=I.useState(""),[h,m]=I.useState(!1),[g,x]=I.useState(!1),[y,R]=I.useState(""),[_,T]=I.useState([]),[A,C]=I.useState("today"),[k,D]=I.useState("summary"),[P,v]=I.useState({totalRevenue:0,totalExpenses:0,netProfit:0,salesCount:0,expensesCount:0}),[b,N]=I.useState(!1),[f,j]=I.useState(""),[E,S]=I.useState(!1),[ee,U]=I.useState([]),{user:z}=Fe(),J=(z==null?void 0:z.role)==="reader",W=async()=>{if(z!=null&&z.establishmentId)try{const Y=Ae(Ee(H,"stores"),ce("establishmentId","==",z.establishmentId),ce("isActive","==",!0)),_e=(await Ie(Y)).docs.map(ae=>{const Ce=ae.data();return{id:ae.id,name:Ce.name,isMainStore:Ce.isMainStore||!1}});U(_e);const B=_e.find(ae=>ae.isMainStore);B?j(B.id):_e.length>0&&j(_e[0].id),_e.length>1&&!t&&S(!0)}catch(Y){console.error("Erreur lors du chargement des magasins:",Y)}},oe=async()=>{if(!(!(z!=null&&z.establishmentId)||!f)){N(!0);try{const{startDate:Y,endDate:Ne}=X(A);let _e=[];try{const Be=Ae(Ee(H,"sales"),ce("establishmentId","==",z.establishmentId),ce("storeId","==",f),ce("createdAt",">=",Q.fromDate(Y)),ce("createdAt","<=",Q.fromDate(Ne)),ce("status","==","completed"),Na("createdAt","desc"));_e=(await Ie(Be)).docs.map(ct=>{const $e=ct.data();return{id:ct.id,type:"sale",amount:$e.total,description:`Vente ${$e.receiptNumber}`,paymentMethod:$e.paymentMethod,time:$e.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:$e.createdAt.toDate(),category:"Vente"}})}catch{console.warn("Index composite non disponible, utilisation d'une requête simplifiée pour les ventes");const Re=Ae(Ee(H,"sales"),ce("establishmentId","==",z.establishmentId),ce("storeId","==",f),ce("status","==","completed"));_e=(await Ie(Re)).docs.map($e=>{const We=$e.data(),st=We.createdAt.toDate();return st>=Y&&st<=Ne?{id:$e.id,type:"sale",amount:We.total,description:`Vente ${We.receiptNumber}`,paymentMethod:We.paymentMethod,time:st.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:st,category:"Vente"}:null}).filter(Boolean).sort(($e,We)=>We.date.getTime()-$e.date.getTime())}let B=[];try{const Be=Ae(Ee(H,"expenses"),ce("establishmentId","==",z.establishmentId),ce("storeId","==",f),ce("createdAt",">=",Q.fromDate(Y)),ce("createdAt","<=",Q.fromDate(Ne)),ce("status","==","paid"),Na("createdAt","desc"));B=(await Ie(Be)).docs.map(ct=>{const $e=ct.data();return{id:ct.id,type:"expense",amount:-$e.amount,description:$e.title,paymentMethod:$e.paymentMethod,time:$e.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:$e.createdAt.toDate(),category:$e.categoryName}})}catch{console.warn("Index composite non disponible, utilisation d'une requête simplifiée pour les dépenses");const Re=Ae(Ee(H,"expenses"),ce("establishmentId","==",z.establishmentId),ce("storeId","==",f),ce("status","==","paid"));B=(await Ie(Re)).docs.map($e=>{const We=$e.data(),st=We.createdAt.toDate();return st>=Y&&st<=Ne?{id:$e.id,type:"expense",amount:-We.amount,description:We.title,paymentMethod:We.paymentMethod,time:st.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:st,category:We.categoryName}:null}).filter(Boolean).sort(($e,We)=>We.date.getTime()-$e.date.getTime())}try{const Be=he(H,"cash_registers",`${z.establishmentId}_${f}`),Re=await Rs(Be);if(Re.exists()){const ct=Re.data();ct.status==="open"?(a(ct.currentAmount||0),r(ct.openingAmount||0)):(a(0),r(1e5))}}catch(Be){console.error("Erreur lors du chargement de l'état de la caisse:",Be)}const ae=[..._e,...B].sort((Be,Re)=>Re.date.getTime()-Be.date.getTime());T(ae);const Ce=_e.reduce((Be,Re)=>Be+Re.amount,0),ze=Math.abs(B.reduce((Be,Re)=>Be+Re.amount,0)),Ye=Ce-ze;v({totalRevenue:Ce,totalExpenses:ze,netProfit:Ye,salesCount:_e.length,expensesCount:B.length})}catch(Y){console.error("Erreur lors du chargement des données financières:",Y),L.error("Erreur lors du chargement des données. Veuillez créer les index Firestore requis."),L.error("Pour résoudre ce problème, créez les index composites dans la console Firebase.",{duration:8e3})}finally{N(!1)}}};I.useEffect(()=>{W()},[z==null?void 0:z.establishmentId]),I.useEffect(()=>{f&&oe()},[A,f,z==null?void 0:z.establishmentId]);const X=Y=>{const Ne=new Date;let _e,B=new Date(Ne.getFullYear(),Ne.getMonth(),Ne.getDate(),23,59,59);switch(Y){case"today":_e=new Date(Ne.getFullYear(),Ne.getMonth(),Ne.getDate(),0,0,0);break;case"yesterday":const ae=new Date(Ne);ae.setDate(ae.getDate()-1),_e=new Date(ae.getFullYear(),ae.getMonth(),ae.getDate(),0,0,0),B=new Date(ae.getFullYear(),ae.getMonth(),ae.getDate(),23,59,59);break;case"week":_e=new Date(Ne),_e.setDate(Ne.getDate()-7),_e.setHours(0,0,0,0);break;case"month":_e=new Date(Ne.getFullYear(),Ne.getMonth(),1,0,0,0);break;case"year":_e=new Date(Ne.getFullYear(),0,1,0,0,0);break;default:_e=new Date(Ne.getFullYear(),Ne.getMonth(),Ne.getDate(),0,0,0)}return{startDate:_e,endDate:B}},re=Y=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(Y).replace("MGA","Ar"),Z=Y=>({today:"Aujourd'hui",yesterday:"Hier",week:"Cette semaine",month:"Ce mois",year:"Cette année"})[Y]||Y,$=async()=>{if(!f){L.error("Veuillez sélectionner un magasin");return}if(s<=0){L.error("Le montant d'ouverture doit être supérieur à 0");return}if(!(z!=null&&z.establishmentId)){L.error("Établissement non trouvé");return}try{const Y={id:`mov_${Date.now()}`,type:"opening",amount:s,description:"Ouverture de caisse",paymentMethod:"cash",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};T([Y,..._]),a(s);const Ne=`${z.establishmentId}_${f}`;await Je(he(H,"cash_registers",Ne),{id:Ne,establishmentId:z.establishmentId,storeId:f,cashierId:z.id,cashierName:z.name,openingAmount:s,currentAmount:s,openedAt:Q.now(),status:"open",movements:[{id:Y.id,type:Y.type,amount:Y.amount,description:Y.description,paymentMethod:Y.paymentMethod,createdAt:Q.now()}]}),e(),L.success("Caisse ouverte avec succès")}catch(Y){console.error("Erreur lors de l'ouverture de la caisse:",Y),L.error("Erreur lors de l'ouverture de la caisse")}},q=async()=>{if(!(z!=null&&z.establishmentId)||!f){L.error("Informations manquantes");return}try{const Y=i,Ne=`${z.establishmentId}_${f}`;await Je(he(H,"cash_registers",Ne),{status:"closed",closingAmount:Y,closedAt:Q.now(),updatedAt:Q.now()},{merge:!0}),L.success(`Caisse fermée. Total: ${re(Y)}`),e()}catch(Y){console.error("Erreur lors de la fermeture de la caisse:",Y),L.error("Erreur lors de la fermeture de la caisse")}},ue=()=>{if(J){L.error("Vous n'avez pas les permissions nécessaires pour ajuster les fonds");return}const Y=parseFloat(o);if(isNaN(Y)||Y===0){L.error("Montant invalide");return}if(!d.trim()){L.error("Raison requise");return}const Ne={id:`mov_${Date.now()}`,type:"adjustment",amount:Y,description:d,paymentMethod:"cash",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};T([Ne,..._]),a(_e=>_e+Y),l(""),u(""),m(!1),L.success(Y>0?"Fonds ajoutés":"Fonds retirés")},se=Y=>{if(J){L.error("Vous n'avez pas les permissions nécessaires pour effectuer des retraits");return}if(Y>i){L.error("Fonds insuffisants en caisse");return}const Ne={id:`mov_${Date.now()}`,type:"withdrawal",amount:-Y,description:`Retrait de ${re(Y)}`,paymentMethod:"cash",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};T([Ne,..._]),a(_e=>_e-Y),L.success("Retrait effectué")},ve=()=>{if(J){L.error("Vous n'avez pas les permissions nécessaires pour réinitialiser la caisse");return}if(!y.trim()){L.error("Veuillez indiquer une raison pour la réinitialisation");return}const Y={id:`mov_${Date.now()}`,type:"reset",amount:-i,description:`Réinitialisation de caisse: ${y}`,paymentMethod:"system",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};T([Y,..._]),a(0),x(!1),R(""),L.success("Solde de caisse réinitialisé avec succès")},ke=Y=>{switch(Y){case"sale":return n.jsx(wn,{className:"w-4 h-4 text-green-600"});case"expense":return n.jsx(vi,{className:"w-4 h-4 text-red-600"});case"adjustment":return n.jsx(Qy,{className:"w-4 h-4 text-blue-600"});case"withdrawal":return n.jsx(Fd,{className:"w-4 h-4 text-orange-600"});case"opening":return n.jsx(Jy,{className:"w-4 h-4 text-purple-600"});case"reset":return n.jsx(Zs,{className:"w-4 h-4 text-red-600"});default:return n.jsx(Tt,{className:"w-4 h-4 text-gray-600"})}},me=Y=>Y>=0?"text-green-600":"text-red-600",be=()=>{const Y=[["Type","Description","Catégorie","Montant","Méthode","Date","Heure"],..._.map(ae=>[ae.type==="sale"?"Recette":ae.type==="expense"?"Dépense":ae.type==="adjustment"?"Ajustement":ae.type==="withdrawal"?"Retrait":ae.type==="opening"?"Ouverture":ae.type==="reset"?"Réinitialisation":ae.type,ae.description,ae.category||"",Math.abs(ae.amount),ae.paymentMethod,ae.date.toLocaleDateString("fr-FR"),ae.time])].map(ae=>ae.join(",")).join(`
`),Ne=new Blob([Y],{type:"text/csv"}),_e=window.URL.createObjectURL(Ne),B=document.createElement("a");B.href=_e,B.download=`rapport_financier_${A}_${new Date().toISOString().split("T")[0]}.csv`,B.click(),window.URL.revokeObjectURL(_e),L.success("Rapport exporté avec succès")},we=()=>n.jsxs("div",{className:"space-y-6",children:[_.length===0&&!b&&n.jsx(K,{padding:"md",className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(kt,{className:"w-5 h-5 text-yellow-600 mt-0.5"})}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Configuration requise"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Pour afficher les données financières complètes, veuillez créer les index composites Firestore requis dans votre console Firebase."}),n.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:"Les données locales de la caisse restent disponibles."})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsx(K,{padding:"md",className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:n.jsx(wn,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-green-700",children:"Recettes totales"}),n.jsx("p",{className:"text-2xl font-bold text-green-900",children:re(P.totalRevenue)}),n.jsxs("p",{className:"text-xs text-green-600",children:[P.salesCount," vente(s)"]})]})]})}),n.jsx(K,{padding:"md",className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 bg-red-500 rounded-lg",children:n.jsx(vi,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-red-700",children:"Dépenses totales"}),n.jsx("p",{className:"text-2xl font-bold text-red-900",children:re(P.totalExpenses)}),n.jsxs("p",{className:"text-xs text-red-600",children:[P.expensesCount," dépense(s)"]})]})]})}),n.jsx(K,{padding:"md",className:`bg-gradient-to-br ${i>=0?"from-blue-50 to-blue-100 border-blue-200":"from-orange-50 to-orange-100 border-orange-200"}`,children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:`p-3 rounded-lg ${i>=0?"bg-blue-500":"bg-orange-500"}`,children:n.jsx(Qy,{className:"w-6 h-6 text-white"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:`text-sm font-medium ${i>=0?"text-blue-700":"text-orange-700"}`,children:"Solde de caisse"}),n.jsx("p",{className:`text-2xl font-bold ${i>=0?"text-blue-900":"text-orange-900"}`,children:re(i)}),n.jsx("p",{className:`text-xs ${i>=0?"text-blue-600":"text-orange-600"}`,children:"Montant disponible"})]})]})})]}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Répartition financière"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-sm font-medium text-green-700",children:"Recettes"}),n.jsx("span",{className:"text-sm text-green-600",children:re(P.totalRevenue)})]}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:n.jsx("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-500",style:{width:P.totalRevenue>0?`${P.totalRevenue/(P.totalRevenue+P.totalExpenses)*100}%`:"0%"}})})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-sm font-medium text-red-700",children:"Dépenses"}),n.jsx("span",{className:"text-sm text-red-600",children:re(P.totalExpenses)})]}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:n.jsx("div",{className:"bg-red-500 h-3 rounded-full transition-all duration-500",style:{width:P.totalExpenses>0?`${P.totalExpenses/(P.totalRevenue+P.totalExpenses)*100}%`:"0%"}})})]})]})]})]}),V=()=>n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Mouvements financiers - ",Z(A)]}),n.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:_.length===0?n.jsxs("div",{className:"text-center py-8 text-gray-500",children:[n.jsx(nn,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),n.jsx("p",{children:"Aucun mouvement pour cette période"}),n.jsx("p",{className:"text-sm mt-2",children:"Les données Firestore nécessitent la création d'index composites"})]}):_.map(Y=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[ke(Y.type),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-sm",children:Y.description}),n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[n.jsx("span",{children:Y.paymentMethod}),n.jsx("span",{children:"•"}),n.jsx("span",{children:Y.time}),Y.category&&n.jsxs(n.Fragment,{children:[n.jsx("span",{children:"•"}),n.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full",children:Y.category})]})]})]})]}),n.jsx("div",{className:"text-right",children:n.jsxs("p",{className:`font-semibold ${me(Y.amount)}`,children:[Y.amount>=0?"+":"",re(Math.abs(Y.amount))]})})]},Y.id))})]});return t?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion Financière"}),n.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:"Caisse ouverte"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[n.jsxs("div",{className:"flex items-center bg-blue-50 px-3 py-1 rounded-lg border border-blue-200",children:[n.jsx(Cs,{className:"w-4 h-4 text-blue-600 mr-2"}),n.jsx("span",{className:"text-sm font-medium text-blue-800",children:((pe=ee.find(Y=>Y.id===f))==null?void 0:pe.name)||"Magasin"}),n.jsx(O,{variant:"ghost",size:"sm",className:"ml-2 text-blue-600 hover:bg-blue-100 p-1",onClick:()=>S(!0),children:n.jsx(Zs,{className:"w-3 h-3"})})]}),n.jsxs("select",{value:A,onChange:Y=>C(Y.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"today",children:"Aujourd'hui"}),n.jsx("option",{value:"yesterday",children:"Hier"}),n.jsx("option",{value:"week",children:"Cette semaine"}),n.jsx("option",{value:"month",children:"Ce mois"}),n.jsx("option",{value:"year",children:"Cette année"})]}),n.jsxs(O,{variant:"ghost",onClick:be,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),n.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[n.jsxs("button",{onClick:()=>D("summary"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${k==="summary"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[n.jsx(Tu,{className:"w-4 h-4 inline mr-2"}),"Résumé"]}),n.jsxs("button",{onClick:()=>D("movements"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${k==="movements"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[n.jsx(nn,{className:"w-4 h-4 inline mr-2"}),"Mouvements"]})]}),b?n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des données financières..."})]}):n.jsxs(n.Fragment,{children:[k==="summary"&&we(),k==="movements"&&V()]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"État de la caisse"}),n.jsx("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200 mb-4",children:n.jsxs("div",{className:"flex items-center justify-center",children:[n.jsx(R5,{className:"w-10 h-10 text-blue-600 mr-4"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Solde actuel"}),n.jsx("p",{className:"text-3xl font-bold text-blue-900",children:re(i)})]})]})}),n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Pl,{className:"w-5 h-5 text-green-600 mr-3"}),n.jsx("p",{className:"text-sm font-medium",children:"Espèces en caisse"})]}),n.jsx("p",{className:"font-semibold",children:re(i)})]})]}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions rapides"}),n.jsxs("div",{className:"space-y-3",children:[!J&&n.jsxs(n.Fragment,{children:[n.jsxs(O,{fullWidth:!0,variant:"success",onClick:()=>m(!0),children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Ajuster fonds"]}),n.jsxs(O,{fullWidth:!0,variant:"warning",onClick:()=>se(5e4),children:[n.jsx(Fd,{className:"w-4 h-4 mr-2"}),"Retrait rapide (50,000 Ar)"]}),n.jsxs(O,{fullWidth:!0,variant:"ghost",children:[n.jsx(Dl,{className:"w-4 h-4 mr-2"}),"Imprimer rapport"]}),n.jsxs(O,{fullWidth:!0,variant:"danger",onClick:()=>x(!0),children:[n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Réinitialiser solde"]})]}),n.jsxs(O,{fullWidth:!0,variant:"danger",onClick:q,children:[n.jsx(os,{className:"w-4 h-4 mr-2"}),"Fermer caisse"]})]})]})]}),h&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ajustement de caisse"}),n.jsxs("div",{className:"space-y-4",children:[n.jsx(xe,{label:"Montant (Ar)",type:"number",value:o,onChange:Y=>l(Y.target.value),placeholder:"Montant positif ou négatif",leftIcon:n.jsx(Tt,{className:"w-4 h-4"})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Raison de l'ajustement"}),n.jsx("textarea",{value:d,onChange:Y=>u(Y.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Erreur de caisse, monnaie rendue incorrecte..."})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>m(!1),children:"Annuler"}),n.jsx(O,{onClick:ue,children:"Confirmer"})]})]})}),g&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(kr,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Réinitialiser le solde de caisse"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Cette action va remettre à zéro le solde de la caisse. Cette opération est irréversible."})]}),n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(kr,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Attention"}),n.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["Le solde actuel de ",re(i)," sera remis à zéro. Un mouvement de caisse sera enregistré pour tracer cette opération."]})]})]})}),n.jsx("div",{className:"space-y-4 mb-6",children:n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Raison de la réinitialisation *"}),n.jsx("textarea",{value:y,onChange:Y=>R(Y.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Clôture de journée, correction d'erreur...",required:!0})]})}),n.jsxs("div",{className:"flex justify-end gap-3",children:[n.jsx(O,{variant:"ghost",onClick:()=>x(!1),children:"Annuler"}),n.jsx(O,{variant:"danger",onClick:ve,disabled:!y.trim(),children:"Réinitialiser"})]})]})}),E&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-md",padding:"lg",children:n.jsx(f1,{onStoreSelect:Y=>{j(Y),S(!1),oe()},selectedStore:f,onClose:()=>S(!1)})})})]}):n.jsxs(K,{className:"max-w-md mx-auto",padding:"lg",children:[n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(os,{className:"w-8 h-8 text-blue-600"})}),n.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Ouverture de Caisse"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Sélectionnez un magasin et saisissez le montant d'ouverture"})]}),n.jsxs("div",{className:"space-y-4",children:[ee.length>0?n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin *"}),n.jsxs("select",{value:f,onChange:Y=>j(Y.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"",children:"Sélectionner un magasin"}),ee.map(Y=>n.jsxs("option",{value:Y.id,children:[Y.name," ",Y.isMainStore?"(Principal)":""]},Y.id))]})]}):n.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(kr,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Aucun magasin disponible"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:`Veuillez créer au moins un magasin dans la section "Magasins" avant d'ouvrir une caisse.`})]})]})}),n.jsx(xe,{label:"Montant d'ouverture (Ar)",type:"number",value:s,onChange:Y=>r(Number(Y.target.value)),leftIcon:n.jsx(Tt,{className:"w-4 h-4"}),placeholder:"100000"}),n.jsxs(O,{fullWidth:!0,onClick:$,disabled:!f||ee.length===0,children:[n.jsx(Jy,{className:"w-4 h-4 mr-2"}),"Ouvrir la caisse"]})]})]})},DD=()=>{const[t,e]=I.useState("today"),[s,r]=I.useState({start:new Date().toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[i,a]=I.useState("sales"),[o,l]=I.useState(!1),[d,u]=I.useState(!1),[h,m]=I.useState({totalSales:0,totalExpenses:0,netProfit:0,transactions:0,salesByProduct:[],salesByCategory:[],salesByPaymentMethod:[]}),[g,x]=I.useState(!1),{user:y}=Fe();I.useEffect(()=>{(async()=>{if(y!=null&&y.establishmentId){l(!0),u(!1);try{let f,j;if(g)f=new Date(s.start),f.setHours(0,0,0,0),j=new Date(s.end),j.setHours(23,59,59,999);else{const me=new Date;switch(j=new Date(me),j.setHours(23,59,59,999),t){case"today":f=new Date(me),f.setHours(0,0,0,0);break;case"yesterday":f=new Date(me),f.setDate(f.getDate()-1),f.setHours(0,0,0,0),j=new Date(f),j.setHours(23,59,59,999);break;case"week":f=new Date(me),f.setDate(f.getDate()-7),f.setHours(0,0,0,0);break;case"month":f=new Date(me),f.setMonth(f.getMonth()-1),f.setHours(0,0,0,0);break;case"year":f=new Date(me),f.setFullYear(f.getFullYear()-1),f.setHours(0,0,0,0);break;default:f=new Date(me),f.setHours(0,0,0,0)}}let E=[],S=0,ee=0;try{const me=Ae(Ee(H,"sales"),ce("establishmentId","==",y.establishmentId),ce("status","==","completed"),ce("createdAt",">=",Q.fromDate(f)),ce("createdAt","<=",Q.fromDate(j)));E=(await Ie(me)).docs.map(we=>we.data()),S=E.reduce((we,V)=>we+V.total,0),ee=E.length}catch(me){if(me.code==="failed-precondition"&&me.message.includes("index")){u(!0),console.warn("Index composite requis pour les ventes. Chargement des données alternatives...");const be=Ae(Ee(H,"sales"),ce("establishmentId","==",y.establishmentId)),we=await Ie(be),V=Q.fromDate(f),pe=Q.fromDate(j);E=we.docs.map(Y=>Y.data()).filter(Y=>Y.status==="completed"&&Y.createdAt&&Y.createdAt.toMillis()>=V.toMillis()&&Y.createdAt.toMillis()<=pe.toMillis()),S=E.reduce((Y,Ne)=>Y+Ne.total,0),ee=E.length}else throw me}let U=[],z=0;try{const me=Ae(Ee(H,"expenses"),ce("establishmentId","==",y.establishmentId),ce("status","==","paid"),ce("createdAt",">=",Q.fromDate(f)),ce("createdAt","<=",Q.fromDate(j)));U=(await Ie(me)).docs.map(we=>we.data()),z=U.reduce((we,V)=>we+V.amount,0)}catch(me){if(me.code==="failed-precondition"&&me.message.includes("index")){console.warn("Index composite requis pour les dépenses. Chargement des données alternatives...");const be=Ae(Ee(H,"expenses"),ce("establishmentId","==",y.establishmentId)),we=await Ie(be),V=Q.fromDate(f),pe=Q.fromDate(j);U=we.docs.map(Y=>Y.data()).filter(Y=>Y.status==="paid"&&Y.createdAt&&Y.createdAt.toMillis()>=V.toMillis()&&Y.createdAt.toMillis()<=pe.toMillis()),z=U.reduce((Y,Ne)=>Y+Ne.amount,0)}else throw me}const J={},W=Ae(Ee(H,"products"),ce("establishmentId","==",y.establishmentId)),X=(await Ie(W)).docs.reduce((me,be)=>{const we=be.data();return me[be.id]={name:we.name,purchasePrice:we.purchasePrice||0,salePrice:we.salePrice||0},me},{});for(const me of E)if(me.items&&Array.isArray(me.items))for(const be of me.items){const we=be.productId;J[we]||(J[we]={productId:we,productName:be.productName,quantity:0,totalSales:0,costPrice:0,margin:0,marginPercentage:0}),J[we].quantity+=be.quantity,J[we].totalSales+=be.total;const V=X[we];if(V){const pe=V.purchasePrice*be.quantity;J[we].costPrice+=pe,J[we].margin=J[we].totalSales-J[we].costPrice,J[we].costPrice>0&&(J[we].marginPercentage=J[we].margin/J[we].costPrice*100)}}const re=Object.values(J).sort((me,be)=>be.totalSales-me.totalSales),Z={};for(const me of E){const be=me.paymentMethod||"unknown";Z[be]||(Z[be]={method:be,amount:0,count:0}),Z[be].amount+=me.total,Z[be].count+=1}const $=Object.values(Z).sort((me,be)=>be.amount-me.amount),q={},ue=Ae(Ee(H,"categories"),ce("establishmentId","==",y.establishmentId)),ve=(await Ie(ue)).docs.reduce((me,be)=>(me[be.id]=be.data().name,me),{});for(const me of E)if(me.items&&Array.isArray(me.items))for(const be of me.items){const we=X[be.productId];if(we&&we.categoryId){const V=we.categoryId,pe=ve[V]||"Autre";q[V]||(q[V]={category:pe,amount:0,count:0}),q[V].amount+=be.total,q[V].count+=be.quantity}}const ke=Object.values(q).sort((me,be)=>be.amount-me.amount);m({totalSales:S,totalExpenses:z,netProfit:S-z,transactions:ee,salesByProduct:re,salesByCategory:ke,salesByPaymentMethod:$,startDate:f,endDate:j})}catch(f){console.error("Erreur lors du chargement des données du rapport:",f),L.error("Erreur lors du chargement des données du rapport")}finally{l(!1)}}})()},[y==null?void 0:y.establishmentId,t,g,s]);const R=N=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(N).replace("MGA","Ar"),_=N=>N.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),T=()=>{if(g)return s.start===s.end?`le ${_(new Date(s.start))}`:`du ${_(new Date(s.start))} au ${_(new Date(s.end))}`;switch(t){case"today":return"aujourd'hui";case"yesterday":return"hier";case"week":return"cette semaine";case"month":return"ce mois";case"year":return"cette année";default:return t}},A=(N,f)=>{r(j=>({...j,[N]:f}))},C=()=>{if(x(!g),!g){const N=new Date().toISOString().split("T")[0];r({start:N,end:N})}},k=N=>{let f="",j="";const E=new Date().toISOString().split("T")[0];N==="sales"?(j=`rapport_ventes_${E}.csv`,f=`data:text/csv;charset=utf-8,Produit,Quantité,Ventes Totales,Coût,Marge,Marge (%)
`+h.salesByProduct.map(U=>`"${U.productName}",${U.quantity},${U.totalSales},${U.costPrice},${U.margin},${U.marginPercentage.toFixed(2)}`).join(`
`)):N==="categories"?(j=`rapport_categories_${E}.csv`,f=`data:text/csv;charset=utf-8,Catégorie,Montant,Nombre de ventes
`+h.salesByCategory.map(U=>`"${U.category}",${U.amount},${U.count}`).join(`
`)):N==="payment"?(j=`rapport_paiements_${E}.csv`,f=`data:text/csv;charset=utf-8,Méthode de paiement,Montant,Nombre de transactions
`+h.salesByPaymentMethod.map(U=>`"${U.method}",${U.amount},${U.count}`).join(`
`)):(j=`rapport_complet_${E}.csv`,f=`data:text/csv;charset=utf-8,Période,Ventes Totales,Dépenses Totales,Bénéfice Net,Transactions
"${T()}",${h.totalSales},${h.totalExpenses},${h.netProfit},${h.transactions}`);const S=encodeURI(f),ee=document.createElement("a");ee.setAttribute("href",S),ee.setAttribute("download",j),document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),L.success("Rapport exporté avec succès")},D=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Récapitulatif des ventes ",T()]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ventes"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Coût"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Marge"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Marge (%)"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.salesByProduct.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"Aucune vente pour cette période"})}):h.salesByProduct.map((N,f)=>n.jsxs("tr",{className:f%2===0?"bg-white":"bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:N.productName}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:N.quantity}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:R(N.totalSales)}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:R(N.costPrice)}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium",children:n.jsx("span",{className:N.margin>=0?"text-green-600":"text-red-600",children:R(N.margin)})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:n.jsxs("span",{className:`font-medium ${N.marginPercentage>=30?"text-green-600":N.marginPercentage>=15?"text-yellow-600":"text-red-600"}`,children:[N.marginPercentage.toFixed(1),"%"]})})]},N.productId))}),h.salesByProduct.length>0&&n.jsx("tfoot",{className:"bg-gray-100",children:n.jsxs("tr",{children:[n.jsx("td",{className:"px-6 py-3 text-left text-sm font-bold text-gray-900",children:"Total"}),n.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:h.salesByProduct.reduce((N,f)=>N+f.quantity,0)}),n.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:R(h.totalSales)}),n.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:R(h.salesByProduct.reduce((N,f)=>N+f.costPrice,0))}),n.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:R(h.salesByProduct.reduce((N,f)=>N+f.margin,0))}),n.jsxs("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:[(h.salesByProduct.reduce((N,f)=>N+f.margin,0)/h.salesByProduct.reduce((N,f)=>N+f.costPrice,0)*100).toFixed(1),"%"]})]})})]})})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs(O,{onClick:()=>k("sales"),children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]}),P=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Ventes par catégorie ",T()]}),h.salesByCategory.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Xy,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-500",children:"Aucune vente par catégorie pour cette période"})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Catégorie"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pourcentage"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.salesByCategory.map((N,f)=>n.jsxs("tr",{className:f%2===0?"bg-white":"bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:N.category}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:R(N.amount)}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:[(N.amount/h.totalSales*100).toFixed(1),"%"]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:N.count})]},f))})]})}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Répartition graphique"}),n.jsx("div",{className:"space-y-4",children:h.salesByCategory.map((N,f)=>{const j=N.amount/h.totalSales*100,E=["blue","green","purple","orange","red","yellow","indigo","pink"],S=E[f%E.length];return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:N.category}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:"font-semibold",children:R(N.amount)}),n.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",j.toFixed(1),"%)"]})]})]}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:n.jsx("div",{className:`h-2.5 rounded-full bg-${S}-500`,style:{width:`${j}%`}})})]},f)})})]})]})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs(O,{onClick:()=>k("categories"),children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]}),v=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Répartition des paiements ",T()]}),h.salesByPaymentMethod.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(yn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-500",children:"Aucun paiement pour cette période"})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Méthode"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pourcentage"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transactions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.salesByPaymentMethod.map((N,f)=>{const j=N.method==="cash"?"Espèces":N.method==="card"?"Carte bancaire":N.method==="mvola"?"MVola":N.method==="orange_money"?"Orange Money":N.method==="airtel_money"?"Airtel Money":N.method;return n.jsxs("tr",{className:f%2===0?"bg-white":"bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:j}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:R(N.amount)}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:[(N.amount/h.totalSales*100).toFixed(1),"%"]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:N.count})]},f)})})]})}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Répartition graphique"}),n.jsx("div",{className:"space-y-4",children:h.salesByPaymentMethod.map((N,f)=>{const j=N.amount/h.totalSales*100,E=["blue","green","red","orange","purple"],S=E[f%E.length],ee=N.method==="cash"?"Espèces":N.method==="card"?"Carte bancaire":N.method==="mvola"?"MVola":N.method==="orange_money"?"Orange Money":N.method==="airtel_money"?"Airtel Money":N.method;return n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm font-medium text-gray-700",children:ee}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:"font-semibold",children:R(N.amount)}),n.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",j.toFixed(1),"%)"]})]})]}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:n.jsx("div",{className:`h-2.5 rounded-full bg-${S}-500`,style:{width:`${j}%`}})})]},f)})})]})]})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs(O,{onClick:()=>k("payment"),children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]}),b=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Résumé financier ",T()]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx(wn,{className:"w-6 h-6 text-green-600 mr-2"}),n.jsx("h4",{className:"text-lg font-medium text-green-800",children:"Recettes totales"})]}),n.jsx("p",{className:"text-3xl font-bold text-green-700",children:R(h.totalSales)}),n.jsxs("p",{className:"text-sm text-green-600 mt-2",children:[h.transactions," transaction(s)"]})]}),n.jsxs("div",{className:"bg-red-50 p-6 rounded-lg border border-red-200",children:[n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx(vi,{className:"w-6 h-6 text-red-600 mr-2"}),n.jsx("h4",{className:"text-lg font-medium text-red-800",children:"Dépenses totales"})]}),n.jsx("p",{className:"text-3xl font-bold text-red-700",children:R(h.totalExpenses)})]}),n.jsxs("div",{className:`p-6 rounded-lg border ${h.netProfit>=0?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200"}`,children:[n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx(Tt,{className:`w-6 h-6 ${h.netProfit>=0?"text-blue-600":"text-orange-600"} mr-2`}),n.jsx("h4",{className:`text-lg font-medium ${h.netProfit>=0?"text-blue-800":"text-orange-800"}`,children:h.netProfit>=0?"Bénéfice net":"Perte nette"})]}),n.jsx("p",{className:`text-3xl font-bold ${h.netProfit>=0?"text-blue-700":"text-orange-700"}`,children:R(Math.abs(h.netProfit))}),h.totalSales>0&&n.jsxs("p",{className:`text-sm ${h.netProfit>=0?"text-blue-600":"text-orange-600"} mt-2`,children:[(h.netProfit/h.totalSales*100).toFixed(1),"% des recettes"]})]})]}),n.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[n.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Répartition recettes/dépenses"}),n.jsxs("div",{className:"relative pt-1",children:[n.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[n.jsx("div",{children:n.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200",children:"Recettes"})}),n.jsx("div",{className:"text-right",children:n.jsx("span",{className:"text-xs font-semibold inline-block text-green-600",children:R(h.totalSales)})})]}),n.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200",children:n.jsx("div",{style:{width:"100%"},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"})}),n.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[n.jsx("div",{children:n.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-600 bg-red-200",children:"Dépenses"})}),n.jsx("div",{className:"text-right",children:n.jsx("span",{className:"text-xs font-semibold inline-block text-red-600",children:R(h.totalExpenses)})})]}),n.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200",children:n.jsx("div",{style:{width:`${h.totalSales>0?h.totalExpenses/h.totalSales*100:0}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"})}),n.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[n.jsx("div",{children:n.jsx("span",{className:`text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full ${h.netProfit>=0?"text-blue-600 bg-blue-200":"text-orange-600 bg-orange-200"}`,children:h.netProfit>=0?"Bénéfice":"Perte"})}),n.jsx("div",{className:"text-right",children:n.jsx("span",{className:`text-xs font-semibold inline-block ${h.netProfit>=0?"text-blue-600":"text-orange-600"}`,children:R(Math.abs(h.netProfit))})})]}),n.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200",children:n.jsx("div",{style:{width:`${h.totalSales>0?Math.abs(h.netProfit)/h.totalSales*100:0}%`},className:`shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center ${h.netProfit>=0?"bg-blue-500":"bg-orange-500"}`})})]})]})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs(O,{onClick:()=>k("complete"),children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]});return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Rapports & Analytics"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Analysez les performances de votre établissement"})]}),n.jsxs("div",{className:"flex flex-wrap gap-3",children:[n.jsxs(O,{variant:g?"primary":"outline",onClick:C,children:[n.jsx(kt,{className:"w-4 h-4 mr-2"}),g?"Masquer date personnalisée":"Date personnalisée"]}),n.jsxs(O,{onClick:()=>k("complete"),children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),g?n.jsx(K,{children:n.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de début"}),n.jsx("input",{type:"date",value:s.start,onChange:N=>A("start",N.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de fin"}),n.jsx("input",{type:"date",value:s.end,onChange:N=>A("end",N.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),n.jsx(O,{variant:"ghost",onClick:()=>{const N=new Date().toISOString().split("T")[0];r({start:N,end:N})},children:"Aujourd'hui"})]})}):n.jsx(K,{children:n.jsx("div",{className:"flex flex-wrap gap-2",children:["today","yesterday","week","month","year"].map(N=>n.jsx("button",{onClick:()=>e(N),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${t===N?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:N==="today"?"Aujourd'hui":N==="yesterday"?"Hier":N==="week"?"Cette semaine":N==="month"?"Ce mois":"Cette année"},N))})}),n.jsx(K,{children:n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>a("financial"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="financial"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx(Tt,{className:"w-4 h-4 inline mr-1"}),"Résumé financier"]}),n.jsxs("button",{onClick:()=>a("sales"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="sales"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx(vn,{className:"w-4 h-4 inline mr-1"}),"Ventes par produit"]}),n.jsxs("button",{onClick:()=>a("categories"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="categories"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx(Xy,{className:"w-4 h-4 inline mr-1"}),"Ventes par catégorie"]}),n.jsxs("button",{onClick:()=>a("payment"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="payment"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[n.jsx(yn,{className:"w-4 h-4 inline mr-1"}),"Méthodes de paiement"]})]})}),d&&n.jsx(og,{indexUrl:"https://console.firebase.google.com/v1/r/project/saas-915ec/firestore/indexes?create_composite=Ckhwcm9qZWN0cy9zYWFzLTkxNWVjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9zYWxlcy9pbmRleGVzL18QARoTCg9lc3RhYmxpc2htZW50SWQQARoKCgZzdGF0dXMQARoNCgljcmVhdGVkQXQQAhoMCghfX25hbWVfXxAC",title:"Index de base de données requis pour les rapports",description:"Pour des performances optimales, un index composite doit être créé dans Firebase. Les données sont actuellement chargées avec une méthode alternative qui peut être plus lente."}),o?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Zs,{className:"w-12 h-12 text-blue-500 animate-spin mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chargement des données..."}),n.jsx("p",{className:"text-gray-500",children:"Veuillez patienter pendant que nous générons votre rapport"})]})}):n.jsxs(n.Fragment,{children:[i==="financial"&&b(),i==="sales"&&D(),i==="categories"&&P(),i==="payment"&&v()]})]})},MD=()=>{const[t,e]=I.useState(!1),[s,r]=I.useState(null),[i,a]=I.useState(!1),[o,l]=I.useState(""),[d,u]=I.useState(null),[h,m]=I.useState({sales:0,expenses:0,customers:0,products:0}),[g,x]=I.useState(!1),{user:y}=Fe(),R=()=>(y==null?void 0:y.role)==="admin",_=()=>y!=null&&y.email?is.isDemoEmail(y.email):!1,T=async()=>{if(y!=null&&y.establishmentId){x(!0);try{const S=["sales","expenses","customers","products"],ee={sales:0,expenses:0,customers:0,products:0};for(const U of S){const z=Ae(Ee(H,U),ce("establishmentId","==",y.establishmentId)),J=await Ie(z);ee[U]=J.size}m(ee)}catch(S){console.error("Erreur lors du chargement des statistiques:",S)}finally{x(!1)}}};I.useEffect(()=>{R()&&T()},[y==null?void 0:y.establishmentId]);const A=S=>S==="admin123",C=(S,ee)=>{if(!R()){L.error("Accès refusé : Seuls les administrateurs peuvent effectuer cette action");return}if(_()){L.error("Les comptes de démonstration ne peuvent pas effectuer cette action");return}u({type:S,action:ee}),a(!0),l("")},k=()=>{if(!A(o)){L.error("Mot de passe administrateur incorrect"),l("");return}d&&(a(!1),r(d.type),u(null),l(""))},D=async S=>{if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}if(_()){L.error("Les comptes de démonstration ne peuvent pas supprimer des données");return}e(!0);try{const ee=Ae(Ee(H,S),ce("establishmentId","==",y.establishmentId)),U=await Ie(ee);if(U.empty){L.info(`Aucune donnée ${v(S)} à supprimer`),e(!1);return}const z=Uy(H);U.docs.forEach(J=>{z.delete(J.ref)}),await z.commit(),await T(),L.success(`Toutes les données ${v(S)} ont été supprimées`),r(null)}catch(ee){console.error(`Erreur lors de la suppression des ${S}:`,ee),L.error(`Erreur lors de la suppression des ${v(S)}`)}finally{e(!1)}},P=async()=>{if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}if(_()){L.error("Les comptes de démonstration ne peuvent pas supprimer des données");return}e(!0);try{const S=["sales","expenses","customers","products"];let ee=0;for(const U of S){const z=Ae(Ee(H,U),ce("establishmentId","==",y.establishmentId)),J=await Ie(z);if(!J.empty){const W=Uy(H);J.docs.forEach(oe=>{W.delete(oe.ref)}),await W.commit(),ee+=J.size}}await T(),L.success(`${ee} éléments supprimés avec succès`),r(null)}catch(S){console.error("Erreur lors de la suppression complète:",S),L.error("Erreur lors de la suppression des données")}finally{e(!1)}},v=S=>({sales:"de ventes",expenses:"de dépenses",customers:"de clients",products:"de produits"})[S]||S,b=S=>({sales:n.jsx(nn,{className:"w-5 h-5"}),expenses:n.jsx(vi,{className:"w-5 h-5"}),customers:n.jsx(Xe,{className:"w-5 h-5"}),products:n.jsx(yt,{className:"w-5 h-5"})})[S]||n.jsx(ko,{className:"w-5 h-5"}),N=S=>({sales:"text-green-600 bg-green-50 border-green-200",expenses:"text-red-600 bg-red-50 border-red-200",customers:"text-blue-600 bg-blue-50 border-blue-200",products:"text-purple-600 bg-purple-50 border-purple-200"})[S]||"text-gray-600 bg-gray-50 border-gray-200",f=()=>n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-md",padding:"lg",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Cr,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Authentification Administrateur"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Cette action nécessite une authentification administrateur. Veuillez saisir votre mot de passe pour continuer."}),n.jsx("div",{className:"mb-6",children:n.jsx("input",{type:"password",value:o,onChange:S=>l(S.target.value),placeholder:"Mot de passe administrateur",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",onKeyPress:S=>S.key==="Enter"&&k(),autoFocus:!0})}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6",children:n.jsx("p",{className:"text-sm text-gray-700",children:"Veuillez saisir votre mot de passe administrateur pour confirmer cette action."})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>{a(!1),u(null),l("")},children:"Annuler"}),n.jsx(O,{variant:"danger",fullWidth:!0,onClick:k,disabled:!o.trim(),children:"Confirmer"})]})]})})}),j=({dataType:S,onConfirm:ee,onCancel:U})=>n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-md",padding:"lg",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Me,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Confirmer la suppression"}),n.jsx("p",{className:"text-gray-600 mb-6",children:S==="all"?"Êtes-vous sûr de vouloir supprimer TOUTES les données ? Cette action est irréversible.":`Êtes-vous sûr de vouloir supprimer toutes les données ${v(S)} ? Cette action est irréversible.`}),n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Qe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-yellow-800",children:[n.jsx("p",{className:"font-medium",children:"⚠️ Attention :"}),n.jsxs("ul",{className:"mt-2 space-y-1 text-left",children:[n.jsx("li",{children:"• Cette action ne peut pas être annulée"}),n.jsx("li",{children:"• Toutes les données seront définitivement perdues"}),n.jsx("li",{children:"• Assurez-vous d'avoir une sauvegarde si nécessaire"})]})]})]})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(O,{variant:"ghost",fullWidth:!0,onClick:U,disabled:t,children:"Annuler"}),n.jsx(O,{variant:"danger",fullWidth:!0,onClick:ee,disabled:t,children:t?"Suppression...":"Supprimer définitivement"})]})]})})}),E=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsx(K,{children:n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:n.jsx(T5,{className:"w-10 h-10 text-red-600"})}),n.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Accès Restreint"}),n.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:'La gestion des données est réservée aux administrateurs. Seuls les utilisateurs avec le rôle "Administrateur" peuvent accéder à cette section.'}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Qe,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-blue-800 text-left",children:[n.jsx("p",{className:"font-medium",children:"Votre rôle actuel :"}),n.jsx("p",{className:"mt-1",children:n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(y==null?void 0:y.role)==="manager"?"bg-blue-100 text-blue-800":(y==null?void 0:y.role)==="cashier"?"bg-green-100 text-green-800":(y==null?void 0:y.role)==="reader"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:(y==null?void 0:y.role)==="manager"?"Gérant":(y==null?void 0:y.role)==="cashier"?"Caissier":(y==null?void 0:y.role)==="reader"?"Lecteur":(y==null?void 0:y.role)||"Utilisateur"})})]})]})}),n.jsx("div",{className:"mt-8",children:n.jsx("p",{className:"text-sm text-gray-500",children:"Contactez votre administrateur pour obtenir l'accès à cette fonctionnalité."})})]})}),n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[n.jsx(os,{className:"w-5 h-5 mr-2"}),"Permissions par rôle"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Qe,{className:"w-5 h-5 text-red-600 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-red-900",children:"Administrateur"}),n.jsx("p",{className:"text-sm text-red-700",children:"Accès complet à la gestion des données"})]})]}),n.jsx("span",{className:"text-green-600",children:"✓"})]}),n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Xe,{className:"w-5 h-5 text-blue-600 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Gérant"}),n.jsx("p",{className:"text-sm text-gray-700",children:"Accès en lecture seule aux statistiques"})]})]}),n.jsx("span",{className:"text-red-600",children:"✗"})]}),n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Tt,{className:"w-5 h-5 text-green-600 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Caissier"}),n.jsx("p",{className:"text-sm text-gray-700",children:"Aucun accès à la gestion des données"})]})]}),n.jsx("span",{className:"text-red-600",children:"✗"})]}),n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(ko,{className:"w-5 h-5 text-purple-600 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Lecteur"}),n.jsx("p",{className:"text-sm text-gray-700",children:"Aucun accès à la gestion des données"})]})]}),n.jsx("span",{className:"text-red-600",children:"✗"})]})]})]})]});return R()?n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Qe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsxs("h4",{className:"text-sm font-medium text-red-800 flex items-center",children:["Zone Sécurisée - Administrateur Uniquement",n.jsx(os,{className:"w-4 h-4 ml-2"})]}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Ces actions nécessitent une double authentification et suppriment définitivement vos données. Utilisez avec précaution."})]})]})}),n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[n.jsx(ko,{className:"w-5 h-5 mr-2"}),"État actuel des données"]}),g?n.jsxs("div",{className:"text-center py-4",children:[n.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Chargement des statistiques..."})]}):n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(h).map(([S,ee])=>n.jsx("div",{className:`p-4 rounded-lg border ${N(S)}`,children:n.jsxs("div",{className:"flex items-center",children:[b(S),n.jsxs("div",{className:"ml-3",children:[n.jsx("p",{className:"text-sm font-medium capitalize",children:S==="sales"?"Ventes":S==="expenses"?"Dépenses":S==="customers"?"Clients":"Produits"}),n.jsx("p",{className:"text-2xl font-bold",children:ee})]})]})},S))}),n.jsx("div",{className:"mt-4 flex justify-end",children:n.jsxs(O,{variant:"ghost",size:"sm",onClick:T,disabled:g,children:[n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Actualiser"]})})]}),_()&&n.jsx(K,{className:"bg-red-50 border-red-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(os,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Restriction pour les comptes de démonstration"}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Les comptes de démonstration ne peuvent pas supprimer de données. Cette restriction est en place pour protéger l'environnement de démonstration."})]})]})}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Suppression par type de données"}),n.jsx("div",{className:"space-y-4",children:Object.entries(h).map(([S,ee])=>n.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center",children:[b(S),n.jsxs("div",{className:"ml-3",children:[n.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:S==="sales"?"Ventes":S==="expenses"?"Dépenses":S==="customers"?"Clients":"Produits"}),n.jsxs("p",{className:"text-sm text-gray-600",children:[ee," élément",ee>1?"s":""," dans la base"]})]})]}),n.jsxs(O,{variant:"danger",size:"sm",onClick:()=>C(S,()=>D(S)),disabled:ee===0||t||_(),className:_()?"opacity-50 cursor-not-allowed":"",children:[n.jsx(cs,{className:"w-4 h-4 mr-2"}),n.jsx(os,{className:"w-3 h-3 mr-1"}),"Supprimer tout"]})]},S))})]}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 text-red-600",children:"Suppression complète"}),n.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Action irréversible"}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Cette action supprimera TOUTES vos données : ventes, dépenses, clients et produits. Seuls votre compte utilisateur et les paramètres de l'établissement seront conservés."})]})]})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Remise à zéro complète"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Supprime toutes les données commerciales pour repartir à zéro"})]}),n.jsxs(O,{variant:"danger",onClick:()=>C("all",P),disabled:Object.values(h).every(S=>S===0)||t||_(),className:_()?"opacity-50 cursor-not-allowed":"",children:[n.jsx(cs,{className:"w-4 h-4 mr-2"}),n.jsx(os,{className:"w-3 h-3 mr-1"}),"Tout supprimer"]})]})]}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"💡 Recommandations de sécurité"}),n.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[n.jsxs("div",{className:"flex items-start",children:[n.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Double authentification :"})," Chaque action nécessite votre mot de passe administrateur."]})]}),n.jsxs("div",{className:"flex items-start",children:[n.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Accès restreint :"})," Seuls les administrateurs peuvent accéder à cette section."]})]}),n.jsxs("div",{className:"flex items-start",children:[n.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Avant de supprimer :"})," Exportez vos données importantes depuis les sections Ventes, Dépenses, etc."]})]}),n.jsxs("div",{className:"flex items-start",children:[n.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Données conservées :"})," Votre compte, paramètres d'établissement et catégories restent intacts."]})]}),n.jsxs("div",{className:"flex items-start",children:[n.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),n.jsxs("p",{children:[n.jsx("strong",{children:"Alternative :"})," Créez un nouvel établissement si vous voulez conserver les données actuelles."]})]})]})]}),i&&n.jsx(f,{}),s&&n.jsx(j,{dataType:s,onConfirm:()=>{s==="all"?P():D(s)},onCancel:()=>r(null)})]}):n.jsx(E,{})},LD=({users:t,onUsersUpdate:e})=>{const[s,r]=I.useState(null),[i,a]=I.useState(""),[o,l]=I.useState(""),[d,u]=I.useState(!1),[h,m]=I.useState(!1),[g,x]=I.useState(!1),[y,R]=I.useState(!1),[_,T]=I.useState(""),{user:A}=Fe(),C=E=>{r(E),a(E.email),l(""),x(!1),E.id===(A==null?void 0:A.id)&&m(!0)},k=E=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(E),D=async()=>{if(!s||!i.trim()){L.error("Email requis");return}if(!k(i)){L.error("Format d'email invalide");return}if(i===s.email){L.error("Le nouvel email doit être différent de l'actuel");return}if(s.id===(A==null?void 0:A.id)&&!o.trim()){L.error("Mot de passe requis pour modifier votre propre email");return}u(!0);try{if(s.id===(A==null?void 0:A.id)&&qe.currentUser)try{const E=Si.credential(s.email,o);await iC(qe.currentUser,E),await oC(qe.currentUser,i),L.success("Email de vérification envoyé ! Vérifiez votre nouvelle adresse email pour confirmer le changement."),x(!0)}catch(E){console.error("Erreur Firebase Auth:",E);let S="Erreur lors de la mise à jour";switch(E.code){case"auth/email-already-in-use":S="Cette adresse email est déjà utilisée par un autre compte";break;case"auth/invalid-email":S="Format d'email invalide";break;case"auth/wrong-password":S="Mot de passe incorrect. Veuillez vérifier votre mot de passe actuel.";break;case"auth/invalid-credential":S="Mot de passe incorrect. Veuillez vérifier votre mot de passe actuel.";break;case"auth/requires-recent-login":S="Pour des raisons de sécurité, veuillez vous reconnecter avant de modifier votre email";break;case"auth/operation-not-allowed":S="Cette opération n'est pas autorisée. Contactez l'administrateur.";break;case"auth/too-many-requests":S="Trop de tentatives. Veuillez attendre quelques minutes avant de réessayer.";break;default:S=E.message||"Erreur inconnue lors de la mise à jour de l'email"}L.error(S),u(!1);return}(s.id!==(A==null?void 0:A.id)||g)&&(await ht(he(H,"users",s.id),{email:i,updatedAt:Q.now(),...s.id===(A==null?void 0:A.id)&&{emailVerified:!1}}),await e(),s.id!==(A==null?void 0:A.id)&&(L.success("Email mis à jour avec succès. L'utilisateur devra se reconnecter avec sa nouvelle adresse."),r(null),m(!1),l("")))}catch(E){console.error("Erreur lors de la mise à jour de l'email:",E),L.error("Erreur lors de la mise à jour de l'email")}finally{u(!1)}},P=()=>{r(null),m(!1),l(""),x(!1)},v=async E=>{if(E.preventDefault(),!_.trim()){L.error("Veuillez saisir une adresse email");return}if(!k(_)){L.error("Format d'email invalide");return}u(!0);try{const S={url:window.location.origin+"/login",handleCodeInApp:!1};await ff(qe,_,S),console.log(`Email de réinitialisation envoyé à: ${_}`),L.success("Email de réinitialisation envoyé ! Vérifiez votre boîte de réception et vos spams."),R(!1),T("")}catch(S){console.error("Erreur lors de l'envoi de l'email de réinitialisation:",S);let ee="Erreur lors de l'envoi de l'email";switch(S.code){case"auth/user-not-found":ee="Aucun compte trouvé avec cette adresse email";break;case"auth/invalid-email":ee="Format d'email invalide";break;case"auth/too-many-requests":ee="Trop de tentatives. Veuillez réessayer plus tard.";break;default:ee=S.message||"Erreur lors de l'envoi de l'email"}L.error(ee)}finally{u(!1)}},b=()=>t.filter(E=>E.email.includes("@saaspos.mg")),N=()=>t.filter(E=>!E.email.includes("@saaspos.mg")),f=b(),j=N();return n.jsxs("div",{className:"space-y-6",children:[n.jsxs(K,{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[n.jsx(Ft,{className:"w-5 h-5 mr-2"}),"Gestion des adresses email"]}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(zt,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Comment modifier les emails"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsx("p",{children:`• Cliquez sur "Modifier" à côté de l'email à changer`}),n.jsx("p",{children:"• Saisissez votre vraie adresse email"}),n.jsx("p",{children:"• Pour votre propre compte, vous devrez confirmer votre mot de passe"}),n.jsx("p",{children:"• Un email de vérification sera envoyé à la nouvelle adresse"}),n.jsx("p",{children:"• Vous devrez cliquer sur le lien de vérification pour finaliser le changement"})]})]})]})}),n.jsxs("div",{className:"mt-4",children:[n.jsxs(O,{onClick:()=>R(!0),variant:"ghost",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[n.jsx(Cr,{className:"w-4 h-4 mr-2"}),"Réinitialiser un mot de passe"]}),n.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Envoyez un email de réinitialisation à n'importe quelle adresse email"})]})]}),f.length>0&&n.jsxs(K,{children:[n.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center",children:[n.jsx(Me,{className:"w-5 h-5 mr-2 text-orange-600"}),"Comptes avec emails de démonstration (",f.length,")"]}),n.jsx("div",{className:"space-y-3",children:f.map(E=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:n.jsx(Xe,{className:"w-5 h-5 text-orange-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:E.name}),n.jsx("p",{className:"text-sm text-orange-700 font-mono",children:E.email}),n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800",children:E.role==="admin"?"Administrateur":E.role==="manager"?"Gérant":E.role==="cashier"?"Caissier":"Lecteur"})]})]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>C(E),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:[n.jsx(bn,{className:"w-4 h-4 mr-2"}),"Modifier"]})]},E.id))})]}),j.length>0&&n.jsxs(K,{children:[n.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center",children:[n.jsx(zt,{className:"w-5 h-5 mr-2 text-green-600"}),"Comptes avec vraies adresses email (",j.length,")"]}),n.jsx("div",{className:"space-y-3",children:j.map(E=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:n.jsx(Xe,{className:"w-5 h-5 text-green-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:E.name}),n.jsx("p",{className:"text-sm text-green-700 font-mono",children:E.email}),n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:E.role==="admin"?"Administrateur":E.role==="manager"?"Gérant":E.role==="cashier"?"Caissier":"Lecteur"})]})]}),n.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>C(E),className:"text-green-600 hover:text-green-700 hover:bg-green-100",children:[n.jsx(bn,{className:"w-4 h-4 mr-2"}),"Modifier"]})]},E.id))})]}),s&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Ft,{className:"w-5 h-5 mr-2"}),"Modifier l'email"]}),n.jsx("button",{onClick:P,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:n.jsx(Xe,{className:"w-5 h-5 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:s.name}),n.jsxs("p",{className:"text-sm text-gray-600",children:["Email actuel: ",s.email]})]})]})}),g?n.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(zt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Email de vérification envoyé !"}),n.jsxs("div",{className:"text-sm text-green-700 mt-1 space-y-1",children:[n.jsxs("p",{children:["Un email de vérification a été envoyé à ",n.jsx("strong",{children:i})]}),n.jsx("p",{children:"Cliquez sur le lien dans l'email pour confirmer le changement d'adresse."}),n.jsx("p",{children:"Votre email actuel restera actif jusqu'à la vérification."})]})]})]})}):n.jsxs(n.Fragment,{children:[n.jsx(xe,{label:"Nouvelle adresse email",type:"email",value:i,onChange:E=>a(E.target.value),placeholder:"votre@vraiemail.com",leftIcon:n.jsx(Ft,{className:"w-4 h-4"}),disabled:d}),h&&s.id===(A==null?void 0:A.id)&&n.jsxs("div",{children:[n.jsx(xe,{label:"Votre mot de passe actuel (pour sécurité)",type:"password",value:o,onChange:E=>l(E.target.value),placeholder:"••••••••",leftIcon:n.jsx(Cr,{className:"w-4 h-4"}),disabled:d}),n.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Requis pour modifier votre propre email. Assurez-vous de saisir le bon mot de passe."})]}),s.id!==(A==null?void 0:A.id)&&n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-yellow-800",children:[n.jsx("p",{className:"font-medium",children:"Modification d'un autre utilisateur"}),n.jsx("p",{children:"L'email sera mis à jour dans la base de données. L'utilisateur devra se reconnecter avec sa nouvelle adresse."})]})]})}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-blue-800",children:[n.jsx("p",{className:"font-medium",children:"Processus de changement d'email :"}),n.jsx("ul",{className:"mt-1 space-y-1",children:s.id===(A==null?void 0:A.id)?n.jsxs(n.Fragment,{children:[n.jsx("li",{children:"• Un email de vérification sera envoyé à la nouvelle adresse"}),n.jsx("li",{children:"• Vous devrez cliquer sur le lien de vérification"}),n.jsx("li",{children:"• L'ancien email restera actif jusqu'à la vérification"}),n.jsx("li",{children:"• Une fois vérifié, vous devrez vous reconnecter"})]}):n.jsxs(n.Fragment,{children:[n.jsx("li",{children:"• L'email sera mis à jour immédiatement"}),n.jsx("li",{children:"• L'utilisateur devra se connecter avec le nouvel email"}),n.jsx("li",{children:"• L'ancien email ne fonctionnera plus"})]})})]})]})})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:P,disabled:d,children:g?"Fermer":"Annuler"}),!g&&n.jsx(O,{onClick:D,disabled:d||!i.trim()||!k(i)||i===s.email||h&&!o.trim(),children:d?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Mise à jour..."]}):n.jsxs(n.Fragment,{children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),"Mettre à jour"]})})]})]})}),y&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Cr,{className:"w-5 h-5 mr-2"}),"Réinitialiser un mot de passe"]}),n.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:v,className:"space-y-4",children:[n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Comment ça fonctionne"}),n.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Saisissez l'adresse email de l'utilisateur qui souhaite réinitialiser son mot de passe. Un email contenant un lien de réinitialisation lui sera envoyé."})]})]})}),n.jsx(xe,{label:"Adresse email",type:"email",value:_,onChange:E=>T(E.target.value),placeholder:"email@example.com",leftIcon:n.jsx(Ft,{className:"w-4 h-4"}),disabled:d,required:!0}),n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-yellow-800",children:[n.jsx("p",{className:"font-medium",children:"Important"}),n.jsx("p",{children:"Assurez-vous que l'adresse email est correcte et associée à un compte existant."}),n.jsx("p",{className:"mt-1",children:"L'email peut arriver dans les spams, vérifiez tous les dossiers."})]})]})}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>R(!1),disabled:d,type:"button",children:"Annuler"}),n.jsx(O,{type:"submit",disabled:d||!_.trim()||!k(_),children:d?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Envoi en cours..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Envoyer l'email"]})})]})]})]})})]})},VD=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(!0),[i,a]=I.useState(!1),[o,l]=I.useState(null),[d,u]=I.useState(!1),[h,m]=I.useState(null),[g,x]=I.useState(!1),[y,R]=I.useState(null),[_,T]=I.useState(""),[A,C]=I.useState(!0),[k,D]=I.useState({name:"",email:"",password:""}),{user:P}=Fe(),v=(P==null?void 0:P.isSystemAdmin)===!0,b=()=>P!=null&&P.email?is.isDemoEmail(P.email):!1,N=async()=>{if(v)try{r(!0);const J=Ae(Ee(H,"users"),ce("isSystemAdmin","==",!0)),oe=(await Ie(J)).docs.map(X=>{var Z,$,q;const re=X.data();return{id:X.id,email:re.email,name:re.name,role:re.role,establishmentId:re.establishmentId,isActive:re.isActive??!0,isSuperAdmin:re.isSuperAdmin??!1,isSystemAdmin:re.isSystemAdmin??!1,lastLogin:((Z=re.lastLogin)==null?void 0:Z.toDate())||null,createdAt:(($=re.createdAt)==null?void 0:$.toDate())||new Date,updatedAt:((q=re.updatedAt)==null?void 0:q.toDate())||new Date}});e(oe)}catch(J){console.error("Erreur lors du chargement des administrateurs système:",J),L.error("Erreur lors du chargement des administrateurs système")}finally{r(!1)}};I.useEffect(()=>{v&&N()},[v]);const f=()=>{if(A){L.error("La création de comptes Super Admin est désactivée pour des raisons de sécurité");return}l(null),D({name:"",email:"",password:""}),a(!0)},j=J=>{if(A){L.error("La modification de comptes Super Admin est désactivée pour des raisons de sécurité");return}l(J),D({name:J.name,email:J.email,password:""}),a(!0)},E=async()=>{if(A){L.error("La création/modification de comptes Super Admin est désactivée pour des raisons de sécurité");return}if(!k.name||!k.email){L.error("Le nom et l'email sont requis");return}if(!o&&!k.password){L.error("Le mot de passe est requis pour un nouveau compte");return}if(!v){L.error("Seuls les Super Admins peuvent gérer les administrateurs système");return}if(b()){L.error("Les comptes de démonstration ne peuvent pas gérer les administrateurs système");return}r(!0);try{if(o){const J={name:k.name,updatedAt:Q.now()};await ht(he(H,"users",o.id),J),L.success("Administrateur modifié avec succès")}else{const J=await Zo(qe,k.email,k.password);await tl(J.user,{displayName:k.name});const W={id:J.user.uid,email:k.email,name:k.name,role:"admin",establishmentId:"SYSTEM_ADMIN",isActive:!0,isSuperAdmin:!0,isSystemAdmin:!0,isClientAdmin:!1,lastLogin:null,createdAt:Q.now(),updatedAt:Q.now()};await Je(he(H,"users",J.user.uid),W),L.success("Administrateur système ajouté avec succès")}await N(),D({name:"",email:"",password:""}),a(!1),l(null)}catch(J){console.error("Erreur lors de la gestion de l'administrateur:",J);let W="Erreur lors de la gestion de l'administrateur";switch(J.code){case"auth/email-already-in-use":W="Cette adresse email est déjà utilisée";break;case"auth/weak-password":W="Le mot de passe doit contenir au moins 6 caractères";break;case"auth/invalid-email":W="Format d'email invalide";break;default:W=J.message||W}L.error(W)}finally{r(!1)}},S=J=>{if(A){L.error("La suppression de comptes Super Admin est désactivée pour des raisons de sécurité");return}if(J.id===(P==null?void 0:P.id)){L.error("Vous ne pouvez pas supprimer votre propre compte");return}if(b()){L.error("Les comptes de démonstration ne peuvent pas supprimer d'administrateurs système");return}m(J),u(!0),T("")},ee=async()=>{if(h){if(!_){L.error("Mot de passe administrateur requis");return}if(_!=="superadmin123"){L.error("Mot de passe administrateur incorrect"),T("");return}r(!0);try{await Is(he(H,"users",h.id)),L.success("Administrateur supprimé avec succès"),await N(),u(!1),m(null),T("")}catch(J){console.error("Erreur lors de la suppression de l'administrateur:",J),L.error("Erreur lors de la suppression de l'administrateur")}finally{r(!1)}}},U=J=>{if(A){L.error("La réinitialisation de mot de passe pour les comptes Super Admin est désactivée pour des raisons de sécurité");return}if(b()){L.error("Les comptes de démonstration ne peuvent pas réinitialiser les mots de passe");return}R(J),x(!0)},z=async()=>{if(y)try{r(!0);const J={url:window.location.origin+"/login",handleCodeInApp:!1};await ff(qe,y.email,J),console.log(`Email de réinitialisation envoyé à: ${y.email}`),L.success(`Email de réinitialisation envoyé à ${y.email}`),x(!1),R(null)}catch(J){console.error("Erreur lors de l'envoi de l'email:",J);let W="Erreur lors de l'envoi de l'email";switch(J.code){case"auth/user-not-found":W="Utilisateur non trouvé";break;case"auth/invalid-email":W="Adresse email invalide";break;case"auth/too-many-requests":W="Trop de tentatives. Réessayez plus tard.";break;default:W=J.message||W}L.error(W)}finally{r(!1)}};return v?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Qe,{className:"w-5 h-5 mr-2 text-red-600"}),"Gestion des Administrateurs Système"]}),n.jsxs(O,{onClick:f,disabled:A,className:A?"opacity-50 cursor-not-allowed":"",children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Ajouter un Admin"]})]}),n.jsx(K,{className:"bg-red-50 border-red-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(os,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Restriction de sécurité active"}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"La création, modification et suppression de comptes Super Admin système est désactivée pour des raisons de sécurité. Ces opérations sont réservées uniquement aux processus internes sécurisés."})]})]})}),n.jsx(K,{children:n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"À propos des Administrateurs Système"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsx("p",{children:"• Les Administrateurs Système ont accès à la validation des paiements"}),n.jsx("p",{children:"• Ils peuvent gérer tous les établissements clients"}),n.jsx("p",{children:"• Ils ont un accès complet au système d'administration"}),n.jsx("p",{children:"• Chaque Admin Système a les mêmes droits et privilèges"})]})]})]})})}),n.jsx(K,{children:s?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des administrateurs..."})]}):t.length===0?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Qe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun administrateur trouvé"}),n.jsx("p",{className:"text-gray-500 mb-4",children:"Les administrateurs système apparaîtront ici"})]}):n.jsx("div",{className:"space-y-3",children:t.map(J=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:n.jsx(Qe,{className:"w-5 h-5 text-red-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:J.name}),n.jsx("p",{className:"text-sm text-gray-600",children:J.email}),n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 mt-1",children:"Super Admin"})]})]}),n.jsx("div",{className:"flex items-center space-x-2",children:J.id===(P==null?void 0:P.id)?n.jsx("span",{className:"text-xs text-gray-500 italic",children:"Vous-même"}):n.jsxs(n.Fragment,{children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>j(J),title:"Modifier l'administrateur",disabled:A,className:A?"opacity-50 cursor-not-allowed":"",children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>U(J),title:"Réinitialiser le mot de passe",className:`text-orange-600 hover:text-orange-700 hover:bg-orange-50 ${A?"opacity-50 cursor-not-allowed":""}`,disabled:A,children:n.jsx(Cr,{className:"w-4 h-4"})}),n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>S(J),title:"Supprimer l'administrateur",className:`text-red-600 hover:text-red-700 hover:bg-red-50 ${A?"opacity-50 cursor-not-allowed":""}`,disabled:A,children:n.jsx(cs,{className:"w-4 h-4"})})]})})]},J.id))})}),i&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Qe,{className:"w-5 h-5 mr-2 text-red-600"}),o?"Modifier l'administrateur":"Ajouter un administrateur système"]}),n.jsx("button",{onClick:()=>{a(!1),l(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx(xe,{label:"Nom complet",value:k.name,onChange:J=>D({...k,name:J.target.value}),placeholder:"Ex: Jean Dupont",disabled:s}),n.jsx(xe,{label:"Adresse email",type:"email",value:k.email,onChange:J=>D({...k,email:J.target.value}),placeholder:"admin@example.com",disabled:s||!!o,leftIcon:n.jsx(Ft,{className:"w-4 h-4"})}),!o&&n.jsx(xe,{label:"Mot de passe",type:"password",value:k.password,onChange:J=>D({...k,password:J.target.value}),placeholder:"••••••••",disabled:s,leftIcon:n.jsx(Cr,{className:"w-4 h-4"})}),o&&n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:n.jsxs("p",{className:"text-sm text-blue-800",children:[n.jsx("strong",{children:"Note :"}),` L'email ne peut pas être modifié pour des raisons de sécurité. Pour changer le mot de passe, utilisez le bouton "🔑\\" dans la liste des administrateurs.`]})}),n.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Attention : Privilèges élevés"}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Les Administrateurs Système ont un accès complet à toutes les fonctionnalités d'administration, y compris la validation des paiements et la gestion des clients."})]})]})})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>{a(!1),l(null)},disabled:s,children:"Annuler"}),n.jsx(O,{onClick:E,disabled:s,className:"bg-red-600 hover:bg-red-700",children:s?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),o?"Modification...":"Création..."]}):n.jsxs(n.Fragment,{children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),o?"Modifier":"Ajouter"]})})]})]})}),d&&h&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(cs,{className:"w-5 h-5 mr-2 text-red-600"}),"Supprimer l'administrateur"]}),n.jsx("button",{onClick:()=>{u(!1),m(null),T("")},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Confirmation de suppression"}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Êtes-vous sûr de vouloir supprimer cet administrateur système ? Cette action est irréversible."})]})]})}),n.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:n.jsx(Qe,{className:"w-5 h-5 text-red-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:h.name}),n.jsx("p",{className:"text-sm text-gray-600",children:h.email}),n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 mt-1",children:"Super Admin"})]})]})}),n.jsxs("div",{className:"mb-6",children:[n.jsx(xe,{label:"Mot de passe administrateur",type:"password",value:_,onChange:J=>T(J.target.value),placeholder:"Saisissez votre mot de passe admin"}),n.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Veuillez saisir votre mot de passe administrateur pour confirmer cette action."})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>{u(!1),m(null),T("")},disabled:s,children:"Annuler"}),n.jsx(O,{variant:"danger",onClick:ee,disabled:s||!_.trim(),children:s?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Suppression..."]}):n.jsxs(n.Fragment,{children:[n.jsx(cs,{className:"w-4 h-4 mr-2"}),"Supprimer définitivement"]})})]})]})}),g&&y&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Cr,{className:"w-5 h-5 mr-2"}),"Réinitialiser le mot de passe"]}),n.jsx("button",{onClick:()=>{x(!1),R(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-orange-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-orange-800",children:"Réinitialisation sécurisée"}),n.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Un email de réinitialisation sera envoyé à l'administrateur. Il pourra alors créer un nouveau mot de passe en toute sécurité."})]})]})}),n.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:n.jsx(Qe,{className:"w-5 h-5 text-red-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:y.name}),n.jsx("p",{className:"text-sm text-gray-600",children:y.email}),n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 mt-1",children:"Super Admin"})]})]})}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Processus de réinitialisation"}),n.jsxs("ol",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsxs("li",{children:["1. Un email sera envoyé à ",n.jsx("strong",{children:y.email})]}),n.jsx("li",{children:"2. L'administrateur cliquera sur le lien dans l'email"}),n.jsx("li",{children:"3. Il pourra définir un nouveau mot de passe"}),n.jsx("li",{children:"4. Le nouveau mot de passe sera actif immédiatement"})]})]})]})})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>{x(!1),R(null)},disabled:s,children:"Annuler"}),n.jsx(O,{onClick:z,disabled:s,className:"bg-orange-600 hover:bg-orange-700",children:s?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Envoi en cours..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Ft,{className:"w-4 h-4 mr-2"}),"Envoyer l'email"]})})]})]})})]}):n.jsx(K,{className:"p-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Qe,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Seuls les Super Administrateurs système peuvent accéder à cette section."})]})})},OD=()=>{const[t,e]=I.useState(!1),[s,r]=I.useState(""),[i,a]=I.useState(!1),[o,l]=I.useState(null),d=()=>{a(!0),r(""),l(null)},u=async()=>{if(!s){L.error("Mot de passe requis");return}e(!0);try{await ra(qe);try{const m=await el(qe,"superadmin@saaspos.mg",s);if(m.user){await _j(m.user),console.log("✅ Utilisateur Firebase Auth supprimé");try{await Is(he(H,"users",m.user.uid)),console.log("✅ Document Firestore supprimé")}catch(g){console.error("❌ Erreur lors de la suppression du document Firestore:",g)}try{const g=Ae(Ee(H,"users"),ce("email","==","superadmin@saaspos.mg")),x=await Ie(g);if(!x.empty)for(const y of x.docs)await Is(y.ref),console.log("✅ Document supplémentaire supprimé:",y.id)}catch(g){console.error("❌ Erreur lors de la recherche de documents supplémentaires:",g)}l({success:!0,message:"Compte superadmin supprimé avec succès !",details:"Le compte a été complètement supprimé de Firebase Authentication et de Firestore."}),localStorage.clear(),sessionStorage.clear(),a(!1)}}catch(m){if(console.error("❌ Erreur de connexion:",m),m.code==="auth/invalid-credential")l({success:!1,message:"Mot de passe incorrect",details:"Le mot de passe saisi ne correspond pas au compte superadmin@saaspos.mg. Vérifiez le mot de passe ou utilisez la console Firebase pour supprimer le compte manuellement."});else if(m.code==="auth/user-not-found"){l({success:!0,message:"Le compte superadmin n'existe plus",details:"Le compte superadmin@saaspos.mg a déjà été supprimé de Firebase Authentication. Nettoyage des données Firestore en cours..."});try{const g=Ae(Ee(H,"users"),ce("email","==","superadmin@saaspos.mg")),x=await Ie(g);if(!x.empty){for(const y of x.docs)await Is(y.ref),console.log("✅ Document Firestore supplémentaire supprimé:",y.id);l({success:!0,message:"Nettoyage terminé",details:"Le compte n'existait plus dans Firebase Auth, mais des documents Firestore ont été supprimés."})}}catch(g){console.error("❌ Erreur lors du nettoyage Firestore:",g)}a(!1)}else m.code==="auth/wrong-password"?l({success:!1,message:"Mot de passe incorrect",details:"Le mot de passe saisi est incorrect. Essayez avec le mot de passe correct ou utilisez la console Firebase."}):m.code==="auth/too-many-requests"?l({success:!1,message:"Trop de tentatives",details:"Trop de tentatives de connexion échouées. Attendez quelques minutes avant de réessayer."}):l({success:!1,message:"Erreur lors de la tentative de connexion",details:`Code d'erreur: ${m.code}. ${m.message}`})}}catch(m){console.error("❌ Erreur lors du nettoyage:",m),l({success:!1,message:"Erreur lors du nettoyage",details:m.message})}finally{e(!1)}},h=async()=>{try{await qe.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login",L.success("Déconnexion forcée réussie")}catch(m){console.error("Erreur lors de la déconnexion forcée:",m),L.error("Erreur lors de la déconnexion forcée")}};return n.jsxs(K,{className:"p-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Qe,{className:"w-5 h-5 mr-2 text-red-600"}),"Nettoyage du compte Super Admin"]})}),n.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Qe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsxs("h4",{className:"text-sm font-medium text-red-800 flex items-center",children:["Zone Sécurisée - Administrateur Uniquement",n.jsx(os,{className:"w-4 h-4 ml-2"})]}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Si vous avez supprimé le compte superadmin@saaspos.mg mais qu'il reste accessible, utilisez cet outil pour le supprimer complètement de Firebase Authentication et de Firestore."})]})]})}),o&&n.jsx("div",{className:`border rounded-lg p-4 ${o.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:n.jsxs("div",{className:"flex items-start",children:[o.success?n.jsx(zt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}):n.jsx(Me,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{className:`text-sm ${o.success?"text-green-800":"text-red-800"}`,children:[n.jsx("p",{className:"font-medium",children:o.message}),o.details&&n.jsx("p",{className:"mt-1",children:o.details}),o.success&&n.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[n.jsx("p",{className:"text-blue-800 font-medium text-xs mb-2",children:"🎉 Nettoyage terminé !"}),n.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[n.jsx("p",{children:"• Le compte superadmin a été complètement supprimé"}),n.jsx("p",{children:"• Vous devez maintenant vous déconnecter et vous reconnecter"}),n.jsx("p",{children:"• Si nécessaire, reconfigurer le système depuis la page de configuration"})]})]}),!o.success&&n.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[n.jsx("p",{className:"text-yellow-800 font-medium text-xs mb-2",children:"Solutions possibles :"}),n.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[n.jsx("li",{children:"• Vérifiez que le mot de passe est correct"}),n.jsx("li",{children:"• Essayez la déconnexion forcée ci-dessous"}),n.jsx("li",{children:"• Utilisez la console Firebase pour supprimer le compte manuellement"}),n.jsx("li",{children:"• Attendez quelques minutes si trop de tentatives ont été effectuées"})]})]})]})]})}),n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs(O,{variant:"danger",onClick:d,disabled:t,className:"w-full",children:[n.jsx(cs,{className:"w-4 h-4 mr-2"}),"Supprimer définitivement le compte superadmin"]}),n.jsxs(O,{variant:"ghost",onClick:h,disabled:t,className:"w-full",children:[n.jsx(Co,{className:"w-4 h-4 mr-2"}),"Déconnexion forcée et nettoyage du cache"]})]}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Mots de passe courants"}),n.jsx("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:n.jsxs("p",{children:["• Pour cette démo, utilisez le mot de passe : ",n.jsx("strong",{children:"superadmin123"})]})})]})]})}),n.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(os,{className:"w-5 h-5 text-gray-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Comment ça fonctionne"}),n.jsxs("ol",{className:"text-sm text-gray-700 mt-1 space-y-1",children:[n.jsx("li",{children:"1. L'outil tente de se connecter au compte superadmin"}),n.jsx("li",{children:"2. Si la connexion réussit, il supprime le compte de Firebase Auth"}),n.jsx("li",{children:"3. Il supprime également tous les documents Firestore associés"}),n.jsx("li",{children:"4. Si le compte n'existe plus, il nettoie seulement Firestore"}),n.jsx("li",{children:"5. Après la suppression, vous devrez vous reconnecter"})]})]})]})})]}),i&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-md",padding:"lg",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Cr,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Mot de passe du compte superadmin"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Pour supprimer le compte superadmin@saaspos.mg, veuillez saisir son mot de passe."}),n.jsxs("div",{className:"mb-6",children:[n.jsx("input",{type:"password",value:s,onChange:m=>r(m.target.value),placeholder:"Mot de passe superadmin",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",onKeyPress:m=>m.key==="Enter"&&!t&&u(),autoFocus:!0}),n.jsx("div",{className:"text-xs text-gray-500 mt-2 space-y-1",children:n.jsxs("p",{children:["Pour cette démo, utilisez le mot de passe : ",n.jsx("strong",{children:"superadmin123"})]})})]}),n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-yellow-800",children:[n.jsx("p",{className:"font-medium",children:"⚠️ Attention :"}),n.jsx("p",{children:"Cette action supprimera définitivement le compte superadmin et est irréversible."})]})]})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>{a(!1),r("")},disabled:t,children:"Annuler"}),n.jsx(O,{variant:"danger",fullWidth:!0,onClick:u,disabled:t||!s.trim(),children:t?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Suppression..."]}):n.jsxs(n.Fragment,{children:[n.jsx(cs,{className:"w-4 h-4 mr-2"}),"Supprimer"]})})]})]})})})]})},FD=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(!0),[i,a]=I.useState(""),[o,l]=I.useState(!0),[d,u]=I.useState(!0),[h,m]=I.useState(!0),[g,x]=I.useState(!0),[y,R]=I.useState(!0),[_,T]=I.useState({}),[A,C]=I.useState([]),{user:k}=Fe(),D=(k==null?void 0:k.isSystemAdmin)===!0,P=async()=>{if(D)try{r(!0);const U=Ae(Ee(H,"users")),J=(await Ie(U)).docs.map(X=>{var Z,$,q;const re=X.data();return{id:X.id,email:re.email,name:re.name||"Sans nom",role:re.role||"inconnu",establishmentId:re.establishmentId||"inconnu",establishmentName:re.establishmentId==="SYSTEM_ADMIN"?"Système":re.establishmentId,isActive:re.isActive??!0,isSuperAdmin:re.isSuperAdmin??!1,isSystemAdmin:re.isSystemAdmin??!1,isClientAdmin:re.isClientAdmin??!1,lastLogin:((Z=re.lastLogin)==null?void 0:Z.toDate())||null,createdAt:(($=re.createdAt)==null?void 0:$.toDate())||new Date,updatedAt:((q=re.updatedAt)==null?void 0:q.toDate())||new Date}});e(J);const W=Array.from(new Set(J.map(X=>X.establishmentId))).map(X=>{const re=X==="SYSTEM_ADMIN"?"Système":X==="demo-establishment-main"?"Établissement Démo":`Établissement ${X.substring(0,8)}`;return{id:X,name:re}});C(W);const oe={};W.forEach(X=>{oe[X.id]=!0}),T(oe),L.success(`${J.length} utilisateurs trouvés`)}catch(U){console.error("Erreur lors du chargement des utilisateurs:",U),L.error("Erreur lors du chargement des utilisateurs")}finally{r(!1)}};I.useEffect(()=>{D&&P()},[D]);const v=t.filter(U=>{const z=U.name.toLowerCase().includes(i.toLowerCase())||U.email.toLowerCase().includes(i.toLowerCase())||U.establishmentId.toLowerCase().includes(i.toLowerCase())||U.role.toLowerCase().includes(i.toLowerCase()),J=U.isSystemAdmin===!0,W=U.role==="admin"&&!J,oe=U.role==="manager",X=U.role==="cashier",re=U.role==="reader";return z&&(J&&y||W&&o||oe&&d||X&&h||re&&g)}),b=()=>{const U={};return v.forEach(z=>{U[z.establishmentId]||(U[z.establishmentId]=[]),U[z.establishmentId].push(z)}),U},N=U=>{const z=A.find(J=>J.id===U);return(z==null?void 0:z.name)||U},f=U=>U==="SYSTEM_ADMIN"?"bg-red-100 border-red-200 text-red-800":U==="demo-establishment-main"?"bg-blue-100 border-blue-200 text-blue-800":"bg-gray-100 border-gray-200 text-gray-800",j=U=>{T(z=>({...z,[U]:!z[U]}))},E=U=>U.isSystemAdmin?"bg-red-50 border-red-200":U.role==="admin"||U.isClientAdmin?"bg-blue-50 border-blue-200":U.role==="manager"?"bg-green-50 border-green-200":U.role==="cashier"?"bg-yellow-50 border-yellow-200":U.role==="reader"?"bg-purple-50 border-purple-200":"bg-gray-50 border-gray-200",S=U=>U.isSystemAdmin?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Super Admin Système"}):U.isClientAdmin?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Admin Client"}):U.role==="admin"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Administrateur"}):U.role==="manager"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Gérant"}):U.role==="cashier"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Caissier"}):U.role==="reader"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Lecteur"}):n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:U.role||"Rôle inconnu"}),ee=U=>U.isSystemAdmin?n.jsx(Qe,{className:"w-5 h-5 text-red-600"}):U.role==="admin"||U.isClientAdmin?n.jsx(At,{className:"w-5 h-5 text-blue-600"}):U.role==="manager"?n.jsx(At,{className:"w-5 h-5 text-green-600"}):U.role==="cashier"?n.jsx(At,{className:"w-5 h-5 text-yellow-600"}):U.role==="reader"?n.jsx(At,{className:"w-5 h-5 text-purple-600"}):n.jsx(Xe,{className:"w-5 h-5 text-gray-600"});return D?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Xe,{className:"w-5 h-5 mr-2 text-blue-600"}),"Liste complète des utilisateurs"]}),n.jsxs(O,{onClick:P,variant:"ghost",disabled:s,children:[n.jsx(Zs,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`}),"Actualiser"]})]}),n.jsx(K,{children:n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"À propos de cette liste"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsxs("p",{children:["• Cette liste affiche ",n.jsx("strong",{children:"tous"})," les utilisateurs du système, organisés par établissement"]}),n.jsx("p",{children:"• Les Super Admins Système sont marqués en rouge"}),n.jsx("p",{children:"• Les Administrateurs sont marqués en bleu"}),n.jsx("p",{children:"• Les Gérants sont marqués en vert"}),n.jsx("p",{children:"• Les Caissiers sont marqués en jaune"}),n.jsx("p",{children:"• Les Lecteurs sont marqués en violet"})]})]})]})})}),n.jsx(K,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsx(xe,{placeholder:"Rechercher par nom, email, rôle ou établissement...",value:i,onChange:U=>a(U.target.value),leftIcon:n.jsx(Ps,{className:"w-4 h-4 text-gray-400"})})}),n.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[n.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:y,onChange:()=>R(!y),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),n.jsx("span",{className:"text-sm text-gray-700",children:"Super Admins"})]}),n.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:o,onChange:()=>l(!o),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),n.jsx("span",{className:"text-sm text-gray-700",children:"Admins"})]}),n.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:d,onChange:()=>u(!d),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),n.jsx("span",{className:"text-sm text-gray-700",children:"Gérants"})]}),n.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:h,onChange:()=>m(!h),className:"rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"}),n.jsx("span",{className:"text-sm text-gray-700",children:"Caissiers"})]}),n.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:g,onChange:()=>x(!g),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),n.jsx("span",{className:"text-sm text-gray-700",children:"Lecteurs"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:[v.length," utilisateur(s) trouvé(s)"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(m1,{className:"w-4 h-4 text-gray-400"}),n.jsx("span",{className:"text-sm text-gray-600",children:"Filtres actifs"})]})]})]})}),n.jsx("div",{className:"space-y-4",children:s?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des utilisateurs..."})]})}):v.length===0?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun utilisateur trouvé"}),n.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur ne correspond à vos critères de recherche"})]})}):Object.entries(b()).map(([U,z])=>n.jsxs(K,{className:"overflow-hidden",children:[n.jsx("div",{className:`p-4 ${f(U)} cursor-pointer`,onClick:()=>j(U),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(Qn,{className:"w-5 h-5"}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold",children:N(U)}),n.jsxs("p",{className:"text-sm",children:[z.length," utilisateur(s)"]})]})]}),_[U]?n.jsx(u1,{className:"w-5 h-5"}):n.jsx(Ru,{className:"w-5 h-5"})]})}),_[U]&&n.jsx("div",{className:"divide-y divide-gray-100",children:z.map(J=>n.jsx("div",{className:`p-4 ${E(J)}`,children:n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[n.jsxs("div",{className:"flex items-start space-x-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-white shadow-sm border border-gray-200 flex-shrink-0",children:ee(J)}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900",children:J.name}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ft,{className:"w-3 h-3 text-gray-500"}),n.jsx("p",{className:"text-sm text-gray-600 font-mono truncate max-w-[200px] sm:max-w-none",children:J.email})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[S(J),J.isActive?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Actif"}):n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Inactif"}),J.id===(k==null?void 0:k.id)&&n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Vous-même"})]})]})]}),n.jsxs("div",{className:"text-left sm:text-right mt-2 sm:mt-0",children:[n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[n.jsx(ks,{className:"w-3 h-3"}),n.jsx("span",{children:J.lastLogin?`Dernière connexion: ${J.lastLogin.toLocaleDateString("fr-FR")}`:"Jamais connecté"})]}),n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mt-1",children:[n.jsx(kt,{className:"w-3 h-3"}),n.jsxs("span",{children:["Créé le: ",J.createdAt.toLocaleDateString("fr-FR")]})]})]})]})},J.id))})]},U))}),n.jsxs(K,{children:[n.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Légende des types d'utilisateurs"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-50 rounded-lg",children:[n.jsx(Qe,{className:"w-5 h-5 text-red-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-red-900",children:"Super Admin Système"}),n.jsx("p",{className:"text-sm text-red-700",children:"Accès à la validation des paiements et à l'administration complète"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-blue-50 rounded-lg",children:[n.jsx(At,{className:"w-5 h-5 text-blue-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-blue-900",children:"Administrateur"}),n.jsx("p",{className:"text-sm text-blue-700",children:"Gère un établissement spécifique avec tous les droits"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-50 rounded-lg",children:[n.jsx(At,{className:"w-5 h-5 text-green-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-green-900",children:"Gérant"}),n.jsx("p",{className:"text-sm text-green-700",children:"Gère les opérations quotidiennes de l'établissement"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-50 rounded-lg",children:[n.jsx(At,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-yellow-900",children:"Caissier"}),n.jsx("p",{className:"text-sm text-yellow-700",children:"Gère les ventes et la caisse"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-purple-50 rounded-lg",children:[n.jsx(At,{className:"w-5 h-5 text-purple-600 mt-0.5"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-purple-900",children:"Lecteur"}),n.jsx("p",{className:"text-sm text-purple-700",children:"Accès en lecture seule aux données"})]})]})]})]})]}):n.jsx(K,{className:"p-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Qe,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Seuls les Super Administrateurs système peuvent accéder à cette section."})]})})},$D=()=>{const[t,e]=I.useState([]),[s,r]=I.useState(!0),[i,a]=I.useState(""),[o,l]=I.useState("all"),[d,u]=I.useState("all"),[h,m]=I.useState([]),[g,x]=I.useState({}),{user:y}=Fe(),R=(y==null?void 0:y.isSystemAdmin)===!0,_=async()=>{if(R)try{r(!0);const f=Ae(Ee(H,"users")),E=(await Ie(f)).docs.map(U=>{var J,W,oe;const z=U.data();return{id:U.id,email:z.email,name:z.name||"Sans nom",role:z.role||"inconnu",establishmentId:z.establishmentId||"inconnu",establishmentName:z.establishmentId==="SYSTEM_ADMIN"?"Système":z.establishmentId,isActive:z.isActive??!0,isSuperAdmin:z.isSuperAdmin??!1,isSystemAdmin:z.isSystemAdmin??!1,isClientAdmin:z.isClientAdmin??!1,lastLogin:((J=z.lastLogin)==null?void 0:J.toDate())||null,createdAt:((W=z.createdAt)==null?void 0:W.toDate())||new Date,updatedAt:((oe=z.updatedAt)==null?void 0:oe.toDate())||new Date}});e(E);const S=Array.from(new Set(E.map(U=>U.establishmentId))).map(U=>{const z=E.filter(W=>W.establishmentId===U),J=U==="SYSTEM_ADMIN"?"Système":U==="demo-establishment-main"?"Établissement Démo":`Établissement ${U.substring(0,8)}`;return{id:U,name:J}});m(S);const ee={};S.forEach(U=>{ee[U.id]=!0}),x(ee),L.success(`${E.length} utilisateurs trouvés`)}catch(f){console.error("Erreur lors du chargement des utilisateurs:",f),L.error("Erreur lors du chargement des utilisateurs")}finally{r(!1)}};I.useEffect(()=>{R&&_()},[R]);const T=t.filter(f=>{const j=f.name.toLowerCase().includes(i.toLowerCase())||f.email.toLowerCase().includes(i.toLowerCase())||f.establishmentId.toLowerCase().includes(i.toLowerCase()),E=o==="all"||f.role===o,S=d==="all"||f.establishmentId===d;return j&&E&&S}),A=f=>f.isSystemAdmin?"bg-red-50 border-red-200":f.role==="admin"||f.isClientAdmin?"bg-blue-50 border-blue-200":f.role==="manager"?"bg-green-50 border-green-200":f.role==="cashier"?"bg-yellow-50 border-yellow-200":f.role==="reader"?"bg-purple-50 border-purple-200":"bg-gray-50 border-gray-200",C=f=>f.isSystemAdmin?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Super Admin Système"}):f.isClientAdmin?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Admin Client"}):f.role==="admin"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Administrateur"}):f.role==="manager"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Gérant"}):f.role==="cashier"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Caissier"}):f.role==="reader"?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Lecteur"}):n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:f.role||"Rôle inconnu"}),k=f=>f.isSystemAdmin?n.jsx(Qe,{className:"w-5 h-5 text-red-600"}):f.role==="admin"||f.isClientAdmin?n.jsx(Qe,{className:"w-5 h-5 text-blue-600"}):f.role==="manager"?n.jsx(At,{className:"w-5 h-5 text-green-600"}):f.role==="cashier"?n.jsx(At,{className:"w-5 h-5 text-yellow-600"}):f.role==="reader"?n.jsx(Bs,{className:"w-5 h-5 text-purple-600"}):n.jsx(At,{className:"w-5 h-5 text-gray-600"}),D=()=>{const f={};return T.forEach(j=>{f[j.establishmentId]||(f[j.establishmentId]=[]),f[j.establishmentId].push(j)}),f},P=f=>{const j=h.find(E=>E.id===f);return(j==null?void 0:j.name)||f},v=f=>f==="SYSTEM_ADMIN"?"bg-red-100 border-red-200 text-red-800":f==="demo-establishment-main"?"bg-blue-100 border-blue-200 text-blue-800":"bg-gray-100 border-gray-200 text-gray-800",b=f=>{x(j=>({...j,[f]:!j[f]}))},N=()=>{const f=[["ID","Nom","Email","Rôle","Établissement","Statut","Dernière connexion","Créé le"],...T.map(ee=>[ee.id,ee.name,ee.email,ee.role,ee.establishmentId,ee.isActive?"Actif":"Inactif",ee.lastLogin?ee.lastLogin.toLocaleDateString("fr-FR"):"Jamais",ee.createdAt.toLocaleDateString("fr-FR")])].map(ee=>ee.join(",")).join(`
`),j=new Blob([f],{type:"text/csv"}),E=window.URL.createObjectURL(j),S=document.createElement("a");S.href=E,S.download=`utilisateurs_${new Date().toISOString().split("T")[0]}.csv`,S.click(),window.URL.revokeObjectURL(E),L.success("Liste des utilisateurs exportée avec succès")};return R?n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(Xe,{className:"w-5 h-5 mr-2 text-blue-600"}),"Liste complète des utilisateurs"]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(O,{onClick:_,variant:"ghost",disabled:s,children:[n.jsx(Zs,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`}),"Actualiser"]}),n.jsxs(O,{onClick:N,variant:"ghost",disabled:s||T.length===0,children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),n.jsx(K,{children:n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(qs,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Liste complète des utilisateurs"}),n.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[n.jsxs("p",{children:["• Cette liste affiche ",n.jsx("strong",{children:"tous"})," les utilisateurs du système, organisés par établissement"]}),n.jsx("p",{children:"• Les Super Admins Système sont marqués en rouge"}),n.jsx("p",{children:"• Les Admins Clients sont marqués en bleu"}),n.jsx("p",{children:"• Les Gérants sont marqués en vert"}),n.jsx("p",{children:"• Les Caissiers sont marqués en jaune"}),n.jsx("p",{children:"• Les Lecteurs sont marqués en violet"})]})]})]})})}),n.jsx(K,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx("div",{className:"md:col-span-1",children:n.jsx(xe,{placeholder:"Rechercher par nom, email ou établissement...",value:i,onChange:f=>a(f.target.value),leftIcon:n.jsx(Ps,{className:"w-4 h-4 text-gray-400"})})}),n.jsxs("select",{value:o,onChange:f=>l(f.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"all",children:"Tous les rôles"}),n.jsx("option",{value:"admin",children:"Administrateurs"}),n.jsx("option",{value:"manager",children:"Gérants"}),n.jsx("option",{value:"cashier",children:"Caissiers"}),n.jsx("option",{value:"reader",children:"Lecteurs"})]}),n.jsxs("select",{value:d,onChange:f=>u(f.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"all",children:"Tous les établissements"}),h.map(f=>n.jsx("option",{value:f.id,children:f.name},f.id))]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:[T.length," utilisateur(s) trouvé(s)"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(m1,{className:"w-4 h-4 text-gray-400"}),n.jsx("span",{className:"text-sm text-gray-600",children:"Filtres actifs"})]})]})]})}),n.jsx("div",{className:"space-y-4",children:s?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des utilisateurs..."})]})}):T.length===0?n.jsx(K,{children:n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun utilisateur trouvé"}),n.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur ne correspond à vos critères de recherche"})]})}):Object.entries(D()).map(([f,j])=>n.jsxs(K,{className:"overflow-hidden",children:[n.jsx("div",{className:`p-4 ${v(f)} cursor-pointer`,onClick:()=>b(f),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(Qn,{className:"w-5 h-5"}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-semibold",children:P(f)}),n.jsxs("p",{className:"text-sm",children:[j.length," utilisateur(s)"]})]})]}),g[f]?n.jsx(u1,{className:"w-5 h-5"}):n.jsx(Ru,{className:"w-5 h-5"})]})}),g[f]&&n.jsx("div",{className:"divide-y divide-gray-100",children:j.map(E=>n.jsx("div",{className:`p-4 ${A(E)}`,children:n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[n.jsxs("div",{className:"flex items-start space-x-4",children:[n.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-white shadow-sm border border-gray-200 flex-shrink-0",children:k(E)}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900",children:E.name}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Ft,{className:"w-3 h-3 text-gray-500"}),n.jsx("p",{className:"text-sm text-gray-600 font-mono truncate max-w-[200px] sm:max-w-none",children:E.email})]}),n.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[C(E),E.isActive?n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Actif"}):n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Inactif"}),E.id===(y==null?void 0:y.id)&&n.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Vous-même"})]})]})]}),n.jsxs("div",{className:"text-left sm:text-right mt-2 sm:mt-0",children:[n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[n.jsx(ks,{className:"w-3 h-3"}),n.jsx("span",{children:E.lastLogin?`Dernière connexion: ${E.lastLogin.toLocaleDateString("fr-FR")}`:"Jamais connecté"})]}),n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mt-1",children:[n.jsx(kt,{className:"w-3 h-3"}),n.jsxs("span",{children:["Créé le: ",E.createdAt.toLocaleDateString("fr-FR")]})]})]})]})},E.id))})]},f))}),n.jsxs(K,{children:[n.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Statistiques des utilisateurs"}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[n.jsx("div",{className:"text-lg font-bold text-blue-800",children:t.length}),n.jsx("div",{className:"text-sm text-blue-600",children:"Total utilisateurs"})]}),n.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[n.jsx("div",{className:"text-lg font-bold text-red-800",children:t.filter(f=>f.isSystemAdmin).length}),n.jsx("div",{className:"text-sm text-red-600",children:"Super Admins"})]}),n.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[n.jsx("div",{className:"text-lg font-bold text-green-800",children:h.length}),n.jsx("div",{className:"text-sm text-green-600",children:"Établissements"})]}),n.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[n.jsx("div",{className:"text-lg font-bold text-yellow-800",children:t.filter(f=>f.isActive).length}),n.jsx("div",{className:"text-sm text-yellow-600",children:"Utilisateurs actifs"})]})]})]})]}):n.jsx(K,{className:"p-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Qe,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Seuls les Super Administrateurs système peuvent accéder à cette section."})]})})},UD=()=>{const[t,e]=I.useState("general"),[s,r]=I.useState(!1),[i,a]=I.useState(null),[o,l]=I.useState(!1),[d,u]=I.useState([]),[h,m]=I.useState(!0),[g,x]=I.useState(null),[y,R]=I.useState(""),{user:_,signOut:T}=Fe(),[A,C]=I.useState({name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"1234567890",stat:"12345678901234",currency:"MGA",taxRate:20,logo:""}),[k,D]=I.useState({autoOpenDrawer:!0,autoPrintReceipt:!1,defaultPaymentMethod:"cash",receiptFooter:"Merci de votre visite !",lowStockAlert:10,enableLoyalty:!0}),[P,v]=I.useState({name:"",email:"",password:"",role:"cashier",isActive:!0}),b=[{id:"general",label:"Général",icon:Cs},{id:"pos",label:"Point de Vente",icon:yn},{id:"users",label:"Utilisateurs",icon:Xe},{id:"emails",label:"Emails",icon:S5},{id:"data",label:"Données",icon:ko},{id:"printer",label:"Impression",icon:Dl},{id:"backup",label:"Sauvegarde",icon:ko},{id:"security",label:"Sécurité",icon:Qe}];_!=null&&_.isSystemAdmin&&(b.push({id:"system-admin",label:"Admin Système",icon:Qe}),b.push({id:"admin-list",label:"Liste Admins",icon:Xe}),b.push({id:"all-users",label:"Tous les utilisateurs",icon:Xe}));const N=[{id:"admin",name:"Administrateur",description:"Accès complet au système"},{id:"manager",name:"Gérant",description:"Gestion de l'établissement"},{id:"cashier",name:"Caissier",description:"Ventes et caisse uniquement"},{id:"reader",name:"Lecteur",description:"Consultation seule"}],f=async()=>{if(_!=null&&_.establishmentId)try{m(!0);const V=Ae(Ee(H,"users"),ce("establishmentId","==",_.establishmentId)),Y=(await Ie(V)).docs.map(Ne=>{var B,ae,Ce;const _e=Ne.data();return{id:Ne.id,email:_e.email,name:_e.name,role:_e.role,establishmentId:_e.establishmentId,isActive:_e.isActive??!0,isSuperAdmin:_e.isSuperAdmin??!1,isSystemAdmin:_e.isSystemAdmin??!1,isClientAdmin:_e.isClientAdmin??!1,lastLogin:((B=_e.lastLogin)==null?void 0:B.toDate())||null,createdAt:((ae=_e.createdAt)==null?void 0:ae.toDate())||new Date,updatedAt:((Ce=_e.updatedAt)==null?void 0:Ce.toDate())||new Date}});u(Y)}catch(V){console.error("Erreur lors du chargement des utilisateurs:",V),L.error("Erreur lors du chargement des utilisateurs")}finally{m(!1)}},j=async()=>{if(_!=null&&_.establishmentId)try{const V=await Rs(he(H,"establishments",_.establishmentId));if(V.exists()){const pe=V.data();C({name:pe.name||"Nirina Nirina Pos Madagascar",address:pe.address||"Antananarivo, Madagascar",phone:pe.phone||"+261 34 12 345 67",email:pe.email||"contact@saaspos.mg",nif:pe.nif||"1234567890",stat:pe.stat||"12345678901234",currency:pe.currency||"MGA",taxRate:pe.taxRate||20,logo:pe.logo||""})}}catch(V){console.error("Erreur lors du chargement des paramètres:",V)}},E=async()=>{if(_!=null&&_.establishmentId)try{const V=await Rs(he(H,"pos_settings",_.establishmentId));if(V.exists()){const pe=V.data();D({autoOpenDrawer:pe.autoOpenDrawer??!0,autoPrintReceipt:pe.autoPrintReceipt??!1,defaultPaymentMethod:pe.defaultPaymentMethod||"cash",receiptFooter:pe.receiptFooter||"Merci de votre visite !",lowStockAlert:pe.lowStockAlert||10,enableLoyalty:pe.enableLoyalty??!0})}}catch(V){console.error("Erreur lors du chargement des paramètres POS:",V)}};I.useEffect(()=>{(t==="users"||t==="emails")&&f(),t==="general"&&j(),t==="pos"&&E()},[t,_==null?void 0:_.establishmentId]);const S=()=>{if(!(_!=null&&_.establishmentId)){L.error("Établissement non trouvé");return}l(!0),Je(he(H,"establishments",_.establishmentId),{name:A.name,address:A.address,phone:A.phone,email:A.email,nif:A.nif,stat:A.stat,currency:A.currency,taxRate:A.taxRate,updatedAt:Q.now()},{merge:!0}).then(()=>{L.success("Paramètres de l'établissement sauvegardés avec succès"),l(!1)}).catch(V=>{console.error("Erreur lors de la sauvegarde:",V),L.error("Erreur lors de la sauvegarde des paramètres"),l(!1)})},ee=()=>{if(!(user!=null&&user.establishmentId)){L.error("Établissement non trouvé");return}l(!0),Je(he(H,"pos_settings",user.establishmentId),{...k,establishmentId:user.establishmentId,updatedAt:Q.now()}).then(()=>{L.success("Paramètres POS sauvegardés avec succès"),l(!1)}).catch(V=>{console.error("Erreur lors de la sauvegarde:",V),L.error("Erreur lors de la sauvegarde des paramètres POS"),l(!1)})},U=async()=>{if(!P.name||!P.email||!P.password){L.error("Tous les champs sont requis");return}if(!(_!=null&&_.establishmentId)){L.error("Établissement non trouvé");return}if(_.role!=="admin"){L.error("Seuls les administrateurs peuvent ajouter des utilisateurs");return}if(is.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas créer de nouveaux utilisateurs");return}if(is.isSuperAdminEmail(P.email)){L.error("Cet email est réservé pour l'administration système. Veuillez utiliser une autre adresse email.");return}l(!0);try{const V=await Zo(qe,P.email,P.password);await tl(V.user,{displayName:P.name});const pe={id:V.user.uid,email:P.email,name:P.name,role:P.role,establishmentId:_.establishmentId,isActive:P.isActive,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:P.role==="admin",lastLogin:null,createdAt:Q.now(),updatedAt:Q.now()};await Je(he(H,"users",V.user.uid),pe),await f(),v({name:"",email:"",password:"",role:"cashier",isActive:!0}),r(!1),L.success("Utilisateur ajouté avec succès")}catch(V){let pe="Erreur lors de l'ajout de l'utilisateur";if(V!=null&&V.code)switch(V.code){case"auth/email-already-in-use":pe="Cette adresse email est déjà utilisée";break;case"auth/weak-password":pe="Le mot de passe doit contenir au moins 6 caractères";break;case"auth/invalid-email":pe="Format d'email invalide";break;case"auth/operation-not-allowed":pe="Création de compte désactivée";break;case"auth/too-many-requests":pe="Trop de tentatives. Veuillez réessayer plus tard";break;default:pe=`Erreur Firebase: ${V.code}`}else V!=null&&V.message&&(pe=V.message);L.error(pe),console.error("Détails de l'erreur d'ajout d'utilisateur:",{code:V==null?void 0:V.code,message:V==null?void 0:V.message,email:P.email})}finally{l(!1)}},z=V=>{if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent modifier les utilisateurs");return}if(is.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas modifier d'autres utilisateurs");return}if(V.isSystemAdmin){L.error("Les comptes Super Admin système ne peuvent pas être modifiés par cette méthode");return}a(V),v({name:V.name,email:V.email,password:"",role:V.role,isActive:V.isActive}),r(!0),L.success(`Modification de l'utilisateur ${V.name}`)},J=async V=>{if(V===(_==null?void 0:_.id)){L.error("Vous ne pouvez pas supprimer votre propre compte");return}if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent supprimer des utilisateurs");return}if(is.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas supprimer d'autres utilisateurs");return}const pe=d.find(Y=>Y.id===V);if(pe&&pe.isSystemAdmin){L.error("Les comptes Super Admin système ne peuvent pas être supprimés par cette méthode");return}x(V)},W=async()=>{if(g){if(!y){L.error("Mot de passe administrateur requis");return}if(y!=="admin123"){L.error("Mot de passe administrateur incorrect"),R("");return}l(!0);try{const V=d.find(pe=>pe.id===g);if(!V){L.error("Utilisateur non trouvé");return}await Is(he(H,"users",g)),console.log("✅ Document Firestore supprimé");try{const pe=Dj();pe.currentUser&&await ra(pe);try{await el(qe,V.email,"password-inconnu"),qe.currentUser&&await _j(qe.currentUser)}catch(Ne){console.log("Impossible de se connecter avec l'utilisateur à supprimer:",Ne)}if(_)try{await el(qe,_.email,y)}catch(Ne){console.log("Erreur de reconnexion:",Ne),window.location.href="/login";return}}catch(pe){console.log("Erreur lors de la tentative de suppression Auth:",pe)}await f(),x(null),R(""),L.success("Utilisateur supprimé avec succès de la base de données"),L.info("Note: Pour supprimer complètement le compte de Firebase Authentication, utilisez la console Firebase.")}catch(V){console.error("Erreur lors de la suppression complète:",V),L.error("Erreur lors de la suppression: "+V.message)}finally{l(!1)}}},oe=async V=>{if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent modifier le statut des utilisateurs");return}if(is.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas modifier le statut des utilisateurs");return}const pe=d.find(Y=>Y.id===V);if(pe){if(pe.isSystemAdmin){L.error("Le statut des comptes Super Admin ne peut pas être modifié par cette méthode");return}try{await ht(he(H,"users",V),{isActive:!pe.isActive,updatedAt:Q.now()}),await f(),L.success("Statut utilisateur mis à jour")}catch(Y){console.error("Erreur lors de la mise à jour du statut:",Y),L.error("Erreur lors de la mise à jour du statut")}}},X=V=>{switch(V){case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";case"cashier":return"bg-green-100 text-green-800";case"reader":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},re=V=>{const pe=N.find(Y=>Y.id===V);return pe?pe.name:V},Z=async()=>{if(!i){L.error("Aucun utilisateur sélectionné pour la modification");return}if(!P.name){L.error("Le nom est requis");return}if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent modifier les utilisateurs");return}if(is.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas modifier d'autres utilisateurs");return}if(i.isSystemAdmin){L.error("Les comptes Super Admin système ne peuvent pas être modifiés par cette méthode");return}l(!0);try{await ht(he(H,"users",i.id),{name:P.name,role:P.role,isActive:P.isActive,isClientAdmin:P.role==="admin",updatedAt:Q.now()}),await f(),v({name:"",email:"",password:"",role:"cashier",isActive:!0}),r(!1),a(null),L.success("Utilisateur modifié avec succès")}catch(V){console.error("Erreur lors de la modification de l'utilisateur:",V),L.error("Erreur lors de la modification de l'utilisateur")}finally{l(!1)}},$=()=>n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations de l'établissement"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(xe,{label:"Nom de l'établissement",value:A.name,onChange:V=>C({...A,name:V.target.value})}),n.jsx(xe,{label:"Adresse",value:A.address,onChange:V=>C({...A,address:V.target.value})}),n.jsx(xe,{label:"Téléphone",value:A.phone,onChange:V=>C({...A,phone:V.target.value})}),n.jsx(xe,{label:"Email",type:"email",value:A.email,onChange:V=>C({...A,email:V.target.value})}),n.jsx(xe,{label:"NIF",value:A.nif,onChange:V=>C({...A,nif:V.target.value})}),n.jsx(xe,{label:"STAT",value:A.stat,onChange:V=>C({...A,stat:V.target.value})}),n.jsx(xe,{label:"Devise",value:A.currency,onChange:V=>C({...A,currency:V.target.value})}),n.jsx(xe,{label:"Taux de TVA (%)",type:"number",value:A.taxRate.toString(),onChange:V=>C({...A,taxRate:parseInt(V.target.value)})})]}),n.jsx("div",{className:"mt-6",children:n.jsxs(O,{onClick:S,disabled:o,children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),o?"Sauvegarde...":"Sauvegarder"]})})]}),q=()=>n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Configuration du Point de Vente"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ouverture automatique du tiroir-caisse"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Ouvrir automatiquement le tiroir après chaque vente"})]}),n.jsx("input",{type:"checkbox",checked:k.autoOpenDrawer,onChange:V=>D({...k,autoOpenDrawer:V.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Impression automatique des reçus"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Imprimer automatiquement après chaque vente"})]}),n.jsx("input",{type:"checkbox",checked:k.autoPrintReceipt,onChange:V=>D({...k,autoPrintReceipt:V.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mode de paiement par défaut"}),n.jsxs("select",{value:k.defaultPaymentMethod,onChange:V=>D({...k,defaultPaymentMethod:V.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"cash",children:"Espèces"}),n.jsx("option",{value:"card",children:"Carte"}),n.jsx("option",{value:"mobile",children:"Mobile Money"})]})]}),n.jsx(xe,{label:"Pied de page des reçus",value:k.receiptFooter,onChange:V=>D({...k,receiptFooter:V.target.value}),placeholder:"Message à afficher en bas des reçus"}),n.jsx(xe,{label:"Seuil d'alerte stock faible",type:"number",value:k.lowStockAlert.toString(),onChange:V=>D({...k,lowStockAlert:parseInt(V.target.value)})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Programme de fidélité"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Activer le système de points de fidélité"})]}),n.jsx("input",{type:"checkbox",checked:k.enableLoyalty,onChange:V=>D({...k,enableLoyalty:V.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),n.jsx("div",{className:"mt-6",children:n.jsxs(O,{onClick:ee,disabled:o,children:[n.jsx(xi,{className:"w-4 h-4 mr-2"}),o?"Sauvegarde...":"Sauvegarder"]})})]}),ue=()=>n.jsx("div",{className:"space-y-6",children:n.jsxs(K,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Gestion des utilisateurs"}),(_==null?void 0:_.role)==="admin"&&!is.isDemoEmail(_.email)&&n.jsxs(O,{onClick:()=>r(!0),children:[n.jsx(Ct,{className:"w-4 h-4 mr-2"}),"Ajouter un utilisateur"]})]}),h?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Zs,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),n.jsx("p",{className:"text-gray-500 mt-2",children:"Chargement des utilisateurs..."})]}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Utilisateur"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rôle"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dernière connexion"}),n.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(V=>n.jsxs("tr",{children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:n.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:n.jsx(Xe,{className:"w-5 h-5 text-gray-600"})})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:V.name}),n.jsx("div",{className:"text-sm text-gray-500",children:V.email})]})]})}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${X(V.role)}`,children:re(V.role)}),V.isSystemAdmin&&n.jsx("span",{className:"ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Super Admin"})]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${V.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:V.isActive?"Actif":"Inactif"})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:V.lastLogin?V.lastLogin.toLocaleDateString():"Jamais"}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:n.jsx("div",{className:"flex items-center justify-end space-x-2",children:(_==null?void 0:_.role)==="admin"&&!is.isDemoEmail(_.email)&&!V.isSystemAdmin&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>z(V),className:"text-blue-600 hover:text-blue-900",children:n.jsx(bn,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>oe(V.id),className:V.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",children:V.isActive?n.jsx(Vd,{className:"w-4 h-4"}):n.jsx(Bs,{className:"w-4 h-4"})}),V.id!==(_==null?void 0:_.id)&&n.jsx("button",{onClick:()=>J(V.id),className:"text-red-600 hover:text-red-900",children:n.jsx(cs,{className:"w-4 h-4"})})]})})})]},V.id))})]})})]})}),se=()=>n.jsx(LD,{users:d}),ve=()=>n.jsx(MD,{}),ke=()=>n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sauvegarde et restauration"}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Sauvegarde automatique"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Sauvegarde quotidienne de vos données"})]}),n.jsxs(O,{variant:"outline",onClick:()=>L.info("Fonctionnalité de sauvegarde en cours de développement"),children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]}),n.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Restaurer les données"}),n.jsx("p",{className:"text-sm text-gray-500",children:"Restaurer à partir d'une sauvegarde"})]}),n.jsxs(O,{variant:"outline",onClick:()=>L.info("Fonctionnalité de restauration en cours de développement"),children:[n.jsx(Pu,{className:"w-4 h-4 mr-2"}),"Restaurer"]})]})]})]}),me=()=>n.jsx(VD,{}),be=()=>n.jsx(FD,{}),we=()=>n.jsx($D,{});return n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Paramètres"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Configurez votre système de point de vente"})]})}),n.jsx("div",{className:"border-b border-gray-200 overflow-x-auto",children:n.jsx("nav",{className:"-mb-px flex space-x-8",children:b.map(V=>{const pe=V.icon;return n.jsxs("button",{onClick:()=>e(V.id),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${t===V.id?V.id==="system-admin"?"border-red-500 text-red-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[n.jsx(pe,{className:"w-4 h-4"}),n.jsx("span",{children:V.label})]},V.id)})})}),n.jsxs("div",{children:[t==="general"&&$(),t==="pos"&&q(),t==="users"&&ue(),t==="emails"&&se(),t==="data"&&ve(),t==="backup"&&ke(),t==="system-admin"&&me(),t==="admin-list"&&be(),t==="all-users"&&we(),t==="printer"&&n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Configuration d'impression"}),n.jsx("p",{className:"text-gray-600",children:"Module d'impression en cours de développement..."})]}),t==="security"&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Paramètres de sécurité"}),n.jsx("p",{className:"text-gray-600 mb-4",children:"Module de sécurité en cours de développement..."})]}),n.jsx(K,{className:"bg-red-50 border-red-200",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(os,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Restriction de sécurité active"}),n.jsx("p",{className:"text-sm text-red-700 mt-1",children:"La création, modification et suppression de comptes Super Admin système est désactivée pour des raisons de sécurité. Ces opérations sont réservées uniquement aux processus internes sécurisés."})]})]})}),n.jsx(OD,{})]})]}),s&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-md",padding:"lg",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:i?"Modifier l'utilisateur":"Ajouter un utilisateur"}),n.jsxs("div",{className:"space-y-4",children:[n.jsx(xe,{label:"Nom complet",value:P.name,onChange:V=>v({...P,name:V.target.value}),placeholder:"Ex: Marie Dupont",disabled:o}),n.jsx(xe,{label:"Adresse email",type:"email",value:P.email,onChange:V=>v({...P,email:V.target.value}),placeholder:"marie@nirinanirina.mg",disabled:o||!!i}),!i&&n.jsx(xe,{label:"Mot de passe",type:"password",value:P.password,onChange:V=>v({...P,password:V.target.value}),placeholder:"••••••••",disabled:o}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rôle"}),n.jsx("select",{value:P.role,onChange:V=>v({...P,role:V.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:o,children:N.map(V=>n.jsxs("option",{value:V.id,children:[V.name," - ",V.description]},V.id))})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("input",{type:"checkbox",id:"isActive",checked:P.isActive,onChange:V=>v({...P,isActive:V.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:o}),n.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Utilisateur actif"})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[n.jsx(O,{variant:"ghost",onClick:()=>{r(!1),a(null),v({name:"",email:"",password:"",role:"cashier",isActive:!0})},disabled:o,children:"Annuler"}),n.jsx(O,{onClick:i?Z:U,disabled:o,children:o?"Traitement en cours...":i?"Mettre à jour":"Ajouter"})]})]})}),g&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsx(K,{className:"w-full max-w-md",padding:"lg",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:n.jsx(Me,{className:"w-8 h-8 text-red-600"})}),n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Suppression complète de l'utilisateur"}),n.jsx("p",{className:"text-gray-600 mb-6",children:"Cette action supprimera l'utilisateur de Firestore ET de Firebase Authentication. Cette action est irréversible."}),n.jsxs("div",{className:"mb-6",children:[n.jsx(xe,{label:"Mot de passe administrateur",type:"password",value:y,onChange:V=>R(V.target.value),placeholder:"Saisissez votre mot de passe admin"}),n.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Veuillez saisir votre mot de passe administrateur pour confirmer cette action."})]}),n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx(Me,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),n.jsxs("div",{className:"text-sm text-yellow-800",children:[n.jsx("p",{className:"font-medium",children:"⚠️ Attention :"}),n.jsxs("ul",{className:"mt-2 space-y-1 text-left",children:[n.jsx("li",{children:"• Suppression du document Firestore"}),n.jsx("li",{children:"• Suppression du compte Firebase Auth"}),n.jsx("li",{children:"• Action irréversible"})]})]})]})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>{x(null),R("")},disabled:o,children:"Annuler"}),n.jsx(O,{variant:"danger",fullWidth:!0,onClick:W,disabled:o||!y.trim(),children:o?"Suppression...":"Supprimer définitivement"})]})]})})})]})},zD=[{id:"starter",name:"Starter",price:15e3,maxUsers:2,maxProducts:100,features:["Point de vente basique","Gestion des produits","Gestion des clients","Rapports simples","Support par email"]},{id:"business",name:"Business",price:35e3,maxUsers:10,maxProducts:1e3,isPopular:!0,features:["Toutes les fonctionnalités Starter","Gestion des dépenses","Rapports avancés","Gestion multi-utilisateurs","Sauvegarde automatique","Support prioritaire"]},{id:"enterprise",name:"Enterprise",price:75e3,maxUsers:-1,maxProducts:-1,features:["Toutes les fonctionnalités Business","Établissements multiples","API Access","Formations personnalisées","Support dédié 24/7","Personnalisation avancée"]}],BD=({onSelectPlan:t,currentPlan:e})=>{const s=i=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(i).replace("MGA","Ar"),r=i=>i.includes("utilisateur")?n.jsx(Xe,{className:"w-4 h-4"}):i.includes("produit")?n.jsx(yt,{className:"w-4 h-4"}):i.includes("rapport")?n.jsx(Tu,{className:"w-4 h-4"}):i.includes("support")?n.jsx(E5,{className:"w-4 h-4"}):i.includes("API")?n.jsx(cl,{className:"w-4 h-4"}):n.jsx(d1,{className:"w-4 h-4"});return n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Choisissez votre plan d'abonnement"}),n.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Sélectionnez le plan qui correspond le mieux aux besoins de votre établissement. Tous les plans incluent 14 jours d'essai gratuit."})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto",children:zD.map(i=>n.jsxs(K,{className:`relative ${i.isPopular?"border-blue-500 shadow-lg scale-105":"border-gray-200"}`,padding:"lg",children:[i.isPopular&&n.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:n.jsxs("span",{className:"bg-blue-500 text-white px-4 py-1 rounded-full text-sm font-medium flex items-center",children:[n.jsx(Ud,{className:"w-4 h-4 mr-1"}),"Plus populaire"]})}),n.jsxs("div",{className:"text-center mb-6",children:[n.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:i.name}),n.jsxs("div",{className:"mb-4",children:[n.jsx("span",{className:"text-4xl font-bold text-blue-600",children:s(i.price)}),n.jsx("span",{className:"text-gray-600",children:"/mois"})]}),n.jsxs("div",{className:"flex justify-center space-x-4 text-sm text-gray-600 mb-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Xe,{className:"w-4 h-4 mr-1"}),i.maxUsers===-1?"Illimité":`${i.maxUsers} utilisateurs`]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(yt,{className:"w-4 h-4 mr-1"}),i.maxProducts===-1?"Illimité":`${i.maxProducts} produits`]})]})]}),n.jsx("div",{className:"space-y-3 mb-8",children:i.features.map((a,o)=>n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:r(a)}),n.jsx("span",{className:"text-sm text-gray-700",children:a})]},o))}),n.jsx(O,{fullWidth:!0,variant:i.isPopular?"primary":"ghost",onClick:()=>t(i.id),disabled:e===i.id,children:e===i.id?"Plan actuel":"Choisir ce plan"})]},i.id))}),n.jsxs("div",{className:"text-center text-sm text-gray-600",children:[n.jsx("p",{children:"💡 Tous les plans incluent 14 jours d'essai gratuit"}),n.jsx("p",{children:"🔒 Paiement sécurisé • 📞 Support en français • 🇲🇬 Adapté pour Madagascar"})]})]})},qD=({subscription:t,onUpgrade:e})=>{const s=d=>{switch(d){case"trial":return"bg-blue-100 text-blue-800 border-blue-200";case"active":return"bg-green-100 text-green-800 border-green-200";case"expired":return"bg-red-100 text-red-800 border-red-200";case"suspended":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},r=d=>{switch(d){case"trial":return n.jsx(ks,{className:"w-5 h-5"});case"active":return n.jsx(zt,{className:"w-5 h-5"});case"expired":return n.jsx(Me,{className:"w-5 h-5"});case"suspended":return n.jsx(Me,{className:"w-5 h-5"});default:return n.jsx(ks,{className:"w-5 h-5"})}},i=d=>{switch(d){case"trial":return"Période d'essai";case"active":return"Actif";case"expired":return"Expiré";case"suspended":return"Suspendu";default:return d}},a=d=>{switch(d){case"starter":return"Starter";case"business":return"Business";case"enterprise":return"Enterprise";case"trial":return"Essai gratuit";default:return d}},o=t.daysLeft<=7,l=t.daysLeft<=0;return n.jsxs(K,{className:`${o?"border-orange-200 bg-orange-50":""}`,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:`p-3 rounded-lg ${t.status==="active"?"bg-green-100":t.status==="trial"?"bg-blue-100":"bg-gray-100"}`,children:n.jsx(h1,{className:`w-8 h-8 ${t.status==="active"?"text-green-600":t.status==="trial"?"text-blue-600":"text-gray-600"}`})}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Plan ",a(t.plan)]}),n.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[r(t.status),n.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${s(t.status)}`,children:i(t.status)})]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("div",{className:"flex items-center text-gray-600 mb-1",children:[n.jsx(kt,{className:"w-4 h-4 mr-1"}),n.jsx("span",{className:"text-sm",children:l?"Expiré le":"Expire le"})]}),n.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.endDate.toLocaleDateString("fr-FR")}),n.jsx("p",{className:`text-sm font-medium ${l?"text-red-600":o?"text-orange-600":"text-green-600"}`,children:l?"Expiré":`${t.daysLeft} jours restants`})]})]}),(o||l)&&n.jsx("div",{className:"mt-4 p-4 bg-orange-100 border border-orange-200 rounded-lg",children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(Me,{className:"w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-medium text-orange-800",children:l?"Abonnement expiré":"Abonnement bientôt expiré"}),n.jsx("p",{className:"text-sm text-orange-700 mt-1",children:l?"Votre abonnement a expiré. Renouvelez-le pour continuer à utiliser toutes les fonctionnalités.":`Votre abonnement expire dans ${t.daysLeft} jours. Renouvelez-le pour éviter toute interruption de service.`}),n.jsxs(O,{size:"sm",className:"mt-3",onClick:e,children:[n.jsx(cl,{className:"w-4 h-4 mr-2"}),l?"Renouveler maintenant":"Renouveler l'abonnement"]})]})]})}),t.status==="trial"&&!o&&n.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(zt,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-medium text-blue-800",children:"Période d'essai active"}),n.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Profitez de toutes les fonctionnalités gratuitement pendant votre période d'essai. Vous pourrez choisir un plan avant la fin de votre essai."})]})]})})]})},av=[{id:"mvola",name:"MVola",icon:fn,color:"text-red-600",instructions:"Envoyez le montant au numéro MVola : +261 34 XX XXX XX"},{id:"orange_money",name:"Orange Money",icon:fn,color:"text-orange-600",instructions:"Envoyez le montant au numéro Orange Money : +261 32 XX XXX XX"},{id:"airtel_money",name:"Airtel Money",icon:fn,color:"text-red-600",instructions:"Envoyez le montant au numéro Airtel Money : +261 33 XX XXX XX"},{id:"bank_transfer",name:"Virement bancaire",icon:Qn,color:"text-blue-600",instructions:"Effectuez un virement vers : BNI Madagascar - Compte : 12345678901"},{id:"cash",name:"Espèces",icon:Pl,color:"text-green-600",instructions:"Déposez le montant dans nos bureaux à Antananarivo"}],GD=({subscriptionId:t,amount:e,onSubmit:s,onCancel:r,isLoading:i=!1})=>{const[a,o]=I.useState({paymentMethod:"mvola",paymentReference:"",notes:""}),[l,d]=I.useState({}),u=y=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(y).replace("MGA","Ar"),h=av.find(y=>y.id===a.paymentMethod),m=(y,R)=>{o(_=>({..._,[y]:R})),l[y]&&d(_=>({..._,[y]:""}))},g=()=>{const y={};return a.paymentReference.trim()||(y.paymentReference="La référence de paiement est requise"),d(y),Object.keys(y).length===0},x=y=>{y.preventDefault(),g()&&s({subscriptionId:t,amount:e,...a})};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Demande de paiement"}),n.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("form",{onSubmit:x,className:"p-6",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsxs("div",{className:"text-center",children:[n.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Montant à payer"}),n.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:u(e)})]})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Méthode de paiement *"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:av.map(y=>{const R=y.icon;return n.jsx("button",{type:"button",onClick:()=>m("paymentMethod",y.id),className:`p-4 border-2 rounded-lg transition-all ${a.paymentMethod===y.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(R,{className:`w-6 h-6 ${y.color}`}),n.jsx("span",{className:"font-medium text-gray-900",children:y.name})]})},y.id)})})]}),h&&n.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(kr,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-yellow-800",children:"Instructions de paiement"}),n.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:h.instructions})]})]})}),n.jsx(xe,{label:"Référence de paiement *",value:a.paymentReference,onChange:y=>m("paymentReference",y.target.value),error:l.paymentReference,placeholder:"Ex: Transaction ID, numéro de reçu, etc.",leftIcon:n.jsx(yn,{className:"w-4 h-4"})}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optionnel)"}),n.jsx("textarea",{value:a.notes,onChange:y=>m("notes",y.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Informations supplémentaires sur le paiement..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Preuve de paiement (optionnel)"}),n.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[n.jsx(Pu,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Téléchargez une capture d'écran ou photo du reçu"}),n.jsx(O,{variant:"ghost",size:"sm",type:"button",children:"Choisir un fichier"}),n.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formats acceptés: JPG, PNG, PDF (max 5MB)"})]})]}),n.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[n.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"⏰ Délai de traitement"}),n.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[n.jsx("li",{children:"• MVola/Orange Money/Airtel Money: 2-4 heures ouvrables"}),n.jsx("li",{children:"• Virement bancaire: 1-2 jours ouvrables"}),n.jsx("li",{children:"• Espèces: Immédiat lors du dépôt"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:r,disabled:i,children:"Annuler"}),n.jsx(O,{type:"submit",disabled:i,children:i?"Envoi en cours...":"Envoyer la demande"})]})]})]})})},WD=()=>{const[t,e]=I.useState(!1),[s,r]=I.useState(null),[i,a]=I.useState(!1),[o,l]=I.useState(null),[d,u]=I.useState([]),[h,m]=I.useState(!0),[g,x]=I.useState(!1),{user:y}=Fe(),R={starter:15e3,business:35e3,enterprise:75e3},_=async()=>{var v,b,N,f,j,E;if(y!=null&&y.establishmentId)try{m(!0);const S=await Rs(he(H,"subscriptions",`sub_${y.establishmentId}`));if(S.exists()){const W=S.data();l({...W,startDate:(v=W.startDate)==null?void 0:v.toDate(),endDate:(b=W.endDate)==null?void 0:b.toDate(),trialEndDate:(N=W.trialEndDate)==null?void 0:N.toDate(),lastPaymentDate:(f=W.lastPaymentDate)==null?void 0:f.toDate(),nextPaymentDate:(j=W.nextPaymentDate)==null?void 0:j.toDate(),daysLeft:Math.ceil((((E=W.endDate)==null?void 0:E.toDate().getTime())-Date.now())/(1e3*60*60*24))})}else{const W=new Date(Date.now()+12096e5),oe={id:`sub_${y.establishmentId}`,establishmentId:y.establishmentId,establishmentName:y.name||"Mon Établissement",plan:"trial",status:"trial",startDate:new Date,endDate:W,trialEndDate:W,monthlyPrice:0,nextPaymentDate:W,daysLeft:14,createdAt:new Date,updatedAt:new Date};l(oe),await Je(he(H,"subscriptions",`sub_${y.establishmentId}`),{...oe,startDate:Q.fromDate(oe.startDate),endDate:Q.fromDate(oe.endDate),trialEndDate:Q.fromDate(oe.trialEndDate),nextPaymentDate:Q.fromDate(oe.nextPaymentDate),createdAt:Q.now(),updatedAt:Q.now()})}const ee=Ae(Ee(H,"payment_requests"),ce("establishmentId","==",y.establishmentId)),J=(await Ie(ee)).docs.map(W=>{var X,re;const oe=W.data();return{id:W.id,...oe,submittedAt:(X=oe.submittedAt)==null?void 0:X.toDate(),processedAt:(re=oe.processedAt)==null?void 0:re.toDate()}}).sort((W,oe)=>!W.submittedAt||!oe.submittedAt?0:oe.submittedAt.getTime()-W.submittedAt.getTime());u(J)}catch(S){console.error("Erreur lors du chargement des données:",S),L.error("Erreur lors du chargement des données d'abonnement")}finally{m(!1),x(!1)}};I.useEffect(()=>{if(!(y!=null&&y.establishmentId))return;const v=he(H,"subscriptions",`sub_${y.establishmentId}`),b=vP(v,N=>{var f,j,E,S,ee,U;if(N.exists()){const z=N.data();l({...z,startDate:(f=z.startDate)==null?void 0:f.toDate(),endDate:(j=z.endDate)==null?void 0:j.toDate(),trialEndDate:(E=z.trialEndDate)==null?void 0:E.toDate(),lastPaymentDate:(S=z.lastPaymentDate)==null?void 0:S.toDate(),nextPaymentDate:(ee=z.nextPaymentDate)==null?void 0:ee.toDate(),daysLeft:Math.ceil((((U=z.endDate)==null?void 0:U.toDate().getTime())-Date.now())/(1e3*60*60*24))})}},N=>{console.error("Erreur lors de l'écoute des changements d'abonnement:",N)});return()=>b()},[y==null?void 0:y.establishmentId]),I.useEffect(()=>{_()},[y==null?void 0:y.establishmentId]);const T=v=>{r(v),e(!0)},A=async v=>{if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}a(!0);try{const b=`payment_${Date.now()}`,N={id:b,subscriptionId:`sub_${y.establishmentId}`,establishmentId:y.establishmentId,establishmentName:(o==null?void 0:o.establishmentName)||"Mon Établissement",amount:v.amount,paymentMethod:v.paymentMethod,paymentReference:v.paymentReference,status:"pending",submittedAt:Q.now(),notes:v.notes,createdAt:Q.now(),updatedAt:Q.now()};if(await Je(he(H,"payment_requests",b),N),s){const f=o.endDate,j=new Date,E=f>j?f:j,S=new Date(E);S.setDate(S.getDate()+30),await ht(he(H,"subscriptions",`sub_${y.establishmentId}`),{plan:s,status:"pending_payment",endDate:Q.fromDate(S),nextPaymentDate:Q.fromDate(S),monthlyPrice:R[s],updatedAt:Q.now()}),await _()}e(!1),r(null),L.success("Demande de paiement envoyée avec succès !"),L("Votre demande sera traitée dans les prochaines heures.")}catch(b){console.error("Erreur lors de l'envoi de la demande:",b),L.error("Erreur lors de l'envoi de la demande")}finally{a(!1)}},C=()=>{x(!0),_()},k=v=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(v).replace("MGA","Ar"),D=v=>{switch(v){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},P=v=>{switch(v){case"pending":return"En attente";case"approved":return"Approuvé";case"rejected":return"Rejeté";default:return v}};return h?n.jsxs("div",{className:"text-center py-12",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement de votre abonnement..."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestion de votre abonnement"}),n.jsx("p",{className:"text-gray-600",children:"Gérez votre abonnement Nirina Nirina Pos et accédez à toutes les fonctionnalités pour développer votre business à Madagascar."})]}),n.jsxs(O,{variant:"ghost",onClick:C,disabled:g,children:[n.jsx(Zs,{className:`w-4 h-4 mr-2 ${g?"animate-spin":""}`}),"Actualiser"]})]}),o&&n.jsx(qD,{subscription:o,onUpgrade:()=>e(!0)}),o&&o.status==="pending_payment"&&n.jsx(K,{className:"bg-yellow-50 border-yellow-200",children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(ks,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h4",{className:"font-medium text-yellow-800",children:"Paiement en attente de validation"}),n.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["Votre demande de paiement pour le plan ",n.jsx("strong",{children:s||o.plan})," est en cours de traitement. Votre abonnement sera activé dès que notre équipe aura validé votre paiement."]}),n.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"Délai de traitement habituel : 2-4 heures ouvrables."})]})]})}),d.length>0&&n.jsxs(K,{children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[n.jsx(A5,{className:"w-5 h-5 mr-2"}),"Historique des paiements"]}),n.jsxs(O,{variant:"ghost",size:"sm",children:[n.jsx(ps,{className:"w-4 h-4 mr-2"}),"Exporter"]})]}),n.jsx("div",{className:"space-y-3",children:d.slice(0,5).map(v=>{var b;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-sm text-gray-900",children:k(v.amount)}),n.jsxs("p",{className:"text-xs text-gray-600",children:[v.paymentMethod," • ",v.paymentReference]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D(v.status)}`,children:P(v.status)}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(b=v.submittedAt)==null?void 0:b.toLocaleDateString("fr-FR")})]})]},v.id)})})]}),n.jsx(BD,{onSelectPlan:T,currentPlan:o==null?void 0:o.plan}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"💳 Méthodes de paiement acceptées"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:n.jsx("span",{className:"text-red-600 font-bold text-sm",children:"M"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"MVola"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Paiement mobile"})]})]}),n.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:n.jsx("span",{className:"text-orange-600 font-bold text-sm",children:"O"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Orange Money"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Paiement mobile"})]})]}),n.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:n.jsx("span",{className:"text-red-600 font-bold text-sm",children:"A"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Airtel Money"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Paiement mobile"})]})]}),n.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[n.jsx(yn,{className:"w-8 h-8 text-blue-600"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Virement bancaire"}),n.jsx("p",{className:"text-sm text-gray-600",children:"BNI, BOA, BFV"})]})]}),n.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[n.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:n.jsx("span",{className:"text-green-600 font-bold text-sm",children:"💰"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-gray-900",children:"Espèces"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Dépôt en agence"})]})]})]})]}),n.jsxs(K,{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"🆘 Besoin d'aide ?"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Contact Support"}),n.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[n.jsx("p",{children:"📧 Email: admin@saasmada.pro"}),n.jsx("p",{children:"📱 WhatsApp: +261 32 46 118 07"}),n.jsx("p",{children:"🕒 Lundi - Vendredi: 8h - 17h"})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Questions fréquentes"}),n.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[n.jsx("p",{children:"• Comment changer de plan ?"}),n.jsx("p",{children:"• Délai de validation des paiements"}),n.jsx("p",{children:"• Remboursement et annulation"}),n.jsx("p",{children:"• Formation et support technique"})]})]})]})]}),t&&n.jsx(GD,{subscriptionId:`sub_${y==null?void 0:y.establishmentId}`,amount:s?R[s]:(o==null?void 0:o.monthlyPrice)||0,onSubmit:A,onCancel:()=>{e(!1),r(null)},isLoading:i})]})},HD=({request:t,onClose:e,onApprove:s,onReject:r})=>{const i=u=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(u).replace("MGA","Ar"),a=u=>{switch(u){case"mvola":return n.jsx(fn,{className:"w-5 h-5 text-red-600"});case"orange_money":return n.jsx(fn,{className:"w-5 h-5 text-orange-600"});case"airtel_money":return n.jsx(fn,{className:"w-5 h-5 text-red-600"});case"bank_transfer":return n.jsx(Qn,{className:"w-5 h-5 text-blue-600"});case"cash":return n.jsx(Pl,{className:"w-5 h-5 text-green-600"});default:return n.jsx(yn,{className:"w-5 h-5 text-gray-600"})}},o=u=>({mvola:"MVola",orange_money:"Orange Money",airtel_money:"Airtel Money",bank_transfer:"Virement bancaire",cash:"Espèces"})[u]||u,l=u=>{switch(u){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},d=u=>{switch(u){case"pending":return"En attente";case"approved":return"Approuvé";case"rejected":return"Rejeté";default:return u}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs(K,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[n.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[n.jsx(_a,{className:"w-6 h-6 mr-2"}),"Détails de la demande de paiement"]}),n.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n.jsx(vt,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"p-6 space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(At,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Établissement"}),n.jsx("p",{className:"font-semibold text-gray-900",children:t.establishmentName})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx(kt,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Date de soumission"}),n.jsxs("p",{className:"font-semibold text-gray-900",children:[t.submittedAt.toLocaleDateString("fr-FR")," à ",t.submittedAt.toLocaleTimeString("fr-FR")]})]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(Tt,{className:"w-5 h-5 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Montant"}),n.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i(t.amount)})]})]}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"mr-3",children:a(t.paymentMethod)}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Méthode de paiement"}),n.jsx("p",{className:"font-semibold text-gray-900",children:o(t.paymentMethod)})]})]})]})]}),n.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[n.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Référence de paiement"}),n.jsx("p",{className:"font-mono text-lg text-gray-800 bg-white p-3 rounded border",children:t.paymentReference})]}),t.notes&&n.jsxs("div",{children:[n.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Notes"}),n.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:n.jsx("p",{className:"text-gray-700",children:t.notes})})]}),n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Statut de la demande"}),n.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full border ${l(t.status)}`,children:d(t.status)})]}),t.processedAt&&n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Traité le"}),n.jsx("p",{className:"font-medium text-gray-900",children:t.processedAt.toLocaleDateString("fr-FR")}),t.processedBy&&n.jsxs("p",{className:"text-sm text-gray-500",children:["par ",t.processedBy]})]})]}),n.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[n.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Instructions de vérification"}),n.jsxs("div",{className:"text-sm text-yellow-700",children:[t.paymentMethod==="mvola"&&n.jsx("p",{children:"Vérifiez la transaction MVola avec la référence fournie dans votre historique des transactions."}),t.paymentMethod==="orange_money"&&n.jsx("p",{children:"Vérifiez la transaction Orange Money avec la référence fournie dans votre historique des transactions."}),t.paymentMethod==="airtel_money"&&n.jsx("p",{children:"Vérifiez la transaction Airtel Money avec la référence fournie dans votre historique des transactions."}),t.paymentMethod==="bank_transfer"&&n.jsx("p",{children:"Vérifiez le virement bancaire dans votre compte avec la référence fournie."}),t.paymentMethod==="cash"&&n.jsx("p",{children:"Vérifiez le dépôt d'espèces avec la référence fournie auprès de votre agence."})]})]})]}),n.jsxs("div",{className:"flex justify-between gap-3 p-6 border-t border-gray-200",children:[n.jsx(O,{variant:"ghost",onClick:e,children:"Fermer"}),t.status==="pending"&&n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(O,{variant:"danger",onClick:()=>{r(t.id),e()},children:[n.jsx(aa,{className:"w-4 h-4 mr-2"}),"Rejeter"]}),n.jsxs(O,{variant:"success",onClick:()=>{s(t.id),e()},children:[n.jsx(zt,{className:"w-4 h-4 mr-2"}),"Approuver"]})]})]})]})})},KD=()=>{const[t,e]=I.useState([]),[s,r]=I.useState("pending"),[i,a]=I.useState(""),[o,l]=I.useState(!0),[d,u]=I.useState(null),[h,m]=I.useState(!1),{user:g}=Fe(),x=async()=>{try{l(!0);let v;s==="all"?v=Ae(Ee(H,"payment_requests")):v=Ae(Ee(H,"payment_requests"),ce("status","==",s));const f=(await Ie(v)).docs.map(j=>{var S,ee,U,z;const E=j.data();return{id:j.id,...E,submittedAt:((S=E.submittedAt)==null?void 0:S.toDate())||new Date,processedAt:(ee=E.processedAt)==null?void 0:ee.toDate(),createdAt:((U=E.createdAt)==null?void 0:U.toDate())||new Date,updatedAt:((z=E.updatedAt)==null?void 0:z.toDate())||new Date}}).sort((j,E)=>E.submittedAt.getTime()-j.submittedAt.getTime());e(f)}catch(v){console.error("Erreur lors du chargement des demandes:",v),L.error("Erreur lors du chargement des demandes")}finally{l(!1)}};I.useEffect(()=>{(g==null?void 0:g.role)==="admin"&&x()},[s,g]);const y=async v=>{var b;if(window.confirm("Êtes-vous sûr de vouloir approuver ce paiement ?"))try{const N=t.find(E=>E.id===v);if(!N){L.error("Demande de paiement non trouvée");return}await ht(he(H,"payment_requests",v),{status:"approved",processedAt:Q.now(),processedBy:(g==null?void 0:g.name)||"Admin"});const f=N.subscriptionId,j=await Rs(he(H,"subscriptions",f));if(j.exists()){const S=((b=j.data().endDate)==null?void 0:b.toDate())||new Date,ee=new Date,U=S>ee?S:ee,z=new Date(U);z.setDate(z.getDate()+30),await ht(he(H,"subscriptions",f),{status:"active",endDate:Q.fromDate(z),nextPaymentDate:Q.fromDate(z),lastPaymentDate:Q.now(),updatedAt:Q.now()})}await x(),L.success("Paiement approuvé avec succès")}catch(N){console.error("Erreur lors de l'approbation:",N),L.error("Erreur lors de l'approbation")}},R=async(v,b)=>{var N;if(window.confirm("Êtes-vous sûr de vouloir rejeter ce paiement ?"))try{const f=t.find(S=>S.id===v);if(!f){L.error("Demande de paiement non trouvée");return}await ht(he(H,"payment_requests",v),{status:"rejected",processedAt:Q.now(),processedBy:(g==null?void 0:g.name)||"Admin",notes:b||"Paiement rejeté par l'administrateur"});const j=f.subscriptionId,E=await Rs(he(H,"subscriptions",j));if(E.exists()){const S=E.data();S.status==="pending_payment"&&await ht(he(H,"subscriptions",j),{status:((N=S.endDate)==null?void 0:N.toDate())<new Date?"expired":"active",updatedAt:Q.now()})}await x(),L.success("Paiement rejeté")}catch(f){console.error("Erreur lors du rejet:",f),L.error("Erreur lors du rejet")}},_=v=>{u(v),m(!0)},T=v=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(v).replace("MGA","Ar"),A=v=>{switch(v){case"pending":return n.jsx(ks,{className:"w-4 h-4 text-yellow-600"});case"approved":return n.jsx(zt,{className:"w-4 h-4 text-green-600"});case"rejected":return n.jsx(aa,{className:"w-4 h-4 text-red-600"});default:return n.jsx(ks,{className:"w-4 h-4 text-gray-600"})}},C=v=>{switch(v){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},k=v=>({mvola:"MVola",orange_money:"Orange Money",airtel_money:"Airtel Money",bank_transfer:"Virement bancaire",cash:"Espèces"})[v]||v,D=t.filter(v=>v.establishmentName.toLowerCase().includes(i.toLowerCase())||v.paymentReference.toLowerCase().includes(i.toLowerCase())),P={pending:t.filter(v=>v.status==="pending").length,approved:t.filter(v=>v.status==="approved").length,rejected:t.filter(v=>v.status==="rejected").length,totalAmount:t.filter(v=>v.status==="pending").reduce((v,b)=>v+b.amount,0)};return(g==null?void 0:g.role)!=="admin"?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Me,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),n.jsx("p",{className:"text-gray-600",children:"Seuls les administrateurs peuvent accéder à cette section."})]}):n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Validation des paiements"}),n.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez les demandes de paiement des abonnements clients"})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:n.jsx(ks,{className:"w-6 h-6 text-yellow-600"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"En attente"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:P.pending})]})]})}),n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:n.jsx(zt,{className:"w-6 h-6 text-green-600"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approuvés"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:P.approved})]})]})}),n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:n.jsx(aa,{className:"w-6 h-6 text-red-600"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejetés"}),n.jsx("p",{className:"text-2xl font-bold text-gray-900",children:P.rejected})]})]})}),n.jsx(K,{padding:"md",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:n.jsx(Tt,{className:"w-6 h-6 text-blue-600"})}),n.jsxs("div",{className:"ml-4",children:[n.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Montant en attente"}),n.jsx("p",{className:"text-xl font-bold text-gray-900",children:T(P.totalAmount)})]})]})})]}),n.jsx(K,{children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"relative",children:[n.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),n.jsx("input",{type:"text",placeholder:"Rechercher par établissement ou référence...",value:i,onChange:v=>a(v.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})}),n.jsxs("select",{value:s,onChange:v=>r(v.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[n.jsx("option",{value:"all",children:"Tous les statuts"}),n.jsx("option",{value:"pending",children:"En attente"}),n.jsx("option",{value:"approved",children:"Approuvés"}),n.jsx("option",{value:"rejected",children:"Rejetés"})]})]})}),n.jsx(K,{children:o?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),n.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des demandes..."})]}):D.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Tt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune demande trouvée"}),n.jsx("p",{className:"text-gray-500",children:"Aucune demande de paiement ne correspond à vos critères"})]}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Établissement"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Montant"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Méthode"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Référence"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Statut"}),n.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(v=>n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(At,{className:"w-8 h-8 text-gray-400 mr-3"}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm font-medium text-gray-900",children:v.establishmentName}),n.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",v.establishmentId.slice(-8)]})]})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("div",{className:"text-lg font-bold text-blue-600",children:T(v.amount)})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:"text-sm text-gray-900",children:k(v.paymentMethod)})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsx("span",{className:"text-sm font-mono text-gray-900",children:v.paymentReference})}),n.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[n.jsx("div",{className:"text-sm text-gray-900",children:v.submittedAt.toLocaleDateString("fr-FR")}),n.jsx("div",{className:"text-sm text-gray-500",children:v.submittedAt.toLocaleTimeString("fr-FR")})]}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center",children:[A(v.status),n.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${C(v.status)}`,children:v.status==="pending"?"En attente":v.status==="approved"?"Approuvé":"Rejeté"})]})}),n.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(O,{variant:"ghost",size:"sm",onClick:()=>_(v),title:"Voir les détails",children:n.jsx(Bs,{className:"w-4 h-4"})}),v.status==="pending"&&n.jsxs(n.Fragment,{children:[n.jsx(O,{variant:"success",size:"sm",onClick:()=>y(v.id),title:"Approuver",children:n.jsx(zt,{className:"w-4 h-4"})}),n.jsx(O,{variant:"danger",size:"sm",onClick:()=>R(v.id),title:"Rejeter",children:n.jsx(aa,{className:"w-4 h-4"})})]})]})})]},v.id))})]})})}),h&&d&&n.jsx(HD,{request:d,onClose:()=>{m(!1),u(null)},onApprove:y,onReject:R})]})},QD=({size:t="md",color:e="blue",text:s})=>{const r={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"},i={blue:"border-blue-600",green:"border-green-600",purple:"border-purple-600",gray:"border-gray-600"};return n.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[n.jsx("div",{className:`${r[t]} border-2 ${i[e]} border-t-transparent rounded-full animate-spin`}),s&&n.jsx("p",{className:"text-sm text-gray-600 font-medium",children:s})]})},Ns=({children:t})=>{const{user:e,isLoading:s}=Fe();return s?n.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:n.jsx(QD,{size:"lg",text:"Chargement..."})}):e?n.jsx(n.Fragment,{children:t}):n.jsx(Cw,{to:"/login",replace:!0})};function YD(){const{initialize:t}=Fe(),[e,s]=To.useState(!1);return I.useEffect(()=>{t()},[t]),n.jsxs(n.Fragment,{children:[n.jsx(uE,{children:n.jsxs(rE,{children:[n.jsx(Yt,{path:"/login",element:n.jsx(z5,{})}),n.jsx(Yt,{path:"/setup",element:n.jsx(q5,{})}),n.jsx(Yt,{path:"/",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(K5,{})})})}),n.jsx(Yt,{path:"/pos",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(J5,{})})})}),n.jsx(Yt,{path:"/products",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(rD,{})})})}),n.jsx(Yt,{path:"/categories",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(iD,{})})})}),n.jsx(Yt,{path:"/stores",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(RD,{})})})}),n.jsx(Yt,{path:"/customers",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(dD,{})})})}),n.jsx(Yt,{path:"/sales",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(gD,{})})})}),n.jsx(Yt,{path:"/expenses",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(ED,{})})})}),n.jsx(Yt,{path:"/cash-register",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(PD,{isOpen:e,onToggleRegister:()=>s(!e)})})})}),n.jsx(Yt,{path:"/reports",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(DD,{})})})}),n.jsx(Yt,{path:"/settings",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(UD,{})})})}),n.jsx(Yt,{path:"/subscription",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(WD,{})})})}),n.jsx(Yt,{path:"/admin/payments",element:n.jsx(Ns,{children:n.jsx(js,{children:n.jsx(KD,{})})})})]})}),n.jsx(rA,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})}bw(document.getElementById("root")).render(n.jsx(I.StrictMode,{children:n.jsx(YD,{})}));
