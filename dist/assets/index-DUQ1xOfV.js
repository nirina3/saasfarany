function d_(t,e){for(var s=0;s<e.length;s++){const n=e[s];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const a=Object.getOwnPropertyDescriptor(n,i);a&&Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();function yv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vv={exports:{}},Kd={},bv={exports:{}},$e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xl=Symbol.for("react.element"),u_=Symbol.for("react.portal"),m_=Symbol.for("react.fragment"),h_=Symbol.for("react.strict_mode"),p_=Symbol.for("react.profiler"),f_=Symbol.for("react.provider"),g_=Symbol.for("react.context"),x_=Symbol.for("react.forward_ref"),y_=Symbol.for("react.suspense"),v_=Symbol.for("react.memo"),b_=Symbol.for("react.lazy"),px=Symbol.iterator;function w_(t){return t===null||typeof t!="object"?null:(t=px&&t[px]||t["@@iterator"],typeof t=="function"?t:null)}var wv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jv=Object.assign,Nv={};function Ia(t,e,s){this.props=t,this.context=e,this.refs=Nv,this.updater=s||wv}Ia.prototype.isReactComponent={};Ia.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ia.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function _v(){}_v.prototype=Ia.prototype;function pp(t,e,s){this.props=t,this.context=e,this.refs=Nv,this.updater=s||wv}var fp=pp.prototype=new _v;fp.constructor=pp;jv(fp,Ia.prototype);fp.isPureReactComponent=!0;var fx=Array.isArray,Sv=Object.prototype.hasOwnProperty,gp={current:null},Ev={key:!0,ref:!0,__self:!0,__source:!0};function Av(t,e,s){var n,i={},a=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)Sv.call(e,n)&&!Ev.hasOwnProperty(n)&&(i[n]=e[n]);var l=arguments.length-2;if(l===1)i.children=s;else if(1<l){for(var d=Array(l),u=0;u<l;u++)d[u]=arguments[u+2];i.children=d}if(t&&t.defaultProps)for(n in l=t.defaultProps,l)i[n]===void 0&&(i[n]=l[n]);return{$$typeof:xl,type:t,key:a,ref:o,props:i,_owner:gp.current}}function j_(t,e){return{$$typeof:xl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function xp(t){return typeof t=="object"&&t!==null&&t.$$typeof===xl}function N_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var gx=/\/+/g;function rm(t,e){return typeof t=="object"&&t!==null&&t.key!=null?N_(""+t.key):e.toString(36)}function Ac(t,e,s,n,i){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case xl:case u_:o=!0}}if(o)return o=t,i=i(o),t=n===""?"."+rm(o,0):n,fx(i)?(s="",t!=null&&(s=t.replace(gx,"$&/")+"/"),Ac(i,e,s,"",function(u){return u})):i!=null&&(xp(i)&&(i=j_(i,s+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(gx,"$&/")+"/")+t)),e.push(i)),1;if(o=0,n=n===""?".":n+":",fx(t))for(var l=0;l<t.length;l++){a=t[l];var d=n+rm(a,l);o+=Ac(a,e,s,d,i)}else if(d=w_(t),typeof d=="function")for(t=d.call(t),l=0;!(a=t.next()).done;)a=a.value,d=n+rm(a,l++),o+=Ac(a,e,s,d,i);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function rc(t,e,s){if(t==null)return t;var n=[],i=0;return Ac(t,n,"","",function(a){return e.call(s,a,i++)}),n}function __(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ps={current:null},Ic={transition:null},S_={ReactCurrentDispatcher:ps,ReactCurrentBatchConfig:Ic,ReactCurrentOwner:gp};function Iv(){throw Error("act(...) is not supported in production builds of React.")}$e.Children={map:rc,forEach:function(t,e,s){rc(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return rc(t,function(){e++}),e},toArray:function(t){return rc(t,function(e){return e})||[]},only:function(t){if(!xp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};$e.Component=Ia;$e.Fragment=m_;$e.Profiler=p_;$e.PureComponent=pp;$e.StrictMode=h_;$e.Suspense=y_;$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S_;$e.act=Iv;$e.cloneElement=function(t,e,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=jv({},t.props),i=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=gp.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(d in e)Sv.call(e,d)&&!Ev.hasOwnProperty(d)&&(n[d]=e[d]===void 0&&l!==void 0?l[d]:e[d])}var d=arguments.length-2;if(d===1)n.children=s;else if(1<d){l=Array(d);for(var u=0;u<d;u++)l[u]=arguments[u+2];n.children=l}return{$$typeof:xl,type:t.type,key:i,ref:a,props:n,_owner:o}};$e.createContext=function(t){return t={$$typeof:g_,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:f_,_context:t},t.Consumer=t};$e.createElement=Av;$e.createFactory=function(t){var e=Av.bind(null,t);return e.type=t,e};$e.createRef=function(){return{current:null}};$e.forwardRef=function(t){return{$$typeof:x_,render:t}};$e.isValidElement=xp;$e.lazy=function(t){return{$$typeof:b_,_payload:{_status:-1,_result:t},_init:__}};$e.memo=function(t,e){return{$$typeof:v_,type:t,compare:e===void 0?null:e}};$e.startTransition=function(t){var e=Ic.transition;Ic.transition={};try{t()}finally{Ic.transition=e}};$e.unstable_act=Iv;$e.useCallback=function(t,e){return ps.current.useCallback(t,e)};$e.useContext=function(t){return ps.current.useContext(t)};$e.useDebugValue=function(){};$e.useDeferredValue=function(t){return ps.current.useDeferredValue(t)};$e.useEffect=function(t,e){return ps.current.useEffect(t,e)};$e.useId=function(){return ps.current.useId()};$e.useImperativeHandle=function(t,e,s){return ps.current.useImperativeHandle(t,e,s)};$e.useInsertionEffect=function(t,e){return ps.current.useInsertionEffect(t,e)};$e.useLayoutEffect=function(t,e){return ps.current.useLayoutEffect(t,e)};$e.useMemo=function(t,e){return ps.current.useMemo(t,e)};$e.useReducer=function(t,e,s){return ps.current.useReducer(t,e,s)};$e.useRef=function(t){return ps.current.useRef(t)};$e.useState=function(t){return ps.current.useState(t)};$e.useSyncExternalStore=function(t,e,s){return ps.current.useSyncExternalStore(t,e,s)};$e.useTransition=function(){return ps.current.useTransition()};$e.version="18.3.1";bv.exports=$e;var A=bv.exports;const gn=yv(A),E_=d_({__proto__:null,default:gn},[A]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A_=A,I_=Symbol.for("react.element"),k_=Symbol.for("react.fragment"),C_=Object.prototype.hasOwnProperty,T_=A_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R_={key:!0,ref:!0,__self:!0,__source:!0};function kv(t,e,s){var n,i={},a=null,o=null;s!==void 0&&(a=""+s),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)C_.call(e,n)&&!R_.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:I_,type:t,key:a,ref:o,props:i,_owner:T_.current}}Kd.Fragment=k_;Kd.jsx=kv;Kd.jsxs=kv;vv.exports=Kd;var r=vv.exports,Cv={exports:{}},Vs={},Tv={exports:{}},Rv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,re){var Z=W.length;W.push(re);e:for(;0<Z;){var se=Z-1>>>1,Y=W[se];if(0<i(Y,re))W[se]=re,W[Z]=Y,Z=se;else break e}}function s(W){return W.length===0?null:W[0]}function n(W){if(W.length===0)return null;var re=W[0],Z=W.pop();if(Z!==re){W[0]=Z;e:for(var se=0,Y=W.length,U=Y>>>1;se<U;){var K=2*(se+1)-1,de=W[K],ne=K+1,be=W[ne];if(0>i(de,Z))ne<Y&&0>i(be,de)?(W[se]=be,W[ne]=Z,se=ne):(W[se]=de,W[K]=Z,se=K);else if(ne<Y&&0>i(be,Z))W[se]=be,W[ne]=Z,se=ne;else break e}}return re}function i(W,re){var Z=W.sortIndex-re.sortIndex;return Z!==0?Z:W.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var d=[],u=[],m=1,h=null,f=3,x=!1,y=!1,P=!1,_=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(W){for(var re=s(u);re!==null;){if(re.callback===null)n(u);else if(re.startTime<=W)n(u),re.sortIndex=re.expirationTime,e(d,re);else break;re=s(u)}}function S(W){if(P=!1,T(W),!y)if(s(d)!==null)y=!0,F(D);else{var re=s(u);re!==null&&X(S,re.startTime-W)}}function D(W,re){y=!1,P&&(P=!1,C(b),b=-1),x=!0;var Z=f;try{for(T(re),h=s(d);h!==null&&(!(h.expirationTime>re)||W&&!w());){var se=h.callback;if(typeof se=="function"){h.callback=null,f=h.priorityLevel;var Y=se(h.expirationTime<=re);re=t.unstable_now(),typeof Y=="function"?h.callback=Y:h===s(d)&&n(d),T(re)}else n(d);h=s(d)}if(h!==null)var U=!0;else{var K=s(u);K!==null&&X(S,K.startTime-re),U=!1}return U}finally{h=null,f=Z,x=!1}}var R=!1,v=null,b=-1,N=5,g=-1;function w(){return!(t.unstable_now()-g<N)}function I(){if(v!==null){var W=t.unstable_now();g=W;var re=!0;try{re=v(!0,W)}finally{re?E():(R=!1,v=null)}}else R=!1}var E;if(typeof k=="function")E=function(){k(I)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,V=ee.port2;ee.port1.onmessage=I,E=function(){V.postMessage(null)}}else E=function(){_(I,0)};function F(W){v=W,R||(R=!0,E())}function X(W,re){b=_(function(){W(t.unstable_now())},re)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){y||x||(y=!0,F(D))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return s(d)},t.unstable_next=function(W){switch(f){case 1:case 2:case 3:var re=3;break;default:re=f}var Z=f;f=re;try{return W()}finally{f=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,re){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Z=f;f=W;try{return re()}finally{f=Z}},t.unstable_scheduleCallback=function(W,re,Z){var se=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?se+Z:se):Z=se,W){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=Z+Y,W={id:m++,callback:re,priorityLevel:W,startTime:Z,expirationTime:Y,sortIndex:-1},Z>se?(W.sortIndex=Z,e(u,W),s(d)===null&&W===s(u)&&(P?(C(b),b=-1):P=!0,X(S,Z-se))):(W.sortIndex=Y,e(d,W),y||x||(y=!0,F(D))),W},t.unstable_shouldYield=w,t.unstable_wrapCallback=function(W){var re=f;return function(){var Z=f;f=re;try{return W.apply(this,arguments)}finally{f=Z}}}})(Rv);Tv.exports=Rv;var P_=Tv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D_=A,Ls=P_;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Pv=new Set,Vo={};function _i(t,e){ma(t,e),ma(t+"Capture",e)}function ma(t,e){for(Vo[t]=e,t=0;t<e.length;t++)Pv.add(e[t])}var Fr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gm=Object.prototype.hasOwnProperty,M_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xx={},yx={};function L_(t){return Gm.call(yx,t)?!0:Gm.call(xx,t)?!1:M_.test(t)?yx[t]=!0:(xx[t]=!0,!1)}function V_(t,e,s,n){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:s!==null?!s.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function O_(t,e,s,n){if(e===null||typeof e>"u"||V_(t,e,s,n))return!0;if(n)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function fs(t,e,s,n,i,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=s,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Gt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Gt[t]=new fs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Gt[e]=new fs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Gt[t]=new fs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Gt[t]=new fs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Gt[t]=new fs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Gt[t]=new fs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Gt[t]=new fs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Gt[t]=new fs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Gt[t]=new fs(t,5,!1,t.toLowerCase(),null,!1,!1)});var yp=/[\-:]([a-z])/g;function vp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(yp,vp);Gt[e]=new fs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(yp,vp);Gt[e]=new fs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(yp,vp);Gt[e]=new fs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Gt[t]=new fs(t,1,!1,t.toLowerCase(),null,!1,!1)});Gt.xlinkHref=new fs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Gt[t]=new fs(t,1,!1,t.toLowerCase(),null,!0,!0)});function bp(t,e,s,n){var i=Gt.hasOwnProperty(e)?Gt[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(O_(e,s,i,n)&&(s=null),n||i===null?L_(e)&&(s===null?t.removeAttribute(e):t.setAttribute(e,""+s)):i.mustUseProperty?t[i.propertyName]=s===null?i.type===3?!1:"":s:(e=i.attributeName,n=i.attributeNamespace,s===null?t.removeAttribute(e):(i=i.type,s=i===3||i===4&&s===!0?"":""+s,n?t.setAttributeNS(n,e,s):t.setAttribute(e,s))))}var Jr=D_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nc=Symbol.for("react.element"),zi=Symbol.for("react.portal"),Ui=Symbol.for("react.fragment"),wp=Symbol.for("react.strict_mode"),Wm=Symbol.for("react.profiler"),Dv=Symbol.for("react.provider"),Mv=Symbol.for("react.context"),jp=Symbol.for("react.forward_ref"),Hm=Symbol.for("react.suspense"),Km=Symbol.for("react.suspense_list"),Np=Symbol.for("react.memo"),on=Symbol.for("react.lazy"),Lv=Symbol.for("react.offscreen"),vx=Symbol.iterator;function Za(t){return t===null||typeof t!="object"?null:(t=vx&&t[vx]||t["@@iterator"],typeof t=="function"?t:null)}var gt=Object.assign,nm;function lo(t){if(nm===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);nm=e&&e[1]||""}return`
`+nm+t}var im=!1;function am(t,e){if(!t||im)return"";im=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){n=u}t.call(e.prototype)}else{try{throw Error()}catch(u){n=u}t()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),a=n.stack.split(`
`),o=i.length-1,l=a.length-1;1<=o&&0<=l&&i[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==a[l]){var d=`
`+i[o].replace(" at new "," at ");return t.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",t.displayName)),d}while(1<=o&&0<=l);break}}}finally{im=!1,Error.prepareStackTrace=s}return(t=t?t.displayName||t.name:"")?lo(t):""}function F_(t){switch(t.tag){case 5:return lo(t.type);case 16:return lo("Lazy");case 13:return lo("Suspense");case 19:return lo("SuspenseList");case 0:case 2:case 15:return t=am(t.type,!1),t;case 11:return t=am(t.type.render,!1),t;case 1:return t=am(t.type,!0),t;default:return""}}function Qm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ui:return"Fragment";case zi:return"Portal";case Wm:return"Profiler";case wp:return"StrictMode";case Hm:return"Suspense";case Km:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Mv:return(t.displayName||"Context")+".Consumer";case Dv:return(t._context.displayName||"Context")+".Provider";case jp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Np:return e=t.displayName||null,e!==null?e:Qm(t.type)||"Memo";case on:e=t._payload,t=t._init;try{return Qm(t(e))}catch{}}return null}function $_(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qm(e);case 8:return e===wp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Dn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Vv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function z_(t){var e=Vv(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var i=s.get,a=s.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ic(t){t._valueTracker||(t._valueTracker=z_(t))}function Ov(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),n="";return t&&(n=Vv(t)?t.checked?"true":"false":t.value),t=n,t!==s?(e.setValue(t),!0):!1}function Qc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ym(t,e){var s=e.checked;return gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??t._wrapperState.initialChecked})}function bx(t,e){var s=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;s=Dn(e.value!=null?e.value:s),t._wrapperState={initialChecked:n,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Fv(t,e){e=e.checked,e!=null&&bp(t,"checked",e,!1)}function Xm(t,e){Fv(t,e);var s=Dn(e.value),n=e.type;if(s!=null)n==="number"?(s===0&&t.value===""||t.value!=s)&&(t.value=""+s):t.value!==""+s&&(t.value=""+s);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Jm(t,e.type,s):e.hasOwnProperty("defaultValue")&&Jm(t,e.type,Dn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function wx(t,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,s||e===t.value||(t.value=e),t.defaultValue=e}s=t.name,s!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,s!==""&&(t.name=s)}function Jm(t,e,s){(e!=="number"||Qc(t.ownerDocument)!==t)&&(s==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+s&&(t.defaultValue=""+s))}var co=Array.isArray;function ea(t,e,s,n){if(t=t.options,e){e={};for(var i=0;i<s.length;i++)e["$"+s[i]]=!0;for(s=0;s<t.length;s++)i=e.hasOwnProperty("$"+t[s].value),t[s].selected!==i&&(t[s].selected=i),i&&n&&(t[s].defaultSelected=!0)}else{for(s=""+Dn(s),e=null,i=0;i<t.length;i++){if(t[i].value===s){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Zm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function jx(t,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(ae(92));if(co(s)){if(1<s.length)throw Error(ae(93));s=s[0]}e=s}e==null&&(e=""),s=e}t._wrapperState={initialValue:Dn(s)}}function $v(t,e){var s=Dn(e.value),n=Dn(e.defaultValue);s!=null&&(s=""+s,s!==t.value&&(t.value=s),e.defaultValue==null&&t.defaultValue!==s&&(t.defaultValue=s)),n!=null&&(t.defaultValue=""+n)}function Nx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function zv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function eh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?zv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ac,Uv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,n,i){MSApp.execUnsafeLocalFunction(function(){return t(e,s,n,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ac=ac||document.createElement("div"),ac.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ac.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Oo(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var bo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},U_=["Webkit","ms","Moz","O"];Object.keys(bo).forEach(function(t){U_.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bo[e]=bo[t]})});function Bv(t,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||bo.hasOwnProperty(t)&&bo[t]?(""+e).trim():e+"px"}function qv(t,e){t=t.style;for(var s in e)if(e.hasOwnProperty(s)){var n=s.indexOf("--")===0,i=Bv(s,e[s],n);s==="float"&&(s="cssFloat"),n?t.setProperty(s,i):t[s]=i}}var B_=gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function th(t,e){if(e){if(B_[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function sh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rh=null;function _p(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var nh=null,ta=null,sa=null;function _x(t){if(t=bl(t)){if(typeof nh!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=Zd(e),nh(t.stateNode,t.type,e))}}function Gv(t){ta?sa?sa.push(t):sa=[t]:ta=t}function Wv(){if(ta){var t=ta,e=sa;if(sa=ta=null,_x(t),e)for(t=0;t<e.length;t++)_x(e[t])}}function Hv(t,e){return t(e)}function Kv(){}var om=!1;function Qv(t,e,s){if(om)return t(e,s);om=!0;try{return Hv(t,e,s)}finally{om=!1,(ta!==null||sa!==null)&&(Kv(),Wv())}}function Fo(t,e){var s=t.stateNode;if(s===null)return null;var n=Zd(s);if(n===null)return null;s=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(ae(231,e,typeof s));return s}var ih=!1;if(Fr)try{var eo={};Object.defineProperty(eo,"passive",{get:function(){ih=!0}}),window.addEventListener("test",eo,eo),window.removeEventListener("test",eo,eo)}catch{ih=!1}function q_(t,e,s,n,i,a,o,l,d){var u=Array.prototype.slice.call(arguments,3);try{e.apply(s,u)}catch(m){this.onError(m)}}var wo=!1,Yc=null,Xc=!1,ah=null,G_={onError:function(t){wo=!0,Yc=t}};function W_(t,e,s,n,i,a,o,l,d){wo=!1,Yc=null,q_.apply(G_,arguments)}function H_(t,e,s,n,i,a,o,l,d){if(W_.apply(this,arguments),wo){if(wo){var u=Yc;wo=!1,Yc=null}else throw Error(ae(198));Xc||(Xc=!0,ah=u)}}function Si(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function Yv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Sx(t){if(Si(t)!==t)throw Error(ae(188))}function K_(t){var e=t.alternate;if(!e){if(e=Si(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var s=t,n=e;;){var i=s.return;if(i===null)break;var a=i.alternate;if(a===null){if(n=i.return,n!==null){s=n;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===s)return Sx(i),t;if(a===n)return Sx(i),e;a=a.sibling}throw Error(ae(188))}if(s.return!==n.return)s=i,n=a;else{for(var o=!1,l=i.child;l;){if(l===s){o=!0,s=i,n=a;break}if(l===n){o=!0,n=i,s=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===s){o=!0,s=a,n=i;break}if(l===n){o=!0,n=a,s=i;break}l=l.sibling}if(!o)throw Error(ae(189))}}if(s.alternate!==n)throw Error(ae(190))}if(s.tag!==3)throw Error(ae(188));return s.stateNode.current===s?t:e}function Xv(t){return t=K_(t),t!==null?Jv(t):null}function Jv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Jv(t);if(e!==null)return e;t=t.sibling}return null}var Zv=Ls.unstable_scheduleCallback,Ex=Ls.unstable_cancelCallback,Q_=Ls.unstable_shouldYield,Y_=Ls.unstable_requestPaint,jt=Ls.unstable_now,X_=Ls.unstable_getCurrentPriorityLevel,Sp=Ls.unstable_ImmediatePriority,eb=Ls.unstable_UserBlockingPriority,Jc=Ls.unstable_NormalPriority,J_=Ls.unstable_LowPriority,tb=Ls.unstable_IdlePriority,Qd=null,mr=null;function Z_(t){if(mr&&typeof mr.onCommitFiberRoot=="function")try{mr.onCommitFiberRoot(Qd,t,void 0,(t.current.flags&128)===128)}catch{}}var tr=Math.clz32?Math.clz32:sS,eS=Math.log,tS=Math.LN2;function sS(t){return t>>>=0,t===0?32:31-(eS(t)/tS|0)|0}var oc=64,lc=4194304;function uo(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Zc(t,e){var s=t.pendingLanes;if(s===0)return 0;var n=0,i=t.suspendedLanes,a=t.pingedLanes,o=s&268435455;if(o!==0){var l=o&~i;l!==0?n=uo(l):(a&=o,a!==0&&(n=uo(a)))}else o=s&~i,o!==0?n=uo(o):a!==0&&(n=uo(a));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,a=e&-e,i>=a||i===16&&(a&4194240)!==0))return e;if(n&4&&(n|=s&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)s=31-tr(e),i=1<<s,n|=t[s],e&=~i;return n}function rS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nS(t,e){for(var s=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-tr(a),l=1<<o,d=i[o];d===-1?(!(l&s)||l&n)&&(i[o]=rS(l,e)):d<=e&&(t.expiredLanes|=l),a&=~l}}function oh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sb(){var t=oc;return oc<<=1,!(oc&4194240)&&(oc=64),t}function lm(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function yl(t,e,s){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-tr(e),t[e]=s}function iS(t,e){var s=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<s;){var i=31-tr(s),a=1<<i;e[i]=0,n[i]=-1,t[i]=-1,s&=~a}}function Ep(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var n=31-tr(s),i=1<<n;i&e|t[n]&e&&(t[n]|=e),s&=~i}}var et=0;function rb(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var nb,Ap,ib,ab,ob,lh=!1,cc=[],wn=null,jn=null,Nn=null,$o=new Map,zo=new Map,cn=[],aS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ax(t,e){switch(t){case"focusin":case"focusout":wn=null;break;case"dragenter":case"dragleave":jn=null;break;case"mouseover":case"mouseout":Nn=null;break;case"pointerover":case"pointerout":$o.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zo.delete(e.pointerId)}}function to(t,e,s,n,i,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:s,eventSystemFlags:n,nativeEvent:a,targetContainers:[i]},e!==null&&(e=bl(e),e!==null&&Ap(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function oS(t,e,s,n,i){switch(e){case"focusin":return wn=to(wn,t,e,s,n,i),!0;case"dragenter":return jn=to(jn,t,e,s,n,i),!0;case"mouseover":return Nn=to(Nn,t,e,s,n,i),!0;case"pointerover":var a=i.pointerId;return $o.set(a,to($o.get(a)||null,t,e,s,n,i)),!0;case"gotpointercapture":return a=i.pointerId,zo.set(a,to(zo.get(a)||null,t,e,s,n,i)),!0}return!1}function lb(t){var e=ri(t.target);if(e!==null){var s=Si(e);if(s!==null){if(e=s.tag,e===13){if(e=Yv(s),e!==null){t.blockedOn=e,ob(t.priority,function(){ib(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function kc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=ch(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);rh=n,s.target.dispatchEvent(n),rh=null}else return e=bl(s),e!==null&&Ap(e),t.blockedOn=s,!1;e.shift()}return!0}function Ix(t,e,s){kc(t)&&s.delete(e)}function lS(){lh=!1,wn!==null&&kc(wn)&&(wn=null),jn!==null&&kc(jn)&&(jn=null),Nn!==null&&kc(Nn)&&(Nn=null),$o.forEach(Ix),zo.forEach(Ix)}function so(t,e){t.blockedOn===e&&(t.blockedOn=null,lh||(lh=!0,Ls.unstable_scheduleCallback(Ls.unstable_NormalPriority,lS)))}function Uo(t){function e(i){return so(i,t)}if(0<cc.length){so(cc[0],t);for(var s=1;s<cc.length;s++){var n=cc[s];n.blockedOn===t&&(n.blockedOn=null)}}for(wn!==null&&so(wn,t),jn!==null&&so(jn,t),Nn!==null&&so(Nn,t),$o.forEach(e),zo.forEach(e),s=0;s<cn.length;s++)n=cn[s],n.blockedOn===t&&(n.blockedOn=null);for(;0<cn.length&&(s=cn[0],s.blockedOn===null);)lb(s),s.blockedOn===null&&cn.shift()}var ra=Jr.ReactCurrentBatchConfig,ed=!0;function cS(t,e,s,n){var i=et,a=ra.transition;ra.transition=null;try{et=1,Ip(t,e,s,n)}finally{et=i,ra.transition=a}}function dS(t,e,s,n){var i=et,a=ra.transition;ra.transition=null;try{et=4,Ip(t,e,s,n)}finally{et=i,ra.transition=a}}function Ip(t,e,s,n){if(ed){var i=ch(t,e,s,n);if(i===null)ym(t,e,n,td,s),Ax(t,n);else if(oS(i,t,e,s,n))n.stopPropagation();else if(Ax(t,n),e&4&&-1<aS.indexOf(t)){for(;i!==null;){var a=bl(i);if(a!==null&&nb(a),a=ch(t,e,s,n),a===null&&ym(t,e,n,td,s),a===i)break;i=a}i!==null&&n.stopPropagation()}else ym(t,e,n,null,s)}}var td=null;function ch(t,e,s,n){if(td=null,t=_p(n),t=ri(t),t!==null)if(e=Si(t),e===null)t=null;else if(s=e.tag,s===13){if(t=Yv(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return td=t,null}function cb(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(X_()){case Sp:return 1;case eb:return 4;case Jc:case J_:return 16;case tb:return 536870912;default:return 16}default:return 16}}var xn=null,kp=null,Cc=null;function db(){if(Cc)return Cc;var t,e=kp,s=e.length,n,i="value"in xn?xn.value:xn.textContent,a=i.length;for(t=0;t<s&&e[t]===i[t];t++);var o=s-t;for(n=1;n<=o&&e[s-n]===i[a-n];n++);return Cc=i.slice(t,1<n?1-n:void 0)}function Tc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function dc(){return!0}function kx(){return!1}function Os(t){function e(s,n,i,a,o){this._reactName=s,this._targetInst=i,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(s=t[l],this[l]=s?s(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?dc:kx,this.isPropagationStopped=kx,this}return gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=dc)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=dc)},persist:function(){},isPersistent:dc}),e}var ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cp=Os(ka),vl=gt({},ka,{view:0,detail:0}),uS=Os(vl),cm,dm,ro,Yd=gt({},vl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ro&&(ro&&t.type==="mousemove"?(cm=t.screenX-ro.screenX,dm=t.screenY-ro.screenY):dm=cm=0,ro=t),cm)},movementY:function(t){return"movementY"in t?t.movementY:dm}}),Cx=Os(Yd),mS=gt({},Yd,{dataTransfer:0}),hS=Os(mS),pS=gt({},vl,{relatedTarget:0}),um=Os(pS),fS=gt({},ka,{animationName:0,elapsedTime:0,pseudoElement:0}),gS=Os(fS),xS=gt({},ka,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yS=Os(xS),vS=gt({},ka,{data:0}),Tx=Os(vS),bS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function NS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=jS[t])?!!e[t]:!1}function Tp(){return NS}var _S=gt({},vl,{key:function(t){if(t.key){var e=bS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Tc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?wS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tp,charCode:function(t){return t.type==="keypress"?Tc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Tc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),SS=Os(_S),ES=gt({},Yd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rx=Os(ES),AS=gt({},vl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tp}),IS=Os(AS),kS=gt({},ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),CS=Os(kS),TS=gt({},Yd,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),RS=Os(TS),PS=[9,13,27,32],Rp=Fr&&"CompositionEvent"in window,jo=null;Fr&&"documentMode"in document&&(jo=document.documentMode);var DS=Fr&&"TextEvent"in window&&!jo,ub=Fr&&(!Rp||jo&&8<jo&&11>=jo),Px=" ",Dx=!1;function mb(t,e){switch(t){case"keyup":return PS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Bi=!1;function MS(t,e){switch(t){case"compositionend":return hb(e);case"keypress":return e.which!==32?null:(Dx=!0,Px);case"textInput":return t=e.data,t===Px&&Dx?null:t;default:return null}}function LS(t,e){if(Bi)return t==="compositionend"||!Rp&&mb(t,e)?(t=db(),Cc=kp=xn=null,Bi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ub&&e.locale!=="ko"?null:e.data;default:return null}}var VS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!VS[t.type]:e==="textarea"}function pb(t,e,s,n){Gv(n),e=sd(e,"onChange"),0<e.length&&(s=new Cp("onChange","change",null,s,n),t.push({event:s,listeners:e}))}var No=null,Bo=null;function OS(t){Sb(t,0)}function Xd(t){var e=Wi(t);if(Ov(e))return t}function FS(t,e){if(t==="change")return e}var fb=!1;if(Fr){var mm;if(Fr){var hm="oninput"in document;if(!hm){var Lx=document.createElement("div");Lx.setAttribute("oninput","return;"),hm=typeof Lx.oninput=="function"}mm=hm}else mm=!1;fb=mm&&(!document.documentMode||9<document.documentMode)}function Vx(){No&&(No.detachEvent("onpropertychange",gb),Bo=No=null)}function gb(t){if(t.propertyName==="value"&&Xd(Bo)){var e=[];pb(e,Bo,t,_p(t)),Qv(OS,e)}}function $S(t,e,s){t==="focusin"?(Vx(),No=e,Bo=s,No.attachEvent("onpropertychange",gb)):t==="focusout"&&Vx()}function zS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Xd(Bo)}function US(t,e){if(t==="click")return Xd(e)}function BS(t,e){if(t==="input"||t==="change")return Xd(e)}function qS(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var nr=typeof Object.is=="function"?Object.is:qS;function qo(t,e){if(nr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var i=s[n];if(!Gm.call(e,i)||!nr(t[i],e[i]))return!1}return!0}function Ox(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fx(t,e){var s=Ox(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=e&&n>=e)return{node:s,offset:e-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Ox(s)}}function xb(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?xb(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function yb(){for(var t=window,e=Qc();e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=Qc(t.document)}return e}function Pp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function GS(t){var e=yb(),s=t.focusedElem,n=t.selectionRange;if(e!==s&&s&&s.ownerDocument&&xb(s.ownerDocument.documentElement,s)){if(n!==null&&Pp(s)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(t,s.value.length);else if(t=(e=s.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=s.textContent.length,a=Math.min(n.start,i);n=n.end===void 0?a:Math.min(n.end,i),!t.extend&&a>n&&(i=n,n=a,a=i),i=Fx(s,a);var o=Fx(s,n);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),a>n?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=s;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)t=e[s],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var WS=Fr&&"documentMode"in document&&11>=document.documentMode,qi=null,dh=null,_o=null,uh=!1;function $x(t,e,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;uh||qi==null||qi!==Qc(n)||(n=qi,"selectionStart"in n&&Pp(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),_o&&qo(_o,n)||(_o=n,n=sd(dh,"onSelect"),0<n.length&&(e=new Cp("onSelect","select",null,e,s),t.push({event:e,listeners:n}),e.target=qi)))}function uc(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var Gi={animationend:uc("Animation","AnimationEnd"),animationiteration:uc("Animation","AnimationIteration"),animationstart:uc("Animation","AnimationStart"),transitionend:uc("Transition","TransitionEnd")},pm={},vb={};Fr&&(vb=document.createElement("div").style,"AnimationEvent"in window||(delete Gi.animationend.animation,delete Gi.animationiteration.animation,delete Gi.animationstart.animation),"TransitionEvent"in window||delete Gi.transitionend.transition);function Jd(t){if(pm[t])return pm[t];if(!Gi[t])return t;var e=Gi[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in vb)return pm[t]=e[s];return t}var bb=Jd("animationend"),wb=Jd("animationiteration"),jb=Jd("animationstart"),Nb=Jd("transitionend"),_b=new Map,zx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Un(t,e){_b.set(t,e),_i(e,[t])}for(var fm=0;fm<zx.length;fm++){var gm=zx[fm],HS=gm.toLowerCase(),KS=gm[0].toUpperCase()+gm.slice(1);Un(HS,"on"+KS)}Un(bb,"onAnimationEnd");Un(wb,"onAnimationIteration");Un(jb,"onAnimationStart");Un("dblclick","onDoubleClick");Un("focusin","onFocus");Un("focusout","onBlur");Un(Nb,"onTransitionEnd");ma("onMouseEnter",["mouseout","mouseover"]);ma("onMouseLeave",["mouseout","mouseover"]);ma("onPointerEnter",["pointerout","pointerover"]);ma("onPointerLeave",["pointerout","pointerover"]);_i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_i("onBeforeInput",["compositionend","keypress","textInput","paste"]);_i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QS=new Set("cancel close invalid load scroll toggle".split(" ").concat(mo));function Ux(t,e,s){var n=t.type||"unknown-event";t.currentTarget=s,H_(n,e,void 0,t),t.currentTarget=null}function Sb(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],i=n.event;n=n.listeners;e:{var a=void 0;if(e)for(var o=n.length-1;0<=o;o--){var l=n[o],d=l.instance,u=l.currentTarget;if(l=l.listener,d!==a&&i.isPropagationStopped())break e;Ux(i,l,u),a=d}else for(o=0;o<n.length;o++){if(l=n[o],d=l.instance,u=l.currentTarget,l=l.listener,d!==a&&i.isPropagationStopped())break e;Ux(i,l,u),a=d}}}if(Xc)throw t=ah,Xc=!1,ah=null,t}function ot(t,e){var s=e[gh];s===void 0&&(s=e[gh]=new Set);var n=t+"__bubble";s.has(n)||(Eb(e,t,2,!1),s.add(n))}function xm(t,e,s){var n=0;e&&(n|=4),Eb(s,t,n,e)}var mc="_reactListening"+Math.random().toString(36).slice(2);function Go(t){if(!t[mc]){t[mc]=!0,Pv.forEach(function(s){s!=="selectionchange"&&(QS.has(s)||xm(s,!1,t),xm(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[mc]||(e[mc]=!0,xm("selectionchange",!1,e))}}function Eb(t,e,s,n){switch(cb(e)){case 1:var i=cS;break;case 4:i=dS;break;default:i=Ip}s=i.bind(null,e,s,t),i=void 0,!ih||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,s,{capture:!0,passive:i}):t.addEventListener(e,s,!0):i!==void 0?t.addEventListener(e,s,{passive:i}):t.addEventListener(e,s,!1)}function ym(t,e,s,n,i){var a=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var l=n.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var d=o.tag;if((d===3||d===4)&&(d=o.stateNode.containerInfo,d===i||d.nodeType===8&&d.parentNode===i))return;o=o.return}for(;l!==null;){if(o=ri(l),o===null)return;if(d=o.tag,d===5||d===6){n=a=o;continue e}l=l.parentNode}}n=n.return}Qv(function(){var u=a,m=_p(s),h=[];e:{var f=_b.get(t);if(f!==void 0){var x=Cp,y=t;switch(t){case"keypress":if(Tc(s)===0)break e;case"keydown":case"keyup":x=SS;break;case"focusin":y="focus",x=um;break;case"focusout":y="blur",x=um;break;case"beforeblur":case"afterblur":x=um;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=Cx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=hS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=IS;break;case bb:case wb:case jb:x=gS;break;case Nb:x=CS;break;case"scroll":x=uS;break;case"wheel":x=RS;break;case"copy":case"cut":case"paste":x=yS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=Rx}var P=(e&4)!==0,_=!P&&t==="scroll",C=P?f!==null?f+"Capture":null:f;P=[];for(var k=u,T;k!==null;){T=k;var S=T.stateNode;if(T.tag===5&&S!==null&&(T=S,C!==null&&(S=Fo(k,C),S!=null&&P.push(Wo(k,S,T)))),_)break;k=k.return}0<P.length&&(f=new x(f,y,null,s,m),h.push({event:f,listeners:P}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",f&&s!==rh&&(y=s.relatedTarget||s.fromElement)&&(ri(y)||y[$r]))break e;if((x||f)&&(f=m.window===m?m:(f=m.ownerDocument)?f.defaultView||f.parentWindow:window,x?(y=s.relatedTarget||s.toElement,x=u,y=y?ri(y):null,y!==null&&(_=Si(y),y!==_||y.tag!==5&&y.tag!==6)&&(y=null)):(x=null,y=u),x!==y)){if(P=Cx,S="onMouseLeave",C="onMouseEnter",k="mouse",(t==="pointerout"||t==="pointerover")&&(P=Rx,S="onPointerLeave",C="onPointerEnter",k="pointer"),_=x==null?f:Wi(x),T=y==null?f:Wi(y),f=new P(S,k+"leave",x,s,m),f.target=_,f.relatedTarget=T,S=null,ri(m)===u&&(P=new P(C,k+"enter",y,s,m),P.target=T,P.relatedTarget=_,S=P),_=S,x&&y)t:{for(P=x,C=y,k=0,T=P;T;T=Vi(T))k++;for(T=0,S=C;S;S=Vi(S))T++;for(;0<k-T;)P=Vi(P),k--;for(;0<T-k;)C=Vi(C),T--;for(;k--;){if(P===C||C!==null&&P===C.alternate)break t;P=Vi(P),C=Vi(C)}P=null}else P=null;x!==null&&Bx(h,f,x,P,!1),y!==null&&_!==null&&Bx(h,_,y,P,!0)}}e:{if(f=u?Wi(u):window,x=f.nodeName&&f.nodeName.toLowerCase(),x==="select"||x==="input"&&f.type==="file")var D=FS;else if(Mx(f))if(fb)D=BS;else{D=zS;var R=$S}else(x=f.nodeName)&&x.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=US);if(D&&(D=D(t,u))){pb(h,D,s,m);break e}R&&R(t,f,u),t==="focusout"&&(R=f._wrapperState)&&R.controlled&&f.type==="number"&&Jm(f,"number",f.value)}switch(R=u?Wi(u):window,t){case"focusin":(Mx(R)||R.contentEditable==="true")&&(qi=R,dh=u,_o=null);break;case"focusout":_o=dh=qi=null;break;case"mousedown":uh=!0;break;case"contextmenu":case"mouseup":case"dragend":uh=!1,$x(h,s,m);break;case"selectionchange":if(WS)break;case"keydown":case"keyup":$x(h,s,m)}var v;if(Rp)e:{switch(t){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Bi?mb(t,s)&&(b="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(b="onCompositionStart");b&&(ub&&s.locale!=="ko"&&(Bi||b!=="onCompositionStart"?b==="onCompositionEnd"&&Bi&&(v=db()):(xn=m,kp="value"in xn?xn.value:xn.textContent,Bi=!0)),R=sd(u,b),0<R.length&&(b=new Tx(b,t,null,s,m),h.push({event:b,listeners:R}),v?b.data=v:(v=hb(s),v!==null&&(b.data=v)))),(v=DS?MS(t,s):LS(t,s))&&(u=sd(u,"onBeforeInput"),0<u.length&&(m=new Tx("onBeforeInput","beforeinput",null,s,m),h.push({event:m,listeners:u}),m.data=v))}Sb(h,e)})}function Wo(t,e,s){return{instance:t,listener:e,currentTarget:s}}function sd(t,e){for(var s=e+"Capture",n=[];t!==null;){var i=t,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=Fo(t,s),a!=null&&n.unshift(Wo(t,a,i)),a=Fo(t,e),a!=null&&n.push(Wo(t,a,i))),t=t.return}return n}function Vi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Bx(t,e,s,n,i){for(var a=e._reactName,o=[];s!==null&&s!==n;){var l=s,d=l.alternate,u=l.stateNode;if(d!==null&&d===n)break;l.tag===5&&u!==null&&(l=u,i?(d=Fo(s,a),d!=null&&o.unshift(Wo(s,d,l))):i||(d=Fo(s,a),d!=null&&o.push(Wo(s,d,l)))),s=s.return}o.length!==0&&t.push({event:e,listeners:o})}var YS=/\r\n?/g,XS=/\u0000|\uFFFD/g;function qx(t){return(typeof t=="string"?t:""+t).replace(YS,`
`).replace(XS,"")}function hc(t,e,s){if(e=qx(e),qx(t)!==e&&s)throw Error(ae(425))}function rd(){}var mh=null,hh=null;function ph(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var fh=typeof setTimeout=="function"?setTimeout:void 0,JS=typeof clearTimeout=="function"?clearTimeout:void 0,Gx=typeof Promise=="function"?Promise:void 0,ZS=typeof queueMicrotask=="function"?queueMicrotask:typeof Gx<"u"?function(t){return Gx.resolve(null).then(t).catch(e2)}:fh;function e2(t){setTimeout(function(){throw t})}function vm(t,e){var s=e,n=0;do{var i=s.nextSibling;if(t.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"){if(n===0){t.removeChild(i),Uo(e);return}n--}else s!=="$"&&s!=="$?"&&s!=="$!"||n++;s=i}while(s);Uo(e)}function _n(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Wx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return t;e--}else s==="/$"&&e++}t=t.previousSibling}return null}var Ca=Math.random().toString(36).slice(2),dr="__reactFiber$"+Ca,Ho="__reactProps$"+Ca,$r="__reactContainer$"+Ca,gh="__reactEvents$"+Ca,t2="__reactListeners$"+Ca,s2="__reactHandles$"+Ca;function ri(t){var e=t[dr];if(e)return e;for(var s=t.parentNode;s;){if(e=s[$r]||s[dr]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=Wx(t);t!==null;){if(s=t[dr])return s;t=Wx(t)}return e}t=s,s=t.parentNode}return null}function bl(t){return t=t[dr]||t[$r],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Wi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function Zd(t){return t[Ho]||null}var xh=[],Hi=-1;function Bn(t){return{current:t}}function ct(t){0>Hi||(t.current=xh[Hi],xh[Hi]=null,Hi--)}function it(t,e){Hi++,xh[Hi]=t.current,t.current=e}var Mn={},ss=Bn(Mn),ws=Bn(!1),ui=Mn;function ha(t,e){var s=t.type.contextTypes;if(!s)return Mn;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in s)i[a]=e[a];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function js(t){return t=t.childContextTypes,t!=null}function nd(){ct(ws),ct(ss)}function Hx(t,e,s){if(ss.current!==Mn)throw Error(ae(168));it(ss,e),it(ws,s)}function Ab(t,e,s){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return s;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(ae(108,$_(t)||"Unknown",i));return gt({},s,n)}function id(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Mn,ui=ss.current,it(ss,t),it(ws,ws.current),!0}function Kx(t,e,s){var n=t.stateNode;if(!n)throw Error(ae(169));s?(t=Ab(t,e,ui),n.__reactInternalMemoizedMergedChildContext=t,ct(ws),ct(ss),it(ss,t)):ct(ws),it(ws,s)}var kr=null,eu=!1,bm=!1;function Ib(t){kr===null?kr=[t]:kr.push(t)}function r2(t){eu=!0,Ib(t)}function qn(){if(!bm&&kr!==null){bm=!0;var t=0,e=et;try{var s=kr;for(et=1;t<s.length;t++){var n=s[t];do n=n(!0);while(n!==null)}kr=null,eu=!1}catch(i){throw kr!==null&&(kr=kr.slice(t+1)),Zv(Sp,qn),i}finally{et=e,bm=!1}}return null}var Ki=[],Qi=0,ad=null,od=0,Fs=[],$s=0,mi=null,Cr=1,Tr="";function ei(t,e){Ki[Qi++]=od,Ki[Qi++]=ad,ad=t,od=e}function kb(t,e,s){Fs[$s++]=Cr,Fs[$s++]=Tr,Fs[$s++]=mi,mi=t;var n=Cr;t=Tr;var i=32-tr(n)-1;n&=~(1<<i),s+=1;var a=32-tr(e)+i;if(30<a){var o=i-i%5;a=(n&(1<<o)-1).toString(32),n>>=o,i-=o,Cr=1<<32-tr(e)+i|s<<i|n,Tr=a+t}else Cr=1<<a|s<<i|n,Tr=t}function Dp(t){t.return!==null&&(ei(t,1),kb(t,1,0))}function Mp(t){for(;t===ad;)ad=Ki[--Qi],Ki[Qi]=null,od=Ki[--Qi],Ki[Qi]=null;for(;t===mi;)mi=Fs[--$s],Fs[$s]=null,Tr=Fs[--$s],Fs[$s]=null,Cr=Fs[--$s],Fs[$s]=null}var Ps=null,Ts=null,dt=!1,Zs=null;function Cb(t,e){var s=zs(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=t,e=t.deletions,e===null?(t.deletions=[s],t.flags|=16):e.push(s)}function Qx(t,e){switch(t.tag){case 5:var s=t.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Ps=t,Ts=_n(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Ps=t,Ts=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=mi!==null?{id:Cr,overflow:Tr}:null,t.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=zs(18,null,null,0),s.stateNode=e,s.return=t,t.child=s,Ps=t,Ts=null,!0):!1;default:return!1}}function yh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function vh(t){if(dt){var e=Ts;if(e){var s=e;if(!Qx(t,e)){if(yh(t))throw Error(ae(418));e=_n(s.nextSibling);var n=Ps;e&&Qx(t,e)?Cb(n,s):(t.flags=t.flags&-4097|2,dt=!1,Ps=t)}}else{if(yh(t))throw Error(ae(418));t.flags=t.flags&-4097|2,dt=!1,Ps=t}}}function Yx(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ps=t}function pc(t){if(t!==Ps)return!1;if(!dt)return Yx(t),dt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ph(t.type,t.memoizedProps)),e&&(e=Ts)){if(yh(t))throw Tb(),Error(ae(418));for(;e;)Cb(t,e),e=_n(e.nextSibling)}if(Yx(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"){if(e===0){Ts=_n(t.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}t=t.nextSibling}Ts=null}}else Ts=Ps?_n(t.stateNode.nextSibling):null;return!0}function Tb(){for(var t=Ts;t;)t=_n(t.nextSibling)}function pa(){Ts=Ps=null,dt=!1}function Lp(t){Zs===null?Zs=[t]:Zs.push(t)}var n2=Jr.ReactCurrentBatchConfig;function no(t,e,s){if(t=s.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(ae(309));var n=s.stateNode}if(!n)throw Error(ae(147,t));var i=n,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var l=i.refs;o===null?delete l[a]:l[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(ae(284));if(!s._owner)throw Error(ae(290,t))}return t}function fc(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Xx(t){var e=t._init;return e(t._payload)}function Rb(t){function e(C,k){if(t){var T=C.deletions;T===null?(C.deletions=[k],C.flags|=16):T.push(k)}}function s(C,k){if(!t)return null;for(;k!==null;)e(C,k),k=k.sibling;return null}function n(C,k){for(C=new Map;k!==null;)k.key!==null?C.set(k.key,k):C.set(k.index,k),k=k.sibling;return C}function i(C,k){return C=In(C,k),C.index=0,C.sibling=null,C}function a(C,k,T){return C.index=T,t?(T=C.alternate,T!==null?(T=T.index,T<k?(C.flags|=2,k):T):(C.flags|=2,k)):(C.flags|=1048576,k)}function o(C){return t&&C.alternate===null&&(C.flags|=2),C}function l(C,k,T,S){return k===null||k.tag!==6?(k=Am(T,C.mode,S),k.return=C,k):(k=i(k,T),k.return=C,k)}function d(C,k,T,S){var D=T.type;return D===Ui?m(C,k,T.props.children,S,T.key):k!==null&&(k.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===on&&Xx(D)===k.type)?(S=i(k,T.props),S.ref=no(C,k,T),S.return=C,S):(S=Oc(T.type,T.key,T.props,null,C.mode,S),S.ref=no(C,k,T),S.return=C,S)}function u(C,k,T,S){return k===null||k.tag!==4||k.stateNode.containerInfo!==T.containerInfo||k.stateNode.implementation!==T.implementation?(k=Im(T,C.mode,S),k.return=C,k):(k=i(k,T.children||[]),k.return=C,k)}function m(C,k,T,S,D){return k===null||k.tag!==7?(k=ci(T,C.mode,S,D),k.return=C,k):(k=i(k,T),k.return=C,k)}function h(C,k,T){if(typeof k=="string"&&k!==""||typeof k=="number")return k=Am(""+k,C.mode,T),k.return=C,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case nc:return T=Oc(k.type,k.key,k.props,null,C.mode,T),T.ref=no(C,null,k),T.return=C,T;case zi:return k=Im(k,C.mode,T),k.return=C,k;case on:var S=k._init;return h(C,S(k._payload),T)}if(co(k)||Za(k))return k=ci(k,C.mode,T,null),k.return=C,k;fc(C,k)}return null}function f(C,k,T,S){var D=k!==null?k.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return D!==null?null:l(C,k,""+T,S);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case nc:return T.key===D?d(C,k,T,S):null;case zi:return T.key===D?u(C,k,T,S):null;case on:return D=T._init,f(C,k,D(T._payload),S)}if(co(T)||Za(T))return D!==null?null:m(C,k,T,S,null);fc(C,T)}return null}function x(C,k,T,S,D){if(typeof S=="string"&&S!==""||typeof S=="number")return C=C.get(T)||null,l(k,C,""+S,D);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case nc:return C=C.get(S.key===null?T:S.key)||null,d(k,C,S,D);case zi:return C=C.get(S.key===null?T:S.key)||null,u(k,C,S,D);case on:var R=S._init;return x(C,k,T,R(S._payload),D)}if(co(S)||Za(S))return C=C.get(T)||null,m(k,C,S,D,null);fc(k,S)}return null}function y(C,k,T,S){for(var D=null,R=null,v=k,b=k=0,N=null;v!==null&&b<T.length;b++){v.index>b?(N=v,v=null):N=v.sibling;var g=f(C,v,T[b],S);if(g===null){v===null&&(v=N);break}t&&v&&g.alternate===null&&e(C,v),k=a(g,k,b),R===null?D=g:R.sibling=g,R=g,v=N}if(b===T.length)return s(C,v),dt&&ei(C,b),D;if(v===null){for(;b<T.length;b++)v=h(C,T[b],S),v!==null&&(k=a(v,k,b),R===null?D=v:R.sibling=v,R=v);return dt&&ei(C,b),D}for(v=n(C,v);b<T.length;b++)N=x(v,C,b,T[b],S),N!==null&&(t&&N.alternate!==null&&v.delete(N.key===null?b:N.key),k=a(N,k,b),R===null?D=N:R.sibling=N,R=N);return t&&v.forEach(function(w){return e(C,w)}),dt&&ei(C,b),D}function P(C,k,T,S){var D=Za(T);if(typeof D!="function")throw Error(ae(150));if(T=D.call(T),T==null)throw Error(ae(151));for(var R=D=null,v=k,b=k=0,N=null,g=T.next();v!==null&&!g.done;b++,g=T.next()){v.index>b?(N=v,v=null):N=v.sibling;var w=f(C,v,g.value,S);if(w===null){v===null&&(v=N);break}t&&v&&w.alternate===null&&e(C,v),k=a(w,k,b),R===null?D=w:R.sibling=w,R=w,v=N}if(g.done)return s(C,v),dt&&ei(C,b),D;if(v===null){for(;!g.done;b++,g=T.next())g=h(C,g.value,S),g!==null&&(k=a(g,k,b),R===null?D=g:R.sibling=g,R=g);return dt&&ei(C,b),D}for(v=n(C,v);!g.done;b++,g=T.next())g=x(v,C,b,g.value,S),g!==null&&(t&&g.alternate!==null&&v.delete(g.key===null?b:g.key),k=a(g,k,b),R===null?D=g:R.sibling=g,R=g);return t&&v.forEach(function(I){return e(C,I)}),dt&&ei(C,b),D}function _(C,k,T,S){if(typeof T=="object"&&T!==null&&T.type===Ui&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case nc:e:{for(var D=T.key,R=k;R!==null;){if(R.key===D){if(D=T.type,D===Ui){if(R.tag===7){s(C,R.sibling),k=i(R,T.props.children),k.return=C,C=k;break e}}else if(R.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===on&&Xx(D)===R.type){s(C,R.sibling),k=i(R,T.props),k.ref=no(C,R,T),k.return=C,C=k;break e}s(C,R);break}else e(C,R);R=R.sibling}T.type===Ui?(k=ci(T.props.children,C.mode,S,T.key),k.return=C,C=k):(S=Oc(T.type,T.key,T.props,null,C.mode,S),S.ref=no(C,k,T),S.return=C,C=S)}return o(C);case zi:e:{for(R=T.key;k!==null;){if(k.key===R)if(k.tag===4&&k.stateNode.containerInfo===T.containerInfo&&k.stateNode.implementation===T.implementation){s(C,k.sibling),k=i(k,T.children||[]),k.return=C,C=k;break e}else{s(C,k);break}else e(C,k);k=k.sibling}k=Im(T,C.mode,S),k.return=C,C=k}return o(C);case on:return R=T._init,_(C,k,R(T._payload),S)}if(co(T))return y(C,k,T,S);if(Za(T))return P(C,k,T,S);fc(C,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,k!==null&&k.tag===6?(s(C,k.sibling),k=i(k,T),k.return=C,C=k):(s(C,k),k=Am(T,C.mode,S),k.return=C,C=k),o(C)):s(C,k)}return _}var fa=Rb(!0),Pb=Rb(!1),ld=Bn(null),cd=null,Yi=null,Vp=null;function Op(){Vp=Yi=cd=null}function Fp(t){var e=ld.current;ct(ld),t._currentValue=e}function bh(t,e,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===s)break;t=t.return}}function na(t,e){cd=t,Vp=Yi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(bs=!0),t.firstContext=null)}function Gs(t){var e=t._currentValue;if(Vp!==t)if(t={context:t,memoizedValue:e,next:null},Yi===null){if(cd===null)throw Error(ae(308));Yi=t,cd.dependencies={lanes:0,firstContext:t}}else Yi=Yi.next=t;return e}var ni=null;function $p(t){ni===null?ni=[t]:ni.push(t)}function Db(t,e,s,n){var i=e.interleaved;return i===null?(s.next=s,$p(e)):(s.next=i.next,i.next=s),e.interleaved=s,zr(t,n)}function zr(t,e){t.lanes|=e;var s=t.alternate;for(s!==null&&(s.lanes|=e),s=t,t=t.return;t!==null;)t.childLanes|=e,s=t.alternate,s!==null&&(s.childLanes|=e),s=t,t=t.return;return s.tag===3?s.stateNode:null}var ln=!1;function zp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mb(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Mr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Sn(t,e,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,He&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,zr(t,s)}return i=n.interleaved,i===null?(e.next=e,$p(n)):(e.next=i.next,i.next=e),n.interleaved=e,zr(t,s)}function Rc(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,Ep(t,s)}}function Jx(t,e){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var i=null,a=null;if(s=s.firstBaseUpdate,s!==null){do{var o={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};a===null?i=a=o:a=a.next=o,s=s.next}while(s!==null);a===null?i=a=e:a=a.next=e}else i=a=e;s={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:n.shared,effects:n.effects},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}function dd(t,e,s,n){var i=t.updateQueue;ln=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var d=l,u=d.next;d.next=null,o===null?a=u:o.next=u,o=d;var m=t.alternate;m!==null&&(m=m.updateQueue,l=m.lastBaseUpdate,l!==o&&(l===null?m.firstBaseUpdate=u:l.next=u,m.lastBaseUpdate=d))}if(a!==null){var h=i.baseState;o=0,m=u=d=null,l=a;do{var f=l.lane,x=l.eventTime;if((n&f)===f){m!==null&&(m=m.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=t,P=l;switch(f=e,x=s,P.tag){case 1:if(y=P.payload,typeof y=="function"){h=y.call(x,h,f);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=P.payload,f=typeof y=="function"?y.call(x,h,f):y,f==null)break e;h=gt({},h,f);break e;case 2:ln=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[l]:f.push(l))}else x={eventTime:x,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},m===null?(u=m=x,d=h):m=m.next=x,o|=f;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;f=l,l=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(m===null&&(d=h),i.baseState=d,i.firstBaseUpdate=u,i.lastBaseUpdate=m,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else a===null&&(i.shared.lanes=0);pi|=o,t.lanes=o,t.memoizedState=h}}function Zx(t,e,s){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(i!==null){if(n.callback=null,n=s,typeof i!="function")throw Error(ae(191,i));i.call(n)}}}var wl={},hr=Bn(wl),Ko=Bn(wl),Qo=Bn(wl);function ii(t){if(t===wl)throw Error(ae(174));return t}function Up(t,e){switch(it(Qo,e),it(Ko,t),it(hr,wl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:eh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=eh(e,t)}ct(hr),it(hr,e)}function ga(){ct(hr),ct(Ko),ct(Qo)}function Lb(t){ii(Qo.current);var e=ii(hr.current),s=eh(e,t.type);e!==s&&(it(Ko,t),it(hr,s))}function Bp(t){Ko.current===t&&(ct(hr),ct(Ko))}var mt=Bn(0);function ud(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var wm=[];function qp(){for(var t=0;t<wm.length;t++)wm[t]._workInProgressVersionPrimary=null;wm.length=0}var Pc=Jr.ReactCurrentDispatcher,jm=Jr.ReactCurrentBatchConfig,hi=0,ft=null,Ct=null,Dt=null,md=!1,So=!1,Yo=0,i2=0;function Qt(){throw Error(ae(321))}function Gp(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!nr(t[s],e[s]))return!1;return!0}function Wp(t,e,s,n,i,a){if(hi=a,ft=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Pc.current=t===null||t.memoizedState===null?c2:d2,t=s(n,i),So){a=0;do{if(So=!1,Yo=0,25<=a)throw Error(ae(301));a+=1,Dt=Ct=null,e.updateQueue=null,Pc.current=u2,t=s(n,i)}while(So)}if(Pc.current=hd,e=Ct!==null&&Ct.next!==null,hi=0,Dt=Ct=ft=null,md=!1,e)throw Error(ae(300));return t}function Hp(){var t=Yo!==0;return Yo=0,t}function cr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?ft.memoizedState=Dt=t:Dt=Dt.next=t,Dt}function Ws(){if(Ct===null){var t=ft.alternate;t=t!==null?t.memoizedState:null}else t=Ct.next;var e=Dt===null?ft.memoizedState:Dt.next;if(e!==null)Dt=e,Ct=t;else{if(t===null)throw Error(ae(310));Ct=t,t={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},Dt===null?ft.memoizedState=Dt=t:Dt=Dt.next=t}return Dt}function Xo(t,e){return typeof e=="function"?e(t):e}function Nm(t){var e=Ws(),s=e.queue;if(s===null)throw Error(ae(311));s.lastRenderedReducer=t;var n=Ct,i=n.baseQueue,a=s.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}n.baseQueue=i=a,s.pending=null}if(i!==null){a=i.next,n=n.baseState;var l=o=null,d=null,u=a;do{var m=u.lane;if((hi&m)===m)d!==null&&(d=d.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var h={lane:m,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};d===null?(l=d=h,o=n):d=d.next=h,ft.lanes|=m,pi|=m}u=u.next}while(u!==null&&u!==a);d===null?o=n:d.next=l,nr(n,e.memoizedState)||(bs=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=d,s.lastRenderedState=n}if(t=s.interleaved,t!==null){i=t;do a=i.lane,ft.lanes|=a,pi|=a,i=i.next;while(i!==t)}else i===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function _m(t){var e=Ws(),s=e.queue;if(s===null)throw Error(ae(311));s.lastRenderedReducer=t;var n=s.dispatch,i=s.pending,a=e.memoizedState;if(i!==null){s.pending=null;var o=i=i.next;do a=t(a,o.action),o=o.next;while(o!==i);nr(a,e.memoizedState)||(bs=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),s.lastRenderedState=a}return[a,n]}function Vb(){}function Ob(t,e){var s=ft,n=Ws(),i=e(),a=!nr(n.memoizedState,i);if(a&&(n.memoizedState=i,bs=!0),n=n.queue,Kp(zb.bind(null,s,n,t),[t]),n.getSnapshot!==e||a||Dt!==null&&Dt.memoizedState.tag&1){if(s.flags|=2048,Jo(9,$b.bind(null,s,n,i,e),void 0,null),Mt===null)throw Error(ae(349));hi&30||Fb(s,e,i)}return i}function Fb(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function $b(t,e,s,n){e.value=s,e.getSnapshot=n,Ub(e)&&Bb(t)}function zb(t,e,s){return s(function(){Ub(e)&&Bb(t)})}function Ub(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!nr(t,s)}catch{return!0}}function Bb(t){var e=zr(t,1);e!==null&&sr(e,t,1,-1)}function e0(t){var e=cr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xo,lastRenderedState:t},e.queue=t,t=t.dispatch=l2.bind(null,ft,t),[e.memoizedState,t]}function Jo(t,e,s,n){return t={tag:t,create:e,destroy:s,deps:n,next:null},e=ft.updateQueue,e===null?(e={lastEffect:null,stores:null},ft.updateQueue=e,e.lastEffect=t.next=t):(s=e.lastEffect,s===null?e.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,e.lastEffect=t)),t}function qb(){return Ws().memoizedState}function Dc(t,e,s,n){var i=cr();ft.flags|=t,i.memoizedState=Jo(1|e,s,void 0,n===void 0?null:n)}function tu(t,e,s,n){var i=Ws();n=n===void 0?null:n;var a=void 0;if(Ct!==null){var o=Ct.memoizedState;if(a=o.destroy,n!==null&&Gp(n,o.deps)){i.memoizedState=Jo(e,s,a,n);return}}ft.flags|=t,i.memoizedState=Jo(1|e,s,a,n)}function t0(t,e){return Dc(8390656,8,t,e)}function Kp(t,e){return tu(2048,8,t,e)}function Gb(t,e){return tu(4,2,t,e)}function Wb(t,e){return tu(4,4,t,e)}function Hb(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Kb(t,e,s){return s=s!=null?s.concat([t]):null,tu(4,4,Hb.bind(null,e,t),s)}function Qp(){}function Qb(t,e){var s=Ws();e=e===void 0?null:e;var n=s.memoizedState;return n!==null&&e!==null&&Gp(e,n[1])?n[0]:(s.memoizedState=[t,e],t)}function Yb(t,e){var s=Ws();e=e===void 0?null:e;var n=s.memoizedState;return n!==null&&e!==null&&Gp(e,n[1])?n[0]:(t=t(),s.memoizedState=[t,e],t)}function Xb(t,e,s){return hi&21?(nr(s,e)||(s=sb(),ft.lanes|=s,pi|=s,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,bs=!0),t.memoizedState=s)}function a2(t,e){var s=et;et=s!==0&&4>s?s:4,t(!0);var n=jm.transition;jm.transition={};try{t(!1),e()}finally{et=s,jm.transition=n}}function Jb(){return Ws().memoizedState}function o2(t,e,s){var n=An(t);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},Zb(t))ew(e,s);else if(s=Db(t,e,s,n),s!==null){var i=us();sr(s,t,n,i),tw(s,e,n)}}function l2(t,e,s){var n=An(t),i={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(Zb(t))ew(e,i);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,s);if(i.hasEagerState=!0,i.eagerState=l,nr(l,o)){var d=e.interleaved;d===null?(i.next=i,$p(e)):(i.next=d.next,d.next=i),e.interleaved=i;return}}catch{}finally{}s=Db(t,e,i,n),s!==null&&(i=us(),sr(s,t,n,i),tw(s,e,n))}}function Zb(t){var e=t.alternate;return t===ft||e!==null&&e===ft}function ew(t,e){So=md=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function tw(t,e,s){if(s&4194240){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,Ep(t,s)}}var hd={readContext:Gs,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useInsertionEffect:Qt,useLayoutEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useMutableSource:Qt,useSyncExternalStore:Qt,useId:Qt,unstable_isNewReconciler:!1},c2={readContext:Gs,useCallback:function(t,e){return cr().memoizedState=[t,e===void 0?null:e],t},useContext:Gs,useEffect:t0,useImperativeHandle:function(t,e,s){return s=s!=null?s.concat([t]):null,Dc(4194308,4,Hb.bind(null,e,t),s)},useLayoutEffect:function(t,e){return Dc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Dc(4,2,t,e)},useMemo:function(t,e){var s=cr();return e=e===void 0?null:e,t=t(),s.memoizedState=[t,e],t},useReducer:function(t,e,s){var n=cr();return e=s!==void 0?s(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=o2.bind(null,ft,t),[n.memoizedState,t]},useRef:function(t){var e=cr();return t={current:t},e.memoizedState=t},useState:e0,useDebugValue:Qp,useDeferredValue:function(t){return cr().memoizedState=t},useTransition:function(){var t=e0(!1),e=t[0];return t=a2.bind(null,t[1]),cr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,s){var n=ft,i=cr();if(dt){if(s===void 0)throw Error(ae(407));s=s()}else{if(s=e(),Mt===null)throw Error(ae(349));hi&30||Fb(n,e,s)}i.memoizedState=s;var a={value:s,getSnapshot:e};return i.queue=a,t0(zb.bind(null,n,a,t),[t]),n.flags|=2048,Jo(9,$b.bind(null,n,a,s,e),void 0,null),s},useId:function(){var t=cr(),e=Mt.identifierPrefix;if(dt){var s=Tr,n=Cr;s=(n&~(1<<32-tr(n)-1)).toString(32)+s,e=":"+e+"R"+s,s=Yo++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=i2++,e=":"+e+"r"+s.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},d2={readContext:Gs,useCallback:Qb,useContext:Gs,useEffect:Kp,useImperativeHandle:Kb,useInsertionEffect:Gb,useLayoutEffect:Wb,useMemo:Yb,useReducer:Nm,useRef:qb,useState:function(){return Nm(Xo)},useDebugValue:Qp,useDeferredValue:function(t){var e=Ws();return Xb(e,Ct.memoizedState,t)},useTransition:function(){var t=Nm(Xo)[0],e=Ws().memoizedState;return[t,e]},useMutableSource:Vb,useSyncExternalStore:Ob,useId:Jb,unstable_isNewReconciler:!1},u2={readContext:Gs,useCallback:Qb,useContext:Gs,useEffect:Kp,useImperativeHandle:Kb,useInsertionEffect:Gb,useLayoutEffect:Wb,useMemo:Yb,useReducer:_m,useRef:qb,useState:function(){return _m(Xo)},useDebugValue:Qp,useDeferredValue:function(t){var e=Ws();return Ct===null?e.memoizedState=t:Xb(e,Ct.memoizedState,t)},useTransition:function(){var t=_m(Xo)[0],e=Ws().memoizedState;return[t,e]},useMutableSource:Vb,useSyncExternalStore:Ob,useId:Jb,unstable_isNewReconciler:!1};function Xs(t,e){if(t&&t.defaultProps){e=gt({},e),t=t.defaultProps;for(var s in t)e[s]===void 0&&(e[s]=t[s]);return e}return e}function wh(t,e,s,n){e=t.memoizedState,s=s(n,e),s=s==null?e:gt({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var su={isMounted:function(t){return(t=t._reactInternals)?Si(t)===t:!1},enqueueSetState:function(t,e,s){t=t._reactInternals;var n=us(),i=An(t),a=Mr(n,i);a.payload=e,s!=null&&(a.callback=s),e=Sn(t,a,i),e!==null&&(sr(e,t,i,n),Rc(e,t,i))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var n=us(),i=An(t),a=Mr(n,i);a.tag=1,a.payload=e,s!=null&&(a.callback=s),e=Sn(t,a,i),e!==null&&(sr(e,t,i,n),Rc(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=us(),n=An(t),i=Mr(s,n);i.tag=2,e!=null&&(i.callback=e),e=Sn(t,i,n),e!==null&&(sr(e,t,n,s),Rc(e,t,n))}};function s0(t,e,s,n,i,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,a,o):e.prototype&&e.prototype.isPureReactComponent?!qo(s,n)||!qo(i,a):!0}function sw(t,e,s){var n=!1,i=Mn,a=e.contextType;return typeof a=="object"&&a!==null?a=Gs(a):(i=js(e)?ui:ss.current,n=e.contextTypes,a=(n=n!=null)?ha(t,i):Mn),e=new e(s,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=su,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=a),e}function r0(t,e,s,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,n),e.state!==t&&su.enqueueReplaceState(e,e.state,null)}function jh(t,e,s,n){var i=t.stateNode;i.props=s,i.state=t.memoizedState,i.refs={},zp(t);var a=e.contextType;typeof a=="object"&&a!==null?i.context=Gs(a):(a=js(e)?ui:ss.current,i.context=ha(t,a)),i.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(wh(t,e,a,s),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&su.enqueueReplaceState(i,i.state,null),dd(t,s,i,n),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function xa(t,e){try{var s="",n=e;do s+=F_(n),n=n.return;while(n);var i=s}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:i,digest:null}}function Sm(t,e,s){return{value:t,source:null,stack:s??null,digest:e??null}}function Nh(t,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var m2=typeof WeakMap=="function"?WeakMap:Map;function rw(t,e,s){s=Mr(-1,s),s.tag=3,s.payload={element:null};var n=e.value;return s.callback=function(){fd||(fd=!0,Ph=n),Nh(t,e)},s}function nw(t,e,s){s=Mr(-1,s),s.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;s.payload=function(){return n(i)},s.callback=function(){Nh(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(s.callback=function(){Nh(t,e),typeof n!="function"&&(En===null?En=new Set([this]):En.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),s}function n0(t,e,s){var n=t.pingCache;if(n===null){n=t.pingCache=new m2;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(s)||(i.add(s),t=E2.bind(null,t,e,s),e.then(t,t))}function i0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function a0(t,e,s,n,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=Mr(-1,1),e.tag=2,Sn(s,e,1))),s.lanes|=1),t)}var h2=Jr.ReactCurrentOwner,bs=!1;function is(t,e,s,n){e.child=t===null?Pb(e,null,s,n):fa(e,t.child,s,n)}function o0(t,e,s,n,i){s=s.render;var a=e.ref;return na(e,i),n=Wp(t,e,s,n,a,i),s=Hp(),t!==null&&!bs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ur(t,e,i)):(dt&&s&&Dp(e),e.flags|=1,is(t,e,n,i),e.child)}function l0(t,e,s,n,i){if(t===null){var a=s.type;return typeof a=="function"&&!rf(a)&&a.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=a,iw(t,e,a,n,i)):(t=Oc(s.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&i)){var o=a.memoizedProps;if(s=s.compare,s=s!==null?s:qo,s(o,n)&&t.ref===e.ref)return Ur(t,e,i)}return e.flags|=1,t=In(a,n),t.ref=e.ref,t.return=e,e.child=t}function iw(t,e,s,n,i){if(t!==null){var a=t.memoizedProps;if(qo(a,n)&&t.ref===e.ref)if(bs=!1,e.pendingProps=n=a,(t.lanes&i)!==0)t.flags&131072&&(bs=!0);else return e.lanes=t.lanes,Ur(t,e,i)}return _h(t,e,s,n,i)}function aw(t,e,s){var n=e.pendingProps,i=n.children,a=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(Ji,Cs),Cs|=s;else{if(!(s&1073741824))return t=a!==null?a.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,it(Ji,Cs),Cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:s,it(Ji,Cs),Cs|=n}else a!==null?(n=a.baseLanes|s,e.memoizedState=null):n=s,it(Ji,Cs),Cs|=n;return is(t,e,i,s),e.child}function ow(t,e){var s=e.ref;(t===null&&s!==null||t!==null&&t.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function _h(t,e,s,n,i){var a=js(s)?ui:ss.current;return a=ha(e,a),na(e,i),s=Wp(t,e,s,n,a,i),n=Hp(),t!==null&&!bs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Ur(t,e,i)):(dt&&n&&Dp(e),e.flags|=1,is(t,e,s,i),e.child)}function c0(t,e,s,n,i){if(js(s)){var a=!0;id(e)}else a=!1;if(na(e,i),e.stateNode===null)Mc(t,e),sw(e,s,n),jh(e,s,n,i),n=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var d=o.context,u=s.contextType;typeof u=="object"&&u!==null?u=Gs(u):(u=js(s)?ui:ss.current,u=ha(e,u));var m=s.getDerivedStateFromProps,h=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==n||d!==u)&&r0(e,o,n,u),ln=!1;var f=e.memoizedState;o.state=f,dd(e,n,o,i),d=e.memoizedState,l!==n||f!==d||ws.current||ln?(typeof m=="function"&&(wh(e,s,m,n),d=e.memoizedState),(l=ln||s0(e,s,l,n,f,d,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=d),o.props=n,o.state=d,o.context=u,n=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,Mb(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:Xs(e.type,l),o.props=u,h=e.pendingProps,f=o.context,d=s.contextType,typeof d=="object"&&d!==null?d=Gs(d):(d=js(s)?ui:ss.current,d=ha(e,d));var x=s.getDerivedStateFromProps;(m=typeof x=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==d)&&r0(e,o,n,d),ln=!1,f=e.memoizedState,o.state=f,dd(e,n,o,i);var y=e.memoizedState;l!==h||f!==y||ws.current||ln?(typeof x=="function"&&(wh(e,s,x,n),y=e.memoizedState),(u=ln||s0(e,s,u,n,f,y,d)||!1)?(m||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,y,d),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,y,d)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=y),o.props=n,o.state=y,o.context=d,n=u):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return Sh(t,e,s,n,a,i)}function Sh(t,e,s,n,i,a){ow(t,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&Kx(e,s,!1),Ur(t,e,a);n=e.stateNode,h2.current=e;var l=o&&typeof s.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&o?(e.child=fa(e,t.child,null,a),e.child=fa(e,null,l,a)):is(t,e,l,a),e.memoizedState=n.state,i&&Kx(e,s,!0),e.child}function lw(t){var e=t.stateNode;e.pendingContext?Hx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Hx(t,e.context,!1),Up(t,e.containerInfo)}function d0(t,e,s,n,i){return pa(),Lp(i),e.flags|=256,is(t,e,s,n),e.child}var Eh={dehydrated:null,treeContext:null,retryLane:0};function Ah(t){return{baseLanes:t,cachePool:null,transitions:null}}function cw(t,e,s){var n=e.pendingProps,i=mt.current,a=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(i&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),it(mt,i&1),t===null)return vh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,t=n.fallback,a?(n=e.mode,a=e.child,o={mode:"hidden",children:o},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=iu(o,n,0,null),t=ci(t,n,s,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Ah(s),e.memoizedState=Eh,t):Yp(e,o));if(i=t.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return p2(t,e,o,n,l,i,s);if(a){a=n.fallback,o=e.mode,i=t.child,l=i.sibling;var d={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=d,e.deletions=null):(n=In(i,d),n.subtreeFlags=i.subtreeFlags&14680064),l!==null?a=In(l,a):(a=ci(a,o,s,null),a.flags|=2),a.return=e,n.return=e,n.sibling=a,e.child=n,n=a,a=e.child,o=t.child.memoizedState,o=o===null?Ah(s):{baseLanes:o.baseLanes|s,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~s,e.memoizedState=Eh,n}return a=t.child,t=a.sibling,n=In(a,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=s),n.return=e,n.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=n,e.memoizedState=null,n}function Yp(t,e){return e=iu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function gc(t,e,s,n){return n!==null&&Lp(n),fa(e,t.child,null,s),t=Yp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function p2(t,e,s,n,i,a,o){if(s)return e.flags&256?(e.flags&=-257,n=Sm(Error(ae(422))),gc(t,e,o,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=n.fallback,i=e.mode,n=iu({mode:"visible",children:n.children},i,0,null),a=ci(a,i,o,null),a.flags|=2,n.return=e,a.return=e,n.sibling=a,e.child=n,e.mode&1&&fa(e,t.child,null,o),e.child.memoizedState=Ah(o),e.memoizedState=Eh,a);if(!(e.mode&1))return gc(t,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var l=n.dgst;return n=l,a=Error(ae(419)),n=Sm(a,n,void 0),gc(t,e,o,n)}if(l=(o&t.childLanes)!==0,bs||l){if(n=Mt,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,zr(t,i),sr(n,t,i,-1))}return sf(),n=Sm(Error(ae(421))),gc(t,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=A2.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,Ts=_n(i.nextSibling),Ps=e,dt=!0,Zs=null,t!==null&&(Fs[$s++]=Cr,Fs[$s++]=Tr,Fs[$s++]=mi,Cr=t.id,Tr=t.overflow,mi=e),e=Yp(e,n.children),e.flags|=4096,e)}function u0(t,e,s){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),bh(t.return,e,s)}function Em(t,e,s,n,i){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:i}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=s,a.tailMode=i)}function dw(t,e,s){var n=e.pendingProps,i=n.revealOrder,a=n.tail;if(is(t,e,n.children,s),n=mt.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&u0(t,s,e);else if(t.tag===19)u0(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(it(mt,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(s=e.child,i=null;s!==null;)t=s.alternate,t!==null&&ud(t)===null&&(i=s),s=s.sibling;s=i,s===null?(i=e.child,e.child=null):(i=s.sibling,s.sibling=null),Em(e,!1,i,s,a);break;case"backwards":for(s=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&ud(t)===null){e.child=i;break}t=i.sibling,i.sibling=s,s=i,i=t}Em(e,!0,s,null,a);break;case"together":Em(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Mc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ur(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),pi|=e.lanes,!(s&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,s=In(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=In(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function f2(t,e,s){switch(e.tag){case 3:lw(e),pa();break;case 5:Lb(e);break;case 1:js(e.type)&&id(e);break;case 4:Up(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;it(ld,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(it(mt,mt.current&1),e.flags|=128,null):s&e.child.childLanes?cw(t,e,s):(it(mt,mt.current&1),t=Ur(t,e,s),t!==null?t.sibling:null);it(mt,mt.current&1);break;case 19:if(n=(s&e.childLanes)!==0,t.flags&128){if(n)return dw(t,e,s);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),it(mt,mt.current),n)break;return null;case 22:case 23:return e.lanes=0,aw(t,e,s)}return Ur(t,e,s)}var uw,Ih,mw,hw;uw=function(t,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)t.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Ih=function(){};mw=function(t,e,s,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,ii(hr.current);var a=null;switch(s){case"input":i=Ym(t,i),n=Ym(t,n),a=[];break;case"select":i=gt({},i,{value:void 0}),n=gt({},n,{value:void 0}),a=[];break;case"textarea":i=Zm(t,i),n=Zm(t,n),a=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=rd)}th(s,n);var o;s=null;for(u in i)if(!n.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(s||(s={}),s[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vo.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in n){var d=n[u];if(l=i!=null?i[u]:void 0,n.hasOwnProperty(u)&&d!==l&&(d!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||d&&d.hasOwnProperty(o)||(s||(s={}),s[o]="");for(o in d)d.hasOwnProperty(o)&&l[o]!==d[o]&&(s||(s={}),s[o]=d[o])}else s||(a||(a=[]),a.push(u,s)),s=d;else u==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,l=l?l.__html:void 0,d!=null&&l!==d&&(a=a||[]).push(u,d)):u==="children"?typeof d!="string"&&typeof d!="number"||(a=a||[]).push(u,""+d):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vo.hasOwnProperty(u)?(d!=null&&u==="onScroll"&&ot("scroll",t),a||l===d||(a=[])):(a=a||[]).push(u,d))}s&&(a=a||[]).push("style",s);var u=a;(e.updateQueue=u)&&(e.flags|=4)}};hw=function(t,e,s,n){s!==n&&(e.flags|=4)};function io(t,e){if(!dt)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Yt(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(e)for(var i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=s,e}function g2(t,e,s){var n=e.pendingProps;switch(Mp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(e),null;case 1:return js(e.type)&&nd(),Yt(e),null;case 3:return n=e.stateNode,ga(),ct(ws),ct(ss),qp(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(pc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Zs!==null&&(Lh(Zs),Zs=null))),Ih(t,e),Yt(e),null;case 5:Bp(e);var i=ii(Qo.current);if(s=e.type,t!==null&&e.stateNode!=null)mw(t,e,s,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ae(166));return Yt(e),null}if(t=ii(hr.current),pc(e)){n=e.stateNode,s=e.type;var a=e.memoizedProps;switch(n[dr]=e,n[Ho]=a,t=(e.mode&1)!==0,s){case"dialog":ot("cancel",n),ot("close",n);break;case"iframe":case"object":case"embed":ot("load",n);break;case"video":case"audio":for(i=0;i<mo.length;i++)ot(mo[i],n);break;case"source":ot("error",n);break;case"img":case"image":case"link":ot("error",n),ot("load",n);break;case"details":ot("toggle",n);break;case"input":bx(n,a),ot("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},ot("invalid",n);break;case"textarea":jx(n,a),ot("invalid",n)}th(s,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?n.textContent!==l&&(a.suppressHydrationWarning!==!0&&hc(n.textContent,l,t),i=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&hc(n.textContent,l,t),i=["children",""+l]):Vo.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&ot("scroll",n)}switch(s){case"input":ic(n),wx(n,a,!0);break;case"textarea":ic(n),Nx(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=rd)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=zv(s)),t==="http://www.w3.org/1999/xhtml"?s==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=o.createElement(s,{is:n.is}):(t=o.createElement(s),s==="select"&&(o=t,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):t=o.createElementNS(t,s),t[dr]=e,t[Ho]=n,uw(t,e,!1,!1),e.stateNode=t;e:{switch(o=sh(s,n),s){case"dialog":ot("cancel",t),ot("close",t),i=n;break;case"iframe":case"object":case"embed":ot("load",t),i=n;break;case"video":case"audio":for(i=0;i<mo.length;i++)ot(mo[i],t);i=n;break;case"source":ot("error",t),i=n;break;case"img":case"image":case"link":ot("error",t),ot("load",t),i=n;break;case"details":ot("toggle",t),i=n;break;case"input":bx(t,n),i=Ym(t,n),ot("invalid",t);break;case"option":i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=gt({},n,{value:void 0}),ot("invalid",t);break;case"textarea":jx(t,n),i=Zm(t,n),ot("invalid",t);break;default:i=n}th(s,i),l=i;for(a in l)if(l.hasOwnProperty(a)){var d=l[a];a==="style"?qv(t,d):a==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&Uv(t,d)):a==="children"?typeof d=="string"?(s!=="textarea"||d!=="")&&Oo(t,d):typeof d=="number"&&Oo(t,""+d):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Vo.hasOwnProperty(a)?d!=null&&a==="onScroll"&&ot("scroll",t):d!=null&&bp(t,a,d,o))}switch(s){case"input":ic(t),wx(t,n,!1);break;case"textarea":ic(t),Nx(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Dn(n.value));break;case"select":t.multiple=!!n.multiple,a=n.value,a!=null?ea(t,!!n.multiple,a,!1):n.defaultValue!=null&&ea(t,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=rd)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yt(e),null;case 6:if(t&&e.stateNode!=null)hw(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ae(166));if(s=ii(Qo.current),ii(hr.current),pc(e)){if(n=e.stateNode,s=e.memoizedProps,n[dr]=e,(a=n.nodeValue!==s)&&(t=Ps,t!==null))switch(t.tag){case 3:hc(n.nodeValue,s,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&hc(n.nodeValue,s,(t.mode&1)!==0)}a&&(e.flags|=4)}else n=(s.nodeType===9?s:s.ownerDocument).createTextNode(n),n[dr]=e,e.stateNode=n}return Yt(e),null;case 13:if(ct(mt),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(dt&&Ts!==null&&e.mode&1&&!(e.flags&128))Tb(),pa(),e.flags|=98560,a=!1;else if(a=pc(e),n!==null&&n.dehydrated!==null){if(t===null){if(!a)throw Error(ae(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(ae(317));a[dr]=e}else pa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yt(e),a=!1}else Zs!==null&&(Lh(Zs),Zs=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||mt.current&1?Tt===0&&(Tt=3):sf())),e.updateQueue!==null&&(e.flags|=4),Yt(e),null);case 4:return ga(),Ih(t,e),t===null&&Go(e.stateNode.containerInfo),Yt(e),null;case 10:return Fp(e.type._context),Yt(e),null;case 17:return js(e.type)&&nd(),Yt(e),null;case 19:if(ct(mt),a=e.memoizedState,a===null)return Yt(e),null;if(n=(e.flags&128)!==0,o=a.rendering,o===null)if(n)io(a,!1);else{if(Tt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ud(t),o!==null){for(e.flags|=128,io(a,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=s,s=e.child;s!==null;)a=s,t=n,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),s=s.sibling;return it(mt,mt.current&1|2),e.child}t=t.sibling}a.tail!==null&&jt()>ya&&(e.flags|=128,n=!0,io(a,!1),e.lanes=4194304)}else{if(!n)if(t=ud(o),t!==null){if(e.flags|=128,n=!0,s=t.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),io(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!dt)return Yt(e),null}else 2*jt()-a.renderingStartTime>ya&&s!==1073741824&&(e.flags|=128,n=!0,io(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(s=a.last,s!==null?s.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=jt(),e.sibling=null,s=mt.current,it(mt,n?s&1|2:s&1),e):(Yt(e),null);case 22:case 23:return tf(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Cs&1073741824&&(Yt(e),e.subtreeFlags&6&&(e.flags|=8192)):Yt(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function x2(t,e){switch(Mp(e),e.tag){case 1:return js(e.type)&&nd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ga(),ct(ws),ct(ss),qp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Bp(e),null;case 13:if(ct(mt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));pa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ct(mt),null;case 4:return ga(),null;case 10:return Fp(e.type._context),null;case 22:case 23:return tf(),null;case 24:return null;default:return null}}var xc=!1,Zt=!1,y2=typeof WeakSet=="function"?WeakSet:Set,xe=null;function Xi(t,e){var s=t.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(n){vt(t,e,n)}else s.current=null}function kh(t,e,s){try{s()}catch(n){vt(t,e,n)}}var m0=!1;function v2(t,e){if(mh=ed,t=yb(),Pp(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{s.nodeType,a.nodeType}catch{s=null;break e}var o=0,l=-1,d=-1,u=0,m=0,h=t,f=null;t:for(;;){for(var x;h!==s||i!==0&&h.nodeType!==3||(l=o+i),h!==a||n!==0&&h.nodeType!==3||(d=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(x=h.firstChild)!==null;)f=h,h=x;for(;;){if(h===t)break t;if(f===s&&++u===i&&(l=o),f===a&&++m===n&&(d=o),(x=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=x}s=l===-1||d===-1?null:{start:l,end:d}}else s=null}s=s||{start:0,end:0}}else s=null;for(hh={focusedElem:t,selectionRange:s},ed=!1,xe=e;xe!==null;)if(e=xe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,xe=t;else for(;xe!==null;){e=xe;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var P=y.memoizedProps,_=y.memoizedState,C=e.stateNode,k=C.getSnapshotBeforeUpdate(e.elementType===e.type?P:Xs(e.type,P),_);C.__reactInternalSnapshotBeforeUpdate=k}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch(S){vt(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,xe=t;break}xe=e.return}return y=m0,m0=!1,y}function Eo(t,e,s){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&t)===t){var a=i.destroy;i.destroy=void 0,a!==void 0&&kh(e,s,a)}i=i.next}while(i!==n)}}function ru(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&t)===t){var n=s.create;s.destroy=n()}s=s.next}while(s!==e)}}function Ch(t){var e=t.ref;if(e!==null){var s=t.stateNode;switch(t.tag){case 5:t=s;break;default:t=s}typeof e=="function"?e(t):e.current=t}}function pw(t){var e=t.alternate;e!==null&&(t.alternate=null,pw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[dr],delete e[Ho],delete e[gh],delete e[t2],delete e[s2])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function fw(t){return t.tag===5||t.tag===3||t.tag===4}function h0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||fw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Th(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(t,e):s.insertBefore(t,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(t,s)):(e=s,e.appendChild(t)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=rd));else if(n!==4&&(t=t.child,t!==null))for(Th(t,e,s),t=t.sibling;t!==null;)Th(t,e,s),t=t.sibling}function Rh(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Rh(t,e,s),t=t.sibling;t!==null;)Rh(t,e,s),t=t.sibling}var Ft=null,Js=!1;function nn(t,e,s){for(s=s.child;s!==null;)gw(t,e,s),s=s.sibling}function gw(t,e,s){if(mr&&typeof mr.onCommitFiberUnmount=="function")try{mr.onCommitFiberUnmount(Qd,s)}catch{}switch(s.tag){case 5:Zt||Xi(s,e);case 6:var n=Ft,i=Js;Ft=null,nn(t,e,s),Ft=n,Js=i,Ft!==null&&(Js?(t=Ft,s=s.stateNode,t.nodeType===8?t.parentNode.removeChild(s):t.removeChild(s)):Ft.removeChild(s.stateNode));break;case 18:Ft!==null&&(Js?(t=Ft,s=s.stateNode,t.nodeType===8?vm(t.parentNode,s):t.nodeType===1&&vm(t,s),Uo(t)):vm(Ft,s.stateNode));break;case 4:n=Ft,i=Js,Ft=s.stateNode.containerInfo,Js=!0,nn(t,e,s),Ft=n,Js=i;break;case 0:case 11:case 14:case 15:if(!Zt&&(n=s.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&kh(s,e,o),i=i.next}while(i!==n)}nn(t,e,s);break;case 1:if(!Zt&&(Xi(s,e),n=s.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(l){vt(s,e,l)}nn(t,e,s);break;case 21:nn(t,e,s);break;case 22:s.mode&1?(Zt=(n=Zt)||s.memoizedState!==null,nn(t,e,s),Zt=n):nn(t,e,s);break;default:nn(t,e,s)}}function p0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var s=t.stateNode;s===null&&(s=t.stateNode=new y2),e.forEach(function(n){var i=I2.bind(null,t,n);s.has(n)||(s.add(n),n.then(i,i))})}}function Ys(t,e){var s=e.deletions;if(s!==null)for(var n=0;n<s.length;n++){var i=s[n];try{var a=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Ft=l.stateNode,Js=!1;break e;case 3:Ft=l.stateNode.containerInfo,Js=!0;break e;case 4:Ft=l.stateNode.containerInfo,Js=!0;break e}l=l.return}if(Ft===null)throw Error(ae(160));gw(a,o,i),Ft=null,Js=!1;var d=i.alternate;d!==null&&(d.return=null),i.return=null}catch(u){vt(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)xw(e,t),e=e.sibling}function xw(t,e){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ys(e,t),lr(t),n&4){try{Eo(3,t,t.return),ru(3,t)}catch(P){vt(t,t.return,P)}try{Eo(5,t,t.return)}catch(P){vt(t,t.return,P)}}break;case 1:Ys(e,t),lr(t),n&512&&s!==null&&Xi(s,s.return);break;case 5:if(Ys(e,t),lr(t),n&512&&s!==null&&Xi(s,s.return),t.flags&32){var i=t.stateNode;try{Oo(i,"")}catch(P){vt(t,t.return,P)}}if(n&4&&(i=t.stateNode,i!=null)){var a=t.memoizedProps,o=s!==null?s.memoizedProps:a,l=t.type,d=t.updateQueue;if(t.updateQueue=null,d!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&Fv(i,a),sh(l,o);var u=sh(l,a);for(o=0;o<d.length;o+=2){var m=d[o],h=d[o+1];m==="style"?qv(i,h):m==="dangerouslySetInnerHTML"?Uv(i,h):m==="children"?Oo(i,h):bp(i,m,h,u)}switch(l){case"input":Xm(i,a);break;case"textarea":$v(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var x=a.value;x!=null?ea(i,!!a.multiple,x,!1):f!==!!a.multiple&&(a.defaultValue!=null?ea(i,!!a.multiple,a.defaultValue,!0):ea(i,!!a.multiple,a.multiple?[]:"",!1))}i[Ho]=a}catch(P){vt(t,t.return,P)}}break;case 6:if(Ys(e,t),lr(t),n&4){if(t.stateNode===null)throw Error(ae(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(P){vt(t,t.return,P)}}break;case 3:if(Ys(e,t),lr(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{Uo(e.containerInfo)}catch(P){vt(t,t.return,P)}break;case 4:Ys(e,t),lr(t);break;case 13:Ys(e,t),lr(t),i=t.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||(Zp=jt())),n&4&&p0(t);break;case 22:if(m=s!==null&&s.memoizedState!==null,t.mode&1?(Zt=(u=Zt)||m,Ys(e,t),Zt=u):Ys(e,t),lr(t),n&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!m&&t.mode&1)for(xe=t,m=t.child;m!==null;){for(h=xe=m;xe!==null;){switch(f=xe,x=f.child,f.tag){case 0:case 11:case 14:case 15:Eo(4,f,f.return);break;case 1:Xi(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){n=f,s=f.return;try{e=n,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(P){vt(n,s,P)}}break;case 5:Xi(f,f.return);break;case 22:if(f.memoizedState!==null){g0(h);continue}}x!==null?(x.return=f,xe=x):g0(h)}m=m.sibling}e:for(m=null,h=t;;){if(h.tag===5){if(m===null){m=h;try{i=h.stateNode,u?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=h.stateNode,d=h.memoizedProps.style,o=d!=null&&d.hasOwnProperty("display")?d.display:null,l.style.display=Bv("display",o))}catch(P){vt(t,t.return,P)}}}else if(h.tag===6){if(m===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(P){vt(t,t.return,P)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;m===h&&(m=null),h=h.return}m===h&&(m=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ys(e,t),lr(t),n&4&&p0(t);break;case 21:break;default:Ys(e,t),lr(t)}}function lr(t){var e=t.flags;if(e&2){try{e:{for(var s=t.return;s!==null;){if(fw(s)){var n=s;break e}s=s.return}throw Error(ae(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Oo(i,""),n.flags&=-33);var a=h0(t);Rh(t,a,i);break;case 3:case 4:var o=n.stateNode.containerInfo,l=h0(t);Th(t,l,o);break;default:throw Error(ae(161))}}catch(d){vt(t,t.return,d)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function b2(t,e,s){xe=t,yw(t)}function yw(t,e,s){for(var n=(t.mode&1)!==0;xe!==null;){var i=xe,a=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||xc;if(!o){var l=i.alternate,d=l!==null&&l.memoizedState!==null||Zt;l=xc;var u=Zt;if(xc=o,(Zt=d)&&!u)for(xe=i;xe!==null;)o=xe,d=o.child,o.tag===22&&o.memoizedState!==null?x0(i):d!==null?(d.return=o,xe=d):x0(i);for(;a!==null;)xe=a,yw(a),a=a.sibling;xe=i,xc=l,Zt=u}f0(t)}else i.subtreeFlags&8772&&a!==null?(a.return=i,xe=a):f0(t)}}function f0(t){for(;xe!==null;){var e=xe;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Zt||ru(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Zt)if(s===null)n.componentDidMount();else{var i=e.elementType===e.type?s.memoizedProps:Xs(e.type,s.memoizedProps);n.componentDidUpdate(i,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&Zx(e,a,n);break;case 3:var o=e.updateQueue;if(o!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}Zx(e,o,s)}break;case 5:var l=e.stateNode;if(s===null&&e.flags&4){s=l;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&s.focus();break;case"img":d.src&&(s.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var m=u.memoizedState;if(m!==null){var h=m.dehydrated;h!==null&&Uo(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}Zt||e.flags&512&&Ch(e)}catch(f){vt(e,e.return,f)}}if(e===t){xe=null;break}if(s=e.sibling,s!==null){s.return=e.return,xe=s;break}xe=e.return}}function g0(t){for(;xe!==null;){var e=xe;if(e===t){xe=null;break}var s=e.sibling;if(s!==null){s.return=e.return,xe=s;break}xe=e.return}}function x0(t){for(;xe!==null;){var e=xe;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{ru(4,e)}catch(d){vt(e,s,d)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(d){vt(e,i,d)}}var a=e.return;try{Ch(e)}catch(d){vt(e,a,d)}break;case 5:var o=e.return;try{Ch(e)}catch(d){vt(e,o,d)}}}catch(d){vt(e,e.return,d)}if(e===t){xe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,xe=l;break}xe=e.return}}var w2=Math.ceil,pd=Jr.ReactCurrentDispatcher,Xp=Jr.ReactCurrentOwner,Us=Jr.ReactCurrentBatchConfig,He=0,Mt=null,Et=null,Bt=0,Cs=0,Ji=Bn(0),Tt=0,Zo=null,pi=0,nu=0,Jp=0,Ao=null,ys=null,Zp=0,ya=1/0,Ir=null,fd=!1,Ph=null,En=null,yc=!1,yn=null,gd=0,Io=0,Dh=null,Lc=-1,Vc=0;function us(){return He&6?jt():Lc!==-1?Lc:Lc=jt()}function An(t){return t.mode&1?He&2&&Bt!==0?Bt&-Bt:n2.transition!==null?(Vc===0&&(Vc=sb()),Vc):(t=et,t!==0||(t=window.event,t=t===void 0?16:cb(t.type)),t):1}function sr(t,e,s,n){if(50<Io)throw Io=0,Dh=null,Error(ae(185));yl(t,s,n),(!(He&2)||t!==Mt)&&(t===Mt&&(!(He&2)&&(nu|=s),Tt===4&&dn(t,Bt)),Ns(t,n),s===1&&He===0&&!(e.mode&1)&&(ya=jt()+500,eu&&qn()))}function Ns(t,e){var s=t.callbackNode;nS(t,e);var n=Zc(t,t===Mt?Bt:0);if(n===0)s!==null&&Ex(s),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(s!=null&&Ex(s),e===1)t.tag===0?r2(y0.bind(null,t)):Ib(y0.bind(null,t)),ZS(function(){!(He&6)&&qn()}),s=null;else{switch(rb(n)){case 1:s=Sp;break;case 4:s=eb;break;case 16:s=Jc;break;case 536870912:s=tb;break;default:s=Jc}s=Ew(s,vw.bind(null,t))}t.callbackPriority=e,t.callbackNode=s}}function vw(t,e){if(Lc=-1,Vc=0,He&6)throw Error(ae(327));var s=t.callbackNode;if(ia()&&t.callbackNode!==s)return null;var n=Zc(t,t===Mt?Bt:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=xd(t,n);else{e=n;var i=He;He|=2;var a=ww();(Mt!==t||Bt!==e)&&(Ir=null,ya=jt()+500,li(t,e));do try{_2();break}catch(l){bw(t,l)}while(!0);Op(),pd.current=a,He=i,Et!==null?e=0:(Mt=null,Bt=0,e=Tt)}if(e!==0){if(e===2&&(i=oh(t),i!==0&&(n=i,e=Mh(t,i))),e===1)throw s=Zo,li(t,0),dn(t,n),Ns(t,jt()),s;if(e===6)dn(t,n);else{if(i=t.current.alternate,!(n&30)&&!j2(i)&&(e=xd(t,n),e===2&&(a=oh(t),a!==0&&(n=a,e=Mh(t,a))),e===1))throw s=Zo,li(t,0),dn(t,n),Ns(t,jt()),s;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(ae(345));case 2:ti(t,ys,Ir);break;case 3:if(dn(t,n),(n&130023424)===n&&(e=Zp+500-jt(),10<e)){if(Zc(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){us(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=fh(ti.bind(null,t,ys,Ir),e);break}ti(t,ys,Ir);break;case 4:if(dn(t,n),(n&4194240)===n)break;for(e=t.eventTimes,i=-1;0<n;){var o=31-tr(n);a=1<<o,o=e[o],o>i&&(i=o),n&=~a}if(n=i,n=jt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*w2(n/1960))-n,10<n){t.timeoutHandle=fh(ti.bind(null,t,ys,Ir),n);break}ti(t,ys,Ir);break;case 5:ti(t,ys,Ir);break;default:throw Error(ae(329))}}}return Ns(t,jt()),t.callbackNode===s?vw.bind(null,t):null}function Mh(t,e){var s=Ao;return t.current.memoizedState.isDehydrated&&(li(t,e).flags|=256),t=xd(t,e),t!==2&&(e=ys,ys=s,e!==null&&Lh(e)),t}function Lh(t){ys===null?ys=t:ys.push.apply(ys,t)}function j2(t){for(var e=t;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var n=0;n<s.length;n++){var i=s[n],a=i.getSnapshot;i=i.value;try{if(!nr(a(),i))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function dn(t,e){for(e&=~Jp,e&=~nu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var s=31-tr(e),n=1<<s;t[s]=-1,e&=~n}}function y0(t){if(He&6)throw Error(ae(327));ia();var e=Zc(t,0);if(!(e&1))return Ns(t,jt()),null;var s=xd(t,e);if(t.tag!==0&&s===2){var n=oh(t);n!==0&&(e=n,s=Mh(t,n))}if(s===1)throw s=Zo,li(t,0),dn(t,e),Ns(t,jt()),s;if(s===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ti(t,ys,Ir),Ns(t,jt()),null}function ef(t,e){var s=He;He|=1;try{return t(e)}finally{He=s,He===0&&(ya=jt()+500,eu&&qn())}}function fi(t){yn!==null&&yn.tag===0&&!(He&6)&&ia();var e=He;He|=1;var s=Us.transition,n=et;try{if(Us.transition=null,et=1,t)return t()}finally{et=n,Us.transition=s,He=e,!(He&6)&&qn()}}function tf(){Cs=Ji.current,ct(Ji)}function li(t,e){t.finishedWork=null,t.finishedLanes=0;var s=t.timeoutHandle;if(s!==-1&&(t.timeoutHandle=-1,JS(s)),Et!==null)for(s=Et.return;s!==null;){var n=s;switch(Mp(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&nd();break;case 3:ga(),ct(ws),ct(ss),qp();break;case 5:Bp(n);break;case 4:ga();break;case 13:ct(mt);break;case 19:ct(mt);break;case 10:Fp(n.type._context);break;case 22:case 23:tf()}s=s.return}if(Mt=t,Et=t=In(t.current,null),Bt=Cs=e,Tt=0,Zo=null,Jp=nu=pi=0,ys=Ao=null,ni!==null){for(e=0;e<ni.length;e++)if(s=ni[e],n=s.interleaved,n!==null){s.interleaved=null;var i=n.next,a=s.pending;if(a!==null){var o=a.next;a.next=i,n.next=o}s.pending=n}ni=null}return t}function bw(t,e){do{var s=Et;try{if(Op(),Pc.current=hd,md){for(var n=ft.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}md=!1}if(hi=0,Dt=Ct=ft=null,So=!1,Yo=0,Xp.current=null,s===null||s.return===null){Tt=1,Zo=e,Et=null;break}e:{var a=t,o=s.return,l=s,d=e;if(e=Bt,l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var u=d,m=l,h=m.tag;if(!(m.mode&1)&&(h===0||h===11||h===15)){var f=m.alternate;f?(m.updateQueue=f.updateQueue,m.memoizedState=f.memoizedState,m.lanes=f.lanes):(m.updateQueue=null,m.memoizedState=null)}var x=i0(o);if(x!==null){x.flags&=-257,a0(x,o,l,a,e),x.mode&1&&n0(a,u,e),e=x,d=u;var y=e.updateQueue;if(y===null){var P=new Set;P.add(d),e.updateQueue=P}else y.add(d);break e}else{if(!(e&1)){n0(a,u,e),sf();break e}d=Error(ae(426))}}else if(dt&&l.mode&1){var _=i0(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),a0(_,o,l,a,e),Lp(xa(d,l));break e}}a=d=xa(d,l),Tt!==4&&(Tt=2),Ao===null?Ao=[a]:Ao.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var C=rw(a,d,e);Jx(a,C);break e;case 1:l=d;var k=a.type,T=a.stateNode;if(!(a.flags&128)&&(typeof k.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(En===null||!En.has(T)))){a.flags|=65536,e&=-e,a.lanes|=e;var S=nw(a,l,e);Jx(a,S);break e}}a=a.return}while(a!==null)}Nw(s)}catch(D){e=D,Et===s&&s!==null&&(Et=s=s.return);continue}break}while(!0)}function ww(){var t=pd.current;return pd.current=hd,t===null?hd:t}function sf(){(Tt===0||Tt===3||Tt===2)&&(Tt=4),Mt===null||!(pi&268435455)&&!(nu&268435455)||dn(Mt,Bt)}function xd(t,e){var s=He;He|=2;var n=ww();(Mt!==t||Bt!==e)&&(Ir=null,li(t,e));do try{N2();break}catch(i){bw(t,i)}while(!0);if(Op(),He=s,pd.current=n,Et!==null)throw Error(ae(261));return Mt=null,Bt=0,Tt}function N2(){for(;Et!==null;)jw(Et)}function _2(){for(;Et!==null&&!Q_();)jw(Et)}function jw(t){var e=Sw(t.alternate,t,Cs);t.memoizedProps=t.pendingProps,e===null?Nw(t):Et=e,Xp.current=null}function Nw(t){var e=t;do{var s=e.alternate;if(t=e.return,e.flags&32768){if(s=x2(s,e),s!==null){s.flags&=32767,Et=s;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Tt=6,Et=null;return}}else if(s=g2(s,e,Cs),s!==null){Et=s;return}if(e=e.sibling,e!==null){Et=e;return}Et=e=t}while(e!==null);Tt===0&&(Tt=5)}function ti(t,e,s){var n=et,i=Us.transition;try{Us.transition=null,et=1,S2(t,e,s,n)}finally{Us.transition=i,et=n}return null}function S2(t,e,s,n){do ia();while(yn!==null);if(He&6)throw Error(ae(327));s=t.finishedWork;var i=t.finishedLanes;if(s===null)return null;if(t.finishedWork=null,t.finishedLanes=0,s===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var a=s.lanes|s.childLanes;if(iS(t,a),t===Mt&&(Et=Mt=null,Bt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||yc||(yc=!0,Ew(Jc,function(){return ia(),null})),a=(s.flags&15990)!==0,s.subtreeFlags&15990||a){a=Us.transition,Us.transition=null;var o=et;et=1;var l=He;He|=4,Xp.current=null,v2(t,s),xw(s,t),GS(hh),ed=!!mh,hh=mh=null,t.current=s,b2(s),Y_(),He=l,et=o,Us.transition=a}else t.current=s;if(yc&&(yc=!1,yn=t,gd=i),a=t.pendingLanes,a===0&&(En=null),Z_(s.stateNode),Ns(t,jt()),e!==null)for(n=t.onRecoverableError,s=0;s<e.length;s++)i=e[s],n(i.value,{componentStack:i.stack,digest:i.digest});if(fd)throw fd=!1,t=Ph,Ph=null,t;return gd&1&&t.tag!==0&&ia(),a=t.pendingLanes,a&1?t===Dh?Io++:(Io=0,Dh=t):Io=0,qn(),null}function ia(){if(yn!==null){var t=rb(gd),e=Us.transition,s=et;try{if(Us.transition=null,et=16>t?16:t,yn===null)var n=!1;else{if(t=yn,yn=null,gd=0,He&6)throw Error(ae(331));var i=He;for(He|=4,xe=t.current;xe!==null;){var a=xe,o=a.child;if(xe.flags&16){var l=a.deletions;if(l!==null){for(var d=0;d<l.length;d++){var u=l[d];for(xe=u;xe!==null;){var m=xe;switch(m.tag){case 0:case 11:case 15:Eo(8,m,a)}var h=m.child;if(h!==null)h.return=m,xe=h;else for(;xe!==null;){m=xe;var f=m.sibling,x=m.return;if(pw(m),m===u){xe=null;break}if(f!==null){f.return=x,xe=f;break}xe=x}}}var y=a.alternate;if(y!==null){var P=y.child;if(P!==null){y.child=null;do{var _=P.sibling;P.sibling=null,P=_}while(P!==null)}}xe=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,xe=o;else e:for(;xe!==null;){if(a=xe,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Eo(9,a,a.return)}var C=a.sibling;if(C!==null){C.return=a.return,xe=C;break e}xe=a.return}}var k=t.current;for(xe=k;xe!==null;){o=xe;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,xe=T;else e:for(o=k;xe!==null;){if(l=xe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:ru(9,l)}}catch(D){vt(l,l.return,D)}if(l===o){xe=null;break e}var S=l.sibling;if(S!==null){S.return=l.return,xe=S;break e}xe=l.return}}if(He=i,qn(),mr&&typeof mr.onPostCommitFiberRoot=="function")try{mr.onPostCommitFiberRoot(Qd,t)}catch{}n=!0}return n}finally{et=s,Us.transition=e}}return!1}function v0(t,e,s){e=xa(s,e),e=rw(t,e,1),t=Sn(t,e,1),e=us(),t!==null&&(yl(t,1,e),Ns(t,e))}function vt(t,e,s){if(t.tag===3)v0(t,t,s);else for(;e!==null;){if(e.tag===3){v0(e,t,s);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(En===null||!En.has(n))){t=xa(s,t),t=nw(e,t,1),e=Sn(e,t,1),t=us(),e!==null&&(yl(e,1,t),Ns(e,t));break}}e=e.return}}function E2(t,e,s){var n=t.pingCache;n!==null&&n.delete(e),e=us(),t.pingedLanes|=t.suspendedLanes&s,Mt===t&&(Bt&s)===s&&(Tt===4||Tt===3&&(Bt&130023424)===Bt&&500>jt()-Zp?li(t,0):Jp|=s),Ns(t,e)}function _w(t,e){e===0&&(t.mode&1?(e=lc,lc<<=1,!(lc&130023424)&&(lc=4194304)):e=1);var s=us();t=zr(t,e),t!==null&&(yl(t,e,s),Ns(t,s))}function A2(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),_w(t,s)}function I2(t,e){var s=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(s=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(ae(314))}n!==null&&n.delete(e),_w(t,s)}var Sw;Sw=function(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps||ws.current)bs=!0;else{if(!(t.lanes&s)&&!(e.flags&128))return bs=!1,f2(t,e,s);bs=!!(t.flags&131072)}else bs=!1,dt&&e.flags&1048576&&kb(e,od,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Mc(t,e),t=e.pendingProps;var i=ha(e,ss.current);na(e,s),i=Wp(null,e,n,t,i,s);var a=Hp();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,js(n)?(a=!0,id(e)):a=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,zp(e),i.updater=su,e.stateNode=i,i._reactInternals=e,jh(e,n,t,s),e=Sh(null,e,n,!0,a,s)):(e.tag=0,dt&&a&&Dp(e),is(null,e,i,s),e=e.child),e;case 16:n=e.elementType;e:{switch(Mc(t,e),t=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=C2(n),t=Xs(n,t),i){case 0:e=_h(null,e,n,t,s);break e;case 1:e=c0(null,e,n,t,s);break e;case 11:e=o0(null,e,n,t,s);break e;case 14:e=l0(null,e,n,Xs(n.type,t),s);break e}throw Error(ae(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Xs(n,i),_h(t,e,n,i,s);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Xs(n,i),c0(t,e,n,i,s);case 3:e:{if(lw(e),t===null)throw Error(ae(387));n=e.pendingProps,a=e.memoizedState,i=a.element,Mb(t,e),dd(e,n,null,s);var o=e.memoizedState;if(n=o.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){i=xa(Error(ae(423)),e),e=d0(t,e,n,s,i);break e}else if(n!==i){i=xa(Error(ae(424)),e),e=d0(t,e,n,s,i);break e}else for(Ts=_n(e.stateNode.containerInfo.firstChild),Ps=e,dt=!0,Zs=null,s=Pb(e,null,n,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(pa(),n===i){e=Ur(t,e,s);break e}is(t,e,n,s)}e=e.child}return e;case 5:return Lb(e),t===null&&vh(e),n=e.type,i=e.pendingProps,a=t!==null?t.memoizedProps:null,o=i.children,ph(n,i)?o=null:a!==null&&ph(n,a)&&(e.flags|=32),ow(t,e),is(t,e,o,s),e.child;case 6:return t===null&&vh(e),null;case 13:return cw(t,e,s);case 4:return Up(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=fa(e,null,n,s):is(t,e,n,s),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Xs(n,i),o0(t,e,n,i,s);case 7:return is(t,e,e.pendingProps,s),e.child;case 8:return is(t,e,e.pendingProps.children,s),e.child;case 12:return is(t,e,e.pendingProps.children,s),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,it(ld,n._currentValue),n._currentValue=o,a!==null)if(nr(a.value,o)){if(a.children===i.children&&!ws.current){e=Ur(t,e,s);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var d=l.firstContext;d!==null;){if(d.context===n){if(a.tag===1){d=Mr(-1,s&-s),d.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var m=u.pending;m===null?d.next=d:(d.next=m.next,m.next=d),u.pending=d}}a.lanes|=s,d=a.alternate,d!==null&&(d.lanes|=s),bh(a.return,s,e),l.lanes|=s;break}d=d.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(ae(341));o.lanes|=s,l=o.alternate,l!==null&&(l.lanes|=s),bh(o,s,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}is(t,e,i.children,s),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,na(e,s),i=Gs(i),n=n(i),e.flags|=1,is(t,e,n,s),e.child;case 14:return n=e.type,i=Xs(n,e.pendingProps),i=Xs(n.type,i),l0(t,e,n,i,s);case 15:return iw(t,e,e.type,e.pendingProps,s);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Xs(n,i),Mc(t,e),e.tag=1,js(n)?(t=!0,id(e)):t=!1,na(e,s),sw(e,n,i),jh(e,n,i,s),Sh(null,e,n,!0,t,s);case 19:return dw(t,e,s);case 22:return aw(t,e,s)}throw Error(ae(156,e.tag))};function Ew(t,e){return Zv(t,e)}function k2(t,e,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zs(t,e,s,n){return new k2(t,e,s,n)}function rf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function C2(t){if(typeof t=="function")return rf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===jp)return 11;if(t===Np)return 14}return 2}function In(t,e){var s=t.alternate;return s===null?(s=zs(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&14680064,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s}function Oc(t,e,s,n,i,a){var o=2;if(n=t,typeof t=="function")rf(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ui:return ci(s.children,i,a,e);case wp:o=8,i|=8;break;case Wm:return t=zs(12,s,e,i|2),t.elementType=Wm,t.lanes=a,t;case Hm:return t=zs(13,s,e,i),t.elementType=Hm,t.lanes=a,t;case Km:return t=zs(19,s,e,i),t.elementType=Km,t.lanes=a,t;case Lv:return iu(s,i,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Dv:o=10;break e;case Mv:o=9;break e;case jp:o=11;break e;case Np:o=14;break e;case on:o=16,n=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=zs(o,s,e,i),e.elementType=t,e.type=n,e.lanes=a,e}function ci(t,e,s,n){return t=zs(7,t,n,e),t.lanes=s,t}function iu(t,e,s,n){return t=zs(22,t,n,e),t.elementType=Lv,t.lanes=s,t.stateNode={isHidden:!1},t}function Am(t,e,s){return t=zs(6,t,null,e),t.lanes=s,t}function Im(t,e,s){return e=zs(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function T2(t,e,s,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lm(0),this.expirationTimes=lm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lm(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function nf(t,e,s,n,i,a,o,l,d){return t=new T2(t,e,s,l,d),e===1?(e=1,a===!0&&(e|=8)):e=0,a=zs(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},zp(a),t}function R2(t,e,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zi,key:n==null?null:""+n,children:t,containerInfo:e,implementation:s}}function Aw(t){if(!t)return Mn;t=t._reactInternals;e:{if(Si(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(js(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var s=t.type;if(js(s))return Ab(t,s,e)}return e}function Iw(t,e,s,n,i,a,o,l,d){return t=nf(s,n,!0,t,i,a,o,l,d),t.context=Aw(null),s=t.current,n=us(),i=An(s),a=Mr(n,i),a.callback=e??null,Sn(s,a,i),t.current.lanes=i,yl(t,i,n),Ns(t,n),t}function au(t,e,s,n){var i=e.current,a=us(),o=An(i);return s=Aw(s),e.context===null?e.context=s:e.pendingContext=s,e=Mr(a,o),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Sn(i,e,o),t!==null&&(sr(t,i,o,a),Rc(t,i,o)),o}function yd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function b0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function af(t,e){b0(t,e),(t=t.alternate)&&b0(t,e)}function P2(){return null}var kw=typeof reportError=="function"?reportError:function(t){console.error(t)};function of(t){this._internalRoot=t}ou.prototype.render=of.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));au(t,e,null,null)};ou.prototype.unmount=of.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;fi(function(){au(null,t,null,null)}),e[$r]=null}};function ou(t){this._internalRoot=t}ou.prototype.unstable_scheduleHydration=function(t){if(t){var e=ab();t={blockedOn:null,target:t,priority:e};for(var s=0;s<cn.length&&e!==0&&e<cn[s].priority;s++);cn.splice(s,0,t),s===0&&lb(t)}};function lf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function lu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function w0(){}function D2(t,e,s,n,i){if(i){if(typeof n=="function"){var a=n;n=function(){var u=yd(o);a.call(u)}}var o=Iw(e,n,t,0,null,!1,!1,"",w0);return t._reactRootContainer=o,t[$r]=o.current,Go(t.nodeType===8?t.parentNode:t),fi(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof n=="function"){var l=n;n=function(){var u=yd(d);l.call(u)}}var d=nf(t,0,!1,null,null,!1,!1,"",w0);return t._reactRootContainer=d,t[$r]=d.current,Go(t.nodeType===8?t.parentNode:t),fi(function(){au(e,d,s,n)}),d}function cu(t,e,s,n,i){var a=s._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var l=i;i=function(){var d=yd(o);l.call(d)}}au(e,o,t,i)}else o=D2(s,e,t,i,n);return yd(o)}nb=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var s=uo(e.pendingLanes);s!==0&&(Ep(e,s|1),Ns(e,jt()),!(He&6)&&(ya=jt()+500,qn()))}break;case 13:fi(function(){var n=zr(t,1);if(n!==null){var i=us();sr(n,t,1,i)}}),af(t,1)}};Ap=function(t){if(t.tag===13){var e=zr(t,134217728);if(e!==null){var s=us();sr(e,t,134217728,s)}af(t,134217728)}};ib=function(t){if(t.tag===13){var e=An(t),s=zr(t,e);if(s!==null){var n=us();sr(s,t,e,n)}af(t,e)}};ab=function(){return et};ob=function(t,e){var s=et;try{return et=t,e()}finally{et=s}};nh=function(t,e,s){switch(e){case"input":if(Xm(t,s),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var n=s[e];if(n!==t&&n.form===t.form){var i=Zd(n);if(!i)throw Error(ae(90));Ov(n),Xm(n,i)}}}break;case"textarea":$v(t,s);break;case"select":e=s.value,e!=null&&ea(t,!!s.multiple,e,!1)}};Hv=ef;Kv=fi;var M2={usingClientEntryPoint:!1,Events:[bl,Wi,Zd,Gv,Wv,ef]},ao={findFiberByHostInstance:ri,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},L2={bundleType:ao.bundleType,version:ao.version,rendererPackageName:ao.rendererPackageName,rendererConfig:ao.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Jr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Xv(t),t===null?null:t.stateNode},findFiberByHostInstance:ao.findFiberByHostInstance||P2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vc.isDisabled&&vc.supportsFiber)try{Qd=vc.inject(L2),mr=vc}catch{}}Vs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M2;Vs.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!lf(e))throw Error(ae(200));return R2(t,e,null,s)};Vs.createRoot=function(t,e){if(!lf(t))throw Error(ae(299));var s=!1,n="",i=kw;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=nf(t,1,!1,null,null,s,!1,n,i),t[$r]=e.current,Go(t.nodeType===8?t.parentNode:t),new of(e)};Vs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=Xv(e),t=t===null?null:t.stateNode,t};Vs.flushSync=function(t){return fi(t)};Vs.hydrate=function(t,e,s){if(!lu(e))throw Error(ae(200));return cu(null,t,e,!0,s)};Vs.hydrateRoot=function(t,e,s){if(!lf(t))throw Error(ae(405));var n=s!=null&&s.hydratedSources||null,i=!1,a="",o=kw;if(s!=null&&(s.unstable_strictMode===!0&&(i=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(o=s.onRecoverableError)),e=Iw(e,null,t,1,s??null,i,!1,a,o),t[$r]=e.current,Go(t),n)for(t=0;t<n.length;t++)s=n[t],i=s._getVersion,i=i(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,i]:e.mutableSourceEagerHydrationData.push(s,i);return new ou(e)};Vs.render=function(t,e,s){if(!lu(e))throw Error(ae(200));return cu(null,t,e,!1,s)};Vs.unmountComponentAtNode=function(t){if(!lu(t))throw Error(ae(40));return t._reactRootContainer?(fi(function(){cu(null,null,t,!1,function(){t._reactRootContainer=null,t[$r]=null})}),!0):!1};Vs.unstable_batchedUpdates=ef;Vs.unstable_renderSubtreeIntoContainer=function(t,e,s,n){if(!lu(s))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return cu(t,e,s,!1,n)};Vs.version="18.3.1-next-f1338f8080-20240426";function Cw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Cw)}catch(t){console.error(t)}}Cw(),Cv.exports=Vs;var V2=Cv.exports,Tw,j0=V2;Tw=j0.createRoot,j0.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function el(){return el=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},el.apply(this,arguments)}var vn;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(vn||(vn={}));const N0="popstate";function O2(t){t===void 0&&(t={});function e(n,i){let{pathname:a,search:o,hash:l}=n.location;return Vh("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){return typeof i=="string"?i:vd(i)}return $2(e,s,null,t)}function Nt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Rw(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function F2(){return Math.random().toString(36).substr(2,8)}function _0(t,e){return{usr:t.state,key:t.key,idx:e}}function Vh(t,e,s,n){return s===void 0&&(s=null),el({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ta(e):e,{state:s,key:e&&e.key||n||F2()})}function vd(t){let{pathname:e="/",search:s="",hash:n=""}=t;return s&&s!=="?"&&(e+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function Ta(t){let e={};if(t){let s=t.indexOf("#");s>=0&&(e.hash=t.substr(s),t=t.substr(0,s));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function $2(t,e,s,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,l=vn.Pop,d=null,u=m();u==null&&(u=0,o.replaceState(el({},o.state,{idx:u}),""));function m(){return(o.state||{idx:null}).idx}function h(){l=vn.Pop;let _=m(),C=_==null?null:_-u;u=_,d&&d({action:l,location:P.location,delta:C})}function f(_,C){l=vn.Push;let k=Vh(P.location,_,C);u=m()+1;let T=_0(k,u),S=P.createHref(k);try{o.pushState(T,"",S)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;i.location.assign(S)}a&&d&&d({action:l,location:P.location,delta:1})}function x(_,C){l=vn.Replace;let k=Vh(P.location,_,C);u=m();let T=_0(k,u),S=P.createHref(k);o.replaceState(T,"",S),a&&d&&d({action:l,location:P.location,delta:0})}function y(_){let C=i.location.origin!=="null"?i.location.origin:i.location.href,k=typeof _=="string"?_:vd(_);return k=k.replace(/ $/,"%20"),Nt(C,"No window.location.(origin|href) available to create URL for href: "+k),new URL(k,C)}let P={get action(){return l},get location(){return t(i,o)},listen(_){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(N0,h),d=_,()=>{i.removeEventListener(N0,h),d=null}},createHref(_){return e(i,_)},createURL:y,encodeLocation(_){let C=y(_);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:f,replace:x,go(_){return o.go(_)}};return P}var S0;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(S0||(S0={}));function z2(t,e,s){return s===void 0&&(s="/"),U2(t,e,s,!1)}function U2(t,e,s,n){let i=typeof e=="string"?Ta(e):e,a=cf(i.pathname||"/",s);if(a==null)return null;let o=Pw(t);B2(o);let l=null;for(let d=0;l==null&&d<o.length;++d){let u=eE(a);l=J2(o[d],u,n)}return l}function Pw(t,e,s,n){e===void 0&&(e=[]),s===void 0&&(s=[]),n===void 0&&(n="");let i=(a,o,l)=>{let d={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};d.relativePath.startsWith("/")&&(Nt(d.relativePath.startsWith(n),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(n.length));let u=kn([n,d.relativePath]),m=s.concat(d);a.children&&a.children.length>0&&(Nt(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),Pw(a.children,e,m,u)),!(a.path==null&&!a.index)&&e.push({path:u,score:Y2(u,a.index),routesMeta:m})};return t.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let d of Dw(a.path))i(a,o,d)}),e}function Dw(t){let e=t.split("/");if(e.length===0)return[];let[s,...n]=e,i=s.endsWith("?"),a=s.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=Dw(n.join("/")),l=[];return l.push(...o.map(d=>d===""?a:[a,d].join("/"))),i&&l.push(...o),l.map(d=>t.startsWith("/")&&d===""?"/":d)}function B2(t){t.sort((e,s)=>e.score!==s.score?s.score-e.score:X2(e.routesMeta.map(n=>n.childrenIndex),s.routesMeta.map(n=>n.childrenIndex)))}const q2=/^:[\w-]+$/,G2=3,W2=2,H2=1,K2=10,Q2=-2,E0=t=>t==="*";function Y2(t,e){let s=t.split("/"),n=s.length;return s.some(E0)&&(n+=Q2),e&&(n+=W2),s.filter(i=>!E0(i)).reduce((i,a)=>i+(q2.test(a)?G2:a===""?H2:K2),n)}function X2(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function J2(t,e,s){let{routesMeta:n}=t,i={},a="/",o=[];for(let l=0;l<n.length;++l){let d=n[l],u=l===n.length-1,m=a==="/"?e:e.slice(a.length)||"/",h=A0({path:d.relativePath,caseSensitive:d.caseSensitive,end:u},m),f=d.route;if(!h&&u&&s&&!n[n.length-1].route.index&&(h=A0({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},m)),!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:kn([a,h.pathname]),pathnameBase:nE(kn([a,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(a=kn([a,h.pathnameBase]))}return o}function A0(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[s,n]=Z2(t.path,t.caseSensitive,t.end),i=e.match(s);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:n.reduce((u,m,h)=>{let{paramName:f,isOptional:x}=m;if(f==="*"){let P=l[h]||"";o=a.slice(0,a.length-P.length).replace(/(.)\/+$/,"$1")}const y=l[h];return x&&!y?u[f]=void 0:u[f]=(y||"").replace(/%2F/g,"/"),u},{}),pathname:a,pathnameBase:o,pattern:t}}function Z2(t,e,s){e===void 0&&(e=!1),s===void 0&&(s=!0),Rw(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,d)=>(n.push({paramName:l,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function eE(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Rw(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function cf(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,n=t.charAt(s);return n&&n!=="/"?null:t.slice(s)||"/"}function tE(t,e){e===void 0&&(e="/");let{pathname:s,search:n="",hash:i=""}=typeof t=="string"?Ta(t):t;return{pathname:s?s.startsWith("/")?s:sE(s,e):e,search:iE(n),hash:aE(i)}}function sE(t,e){let s=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function km(t,e,s,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function rE(t){return t.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function df(t,e){let s=rE(t);return e?s.map((n,i)=>i===s.length-1?n.pathname:n.pathnameBase):s.map(n=>n.pathnameBase)}function uf(t,e,s,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=Ta(t):(i=el({},t),Nt(!i.pathname||!i.pathname.includes("?"),km("?","pathname","search",i)),Nt(!i.pathname||!i.pathname.includes("#"),km("#","pathname","hash",i)),Nt(!i.search||!i.search.includes("#"),km("#","search","hash",i)));let a=t===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=s;else{let h=e.length-1;if(!n&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;i.pathname=f.join("/")}l=h>=0?e[h]:"/"}let d=tE(i,l),u=o&&o!=="/"&&o.endsWith("/"),m=(a||o===".")&&s.endsWith("/");return!d.pathname.endsWith("/")&&(u||m)&&(d.pathname+="/"),d}const kn=t=>t.join("/").replace(/\/\/+/g,"/"),nE=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),iE=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,aE=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function oE(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Mw=["post","put","patch","delete"];new Set(Mw);const lE=["get",...Mw];new Set(lE);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tl(){return tl=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},tl.apply(this,arguments)}const mf=A.createContext(null),cE=A.createContext(null),Gn=A.createContext(null),du=A.createContext(null),Wn=A.createContext({outlet:null,matches:[],isDataRoute:!1}),Lw=A.createContext(null);function dE(t,e){let{relative:s}=e===void 0?{}:e;Ra()||Nt(!1);let{basename:n,navigator:i}=A.useContext(Gn),{hash:a,pathname:o,search:l}=Ow(t,{relative:s}),d=o;return n!=="/"&&(d=o==="/"?n:kn([n,o])),i.createHref({pathname:d,search:l,hash:a})}function Ra(){return A.useContext(du)!=null}function Ei(){return Ra()||Nt(!1),A.useContext(du).location}function Vw(t){A.useContext(Gn).static||A.useLayoutEffect(t)}function jl(){let{isDataRoute:t}=A.useContext(Wn);return t?NE():uE()}function uE(){Ra()||Nt(!1);let t=A.useContext(mf),{basename:e,future:s,navigator:n}=A.useContext(Gn),{matches:i}=A.useContext(Wn),{pathname:a}=Ei(),o=JSON.stringify(df(i,s.v7_relativeSplatPath)),l=A.useRef(!1);return Vw(()=>{l.current=!0}),A.useCallback(function(u,m){if(m===void 0&&(m={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let h=uf(u,JSON.parse(o),a,m.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:kn([e,h.pathname])),(m.replace?n.replace:n.push)(h,m.state,m)},[e,n,o,a,t])}function Ow(t,e){let{relative:s}=e===void 0?{}:e,{future:n}=A.useContext(Gn),{matches:i}=A.useContext(Wn),{pathname:a}=Ei(),o=JSON.stringify(df(i,n.v7_relativeSplatPath));return A.useMemo(()=>uf(t,JSON.parse(o),a,s==="path"),[t,o,a,s])}function mE(t,e){return hE(t,e)}function hE(t,e,s,n){Ra()||Nt(!1);let{navigator:i}=A.useContext(Gn),{matches:a}=A.useContext(Wn),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let d=o?o.pathnameBase:"/";o&&o.route;let u=Ei(),m;if(e){var h;let _=typeof e=="string"?Ta(e):e;d==="/"||(h=_.pathname)!=null&&h.startsWith(d)||Nt(!1),m=_}else m=u;let f=m.pathname||"/",x=f;if(d!=="/"){let _=d.replace(/^\//,"").split("/");x="/"+f.replace(/^\//,"").split("/").slice(_.length).join("/")}let y=z2(t,{pathname:x}),P=yE(y&&y.map(_=>Object.assign({},_,{params:Object.assign({},l,_.params),pathname:kn([d,i.encodeLocation?i.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?d:kn([d,i.encodeLocation?i.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),a,s,n);return e&&P?A.createElement(du.Provider,{value:{location:tl({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:vn.Pop}},P):P}function pE(){let t=jE(),e=oE(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),s=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),s?A.createElement("pre",{style:i},s):null,null)}const fE=A.createElement(pE,null);class gE extends A.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,s){return s.location!==e.location||s.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:s.error,location:s.location,revalidation:e.revalidation||s.revalidation}}componentDidCatch(e,s){console.error("React Router caught the following error during render",e,s)}render(){return this.state.error!==void 0?A.createElement(Wn.Provider,{value:this.props.routeContext},A.createElement(Lw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function xE(t){let{routeContext:e,match:s,children:n}=t,i=A.useContext(mf);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),A.createElement(Wn.Provider,{value:e},n)}function yE(t,e,s,n){var i;if(e===void 0&&(e=[]),s===void 0&&(s=null),n===void 0&&(n=null),t==null){var a;if(!s)return null;if(s.errors)t=s.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!s.initialized&&s.matches.length>0)t=s.matches;else return null}let o=t,l=(i=s)==null?void 0:i.errors;if(l!=null){let m=o.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);m>=0||Nt(!1),o=o.slice(0,Math.min(o.length,m+1))}let d=!1,u=-1;if(s&&n&&n.v7_partialHydration)for(let m=0;m<o.length;m++){let h=o[m];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=m),h.route.id){let{loaderData:f,errors:x}=s,y=h.route.loader&&f[h.route.id]===void 0&&(!x||x[h.route.id]===void 0);if(h.route.lazy||y){d=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((m,h,f)=>{let x,y=!1,P=null,_=null;s&&(x=l&&h.route.id?l[h.route.id]:void 0,P=h.route.errorElement||fE,d&&(u<0&&f===0?(y=!0,_=null):u===f&&(y=!0,_=h.route.hydrateFallbackElement||null)));let C=e.concat(o.slice(0,f+1)),k=()=>{let T;return x?T=P:y?T=_:h.route.Component?T=A.createElement(h.route.Component,null):h.route.element?T=h.route.element:T=m,A.createElement(xE,{match:h,routeContext:{outlet:m,matches:C,isDataRoute:s!=null},children:T})};return s&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?A.createElement(gE,{location:s.location,revalidation:s.revalidation,component:P,error:x,children:k(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):k()},null)}var Fw=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Fw||{}),bd=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(bd||{});function vE(t){let e=A.useContext(mf);return e||Nt(!1),e}function bE(t){let e=A.useContext(cE);return e||Nt(!1),e}function wE(t){let e=A.useContext(Wn);return e||Nt(!1),e}function $w(t){let e=wE(),s=e.matches[e.matches.length-1];return s.route.id||Nt(!1),s.route.id}function jE(){var t;let e=A.useContext(Lw),s=bE(bd.UseRouteError),n=$w(bd.UseRouteError);return e!==void 0?e:(t=s.errors)==null?void 0:t[n]}function NE(){let{router:t}=vE(Fw.UseNavigateStable),e=$w(bd.UseNavigateStable),s=A.useRef(!1);return Vw(()=>{s.current=!0}),A.useCallback(function(i,a){a===void 0&&(a={}),s.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,tl({fromRouteId:e},a)))},[t,e])}function _E(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function zw(t){let{to:e,replace:s,state:n,relative:i}=t;Ra()||Nt(!1);let{future:a,static:o}=A.useContext(Gn),{matches:l}=A.useContext(Wn),{pathname:d}=Ei(),u=jl(),m=uf(e,df(l,a.v7_relativeSplatPath),d,i==="path"),h=JSON.stringify(m);return A.useEffect(()=>u(JSON.parse(h),{replace:s,state:n,relative:i}),[u,h,i,s,n]),null}function Ot(t){Nt(!1)}function SE(t){let{basename:e="/",children:s=null,location:n,navigationType:i=vn.Pop,navigator:a,static:o=!1,future:l}=t;Ra()&&Nt(!1);let d=e.replace(/^\/*/,"/"),u=A.useMemo(()=>({basename:d,navigator:a,static:o,future:tl({v7_relativeSplatPath:!1},l)}),[d,l,a,o]);typeof n=="string"&&(n=Ta(n));let{pathname:m="/",search:h="",hash:f="",state:x=null,key:y="default"}=n,P=A.useMemo(()=>{let _=cf(m,d);return _==null?null:{location:{pathname:_,search:h,hash:f,state:x,key:y},navigationType:i}},[d,m,h,f,x,y,i]);return P==null?null:A.createElement(Gn.Provider,{value:u},A.createElement(du.Provider,{children:s,value:P}))}function EE(t){let{children:e,location:s}=t;return mE(Oh(e),s)}new Promise(()=>{});function Oh(t,e){e===void 0&&(e=[]);let s=[];return A.Children.forEach(t,(n,i)=>{if(!A.isValidElement(n))return;let a=[...e,i];if(n.type===A.Fragment){s.push.apply(s,Oh(n.props.children,a));return}n.type!==Ot&&Nt(!1),!n.props.index||!n.props.children||Nt(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Oh(n.props.children,a)),s.push(o)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fh(){return Fh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Fh.apply(this,arguments)}function AE(t,e){if(t==null)return{};var s={},n=Object.keys(t),i,a;for(a=0;a<n.length;a++)i=n[a],!(e.indexOf(i)>=0)&&(s[i]=t[i]);return s}function IE(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function kE(t,e){return t.button===0&&(!e||e==="_self")&&!IE(t)}const CE=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],TE="6";try{window.__reactRouterVersion=TE}catch{}const RE="startTransition",I0=E_[RE];function PE(t){let{basename:e,children:s,future:n,window:i}=t,a=A.useRef();a.current==null&&(a.current=O2({window:i,v5Compat:!0}));let o=a.current,[l,d]=A.useState({action:o.action,location:o.location}),{v7_startTransition:u}=n||{},m=A.useCallback(h=>{u&&I0?I0(()=>d(h)):d(h)},[d,u]);return A.useLayoutEffect(()=>o.listen(m),[o,m]),A.useEffect(()=>_E(n),[n]),A.createElement(SE,{basename:e,children:s,location:l.location,navigationType:l.action,navigator:o,future:n})}const DE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ME=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,k0=A.forwardRef(function(e,s){let{onClick:n,relative:i,reloadDocument:a,replace:o,state:l,target:d,to:u,preventScrollReset:m,viewTransition:h}=e,f=AE(e,CE),{basename:x}=A.useContext(Gn),y,P=!1;if(typeof u=="string"&&ME.test(u)&&(y=u,DE))try{let T=new URL(window.location.href),S=u.startsWith("//")?new URL(T.protocol+u):new URL(u),D=cf(S.pathname,x);S.origin===T.origin&&D!=null?u=D+S.search+S.hash:P=!0}catch{}let _=dE(u,{relative:i}),C=LE(u,{replace:o,state:l,target:d,preventScrollReset:m,relative:i,viewTransition:h});function k(T){n&&n(T),T.defaultPrevented||C(T)}return A.createElement("a",Fh({},f,{href:y||_,onClick:P||a?n:k,ref:s,target:d}))});var C0;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(C0||(C0={}));var T0;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(T0||(T0={}));function LE(t,e){let{target:s,replace:n,state:i,preventScrollReset:a,relative:o,viewTransition:l}=e===void 0?{}:e,d=jl(),u=Ei(),m=Ow(t,{relative:o});return A.useCallback(h=>{if(kE(h,s)){h.preventDefault();let f=n!==void 0?n:vd(u)===vd(m);d(t,{replace:f,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[u,d,m,n,i,s,t,a,o,l])}let VE={data:""},OE=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||VE,FE=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,$E=/\/\*[^]*?\*\/|  +/g,R0=/\n+/g,un=(t,e)=>{let s="",n="",i="";for(let a in t){let o=t[a];a[0]=="@"?a[1]=="i"?s=a+" "+o+";":n+=a[1]=="f"?un(o,a):a+"{"+un(o,a[1]=="k"?"":e)+"}":typeof o=="object"?n+=un(o,e?e.replace(/([^,])+/g,l=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,l):l?l+" "+d:d)):a):o!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=un.p?un.p(a,o):a+":"+o+";")}return s+(e&&i?e+"{"+i+"}":i)+n},Ar={},Uw=t=>{if(typeof t=="object"){let e="";for(let s in t)e+=s+Uw(t[s]);return e}return t},zE=(t,e,s,n,i)=>{let a=Uw(t),o=Ar[a]||(Ar[a]=(d=>{let u=0,m=11;for(;u<d.length;)m=101*m+d.charCodeAt(u++)>>>0;return"go"+m})(a));if(!Ar[o]){let d=a!==t?t:(u=>{let m,h,f=[{}];for(;m=FE.exec(u.replace($E,""));)m[4]?f.shift():m[3]?(h=m[3].replace(R0," ").trim(),f.unshift(f[0][h]=f[0][h]||{})):f[0][m[1]]=m[2].replace(R0," ").trim();return f[0]})(t);Ar[o]=un(i?{["@keyframes "+o]:d}:d,s?"":"."+o)}let l=s&&Ar.g?Ar.g:null;return s&&(Ar.g=Ar[o]),((d,u,m,h)=>{h?u.data=u.data.replace(h,d):u.data.indexOf(d)===-1&&(u.data=m?d+u.data:u.data+d)})(Ar[o],e,n,l),o},UE=(t,e,s)=>t.reduce((n,i,a)=>{let o=e[a];if(o&&o.call){let l=o(s),d=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=d?"."+d:l&&typeof l=="object"?l.props?"":un(l,""):l===!1?"":l}return n+i+(o??"")},"");function uu(t){let e=this||{},s=t.call?t(e.p):t;return zE(s.unshift?s.raw?UE(s,[].slice.call(arguments,1),e.p):s.reduce((n,i)=>Object.assign(n,i&&i.call?i(e.p):i),{}):s,OE(e.target),e.g,e.o,e.k)}let Bw,$h,zh;uu.bind({g:1});let Br=uu.bind({k:1});function BE(t,e,s,n){un.p=e,Bw=t,$h=s,zh=n}function Hn(t,e){let s=this||{};return function(){let n=arguments;function i(a,o){let l=Object.assign({},a),d=l.className||i.className;s.p=Object.assign({theme:$h&&$h()},l),s.o=/ *go\d+/.test(d),l.className=uu.apply(s,n)+(d?" "+d:"");let u=t;return t[0]&&(u=l.as||t,delete l.as),zh&&u[0]&&zh(l),Bw(u,l)}return i}}var qE=t=>typeof t=="function",wd=(t,e)=>qE(t)?t(e):t,GE=(()=>{let t=0;return()=>(++t).toString()})(),qw=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),WE=20,Gw=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,WE)};case 1:return{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case 2:let{toast:s}=e;return Gw(t,{type:t.toasts.find(a=>a.id===s.id)?1:0,toast:s});case 3:let{toastId:n}=e;return{...t,toasts:t.toasts.map(a=>a.id===n||n===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let i=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+i}))}}},Fc=[],ai={toasts:[],pausedAt:void 0},Ai=t=>{ai=Gw(ai,t),Fc.forEach(e=>{e(ai)})},HE={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},KE=(t={})=>{let[e,s]=A.useState(ai),n=A.useRef(ai);A.useEffect(()=>(n.current!==ai&&s(ai),Fc.push(s),()=>{let a=Fc.indexOf(s);a>-1&&Fc.splice(a,1)}),[]);let i=e.toasts.map(a=>{var o,l,d;return{...t,...t[a.type],...a,removeDelay:a.removeDelay||((o=t[a.type])==null?void 0:o.removeDelay)||(t==null?void 0:t.removeDelay),duration:a.duration||((l=t[a.type])==null?void 0:l.duration)||(t==null?void 0:t.duration)||HE[a.type],style:{...t.style,...(d=t[a.type])==null?void 0:d.style,...a.style}}});return{...e,toasts:i}},QE=(t,e="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...s,id:(s==null?void 0:s.id)||GE()}),Nl=t=>(e,s)=>{let n=QE(e,t,s);return Ai({type:2,toast:n}),n.id},os=(t,e)=>Nl("blank")(t,e);os.error=Nl("error");os.success=Nl("success");os.loading=Nl("loading");os.custom=Nl("custom");os.dismiss=t=>{Ai({type:3,toastId:t})};os.remove=t=>Ai({type:4,toastId:t});os.promise=(t,e,s)=>{let n=os.loading(e.loading,{...s,...s==null?void 0:s.loading});return typeof t=="function"&&(t=t()),t.then(i=>{let a=e.success?wd(e.success,i):void 0;return a?os.success(a,{id:n,...s,...s==null?void 0:s.success}):os.dismiss(n),i}).catch(i=>{let a=e.error?wd(e.error,i):void 0;a?os.error(a,{id:n,...s,...s==null?void 0:s.error}):os.dismiss(n)}),t};var YE=(t,e)=>{Ai({type:1,toast:{id:t,height:e}})},XE=()=>{Ai({type:5,time:Date.now()})},ko=new Map,JE=1e3,ZE=(t,e=JE)=>{if(ko.has(t))return;let s=setTimeout(()=>{ko.delete(t),Ai({type:4,toastId:t})},e);ko.set(t,s)},eA=t=>{let{toasts:e,pausedAt:s}=KE(t);A.useEffect(()=>{if(s)return;let a=Date.now(),o=e.map(l=>{if(l.duration===1/0)return;let d=(l.duration||0)+l.pauseDuration-(a-l.createdAt);if(d<0){l.visible&&os.dismiss(l.id);return}return setTimeout(()=>os.dismiss(l.id),d)});return()=>{o.forEach(l=>l&&clearTimeout(l))}},[e,s]);let n=A.useCallback(()=>{s&&Ai({type:6,time:Date.now()})},[s]),i=A.useCallback((a,o)=>{let{reverseOrder:l=!1,gutter:d=8,defaultPosition:u}=o||{},m=e.filter(x=>(x.position||u)===(a.position||u)&&x.height),h=m.findIndex(x=>x.id===a.id),f=m.filter((x,y)=>y<h&&x.visible).length;return m.filter(x=>x.visible).slice(...l?[f+1]:[0,f]).reduce((x,y)=>x+(y.height||0)+d,0)},[e]);return A.useEffect(()=>{e.forEach(a=>{if(a.dismissed)ZE(a.id,a.removeDelay);else{let o=ko.get(a.id);o&&(clearTimeout(o),ko.delete(a.id))}})},[e]),{toasts:e,handlers:{updateHeight:YE,startPause:XE,endPause:n,calculateOffset:i}}},tA=Br`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,sA=Br`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,rA=Br`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,nA=Hn("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${tA} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${sA} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${rA} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,iA=Br`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,aA=Hn("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${iA} 1s linear infinite;
`,oA=Br`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,lA=Br`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,cA=Hn("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${oA} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${lA} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,dA=Hn("div")`
  position: absolute;
`,uA=Hn("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,mA=Br`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,hA=Hn("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${mA} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,pA=({toast:t})=>{let{icon:e,type:s,iconTheme:n}=t;return e!==void 0?typeof e=="string"?A.createElement(hA,null,e):e:s==="blank"?null:A.createElement(uA,null,A.createElement(aA,{...n}),s!=="loading"&&A.createElement(dA,null,s==="error"?A.createElement(nA,{...n}):A.createElement(cA,{...n})))},fA=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,gA=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,xA="0%{opacity:0;} 100%{opacity:1;}",yA="0%{opacity:1;} 100%{opacity:0;}",vA=Hn("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,bA=Hn("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,wA=(t,e)=>{let s=t.includes("top")?1:-1,[n,i]=qw()?[xA,yA]:[fA(s),gA(s)];return{animation:e?`${Br(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Br(i)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},jA=A.memo(({toast:t,position:e,style:s,children:n})=>{let i=t.height?wA(t.position||e||"top-center",t.visible):{opacity:0},a=A.createElement(pA,{toast:t}),o=A.createElement(bA,{...t.ariaProps},wd(t.message,t));return A.createElement(vA,{className:t.className,style:{...i,...s,...t.style}},typeof n=="function"?n({icon:a,message:o}):A.createElement(A.Fragment,null,a,o))});BE(A.createElement);var NA=({id:t,className:e,style:s,onHeightUpdate:n,children:i})=>{let a=A.useCallback(o=>{if(o){let l=()=>{let d=o.getBoundingClientRect().height;n(t,d)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[t,n]);return A.createElement("div",{ref:a,className:e,style:s},i)},_A=(t,e)=>{let s=t.includes("top"),n=s?{top:0}:{bottom:0},i=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:qw()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(s?1:-1)}px)`,...n,...i}},SA=uu`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,bc=16,EA=({reverseOrder:t,position:e="top-center",toastOptions:s,gutter:n,children:i,containerStyle:a,containerClassName:o})=>{let{toasts:l,handlers:d}=eA(s);return A.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:bc,left:bc,right:bc,bottom:bc,pointerEvents:"none",...a},className:o,onMouseEnter:d.startPause,onMouseLeave:d.endPause},l.map(u=>{let m=u.position||e,h=d.calculateOffset(u,{reverseOrder:t,gutter:n,defaultPosition:e}),f=_A(m,h);return A.createElement(NA,{id:u.id,key:u.id,onHeightUpdate:d.updateHeight,className:u.visible?SA:"",style:f},u.type==="custom"?wd(u.message,u):i?i(u):A.createElement(jA,{toast:u,position:m}))}))},L=os;const AA={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},P0=t=>{let e;const s=new Set,n=(m,h)=>{const f=typeof m=="function"?m(e):m;if(!Object.is(f,e)){const x=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),s.forEach(y=>y(e,x))}},i=()=>e,d={setState:n,getState:i,getInitialState:()=>u,subscribe:m=>(s.add(m),()=>s.delete(m)),destroy:()=>{(AA?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},u=e=t(n,i,d);return d},IA=t=>t?P0(t):P0;var Ww={exports:{}},Hw={},Kw={exports:{}},Qw={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var va=A;function kA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var CA=typeof Object.is=="function"?Object.is:kA,TA=va.useState,RA=va.useEffect,PA=va.useLayoutEffect,DA=va.useDebugValue;function MA(t,e){var s=e(),n=TA({inst:{value:s,getSnapshot:e}}),i=n[0].inst,a=n[1];return PA(function(){i.value=s,i.getSnapshot=e,Cm(i)&&a({inst:i})},[t,s,e]),RA(function(){return Cm(i)&&a({inst:i}),t(function(){Cm(i)&&a({inst:i})})},[t]),DA(s),s}function Cm(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!CA(t,s)}catch{return!0}}function LA(t,e){return e()}var VA=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?LA:MA;Qw.useSyncExternalStore=va.useSyncExternalStore!==void 0?va.useSyncExternalStore:VA;Kw.exports=Qw;var OA=Kw.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mu=A,FA=OA;function $A(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zA=typeof Object.is=="function"?Object.is:$A,UA=FA.useSyncExternalStore,BA=mu.useRef,qA=mu.useEffect,GA=mu.useMemo,WA=mu.useDebugValue;Hw.useSyncExternalStoreWithSelector=function(t,e,s,n,i){var a=BA(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=GA(function(){function d(x){if(!u){if(u=!0,m=x,x=n(x),i!==void 0&&o.hasValue){var y=o.value;if(i(y,x))return h=y}return h=x}if(y=h,zA(m,x))return y;var P=n(x);return i!==void 0&&i(y,P)?(m=x,y):(m=x,h=P)}var u=!1,m,h,f=s===void 0?null:s;return[function(){return d(e())},f===null?void 0:function(){return d(f())}]},[e,s,n,i]);var l=UA(t,a[0],a[1]);return qA(function(){o.hasValue=!0,o.value=l},[l]),WA(l),l};Ww.exports=Hw;var HA=Ww.exports;const KA=yv(HA),Yw={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},{useDebugValue:QA}=gn,{useSyncExternalStoreWithSelector:YA}=KA;let D0=!1;const XA=t=>t;function JA(t,e=XA,s){(Yw?"production":void 0)!=="production"&&s&&!D0&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),D0=!0);const n=YA(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,s);return QA(n),n}const M0=t=>{(Yw?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?IA(t):t,s=(n,i)=>JA(e,n,i);return Object.assign(s,e),s},ZA=t=>t?M0(t):M0;var L0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):(i&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++n)&1023),e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},eI=function(t){const e=[];let s=0,n=0;for(;s<t.length;){const i=t[s++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const a=t[s++];e[n++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=t[s++],o=t[s++],l=t[s++],d=((i&7)<<18|(a&63)<<12|(o&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const a=t[s++],o=t[s++];e[n++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return e.join("")},Jw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<t.length;i+=3){const a=t[i],o=i+1<t.length,l=o?t[i+1]:0,d=i+2<t.length,u=d?t[i+2]:0,m=a>>2,h=(a&3)<<4|l>>4;let f=(l&15)<<2|u>>6,x=u&63;d||(x=64,o||(f=64)),n.push(s[m],s[h],s[f],s[x])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Xw(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):eI(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<t.length;){const a=s[t.charAt(i++)],l=i<t.length?s[t.charAt(i)]:0;++i;const u=i<t.length?s[t.charAt(i)]:64;++i;const h=i<t.length?s[t.charAt(i)]:64;if(++i,a==null||l==null||u==null||h==null)throw new tI;const f=a<<2|l>>4;if(n.push(f),u!==64){const x=l<<4&240|u>>2;if(n.push(x),h!==64){const y=u<<6&192|h;n.push(y)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class tI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const sI=function(t){const e=Xw(t);return Jw.encodeByteArray(e,!0)},jd=function(t){return sI(t).replace(/\./g,"")},Zw=function(t){try{return Jw.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nI=()=>rI().__FIREBASE_DEFAULTS__,iI=()=>{if(typeof process>"u"||typeof L0>"u")return;const t=L0.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},aI=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Zw(t[1]);return e&&JSON.parse(e)},hu=()=>{try{return nI()||iI()||aI()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},ej=t=>{var e,s;return(s=(e=hu())===null||e===void 0?void 0:e.emulatorHosts)===null||s===void 0?void 0:s[t]},hf=t=>{const e=ej(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),n]:[e.substring(0,s),n]},tj=()=>{var t;return(t=hu())===null||t===void 0?void 0:t.config},sj=t=>{var e;return(e=hu())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,n)=>{s?this.reject(s):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,n))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rj(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},n=e||"demo-project",i=t.iat||0,a=t.sub||t.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},t);return[jd(JSON.stringify(s)),jd(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lI(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(rs())}function cI(){var t;const e=(t=hu())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dI(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function uI(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function mI(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hI(){const t=rs();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function pI(){return!cI()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function fI(){try{return typeof indexedDB=="object"}catch{return!1}}function gI(){return new Promise((t,e)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(s){e(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xI="FirebaseError";class jr extends Error{constructor(e,s,n){super(s),this.code=e,this.customData=n,this.name=xI,Object.setPrototypeOf(this,jr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_l.prototype.create)}}class _l{constructor(e,s,n){this.service=e,this.serviceName=s,this.errors=n}create(e,...s){const n=s[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?yI(a,n):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new jr(i,l,n)}}function yI(t,e){return t.replace(vI,(s,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const vI=/\{\$([^}]+)}/g;function bI(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Nd(t,e){if(t===e)return!0;const s=Object.keys(t),n=Object.keys(e);for(const i of s){if(!n.includes(i))return!1;const a=t[i],o=e[i];if(V0(a)&&V0(o)){if(!Nd(a,o))return!1}else if(a!==o)return!1}for(const i of n)if(!s.includes(i))return!1;return!0}function V0(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sl(t){const e=[];for(const[s,n]of Object.entries(t))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function ho(t){const e={};return t.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,a]=n.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function po(t){const e=t.indexOf("?");if(!e)return"";const s=t.indexOf("#",e);return t.substring(e,s>0?s:void 0)}function wI(t,e){const s=new jI(t,e);return s.subscribe.bind(s)}class jI{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,n){let i;if(e===void 0&&s===void 0&&n===void 0)throw new Error("Missing Observer.");NI(e,["next","error","complete"])?i=e:i={next:e,error:s,complete:n},i.next===void 0&&(i.next=Tm),i.error===void 0&&(i.error=Tm),i.complete===void 0&&(i.complete=Tm);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function NI(t,e){if(typeof t!="object"||t===null)return!1;for(const s of e)if(s in t&&typeof t[s]=="function")return!0;return!1}function Tm(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function st(t){return t&&t._delegate?t._delegate:t}class qr{constructor(e,s,n){this.name=e,this.instanceFactory=s,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const si="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const n=new oI;if(this.instancesDeferred.set(s,n),this.isInitialized(s)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:s});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){var s;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(s=e==null?void 0:e.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(EI(e))try{this.getOrInitializeService({instanceIdentifier:si})}catch{}for(const[s,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(s);try{const a=this.getOrInitializeService({instanceIdentifier:i});n.resolve(a)}catch{}}}}clearInstance(e=si){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=si){return this.instances.has(e)}getOptions(e=si){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:s});for(const[a,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);n===l&&o.resolve(i)}return i}onInit(e,s){var n;const i=this.normalizeInstanceIdentifier(s),a=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;a.add(e),this.onInitCallbacks.set(i,a);const o=this.instances.get(i);return o&&e(o,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,s){const n=this.onInitCallbacks.get(s);if(n)for(const i of n)try{i(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:SI(e),options:s}),this.instances.set(e,n),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=si){return this.component?this.component.multipleInstances?e:si:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function SI(t){return t===si?void 0:t}function EI(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new _I(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ue;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ue||(Ue={}));const II={debug:Ue.DEBUG,verbose:Ue.VERBOSE,info:Ue.INFO,warn:Ue.WARN,error:Ue.ERROR,silent:Ue.SILENT},kI=Ue.INFO,CI={[Ue.DEBUG]:"log",[Ue.VERBOSE]:"log",[Ue.INFO]:"info",[Ue.WARN]:"warn",[Ue.ERROR]:"error"},TI=(t,e,...s)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),i=CI[e];if(i)console[i](`[${n}]  ${t.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class pf{constructor(e){this.name=e,this._logLevel=kI,this._logHandler=TI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ue))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?II[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ue.DEBUG,...e),this._logHandler(this,Ue.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ue.VERBOSE,...e),this._logHandler(this,Ue.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ue.INFO,...e),this._logHandler(this,Ue.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ue.WARN,...e),this._logHandler(this,Ue.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ue.ERROR,...e),this._logHandler(this,Ue.ERROR,...e)}}const RI=(t,e)=>e.some(s=>t instanceof s);let O0,F0;function PI(){return O0||(O0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DI(){return F0||(F0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const nj=new WeakMap,Uh=new WeakMap,ij=new WeakMap,Rm=new WeakMap,ff=new WeakMap;function MI(t){const e=new Promise((s,n)=>{const i=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{s(Cn(t.result)),i()},o=()=>{n(t.error),i()};t.addEventListener("success",a),t.addEventListener("error",o)});return e.then(s=>{s instanceof IDBCursor&&nj.set(s,t)}).catch(()=>{}),ff.set(e,t),e}function LI(t){if(Uh.has(t))return;const e=new Promise((s,n)=>{const i=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{s(),i()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});Uh.set(t,e)}let Bh={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return Uh.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ij.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Cn(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function VI(t){Bh=t(Bh)}function OI(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const n=t.call(Pm(this),e,...s);return ij.set(n,e.sort?e.sort():[e]),Cn(n)}:DI().includes(t)?function(...e){return t.apply(Pm(this),e),Cn(nj.get(this))}:function(...e){return Cn(t.apply(Pm(this),e))}}function FI(t){return typeof t=="function"?OI(t):(t instanceof IDBTransaction&&LI(t),RI(t,PI())?new Proxy(t,Bh):t)}function Cn(t){if(t instanceof IDBRequest)return MI(t);if(Rm.has(t))return Rm.get(t);const e=FI(t);return e!==t&&(Rm.set(t,e),ff.set(e,t)),e}const Pm=t=>ff.get(t);function $I(t,e,{blocked:s,upgrade:n,blocking:i,terminated:a}={}){const o=indexedDB.open(t,e),l=Cn(o);return n&&o.addEventListener("upgradeneeded",d=>{n(Cn(o.result),d.oldVersion,d.newVersion,Cn(o.transaction),d)}),s&&o.addEventListener("blocked",d=>s(d.oldVersion,d.newVersion,d)),l.then(d=>{a&&d.addEventListener("close",()=>a()),i&&d.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const zI=["get","getKey","getAll","getAllKeys","count"],UI=["put","add","delete","clear"],Dm=new Map;function $0(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Dm.get(e))return Dm.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,i=UI.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(i||zI.includes(s)))return;const a=async function(o,...l){const d=this.transaction(o,i?"readwrite":"readonly");let u=d.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&d.done]))[0]};return Dm.set(e,a),a}VI(t=>({...t,get:(e,s,n)=>$0(e,s)||t.get(e,s,n),has:(e,s)=>!!$0(e,s)||t.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(qI(s)){const n=s.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(s=>s).join(" ")}}function qI(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const qh="@firebase/app",z0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gr=new pf("@firebase/app"),GI="@firebase/app-compat",WI="@firebase/analytics-compat",HI="@firebase/analytics",KI="@firebase/app-check-compat",QI="@firebase/app-check",YI="@firebase/auth",XI="@firebase/auth-compat",JI="@firebase/database",ZI="@firebase/data-connect",ek="@firebase/database-compat",tk="@firebase/functions",sk="@firebase/functions-compat",rk="@firebase/installations",nk="@firebase/installations-compat",ik="@firebase/messaging",ak="@firebase/messaging-compat",ok="@firebase/performance",lk="@firebase/performance-compat",ck="@firebase/remote-config",dk="@firebase/remote-config-compat",uk="@firebase/storage",mk="@firebase/storage-compat",hk="@firebase/firestore",pk="@firebase/vertexai-preview",fk="@firebase/firestore-compat",gk="firebase",xk="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gh="[DEFAULT]",yk={[qh]:"fire-core",[GI]:"fire-core-compat",[HI]:"fire-analytics",[WI]:"fire-analytics-compat",[QI]:"fire-app-check",[KI]:"fire-app-check-compat",[YI]:"fire-auth",[XI]:"fire-auth-compat",[JI]:"fire-rtdb",[ZI]:"fire-data-connect",[ek]:"fire-rtdb-compat",[tk]:"fire-fn",[sk]:"fire-fn-compat",[rk]:"fire-iid",[nk]:"fire-iid-compat",[ik]:"fire-fcm",[ak]:"fire-fcm-compat",[ok]:"fire-perf",[lk]:"fire-perf-compat",[ck]:"fire-rc",[dk]:"fire-rc-compat",[uk]:"fire-gcs",[mk]:"fire-gcs-compat",[hk]:"fire-fst",[fk]:"fire-fst-compat",[pk]:"fire-vertex","fire-js":"fire-js",[gk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _d=new Map,vk=new Map,Wh=new Map;function U0(t,e){try{t.container.addComponent(e)}catch(s){Gr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,s)}}function Ln(t){const e=t.name;if(Wh.has(e))return Gr.debug(`There were multiple attempts to register component ${e}.`),!1;Wh.set(e,t);for(const s of _d.values())U0(s,t);for(const s of vk.values())U0(s,t);return!0}function El(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function ur(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Tn=new _l("app","Firebase",bk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,s,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new qr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Tn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii=xk;function aj(t,e={}){let s=t;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Gh,automaticDataCollectionEnabled:!1},e),i=n.name;if(typeof i!="string"||!i)throw Tn.create("bad-app-name",{appName:String(i)});if(s||(s=tj()),!s)throw Tn.create("no-options");const a=_d.get(i);if(a){if(Nd(s,a.options)&&Nd(n,a.config))return a;throw Tn.create("duplicate-app",{appName:i})}const o=new AI(i);for(const d of Wh.values())o.addComponent(d);const l=new wk(s,n,o);return _d.set(i,l),l}function pu(t=Gh){const e=_d.get(t);if(!e&&t===Gh&&tj())return aj();if(!e)throw Tn.create("no-app",{appName:t});return e}function Bs(t,e,s){var n;let i=(n=yk[t])!==null&&n!==void 0?n:t;s&&(i+=`-${s}`);const a=i.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const l=[`Unable to register library "${i}" with version "${e}":`];a&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Gr.warn(l.join(" "));return}Ln(new qr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk="firebase-heartbeat-database",Nk=1,sl="firebase-heartbeat-store";let Mm=null;function oj(){return Mm||(Mm=$I(jk,Nk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(sl)}catch(s){console.warn(s)}}}}).catch(t=>{throw Tn.create("idb-open",{originalErrorMessage:t.message})})),Mm}async function _k(t){try{const s=(await oj()).transaction(sl),n=await s.objectStore(sl).get(lj(t));return await s.done,n}catch(e){if(e instanceof jr)Gr.warn(e.message);else{const s=Tn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Gr.warn(s.message)}}}async function B0(t,e){try{const n=(await oj()).transaction(sl,"readwrite");await n.objectStore(sl).put(e,lj(t)),await n.done}catch(s){if(s instanceof jr)Gr.warn(s.message);else{const n=Tn.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Gr.warn(n.message)}}}function lj(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=1024,Ek=30*24*60*60*1e3;class Ak{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new kk(s),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,s;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=q0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a)?void 0:(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=Ek}),this._storage.overwrite(this._heartbeatsCache))}catch(n){Gr.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=q0(),{heartbeatsToSend:n,unsentEntries:i}=Ik(this._heartbeatsCache.heartbeats),a=jd(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=s,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(s){return Gr.warn(s),""}}}function q0(){return new Date().toISOString().substring(0,10)}function Ik(t,e=Sk){const s=[];let n=t.slice();for(const i of t){const a=s.find(o=>o.agent===i.agent);if(a){if(a.dates.push(i.date),G0(s)>e){a.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),G0(s)>e){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}class kk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fI()?gI().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await _k(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return B0(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return B0(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function G0(t){return jd(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ck(t){Ln(new qr("platform-logger",e=>new BI(e),"PRIVATE")),Ln(new qr("heartbeat",e=>new Ak(e),"PRIVATE")),Bs(qh,z0,t),Bs(qh,z0,"esm2017"),Bs("fire-js","")}Ck("");function gf(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(s[n[i]]=t[n[i]]);return s}function cj(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Tk=cj,dj=new _l("auth","Firebase",cj());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd=new pf("@firebase/auth");function Rk(t,...e){Sd.logLevel<=Ue.WARN&&Sd.warn(`Auth (${Ii}): ${t}`,...e)}function $c(t,...e){Sd.logLevel<=Ue.ERROR&&Sd.error(`Auth (${Ii}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ir(t,...e){throw xf(t,...e)}function pr(t,...e){return xf(t,...e)}function uj(t,e,s){const n=Object.assign(Object.assign({},Tk()),{[e]:s});return new _l("auth","Firebase",n).create(e,{appName:t.name})}function Lr(t){return uj(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function xf(t,...e){if(typeof t!="string"){const s=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(s,...n)}return dj.create(t,...e)}function Ee(t,e,...s){if(!t)throw xf(e,...s)}function Rr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw $c(e),new Error(e)}function Wr(t,e){t||Rr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Pk(){return W0()==="http:"||W0()==="https:"}function W0(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Pk()||uI()||"connection"in navigator)?navigator.onLine:!0}function Mk(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(e,s){this.shortDelay=e,this.longDelay=s,Wr(s>e,"Short delay should be less than long delay!"),this.isMobile=lI()||mI()}get(){return Dk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yf(t,e){Wr(t.emulator,"Emulator should always be set here");const{url:s}=t.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mj{static initialize(e,s,n){this.fetchImpl=e,s&&(this.headersImpl=s),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk=new Al(3e4,6e4);function Zr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Nr(t,e,s,n,i={}){return hj(t,i,async()=>{let a={},o={};n&&(e==="GET"?o=n:a={body:JSON.stringify(n)});const l=Sl(Object.assign({key:t.config.apiKey},o)).slice(1),d=await t._getAdditionalHeaders();d["Content-Type"]="application/json",t.languageCode&&(d["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:d},a);return dI()||(u.referrerPolicy="no-referrer"),mj.fetch()(pj(t,t.config.apiHost,s,l),u)})}async function hj(t,e,s){t._canInitEmulator=!1;const n=Object.assign(Object.assign({},Lk),e);try{const i=new Fk(t),a=await Promise.race([s(),i.promise]);i.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw wc(t,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const l=a.ok?o.errorMessage:o.error.message,[d,u]=l.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw wc(t,"credential-already-in-use",o);if(d==="EMAIL_EXISTS")throw wc(t,"email-already-in-use",o);if(d==="USER_DISABLED")throw wc(t,"user-disabled",o);const m=n[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw uj(t,m,u);ir(t,m)}}catch(i){if(i instanceof jr)throw i;ir(t,"network-request-failed",{message:String(i)})}}async function Il(t,e,s,n,i={}){const a=await Nr(t,e,s,n,i);return"mfaPendingCredential"in a&&ir(t,"multi-factor-auth-required",{_serverResponse:a}),a}function pj(t,e,s,n){const i=`${e}${s}?${n}`;return t.config.emulator?yf(t.config,i):`${t.config.apiScheme}://${i}`}function Ok(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Fk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,n)=>{this.timer=setTimeout(()=>n(pr(this.auth,"network-request-failed")),Vk.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function wc(t,e,s){const n={appName:t.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const i=pr(t,e,n);return i.customData._tokenResponse=s,i}function H0(t){return t!==void 0&&t.enterprise!==void 0}class $k{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return Ok(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function zk(t,e){return Nr(t,"GET","/v2/recaptchaConfig",Zr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(t,e){return Nr(t,"POST","/v1/accounts:delete",e)}async function fj(t,e){return Nr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Co(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Bk(t,e=!1){const s=st(t),n=await s.getIdToken(e),i=vf(n);Ee(i&&i.exp&&i.auth_time&&i.iat,s.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:i,token:n,authTime:Co(Lm(i.auth_time)),issuedAtTime:Co(Lm(i.iat)),expirationTime:Co(Lm(i.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function Lm(t){return Number(t)*1e3}function vf(t){const[e,s,n]=t.split(".");if(e===void 0||s===void 0||n===void 0)return $c("JWT malformed, contained fewer than 3 sections"),null;try{const i=Zw(s);return i?JSON.parse(i):($c("Failed to decode base64 JWT payload"),null)}catch(i){return $c("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function K0(t){const e=vf(t);return Ee(e,"internal-error"),Ee(typeof e.exp<"u","internal-error"),Ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ba(t,e,s=!1){if(s)return e;try{return await e}catch(n){throw n instanceof jr&&qk(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function qk({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var s;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Co(this.lastLoginAt),this.creationTime=Co(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ed(t){var e;const s=t.auth,n=await t.getIdToken(),i=await ba(t,fj(s,{idToken:n}));Ee(i==null?void 0:i.users.length,s,"internal-error");const a=i.users[0];t._notifyReloadListener(a);const o=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?gj(a.providerUserInfo):[],l=Hk(t.providerData,o),d=t.isAnonymous,u=!(t.email&&a.passwordHash)&&!(l!=null&&l.length),m=d?u:!1,h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new Kh(a.createdAt,a.lastLoginAt),isAnonymous:m};Object.assign(t,h)}async function Wk(t){const e=st(t);await Ed(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Hk(t,e){return[...t.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function gj(t){return t.map(e=>{var{providerId:s}=e,n=gf(e,["providerId"]);return{providerId:s,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(t,e){const s=await hj(t,{},async()=>{const n=Sl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=t.config,o=pj(t,i,"/v1/token",`key=${a}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",mj.fetch()(o,{method:"POST",headers:l,body:n})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function Qk(t,e){return Nr(t,"POST","/v2/accounts:revokeToken",Zr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ee(e.idToken,"internal-error"),Ee(typeof e.idToken<"u","internal-error"),Ee(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):K0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){Ee(e.length!==0,"internal-error");const s=K0(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:n,refreshToken:i,expiresIn:a}=await Kk(e,s);this.updateTokensAndExpiration(n,i,Number(a))}updateTokensAndExpiration(e,s,n){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,s){const{refreshToken:n,accessToken:i,expirationTime:a}=s,o=new aa;return n&&(Ee(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),i&&(Ee(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),a&&(Ee(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new aa,this.toJSON())}_performRefresh(){return Rr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function an(t,e){Ee(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Pr{constructor(e){var{uid:s,auth:n,stsTokenManager:i}=e,a=gf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Gk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Kh(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const s=await ba(this,this.stsTokenManager.getToken(this.auth,e));return Ee(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return Bk(this,e)}reload(){return Wk(this)}_assign(e){this!==e&&(Ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>Object.assign({},s)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new Pr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(e){Ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),s&&await Ed(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(Lr(this.auth));const e=await this.getIdToken();return await ba(this,Uk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){var n,i,a,o,l,d,u,m;const h=(n=s.displayName)!==null&&n!==void 0?n:void 0,f=(i=s.email)!==null&&i!==void 0?i:void 0,x=(a=s.phoneNumber)!==null&&a!==void 0?a:void 0,y=(o=s.photoURL)!==null&&o!==void 0?o:void 0,P=(l=s.tenantId)!==null&&l!==void 0?l:void 0,_=(d=s._redirectEventId)!==null&&d!==void 0?d:void 0,C=(u=s.createdAt)!==null&&u!==void 0?u:void 0,k=(m=s.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:T,emailVerified:S,isAnonymous:D,providerData:R,stsTokenManager:v}=s;Ee(T&&v,e,"internal-error");const b=aa.fromJSON(this.name,v);Ee(typeof T=="string",e,"internal-error"),an(h,e.name),an(f,e.name),Ee(typeof S=="boolean",e,"internal-error"),Ee(typeof D=="boolean",e,"internal-error"),an(x,e.name),an(y,e.name),an(P,e.name),an(_,e.name),an(C,e.name),an(k,e.name);const N=new Pr({uid:T,auth:e,email:f,emailVerified:S,displayName:h,isAnonymous:D,photoURL:y,phoneNumber:x,tenantId:P,stsTokenManager:b,createdAt:C,lastLoginAt:k});return R&&Array.isArray(R)&&(N.providerData=R.map(g=>Object.assign({},g))),_&&(N._redirectEventId=_),N}static async _fromIdTokenResponse(e,s,n=!1){const i=new aa;i.updateFromServerResponse(s);const a=new Pr({uid:s.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Ed(a),a}static async _fromGetAccountInfoResponse(e,s,n){const i=s.users[0];Ee(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?gj(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),l=new aa;l.updateFromIdToken(n);const d=new Pr({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Kh(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(d,u),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0=new Map;function Dr(t){Wr(t instanceof Function,"Expected a class definition");let e=Q0.get(t);return e?(Wr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Q0.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}xj.type="NONE";const Y0=xj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(t,e,s){return`firebase:${t}:${e}:${s}`}class oa{constructor(e,s,n){this.persistence=e,this.auth=s,this.userKey=n;const{config:i,name:a}=this.auth;this.fullUserKey=zc(this.userKey,i.apiKey,a),this.fullPersistenceKey=zc("persistence",i.apiKey,a),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Pr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,n="authUser"){if(!s.length)return new oa(Dr(Y0),e,n);const i=(await Promise.all(s.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let a=i[0]||Dr(Y0);const o=zc(n,e.config.apiKey,e.name);let l=null;for(const u of s)try{const m=await u._get(o);if(m){const h=Pr._fromJSON(e,m);u!==a&&(l=h),a=u;break}}catch{}const d=i.filter(u=>u._shouldAllowMigration);return!a._shouldAllowMigration||!d.length?new oa(a,e,n):(a=d[0],l&&await a._set(o,l.toJSON()),await Promise.all(s.map(async u=>{if(u!==a)try{await u._remove(o)}catch{}})),new oa(a,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X0(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(wj(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(yj(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Nj(e))return"Blackberry";if(_j(e))return"Webos";if(vj(e))return"Safari";if((e.includes("chrome/")||bj(e))&&!e.includes("edge/"))return"Chrome";if(jj(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(s);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function yj(t=rs()){return/firefox\//i.test(t)}function vj(t=rs()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bj(t=rs()){return/crios\//i.test(t)}function wj(t=rs()){return/iemobile/i.test(t)}function jj(t=rs()){return/android/i.test(t)}function Nj(t=rs()){return/blackberry/i.test(t)}function _j(t=rs()){return/webos/i.test(t)}function bf(t=rs()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Yk(t=rs()){var e;return bf(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Xk(){return hI()&&document.documentMode===10}function Sj(t=rs()){return bf(t)||jj(t)||_j(t)||Nj(t)||/windows phone/i.test(t)||wj(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ej(t,e=[]){let s;switch(t){case"Browser":s=X0(rs());break;case"Worker":s=`${X0(rs())}-${t}`;break;default:s=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${Ii}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const n=a=>new Promise((o,l)=>{try{const d=e(a);o(d)}catch(d){l(d)}});n.onAbort=s,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const n of this.queue)await n(e),n.onAbort&&s.push(n.onAbort)}catch(n){s.reverse();for(const i of s)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zk(t,e={}){return Nr(t,"GET","/v2/passwordPolicy",Zr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eC=6;class tC{constructor(e){var s,n,i,a;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=o.minPasswordLength)!==null&&s!==void 0?s:eC,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var s,n,i,a,o,l;const d={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,d),this.validatePasswordCharacterOptions(e,d),d.isValid&&(d.isValid=(s=d.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),d.isValid&&(d.isValid=(n=d.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),d.isValid&&(d.isValid=(i=d.containsLowercaseLetter)!==null&&i!==void 0?i:!0),d.isValid&&(d.isValid=(a=d.containsUppercaseLetter)!==null&&a!==void 0?a:!0),d.isValid&&(d.isValid=(o=d.containsNumericCharacter)!==null&&o!==void 0?o:!0),d.isValid&&(d.isValid=(l=d.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),d}validatePasswordLengthOptions(e,s){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(s.meetsMinPasswordLength=e.length>=n),i&&(s.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(s,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,s,n,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sC{constructor(e,s,n,i){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new J0(this),this.idTokenSubscription=new J0(this),this.beforeStateQueue=new Jk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dj,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=Dr(s)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await oa.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await fj(this,{idToken:e}),n=await Pr._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(n)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(ur(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,l=i==null?void 0:i._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&(d!=null&&d.user)&&(i=d.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await Ed(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Mk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(Lr(this));const s=e?st(e):null;return s&&Ee(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&Ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ur(this.app)?Promise.reject(Lr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(Lr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Dr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Zk(this),s=new tC(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _l("auth","Firebase",e())}onAuthStateChanged(e,s,n){return this.registerStateListener(this.authStateSubscription,e,s,n)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,n){return this.registerStateListener(this.idTokenSubscription,e,s,n)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(n.tenantId=this.tenantId),await Qk(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,s){const n=await this.getOrInitRedirectPersistenceManager(s);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&Dr(e)||this._popupRedirectResolver;Ee(s,this,"argument-error"),this.redirectPersistenceManager=await oa.create(this,[Dr(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,n;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(s=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,n,i){if(this._deleted)return()=>{};const a=typeof s=="function"?s:s.next.bind(s);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ee(l,this,"internal-error"),l.then(()=>{o||a(this.currentUser)}),typeof s=="function"){const d=e.addObserver(s,n,i);return()=>{o=!0,d()}}else{const d=e.addObserver(s);return()=>{o=!0,d()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ej(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(s["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(s["X-Firebase-AppCheck"]=i),s}async _getAppCheckToken(){var e;const s=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return s!=null&&s.error&&Rk(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Kn(t){return st(t)}class J0{constructor(e){this.auth=e,this.observer=null,this.addObserver=wI(s=>this.observer=s)}get next(){return Ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rC(t){fu=t}function Aj(t){return fu.loadJS(t)}function nC(){return fu.recaptchaEnterpriseScript}function iC(){return fu.gapiScript}function aC(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const oC="recaptcha-enterprise",lC="NO_RECAPTCHA";class cC{constructor(e){this.type=oC,this.auth=Kn(e)}async verify(e="verify",s=!1){async function n(a){if(!s){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,l)=>{zk(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(d.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const u=new $k(d);return a.tenantId==null?a._agentRecaptchaConfig=u:a._tenantRecaptchaConfigs[a.tenantId]=u,o(u.siteKey)}}).catch(d=>{l(d)})})}function i(a,o,l){const d=window.grecaptcha;H0(d)?d.enterprise.ready(()=>{d.enterprise.execute(a,{action:e}).then(u=>{o(u)}).catch(()=>{o(lC)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,o)=>{n(this.auth).then(l=>{if(!s&&H0(window.grecaptcha))i(l,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let d=nC();d.length!==0&&(d+=l),Aj(d).then(()=>{i(l,a,o)}).catch(u=>{o(u)})}}).catch(l=>{o(l)})})}}async function Z0(t,e,s,n=!1){const i=new cC(t);let a;try{a=await i.verify(s)}catch{a=await i.verify(s,!0)}const o=Object.assign({},e);return n?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ad(t,e,s,n){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Z0(t,e,s,s==="getOobCode");return n(t,a)}else return n(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Z0(t,e,s,s==="getOobCode");return n(t,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(t,e){const s=El(t,"auth");if(s.isInitialized()){const i=s.getImmediate(),a=s.getOptions();if(Nd(a,e??{}))return i;ir(i,"already-initialized")}return s.initialize({options:e})}function uC(t,e){const s=(e==null?void 0:e.persistence)||[],n=(Array.isArray(s)?s:[s]).map(Dr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function mC(t,e,s){const n=Kn(t);Ee(n._canInitEmulator,n,"emulator-config-failed"),Ee(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,a=Ij(e),{host:o,port:l}=hC(e),d=l===null?"":`:${l}`;n.config.emulator={url:`${a}//${o}${d}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),pC()}function Ij(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function hC(t){const e=Ij(t),s=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const a=i[1];return{host:a,port:ey(n.substr(a.length+1))}}else{const[a,o]=n.split(":");return{host:a,port:ey(o)}}}function ey(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function pC(){function t(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return Rr("not implemented")}_getIdTokenResponse(e){return Rr("not implemented")}_linkToIdToken(e,s){return Rr("not implemented")}_getReauthenticationResolver(e){return Rr("not implemented")}}async function fC(t,e){return Nr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gC(t,e){return Il(t,"POST","/v1/accounts:signInWithPassword",Zr(t,e))}async function kj(t,e){return Nr(t,"POST","/v1/accounts:sendOobCode",Zr(t,e))}async function xC(t,e){return kj(t,e)}async function yC(t,e){return kj(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vC(t,e){return Il(t,"POST","/v1/accounts:signInWithEmailLink",Zr(t,e))}async function bC(t,e){return Il(t,"POST","/v1/accounts:signInWithEmailLink",Zr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl extends wf{constructor(e,s,n,i=null){super("password",n),this._email=e,this._password=s,this._tenantId=i}static _fromEmailAndPassword(e,s){return new rl(e,s,"password")}static _fromEmailAndCode(e,s,n=null){return new rl(e,s,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ad(e,s,"signInWithPassword",gC);case"emailLink":return vC(e,{email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const n={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ad(e,n,"signUpPassword",fC);case"emailLink":return bC(e,{idToken:s,email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function la(t,e){return Il(t,"POST","/v1/accounts:signInWithIdp",Zr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wC="http://localhost";class gi extends wf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new gi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):ir("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=s,a=gf(s,["providerId","signInMethod"]);if(!n||!i)return null;const o=new gi(n,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const s=this.buildRequest();return la(e,s)}_linkToIdToken(e,s){const n=this.buildRequest();return n.idToken=s,la(e,n)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,la(e,s)}buildRequest(){const e={requestUri:wC,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=Sl(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jC(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function NC(t){const e=ho(po(t)).link,s=e?ho(po(e)).deep_link_id:null,n=ho(po(t)).deep_link_id;return(n?ho(po(n)).link:null)||n||s||e||t}class jf{constructor(e){var s,n,i,a,o,l;const d=ho(po(e)),u=(s=d.apiKey)!==null&&s!==void 0?s:null,m=(n=d.oobCode)!==null&&n!==void 0?n:null,h=jC((i=d.mode)!==null&&i!==void 0?i:null);Ee(u&&m&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=m,this.continueUrl=(a=d.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=d.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=d.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const s=NC(e);try{return new jf(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(){this.providerId=ki.PROVIDER_ID}static credential(e,s){return rl._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const n=jf.parseLink(s);return Ee(n,"argument-error"),rl._fromEmailAndCode(e,n.code,n.tenantId)}}ki.PROVIDER_ID="password";ki.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ki.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl extends Cj{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn extends kl{constructor(){super("facebook.com")}static credential(e){return gi._fromParams({providerId:mn.PROVIDER_ID,signInMethod:mn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mn.credentialFromTaggedObject(e)}static credentialFromError(e){return mn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return mn.credential(e.oauthAccessToken)}catch{return null}}}mn.FACEBOOK_SIGN_IN_METHOD="facebook.com";mn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn extends kl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return gi._fromParams({providerId:hn.PROVIDER_ID,signInMethod:hn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return hn.credentialFromTaggedObject(e)}static credentialFromError(e){return hn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:n}=e;if(!s&&!n)return null;try{return hn.credential(s,n)}catch{return null}}}hn.GOOGLE_SIGN_IN_METHOD="google.com";hn.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn extends kl{constructor(){super("github.com")}static credential(e){return gi._fromParams({providerId:pn.PROVIDER_ID,signInMethod:pn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pn.credentialFromTaggedObject(e)}static credentialFromError(e){return pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pn.credential(e.oauthAccessToken)}catch{return null}}}pn.GITHUB_SIGN_IN_METHOD="github.com";pn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn extends kl{constructor(){super("twitter.com")}static credential(e,s){return gi._fromParams({providerId:fn.PROVIDER_ID,signInMethod:fn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return fn.credentialFromTaggedObject(e)}static credentialFromError(e){return fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:n}=e;if(!s||!n)return null;try{return fn.credential(s,n)}catch{return null}}}fn.TWITTER_SIGN_IN_METHOD="twitter.com";fn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _C(t,e){return Il(t,"POST","/v1/accounts:signUp",Zr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,n,i=!1){const a=await Pr._fromIdTokenResponse(e,n,i),o=ty(n);return new xi({user:a,providerId:o,_tokenResponse:n,operationType:s})}static async _forOperation(e,s,n){await e._updateTokensIfNecessary(n,!0);const i=ty(n);return new xi({user:e,providerId:i,_tokenResponse:n,operationType:s})}}function ty(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id extends jr{constructor(e,s,n,i){var a;super(s.code,s.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Id.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:s.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,s,n,i){return new Id(e,s,n,i)}}function Tj(t,e,s,n){return(e==="reauthenticate"?s._getReauthenticationResolver(t):s._getIdTokenResponse(t)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?Id._fromErrorAndOperation(t,a,e,n):a})}async function SC(t,e,s=!1){const n=await ba(t,e._linkToIdToken(t.auth,await t.getIdToken()),s);return xi._forOperation(t,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rj(t,e,s=!1){const{auth:n}=t;if(ur(n.app))return Promise.reject(Lr(n));const i="reauthenticate";try{const a=await ba(t,Tj(n,i,e,t),s);Ee(a.idToken,n,"internal-error");const o=vf(a.idToken);Ee(o,n,"internal-error");const{sub:l}=o;return Ee(t.uid===l,n,"user-mismatch"),xi._forOperation(t,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&ir(n,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pj(t,e,s=!1){if(ur(t.app))return Promise.reject(Lr(t));const n="signIn",i=await Tj(t,n,e),a=await xi._fromIdTokenResponse(t,n,i);return s||await t._updateCurrentUser(a.user),a}async function EC(t,e){return Pj(Kn(t),e)}async function AC(t,e){return Rj(st(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IC(t,e,s){var n;Ee(((n=s.url)===null||n===void 0?void 0:n.length)>0,t,"invalid-continue-uri"),Ee(typeof s.dynamicLinkDomain>"u"||s.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=s.url,e.dynamicLinkDomain=s.dynamicLinkDomain,e.canHandleCodeInApp=s.handleCodeInApp,s.iOS&&(Ee(s.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=s.iOS.bundleId),s.android&&(Ee(s.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=s.android.installApp,e.androidMinimumVersionCode=s.android.minimumVersion,e.androidPackageName=s.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dj(t){const e=Kn(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Nf(t,e,s){const n=Kn(t),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};s&&IC(n,i,s),await Ad(n,i,"getOobCode",xC)}async function nl(t,e,s){if(ur(t.app))return Promise.reject(Lr(t));const n=Kn(t),o=await Ad(n,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_C).catch(d=>{throw d.code==="auth/password-does-not-meet-requirements"&&Dj(t),d}),l=await xi._fromIdTokenResponse(n,"signIn",o);return await n._updateCurrentUser(l.user),l}function il(t,e,s){return ur(t.app)?Promise.reject(Lr(t)):EC(st(t),ki.credential(e,s)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&Dj(t),n})}async function kC(t,e,s){const n=st(t),a={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await t.getIdToken(),newEmail:e},{email:o}=await yC(n.auth,a);o!==t.email&&await t.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CC(t,e){return Nr(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function al(t,{displayName:e,photoURL:s}){if(e===void 0&&s===void 0)return;const n=st(t),a={idToken:await n.getIdToken(),displayName:e,photoUrl:s,returnSecureToken:!0},o=await ba(n,CC(n.auth,a));n.displayName=o.displayName||null,n.photoURL=o.photoUrl||null;const l=n.providerData.find(({providerId:d})=>d==="password");l&&(l.displayName=n.displayName,l.photoURL=n.photoURL),await n._updateTokensIfNecessary(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TC(t,e){return st(t).setPersistence(e)}function RC(t,e,s,n){return st(t).onIdTokenChanged(e,s,n)}function PC(t,e,s){return st(t).beforeAuthStateChanged(e,s)}function DC(t,e,s,n){return st(t).onAuthStateChanged(e,s,n)}function ca(t){return st(t).signOut()}async function Mj(t){return st(t).delete()}const kd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lj{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(kd,"1"),this.storage.removeItem(kd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=1e3,LC=10;class Vj extends Lj{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Sj(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const n=this.storage.getItem(s),i=this.localCache[s];n!==i&&e(s,i,n)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((o,l,d)=>{this.notifyListeners(o,d)});return}const n=e.key;s?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(n);!s&&this.localCache[n]===o||this.notifyListeners(n,o)},a=this.storage.getItem(n);Xk()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,LC):i()}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:n}),!0)})},MC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}Vj.type="LOCAL";const VC=Vj;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj extends Lj{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}Oj.type="SESSION";const _f=Oj;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OC(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(i=>i.isListeningto(e));if(s)return s;const n=new gu(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:n,eventType:i,data:a}=s.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;s.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const l=Array.from(o).map(async u=>u(s.origin,a)),d=await OC(l);s.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:d})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sf(t="",e=10){let s="";for(let n=0;n<e;n++)s+=Math.floor(Math.random()*10);return t+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,o;return new Promise((l,d)=>{const u=Sf("",20);i.port1.start();const m=setTimeout(()=>{d(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(m),a=setTimeout(()=>{d(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(f.data.response);break;default:clearTimeout(m),clearTimeout(a),d(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:s},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fr(){return window}function $C(t){fr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fj(){return typeof fr().WorkerGlobalScope<"u"&&typeof fr().importScripts=="function"}async function zC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function UC(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function BC(){return Fj()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j="firebaseLocalStorageDb",qC=1,Cd="firebaseLocalStorage",zj="fbase_key";class Cl{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function xu(t,e){return t.transaction([Cd],e?"readwrite":"readonly").objectStore(Cd)}function GC(){const t=indexedDB.deleteDatabase($j);return new Cl(t).toPromise()}function Qh(){const t=indexedDB.open($j,qC);return new Promise((e,s)=>{t.addEventListener("error",()=>{s(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(Cd,{keyPath:zj})}catch(i){s(i)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(Cd)?e(n):(n.close(),await GC(),e(await Qh()))})})}async function sy(t,e,s){const n=xu(t,!0).put({[zj]:e,value:s});return new Cl(n).toPromise()}async function WC(t,e){const s=xu(t,!1).get(e),n=await new Cl(s).toPromise();return n===void 0?null:n.value}function ry(t,e){const s=xu(t,!0).delete(e);return new Cl(s).toPromise()}const HC=800,KC=3;class Uj{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Qh(),this.db)}async _withRetries(e){let s=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(s++>KC)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fj()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gu._getInstance(BC()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var e,s;if(this.activeServiceWorker=await zC(),!this.activeServiceWorker)return;this.sender=new FC(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((s=n[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||UC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Qh();return await sy(e,kd,"1"),await ry(e,kd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(n=>sy(n,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(n=>WC(n,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>ry(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=xu(i,!1).getAll();return new Cl(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),s.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),s.push(i));return s}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),HC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Uj.type="LOCAL";const QC=Uj;new Al(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(t,e){return e?Dr(e):(Ee(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef extends wf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return la(e,this._buildIdpRequest())}_linkToIdToken(e,s){return la(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return la(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function XC(t){return Pj(t.auth,new Ef(t),t.bypassAuthState)}function JC(t){const{auth:e,user:s}=t;return Ee(s,e,"internal-error"),Rj(s,new Ef(t),t.bypassAuthState)}async function ZC(t){const{auth:e,user:s}=t;return Ee(s,e,"internal-error"),SC(s,new Ef(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(e,s,n,i,a=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:n,postBody:i,tenantId:a,error:o,type:l}=e;if(o){this.reject(o);return}const d={auth:this.auth,requestUri:s,sessionId:n,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(d))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return XC;case"linkViaPopup":case"linkViaRedirect":return ZC;case"reauthViaPopup":case"reauthViaRedirect":return JC;default:ir(this.auth,"internal-error")}}resolve(e){Wr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT=new Al(2e3,1e4);class Zi extends Bj{constructor(e,s,n,i,a){super(e,s,i,a),this.provider=n,this.authWindow=null,this.pollId=null,Zi.currentPopupAction&&Zi.currentPopupAction.cancel(),Zi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ee(e,this.auth,"internal-error"),e}async onExecution(){Wr(this.filter.length===1,"Popup operations only handle one event");const e=Sf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(pr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(pr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,n;if(!((n=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(pr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,eT.get())};e()}}Zi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT="pendingRedirect",Uc=new Map;class sT extends Bj{constructor(e,s,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,n),this.eventId=null}async execute(){let e=Uc.get(this.auth._key());if(!e){try{const n=await rT(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(s){e=()=>Promise.reject(s)}Uc.set(this.auth._key(),e)}return this.bypassAuthState||Uc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function rT(t,e){const s=aT(e),n=iT(t);if(!await n._isAvailable())return!1;const i=await n._get(s)==="true";return await n._remove(s),i}function nT(t,e){Uc.set(t._key(),e)}function iT(t){return Dr(t._redirectPersistence)}function aT(t){return zc(tT,t.config.apiKey,t.name)}async function oT(t,e,s=!1){if(ur(t.app))return Promise.reject(Lr(t));const n=Kn(t),i=YC(n,e),o=await new sT(n,i,s).execute();return o&&!s&&(delete o.user._redirectEventId,await n._persistUserIfCurrent(o.user),await n._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=10*60*1e3;class cT{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(s=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!dT(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var n;if(e.error&&!qj(e)){const i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";s.onError(pr(this.auth,i))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const n=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=lT&&this.cachedEventUids.clear(),this.cachedEventUids.has(ny(e))}saveEventToCache(e){this.cachedEventUids.add(ny(e)),this.lastProcessedEventTime=Date.now()}}function ny(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function qj({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function dT(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qj(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uT(t,e={}){return Nr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mT=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hT=/^https?/;async function pT(t){if(t.config.emulator)return;const{authorizedDomains:e}=await uT(t);for(const s of e)try{if(fT(s))return}catch{}ir(t,"unauthorized-domain")}function fT(t){const e=Hh(),{protocol:s,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&n===""?s==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&o.hostname===n}if(!hT.test(s))return!1;if(mT.test(t))return n===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT=new Al(3e4,6e4);function iy(){const t=fr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let s=0;s<t.CP.length;s++)t.CP[s]=null}}function xT(t){return new Promise((e,s)=>{var n,i,a;function o(){iy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{iy(),s(pr(t,"network-request-failed"))},timeout:gT.get()})}if(!((i=(n=fr().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((a=fr().gapi)===null||a===void 0)&&a.load)o();else{const l=aC("iframefcb");return fr()[l]=()=>{gapi.load?o():s(pr(t,"network-request-failed"))},Aj(`${iC()}?onload=${l}`).catch(d=>s(d))}}).catch(e=>{throw Bc=null,e})}let Bc=null;function yT(t){return Bc=Bc||xT(t),Bc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vT=new Al(5e3,15e3),bT="__/auth/iframe",wT="emulator/auth/iframe",jT={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},NT=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _T(t){const e=t.config;Ee(e.authDomain,t,"auth-domain-config-required");const s=e.emulator?yf(e,wT):`https://${t.config.authDomain}/${bT}`,n={apiKey:e.apiKey,appName:t.name,v:Ii},i=NT.get(t.config.apiHost);i&&(n.eid=i);const a=t._getFrameworks();return a.length&&(n.fw=a.join(",")),`${s}?${Sl(n).slice(1)}`}async function ST(t){const e=await yT(t),s=fr().gapi;return Ee(s,t,"internal-error"),e.open({where:document.body,url:_T(t),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jT,dontclear:!0},n=>new Promise(async(i,a)=>{await n.restyle({setHideOnLeave:!1});const o=pr(t,"network-request-failed"),l=fr().setTimeout(()=>{a(o)},vT.get());function d(){fr().clearTimeout(l),i(n)}n.ping(d).then(d,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ET={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},AT=500,IT=600,kT="_blank",CT="http://localhost";class ay{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function TT(t,e,s,n=AT,i=IT){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const d=Object.assign(Object.assign({},ET),{width:n.toString(),height:i.toString(),top:a,left:o}),u=rs().toLowerCase();s&&(l=bj(u)?kT:s),yj(u)&&(e=e||CT,d.scrollbars="yes");const m=Object.entries(d).reduce((f,[x,y])=>`${f}${x}=${y},`,"");if(Yk(u)&&l!=="_self")return RT(e||"",l),new ay(null);const h=window.open(e||"",l,m);Ee(h,t,"popup-blocked");try{h.focus()}catch{}return new ay(h)}function RT(t,e){const s=document.createElement("a");s.href=t,s.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PT="__/auth/handler",DT="emulator/auth/handler",MT=encodeURIComponent("fac");async function oy(t,e,s,n,i,a){Ee(t.config.authDomain,t,"auth-domain-config-required"),Ee(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:s,redirectUrl:n,v:Ii,eventId:i};if(e instanceof Cj){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",bI(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,h]of Object.entries({}))o[m]=h}if(e instanceof kl){const m=e.getScopes().filter(h=>h!=="");m.length>0&&(o.scopes=m.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const m of Object.keys(l))l[m]===void 0&&delete l[m];const d=await t._getAppCheckToken(),u=d?`#${MT}=${encodeURIComponent(d)}`:"";return`${LT(t)}?${Sl(l).slice(1)}${u}`}function LT({config:t}){return t.emulator?yf(t,DT):`https://${t.authDomain}/${PT}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vm="webStorageSupport";class VT{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_f,this._completeRedirectFn=oT,this._overrideRedirectResult=nT}async _openPopup(e,s,n,i){var a;Wr((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await oy(e,s,n,Hh(),i);return TT(e,o,Sf())}async _openRedirect(e,s,n,i){await this._originValidation(e);const a=await oy(e,s,n,Hh(),i);return $C(a),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:i,promise:a}=this.eventManagers[s];return i?Promise.resolve(i):(Wr(a,"If manager is not set, promise should be"),a)}const n=this.initAndGetManager(e);return this.eventManagers[s]={promise:n},n.catch(()=>{delete this.eventManagers[s]}),n}async initAndGetManager(e){const s=await ST(e),n=new cT(e);return s.register("authEvent",i=>(Ee(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=s,n}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(Vm,{type:Vm},i=>{var a;const o=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[Vm];o!==void 0&&s(!!o),ir(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=pT(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return Sj()||vj()||bf()}}const OT=VT;var ly="@firebase/auth",cy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FT{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $T(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function zT(t){Ln(new qr("auth",(e,{options:s})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=n.options;Ee(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const d={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ej(t)},u=new sC(n,i,a,d);return uC(u,s),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,n)=>{e.getProvider("auth-internal").initialize()})),Ln(new qr("auth-internal",e=>{const s=Kn(e.getProvider("auth").getImmediate());return(n=>new FT(n))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bs(ly,cy,$T(t)),Bs(ly,cy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT=5*60,BT=sj("authIdTokenMaxAge")||UT;let dy=null;const qT=t=>async e=>{const s=e&&await e.getIdTokenResult(),n=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(n&&n>BT)return;const i=s==null?void 0:s.token;dy!==i&&(dy=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Gj(t=pu()){const e=El(t,"auth");if(e.isInitialized())return e.getImmediate();const s=dC(t,{popupRedirectResolver:OT,persistence:[QC,VC,_f]}),n=sj("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(n,location.origin);if(location.origin===a.origin){const o=qT(a.toString());PC(s,o,()=>o(s.currentUser)),RC(s,l=>o(l))}}const i=ej("auth");return i&&mC(s,`http://${i}`),s}function GT(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}rC({loadJS(t){return new Promise((e,s)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=i=>{const a=pr("internal-error");a.customData=i,s(a)},n.type="text/javascript",n.charset="UTF-8",GT().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});zT("Browser");var uy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var di,Wj;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,b){function N(){}N.prototype=b.prototype,v.D=b.prototype,v.prototype=new N,v.prototype.constructor=v,v.C=function(g,w,I){for(var E=Array(arguments.length-2),ee=2;ee<arguments.length;ee++)E[ee-2]=arguments[ee];return b.prototype[w].apply(g,E)}}function s(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,s),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,b,N){N||(N=0);var g=Array(16);if(typeof b=="string")for(var w=0;16>w;++w)g[w]=b.charCodeAt(N++)|b.charCodeAt(N++)<<8|b.charCodeAt(N++)<<16|b.charCodeAt(N++)<<24;else for(w=0;16>w;++w)g[w]=b[N++]|b[N++]<<8|b[N++]<<16|b[N++]<<24;b=v.g[0],N=v.g[1],w=v.g[2];var I=v.g[3],E=b+(I^N&(w^I))+g[0]+3614090360&4294967295;b=N+(E<<7&4294967295|E>>>25),E=I+(w^b&(N^w))+g[1]+3905402710&4294967295,I=b+(E<<12&4294967295|E>>>20),E=w+(N^I&(b^N))+g[2]+606105819&4294967295,w=I+(E<<17&4294967295|E>>>15),E=N+(b^w&(I^b))+g[3]+3250441966&4294967295,N=w+(E<<22&4294967295|E>>>10),E=b+(I^N&(w^I))+g[4]+4118548399&4294967295,b=N+(E<<7&4294967295|E>>>25),E=I+(w^b&(N^w))+g[5]+1200080426&4294967295,I=b+(E<<12&4294967295|E>>>20),E=w+(N^I&(b^N))+g[6]+2821735955&4294967295,w=I+(E<<17&4294967295|E>>>15),E=N+(b^w&(I^b))+g[7]+4249261313&4294967295,N=w+(E<<22&4294967295|E>>>10),E=b+(I^N&(w^I))+g[8]+1770035416&4294967295,b=N+(E<<7&4294967295|E>>>25),E=I+(w^b&(N^w))+g[9]+2336552879&4294967295,I=b+(E<<12&4294967295|E>>>20),E=w+(N^I&(b^N))+g[10]+4294925233&4294967295,w=I+(E<<17&4294967295|E>>>15),E=N+(b^w&(I^b))+g[11]+2304563134&4294967295,N=w+(E<<22&4294967295|E>>>10),E=b+(I^N&(w^I))+g[12]+1804603682&4294967295,b=N+(E<<7&4294967295|E>>>25),E=I+(w^b&(N^w))+g[13]+4254626195&4294967295,I=b+(E<<12&4294967295|E>>>20),E=w+(N^I&(b^N))+g[14]+2792965006&4294967295,w=I+(E<<17&4294967295|E>>>15),E=N+(b^w&(I^b))+g[15]+1236535329&4294967295,N=w+(E<<22&4294967295|E>>>10),E=b+(w^I&(N^w))+g[1]+4129170786&4294967295,b=N+(E<<5&4294967295|E>>>27),E=I+(N^w&(b^N))+g[6]+3225465664&4294967295,I=b+(E<<9&4294967295|E>>>23),E=w+(b^N&(I^b))+g[11]+643717713&4294967295,w=I+(E<<14&4294967295|E>>>18),E=N+(I^b&(w^I))+g[0]+3921069994&4294967295,N=w+(E<<20&4294967295|E>>>12),E=b+(w^I&(N^w))+g[5]+3593408605&4294967295,b=N+(E<<5&4294967295|E>>>27),E=I+(N^w&(b^N))+g[10]+38016083&4294967295,I=b+(E<<9&4294967295|E>>>23),E=w+(b^N&(I^b))+g[15]+3634488961&4294967295,w=I+(E<<14&4294967295|E>>>18),E=N+(I^b&(w^I))+g[4]+3889429448&4294967295,N=w+(E<<20&4294967295|E>>>12),E=b+(w^I&(N^w))+g[9]+568446438&4294967295,b=N+(E<<5&4294967295|E>>>27),E=I+(N^w&(b^N))+g[14]+3275163606&4294967295,I=b+(E<<9&4294967295|E>>>23),E=w+(b^N&(I^b))+g[3]+4107603335&4294967295,w=I+(E<<14&4294967295|E>>>18),E=N+(I^b&(w^I))+g[8]+1163531501&4294967295,N=w+(E<<20&4294967295|E>>>12),E=b+(w^I&(N^w))+g[13]+2850285829&4294967295,b=N+(E<<5&4294967295|E>>>27),E=I+(N^w&(b^N))+g[2]+4243563512&4294967295,I=b+(E<<9&4294967295|E>>>23),E=w+(b^N&(I^b))+g[7]+1735328473&4294967295,w=I+(E<<14&4294967295|E>>>18),E=N+(I^b&(w^I))+g[12]+2368359562&4294967295,N=w+(E<<20&4294967295|E>>>12),E=b+(N^w^I)+g[5]+4294588738&4294967295,b=N+(E<<4&4294967295|E>>>28),E=I+(b^N^w)+g[8]+2272392833&4294967295,I=b+(E<<11&4294967295|E>>>21),E=w+(I^b^N)+g[11]+1839030562&4294967295,w=I+(E<<16&4294967295|E>>>16),E=N+(w^I^b)+g[14]+4259657740&4294967295,N=w+(E<<23&4294967295|E>>>9),E=b+(N^w^I)+g[1]+2763975236&4294967295,b=N+(E<<4&4294967295|E>>>28),E=I+(b^N^w)+g[4]+1272893353&4294967295,I=b+(E<<11&4294967295|E>>>21),E=w+(I^b^N)+g[7]+4139469664&4294967295,w=I+(E<<16&4294967295|E>>>16),E=N+(w^I^b)+g[10]+3200236656&4294967295,N=w+(E<<23&4294967295|E>>>9),E=b+(N^w^I)+g[13]+681279174&4294967295,b=N+(E<<4&4294967295|E>>>28),E=I+(b^N^w)+g[0]+3936430074&4294967295,I=b+(E<<11&4294967295|E>>>21),E=w+(I^b^N)+g[3]+3572445317&4294967295,w=I+(E<<16&4294967295|E>>>16),E=N+(w^I^b)+g[6]+76029189&4294967295,N=w+(E<<23&4294967295|E>>>9),E=b+(N^w^I)+g[9]+3654602809&4294967295,b=N+(E<<4&4294967295|E>>>28),E=I+(b^N^w)+g[12]+3873151461&4294967295,I=b+(E<<11&4294967295|E>>>21),E=w+(I^b^N)+g[15]+530742520&4294967295,w=I+(E<<16&4294967295|E>>>16),E=N+(w^I^b)+g[2]+3299628645&4294967295,N=w+(E<<23&4294967295|E>>>9),E=b+(w^(N|~I))+g[0]+4096336452&4294967295,b=N+(E<<6&4294967295|E>>>26),E=I+(N^(b|~w))+g[7]+1126891415&4294967295,I=b+(E<<10&4294967295|E>>>22),E=w+(b^(I|~N))+g[14]+2878612391&4294967295,w=I+(E<<15&4294967295|E>>>17),E=N+(I^(w|~b))+g[5]+4237533241&4294967295,N=w+(E<<21&4294967295|E>>>11),E=b+(w^(N|~I))+g[12]+1700485571&4294967295,b=N+(E<<6&4294967295|E>>>26),E=I+(N^(b|~w))+g[3]+2399980690&4294967295,I=b+(E<<10&4294967295|E>>>22),E=w+(b^(I|~N))+g[10]+4293915773&4294967295,w=I+(E<<15&4294967295|E>>>17),E=N+(I^(w|~b))+g[1]+2240044497&4294967295,N=w+(E<<21&4294967295|E>>>11),E=b+(w^(N|~I))+g[8]+1873313359&4294967295,b=N+(E<<6&4294967295|E>>>26),E=I+(N^(b|~w))+g[15]+4264355552&4294967295,I=b+(E<<10&4294967295|E>>>22),E=w+(b^(I|~N))+g[6]+2734768916&4294967295,w=I+(E<<15&4294967295|E>>>17),E=N+(I^(w|~b))+g[13]+1309151649&4294967295,N=w+(E<<21&4294967295|E>>>11),E=b+(w^(N|~I))+g[4]+4149444226&4294967295,b=N+(E<<6&4294967295|E>>>26),E=I+(N^(b|~w))+g[11]+3174756917&4294967295,I=b+(E<<10&4294967295|E>>>22),E=w+(b^(I|~N))+g[2]+718787259&4294967295,w=I+(E<<15&4294967295|E>>>17),E=N+(I^(w|~b))+g[9]+3951481745&4294967295,v.g[0]=v.g[0]+b&4294967295,v.g[1]=v.g[1]+(w+(E<<21&4294967295|E>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+I&4294967295}n.prototype.u=function(v,b){b===void 0&&(b=v.length);for(var N=b-this.blockSize,g=this.B,w=this.h,I=0;I<b;){if(w==0)for(;I<=N;)i(this,v,I),I+=this.blockSize;if(typeof v=="string"){for(;I<b;)if(g[w++]=v.charCodeAt(I++),w==this.blockSize){i(this,g),w=0;break}}else for(;I<b;)if(g[w++]=v[I++],w==this.blockSize){i(this,g),w=0;break}}this.h=w,this.o+=b},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var b=1;b<v.length-8;++b)v[b]=0;var N=8*this.o;for(b=v.length-8;b<v.length;++b)v[b]=N&255,N/=256;for(this.u(v),v=Array(16),b=N=0;4>b;++b)for(var g=0;32>g;g+=8)v[N++]=this.g[b]>>>g&255;return v};function a(v,b){var N=l;return Object.prototype.hasOwnProperty.call(N,v)?N[v]:N[v]=b(v)}function o(v,b){this.h=b;for(var N=[],g=!0,w=v.length-1;0<=w;w--){var I=v[w]|0;g&&I==b||(N[w]=I,g=!1)}this.g=N}var l={};function d(v){return-128<=v&&128>v?a(v,function(b){return new o([b|0],0>b?-1:0)}):new o([v|0],0>v?-1:0)}function u(v){if(isNaN(v)||!isFinite(v))return h;if(0>v)return _(u(-v));for(var b=[],N=1,g=0;v>=N;g++)b[g]=v/N|0,N*=4294967296;return new o(b,0)}function m(v,b){if(v.length==0)throw Error("number format error: empty string");if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(v.charAt(0)=="-")return _(m(v.substring(1),b));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var N=u(Math.pow(b,8)),g=h,w=0;w<v.length;w+=8){var I=Math.min(8,v.length-w),E=parseInt(v.substring(w,w+I),b);8>I?(I=u(Math.pow(b,I)),g=g.j(I).add(u(E))):(g=g.j(N),g=g.add(u(E)))}return g}var h=d(0),f=d(1),x=d(16777216);t=o.prototype,t.m=function(){if(P(this))return-_(this).m();for(var v=0,b=1,N=0;N<this.g.length;N++){var g=this.i(N);v+=(0<=g?g:4294967296+g)*b,b*=4294967296}return v},t.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(y(this))return"0";if(P(this))return"-"+_(this).toString(v);for(var b=u(Math.pow(v,6)),N=this,g="";;){var w=S(N,b).g;N=C(N,w.j(b));var I=((0<N.g.length?N.g[0]:N.h)>>>0).toString(v);if(N=w,y(N))return I+g;for(;6>I.length;)I="0"+I;g=I+g}},t.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function y(v){if(v.h!=0)return!1;for(var b=0;b<v.g.length;b++)if(v.g[b]!=0)return!1;return!0}function P(v){return v.h==-1}t.l=function(v){return v=C(this,v),P(v)?-1:y(v)?0:1};function _(v){for(var b=v.g.length,N=[],g=0;g<b;g++)N[g]=~v.g[g];return new o(N,~v.h).add(f)}t.abs=function(){return P(this)?_(this):this},t.add=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],g=0,w=0;w<=b;w++){var I=g+(this.i(w)&65535)+(v.i(w)&65535),E=(I>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);g=E>>>16,I&=65535,E&=65535,N[w]=E<<16|I}return new o(N,N[N.length-1]&-2147483648?-1:0)};function C(v,b){return v.add(_(b))}t.j=function(v){if(y(this)||y(v))return h;if(P(this))return P(v)?_(this).j(_(v)):_(_(this).j(v));if(P(v))return _(this.j(_(v)));if(0>this.l(x)&&0>v.l(x))return u(this.m()*v.m());for(var b=this.g.length+v.g.length,N=[],g=0;g<2*b;g++)N[g]=0;for(g=0;g<this.g.length;g++)for(var w=0;w<v.g.length;w++){var I=this.i(g)>>>16,E=this.i(g)&65535,ee=v.i(w)>>>16,V=v.i(w)&65535;N[2*g+2*w]+=E*V,k(N,2*g+2*w),N[2*g+2*w+1]+=I*V,k(N,2*g+2*w+1),N[2*g+2*w+1]+=E*ee,k(N,2*g+2*w+1),N[2*g+2*w+2]+=I*ee,k(N,2*g+2*w+2)}for(g=0;g<b;g++)N[g]=N[2*g+1]<<16|N[2*g];for(g=b;g<2*b;g++)N[g]=0;return new o(N,0)};function k(v,b){for(;(v[b]&65535)!=v[b];)v[b+1]+=v[b]>>>16,v[b]&=65535,b++}function T(v,b){this.g=v,this.h=b}function S(v,b){if(y(b))throw Error("division by zero");if(y(v))return new T(h,h);if(P(v))return b=S(_(v),b),new T(_(b.g),_(b.h));if(P(b))return b=S(v,_(b)),new T(_(b.g),b.h);if(30<v.g.length){if(P(v)||P(b))throw Error("slowDivide_ only works with positive integers.");for(var N=f,g=b;0>=g.l(v);)N=D(N),g=D(g);var w=R(N,1),I=R(g,1);for(g=R(g,2),N=R(N,2);!y(g);){var E=I.add(g);0>=E.l(v)&&(w=w.add(N),I=E),g=R(g,1),N=R(N,1)}return b=C(v,w.j(b)),new T(w,b)}for(w=h;0<=v.l(b);){for(N=Math.max(1,Math.floor(v.m()/b.m())),g=Math.ceil(Math.log(N)/Math.LN2),g=48>=g?1:Math.pow(2,g-48),I=u(N),E=I.j(b);P(E)||0<E.l(v);)N-=g,I=u(N),E=I.j(b);y(I)&&(I=f),w=w.add(I),v=C(v,E)}return new T(w,v)}t.A=function(v){return S(this,v).h},t.and=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],g=0;g<b;g++)N[g]=this.i(g)&v.i(g);return new o(N,this.h&v.h)},t.or=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],g=0;g<b;g++)N[g]=this.i(g)|v.i(g);return new o(N,this.h|v.h)},t.xor=function(v){for(var b=Math.max(this.g.length,v.g.length),N=[],g=0;g<b;g++)N[g]=this.i(g)^v.i(g);return new o(N,this.h^v.h)};function D(v){for(var b=v.g.length+1,N=[],g=0;g<b;g++)N[g]=v.i(g)<<1|v.i(g-1)>>>31;return new o(N,v.h)}function R(v,b){var N=b>>5;b%=32;for(var g=v.g.length-N,w=[],I=0;I<g;I++)w[I]=0<b?v.i(I+N)>>>b|v.i(I+N+1)<<32-b:v.i(I+N);return new o(w,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Wj=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=m,di=o}).apply(typeof uy<"u"?uy:typeof self<"u"?self:typeof window<"u"?window:{});var jc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Hj,fo,Kj,qc,Yh,Qj,Yj,Xj;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,p,j){return c==Array.prototype||c==Object.prototype||(c[p]=j.value),c};function s(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof jc=="object"&&jc];for(var p=0;p<c.length;++p){var j=c[p];if(j&&j.Math==Math)return j}throw Error("Cannot find global object")}var n=s(this);function i(c,p){if(p)e:{var j=n;c=c.split(".");for(var M=0;M<c.length-1;M++){var z=c[M];if(!(z in j))break e;j=j[z]}c=c[c.length-1],M=j[c],p=p(M),p!=M&&p!=null&&e(j,c,{configurable:!0,writable:!0,value:p})}}function a(c,p){c instanceof String&&(c+="");var j=0,M=!1,z={next:function(){if(!M&&j<c.length){var Q=j++;return{value:p(Q,c[Q]),done:!1}}return M=!0,{done:!0,value:void 0}}};return z[Symbol.iterator]=function(){return z},z}i("Array.prototype.values",function(c){return c||function(){return a(this,function(p,j){return j})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function d(c){var p=typeof c;return p=p!="object"?p:c?Array.isArray(c)?"array":p:"null",p=="array"||p=="object"&&typeof c.length=="number"}function u(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function m(c,p,j){return c.call.apply(c.bind,arguments)}function h(c,p,j){if(!c)throw Error();if(2<arguments.length){var M=Array.prototype.slice.call(arguments,2);return function(){var z=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(z,M),c.apply(p,z)}}return function(){return c.apply(p,arguments)}}function f(c,p,j){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:h,f.apply(null,arguments)}function x(c,p){var j=Array.prototype.slice.call(arguments,1);return function(){var M=j.slice();return M.push.apply(M,arguments),c.apply(this,M)}}function y(c,p){function j(){}j.prototype=p.prototype,c.aa=p.prototype,c.prototype=new j,c.prototype.constructor=c,c.Qb=function(M,z,Q){for(var ce=Array(arguments.length-2),rt=2;rt<arguments.length;rt++)ce[rt-2]=arguments[rt];return p.prototype[z].apply(M,ce)}}function P(c){const p=c.length;if(0<p){const j=Array(p);for(let M=0;M<p;M++)j[M]=c[M];return j}return[]}function _(c,p){for(let j=1;j<arguments.length;j++){const M=arguments[j];if(d(M)){const z=c.length||0,Q=M.length||0;c.length=z+Q;for(let ce=0;ce<Q;ce++)c[z+ce]=M[ce]}else c.push(M)}}class C{constructor(p,j){this.i=p,this.j=j,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function k(c){return/^[\s\xa0]*$/.test(c)}function T(){var c=l.navigator;return c&&(c=c.userAgent)?c:""}function S(c){return S[" "](c),c}S[" "]=function(){};var D=T().indexOf("Gecko")!=-1&&!(T().toLowerCase().indexOf("webkit")!=-1&&T().indexOf("Edge")==-1)&&!(T().indexOf("Trident")!=-1||T().indexOf("MSIE")!=-1)&&T().indexOf("Edge")==-1;function R(c,p,j){for(const M in c)p.call(j,c[M],M,c)}function v(c,p){for(const j in c)p.call(void 0,c[j],j,c)}function b(c){const p={};for(const j in c)p[j]=c[j];return p}const N="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function g(c,p){let j,M;for(let z=1;z<arguments.length;z++){M=arguments[z];for(j in M)c[j]=M[j];for(let Q=0;Q<N.length;Q++)j=N[Q],Object.prototype.hasOwnProperty.call(M,j)&&(c[j]=M[j])}}function w(c){var p=1;c=c.split(":");const j=[];for(;0<p&&c.length;)j.push(c.shift()),p--;return c.length&&j.push(c.join(":")),j}function I(c){l.setTimeout(()=>{throw c},0)}function E(){var c=re;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class ee{constructor(){this.h=this.g=null}add(p,j){const M=V.get();M.set(p,j),this.h?this.h.next=M:this.g=M,this.h=M}}var V=new C(()=>new F,c=>c.reset());class F{constructor(){this.next=this.g=this.h=null}set(p,j){this.h=p,this.g=j,this.next=null}reset(){this.next=this.g=this.h=null}}let X,W=!1,re=new ee,Z=()=>{const c=l.Promise.resolve(void 0);X=()=>{c.then(se)}};var se=()=>{for(var c;c=E();){try{c.h.call(c.g)}catch(j){I(j)}var p=V;p.j(c),100>p.h&&(p.h++,c.next=p.g,p.g=c)}W=!1};function Y(){this.s=this.s,this.C=this.C}Y.prototype.s=!1,Y.prototype.ma=function(){this.s||(this.s=!0,this.N())},Y.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function U(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var K=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const j=()=>{};l.addEventListener("test",j,p),l.removeEventListener("test",j,p)}catch{}return c}();function de(c,p){if(U.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var j=this.type=c.type,M=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget){if(D){e:{try{S(p.nodeName);var z=!0;break e}catch{}z=!1}z||(p=null)}}else j=="mouseover"?p=c.fromElement:j=="mouseout"&&(p=c.toElement);this.relatedTarget=p,M?(this.clientX=M.clientX!==void 0?M.clientX:M.pageX,this.clientY=M.clientY!==void 0?M.clientY:M.pageY,this.screenX=M.screenX||0,this.screenY=M.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:ne[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&de.aa.h.call(this)}}y(de,U);var ne={2:"touch",3:"pen",4:"mouse"};de.prototype.h=function(){de.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var be="closure_listenable_"+(1e6*Math.random()|0),ke=0;function Fe(c,p,j,M,z){this.listener=c,this.proxy=null,this.src=p,this.type=j,this.capture=!!M,this.ha=z,this.key=++ke,this.da=this.fa=!1}function ue(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function we(c){this.src=c,this.g={},this.h=0}we.prototype.add=function(c,p,j,M,z){var Q=c.toString();c=this.g[Q],c||(c=this.g[Q]=[],this.h++);var ce=$(c,p,M,z);return-1<ce?(p=c[ce],j||(p.fa=!1)):(p=new Fe(p,this.src,Q,!!M,z),p.fa=j,c.push(p)),p};function ye(c,p){var j=p.type;if(j in c.g){var M=c.g[j],z=Array.prototype.indexOf.call(M,p,void 0),Q;(Q=0<=z)&&Array.prototype.splice.call(M,z,1),Q&&(ue(p),c.g[j].length==0&&(delete c.g[j],c.h--))}}function $(c,p,j,M){for(var z=0;z<c.length;++z){var Q=c[z];if(!Q.da&&Q.listener==p&&Q.capture==!!j&&Q.ha==M)return z}return-1}var q="closure_lm_"+(1e6*Math.random()|0),he={};function Ae(c,p,j,M,z){if(Array.isArray(p)){for(var Q=0;Q<p.length;Q++)Ae(c,p[Q],j,M,z);return null}return j=qe(j),c&&c[be]?c.K(p,j,u(M)?!!M.capture:!!M,z):Ve(c,p,j,!1,M,z)}function Ve(c,p,j,M,z,Q){if(!p)throw Error("Invalid event type");var ce=u(z)?!!z.capture:!!z,rt=Be(c);if(rt||(c[q]=rt=new we(c)),j=rt.add(p,j,M,ce,Q),j.proxy)return j;if(M=B(),j.proxy=M,M.src=c,M.listener=j,c.addEventListener)K||(z=ce),z===void 0&&(z=!1),c.addEventListener(p.toString(),M,z);else if(c.attachEvent)c.attachEvent(Je(p.toString()),M);else if(c.addListener&&c.removeListener)c.addListener(M);else throw Error("addEventListener and attachEvent are unavailable.");return j}function B(){function c(j){return p.call(c.src,c.listener,j)}const p=Te;return c}function pe(c,p,j,M,z){if(Array.isArray(p))for(var Q=0;Q<p.length;Q++)pe(c,p[Q],j,M,z);else M=u(M)?!!M.capture:!!M,j=qe(j),c&&c[be]?(c=c.i,p=String(p).toString(),p in c.g&&(Q=c.g[p],j=$(Q,j,M,z),-1<j&&(ue(Q[j]),Array.prototype.splice.call(Q,j,1),Q.length==0&&(delete c.g[p],c.h--)))):c&&(c=Be(c))&&(p=c.g[p.toString()],c=-1,p&&(c=$(p,j,M,z)),(j=-1<c?p[c]:null)&&Ce(j))}function Ce(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[be])ye(p.i,c);else{var j=c.type,M=c.proxy;p.removeEventListener?p.removeEventListener(j,M,c.capture):p.detachEvent?p.detachEvent(Je(j),M):p.addListener&&p.removeListener&&p.removeListener(M),(j=Be(p))?(ye(j,c),j.h==0&&(j.src=null,p[q]=null)):ue(c)}}}function Je(c){return c in he?he[c]:he[c]="on"+c}function Te(c,p){if(c.da)c=!0;else{p=new de(p,this);var j=c.listener,M=c.ha||c.src;c.fa&&Ce(c),c=j.call(M,p)}return c}function Be(c){return c=c[q],c instanceof we?c:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function qe(c){return typeof c=="function"?c:(c[De]||(c[De]=function(p){return c.handleEvent(p)}),c[De])}function Me(){Y.call(this),this.i=new we(this),this.M=this,this.F=null}y(Me,Y),Me.prototype[be]=!0,Me.prototype.removeEventListener=function(c,p,j,M){pe(this,c,p,j,M)};function nt(c,p){var j,M=c.F;if(M)for(j=[];M;M=M.F)j.push(M);if(c=c.M,M=p.type||p,typeof p=="string")p=new U(p,c);else if(p instanceof U)p.target=p.target||c;else{var z=p;p=new U(M,c),g(p,z)}if(z=!0,j)for(var Q=j.length-1;0<=Q;Q--){var ce=p.g=j[Q];z=Ri(ce,M,!0,p)&&z}if(ce=p.g=c,z=Ri(ce,M,!0,p)&&z,z=Ri(ce,M,!1,p)&&z,j)for(Q=0;Q<j.length;Q++)ce=p.g=j[Q],z=Ri(ce,M,!1,p)&&z}Me.prototype.N=function(){if(Me.aa.N.call(this),this.i){var c=this.i,p;for(p in c.g){for(var j=c.g[p],M=0;M<j.length;M++)ue(j[M]);delete c.g[p],c.h--}}this.F=null},Me.prototype.K=function(c,p,j,M){return this.i.add(String(c),p,!1,j,M)},Me.prototype.L=function(c,p,j,M){return this.i.add(String(c),p,!0,j,M)};function Ri(c,p,j,M){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();for(var z=!0,Q=0;Q<p.length;++Q){var ce=p[Q];if(ce&&!ce.da&&ce.capture==j){var rt=ce.listener,Vt=ce.ha||ce.src;ce.fa&&ye(c.i,ce),z=rt.call(Vt,M)!==!1&&z}}return z&&!M.defaultPrevented}function Fa(c,p,j){if(typeof c=="function")j&&(c=f(c,j));else if(c&&typeof c.handleEvent=="function")c=f(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:l.setTimeout(c,p||0)}function zl(c){c.g=Fa(()=>{c.g=null,c.i&&(c.i=!1,zl(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class O1 extends Y{constructor(p,j){super(),this.m=p,this.l=j,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:zl(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $a(c){Y.call(this),this.h=c,this.g={}}y($a,Y);var wg=[];function jg(c){R(c.g,function(p,j){this.g.hasOwnProperty(j)&&Ce(p)},c),c.g={}}$a.prototype.N=function(){$a.aa.N.call(this),jg(this)},$a.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zu=l.JSON.stringify,F1=l.JSON.parse,$1=class{stringify(c){return l.JSON.stringify(c,void 0)}parse(c){return l.JSON.parse(c,void 0)}};function Uu(){}Uu.prototype.h=null;function Ng(c){return c.h||(c.h=c.i())}function _g(){}var za={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Bu(){U.call(this,"d")}y(Bu,U);function qu(){U.call(this,"c")}y(qu,U);var Yn={},Sg=null;function Ul(){return Sg=Sg||new Me}Yn.La="serverreachability";function Eg(c){U.call(this,Yn.La,c)}y(Eg,U);function Ua(c){const p=Ul();nt(p,new Eg(p))}Yn.STAT_EVENT="statevent";function Ag(c,p){U.call(this,Yn.STAT_EVENT,c),this.stat=p}y(Ag,U);function ns(c){const p=Ul();nt(p,new Ag(p,c))}Yn.Ma="timingevent";function Ig(c,p){U.call(this,Yn.Ma,c),this.size=p}y(Ig,U);function Ba(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){c()},p)}function qa(){this.g=!0}qa.prototype.xa=function(){this.g=!1};function z1(c,p,j,M,z,Q){c.info(function(){if(c.g)if(Q)for(var ce="",rt=Q.split("&"),Vt=0;Vt<rt.length;Vt++){var Qe=rt[Vt].split("=");if(1<Qe.length){var Ht=Qe[0];Qe=Qe[1];var Kt=Ht.split("_");ce=2<=Kt.length&&Kt[1]=="type"?ce+(Ht+"="+Qe+"&"):ce+(Ht+"=redacted&")}}else ce=null;else ce=Q;return"XMLHTTP REQ ("+M+") [attempt "+z+"]: "+p+`
`+j+`
`+ce})}function U1(c,p,j,M,z,Q,ce){c.info(function(){return"XMLHTTP RESP ("+M+") [ attempt "+z+"]: "+p+`
`+j+`
`+Q+" "+ce})}function Pi(c,p,j,M){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+q1(c,j)+(M?" "+M:"")})}function B1(c,p){c.info(function(){return"TIMEOUT: "+p})}qa.prototype.info=function(){};function q1(c,p){if(!c.g)return p;if(!p)return null;try{var j=JSON.parse(p);if(j){for(c=0;c<j.length;c++)if(Array.isArray(j[c])){var M=j[c];if(!(2>M.length)){var z=M[1];if(Array.isArray(z)&&!(1>z.length)){var Q=z[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var ce=1;ce<z.length;ce++)z[ce]=""}}}}return zu(j)}catch{return p}}var Bl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},kg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Gu;function ql(){}y(ql,Uu),ql.prototype.g=function(){return new XMLHttpRequest},ql.prototype.i=function(){return{}},Gu=new ql;function tn(c,p,j,M){this.j=c,this.i=p,this.l=j,this.R=M||1,this.U=new $a(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Cg}function Cg(){this.i=null,this.g="",this.h=!1}var Tg={},Wu={};function Hu(c,p,j){c.L=1,c.v=Kl(Sr(p)),c.m=j,c.P=!0,Rg(c,null)}function Rg(c,p){c.F=Date.now(),Gl(c),c.A=Sr(c.v);var j=c.A,M=c.R;Array.isArray(M)||(M=[String(M)]),Wg(j.i,"t",M),c.C=0,j=c.j.J,c.h=new Cg,c.g=dx(c.j,j?p:null,!c.m),0<c.O&&(c.M=new O1(f(c.Y,c,c.g),c.O)),p=c.U,j=c.g,M=c.ca;var z="readystatechange";Array.isArray(z)||(z&&(wg[0]=z.toString()),z=wg);for(var Q=0;Q<z.length;Q++){var ce=Ae(j,z[Q],M||p.handleEvent,!1,p.h||p);if(!ce)break;p.g[ce.key]=ce}p=c.H?b(c.H):{},c.m?(c.u||(c.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,p)):(c.u="GET",c.g.ea(c.A,c.u,null,p)),Ua(),z1(c.i,c.u,c.A,c.l,c.R,c.m)}tn.prototype.ca=function(c){c=c.target;const p=this.M;p&&Er(c)==3?p.j():this.Y(c)},tn.prototype.Y=function(c){try{if(c==this.g)e:{const Kt=Er(this.g);var p=this.g.Ba();const Li=this.g.Z();if(!(3>Kt)&&(Kt!=3||this.g&&(this.h.h||this.g.oa()||Zg(this.g)))){this.J||Kt!=4||p==7||(p==8||0>=Li?Ua(3):Ua(2)),Ku(this);var j=this.g.Z();this.X=j;t:if(Pg(this)){var M=Zg(this.g);c="";var z=M.length,Q=Er(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Xn(this),Ga(this);var ce="";break t}this.h.i=new l.TextDecoder}for(p=0;p<z;p++)this.h.h=!0,c+=this.h.i.decode(M[p],{stream:!(Q&&p==z-1)});M.length=0,this.h.g+=c,this.C=0,ce=this.h.g}else ce=this.g.oa();if(this.o=j==200,U1(this.i,this.u,this.A,this.l,this.R,Kt,j),this.o){if(this.T&&!this.K){t:{if(this.g){var rt,Vt=this.g;if((rt=Vt.g?Vt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(rt)){var Qe=rt;break t}}Qe=null}if(j=Qe)Pi(this.i,this.l,j,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qu(this,j);else{this.o=!1,this.s=3,ns(12),Xn(this),Ga(this);break e}}if(this.P){j=!0;let Qs;for(;!this.J&&this.C<ce.length;)if(Qs=G1(this,ce),Qs==Wu){Kt==4&&(this.s=4,ns(14),j=!1),Pi(this.i,this.l,null,"[Incomplete Response]");break}else if(Qs==Tg){this.s=4,ns(15),Pi(this.i,this.l,ce,"[Invalid Chunk]"),j=!1;break}else Pi(this.i,this.l,Qs,null),Qu(this,Qs);if(Pg(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kt!=4||ce.length!=0||this.h.h||(this.s=1,ns(16),j=!1),this.o=this.o&&j,!j)Pi(this.i,this.l,ce,"[Invalid Chunked Response]"),Xn(this),Ga(this);else if(0<ce.length&&!this.W){this.W=!0;var Ht=this.j;Ht.g==this&&Ht.ba&&!Ht.M&&(Ht.j.info("Great, no buffering proxy detected. Bytes received: "+ce.length),tm(Ht),Ht.M=!0,ns(11))}}else Pi(this.i,this.l,ce,null),Qu(this,ce);Kt==4&&Xn(this),this.o&&!this.J&&(Kt==4?ax(this.j,this):(this.o=!1,Gl(this)))}else l_(this.g),j==400&&0<ce.indexOf("Unknown SID")?(this.s=3,ns(12)):(this.s=0,ns(13)),Xn(this),Ga(this)}}}catch{}finally{}};function Pg(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function G1(c,p){var j=c.C,M=p.indexOf(`
`,j);return M==-1?Wu:(j=Number(p.substring(j,M)),isNaN(j)?Tg:(M+=1,M+j>p.length?Wu:(p=p.slice(M,M+j),c.C=M+j,p)))}tn.prototype.cancel=function(){this.J=!0,Xn(this)};function Gl(c){c.S=Date.now()+c.I,Dg(c,c.I)}function Dg(c,p){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Ba(f(c.ba,c),p)}function Ku(c){c.B&&(l.clearTimeout(c.B),c.B=null)}tn.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(B1(this.i,this.A),this.L!=2&&(Ua(),ns(17)),Xn(this),this.s=2,Ga(this)):Dg(this,this.S-c)};function Ga(c){c.j.G==0||c.J||ax(c.j,c)}function Xn(c){Ku(c);var p=c.M;p&&typeof p.ma=="function"&&p.ma(),c.M=null,jg(c.U),c.g&&(p=c.g,c.g=null,p.abort(),p.ma())}function Qu(c,p){try{var j=c.j;if(j.G!=0&&(j.g==c||Yu(j.h,c))){if(!c.K&&Yu(j.h,c)&&j.G==3){try{var M=j.Da.g.parse(p)}catch{M=null}if(Array.isArray(M)&&M.length==3){var z=M;if(z[0]==0){e:if(!j.u){if(j.g)if(j.g.F+3e3<c.F)ec(j),Jl(j);else break e;em(j),ns(18)}}else j.za=z[1],0<j.za-j.T&&37500>z[2]&&j.F&&j.v==0&&!j.C&&(j.C=Ba(f(j.Za,j),6e3));if(1>=Vg(j.h)&&j.ca){try{j.ca()}catch{}j.ca=void 0}}else Zn(j,11)}else if((c.K||j.g==c)&&ec(j),!k(p))for(z=j.Da.g.parse(p),p=0;p<z.length;p++){let Qe=z[p];if(j.T=Qe[0],Qe=Qe[1],j.G==2)if(Qe[0]=="c"){j.K=Qe[1],j.ia=Qe[2];const Ht=Qe[3];Ht!=null&&(j.la=Ht,j.j.info("VER="+j.la));const Kt=Qe[4];Kt!=null&&(j.Aa=Kt,j.j.info("SVER="+j.Aa));const Li=Qe[5];Li!=null&&typeof Li=="number"&&0<Li&&(M=1.5*Li,j.L=M,j.j.info("backChannelRequestTimeoutMs_="+M)),M=j;const Qs=c.g;if(Qs){const sc=Qs.g?Qs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(sc){var Q=M.h;Q.g||sc.indexOf("spdy")==-1&&sc.indexOf("quic")==-1&&sc.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(Xu(Q,Q.h),Q.h=null))}if(M.D){const sm=Qs.g?Qs.g.getResponseHeader("X-HTTP-Session-Id"):null;sm&&(M.ya=sm,at(M.I,M.D,sm))}}j.G=3,j.l&&j.l.ua(),j.ba&&(j.R=Date.now()-c.F,j.j.info("Handshake RTT: "+j.R+"ms")),M=j;var ce=c;if(M.qa=cx(M,M.J?M.ia:null,M.W),ce.K){Og(M.h,ce);var rt=ce,Vt=M.L;Vt&&(rt.I=Vt),rt.B&&(Ku(rt),Gl(rt)),M.g=ce}else nx(M);0<j.i.length&&Zl(j)}else Qe[0]!="stop"&&Qe[0]!="close"||Zn(j,7);else j.G==3&&(Qe[0]=="stop"||Qe[0]=="close"?Qe[0]=="stop"?Zn(j,7):Zu(j):Qe[0]!="noop"&&j.l&&j.l.ta(Qe),j.v=0)}}Ua(4)}catch{}}var W1=class{constructor(c,p){this.g=c,this.map=p}};function Mg(c){this.l=c||10,l.PerformanceNavigationTiming?(c=l.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Lg(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Vg(c){return c.h?1:c.g?c.g.size:0}function Yu(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function Xu(c,p){c.g?c.g.add(p):c.h=p}function Og(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}Mg.prototype.cancel=function(){if(this.i=Fg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Fg(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const j of c.g.values())p=p.concat(j.D);return p}return P(c.i)}function H1(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(d(c)){for(var p=[],j=c.length,M=0;M<j;M++)p.push(c[M]);return p}p=[],j=0;for(M in c)p[j++]=c[M];return p}function K1(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(d(c)||typeof c=="string"){var p=[];c=c.length;for(var j=0;j<c;j++)p.push(j);return p}p=[],j=0;for(const M in c)p[j++]=M;return p}}}function $g(c,p){if(c.forEach&&typeof c.forEach=="function")c.forEach(p,void 0);else if(d(c)||typeof c=="string")Array.prototype.forEach.call(c,p,void 0);else for(var j=K1(c),M=H1(c),z=M.length,Q=0;Q<z;Q++)p.call(void 0,M[Q],j&&j[Q],c)}var zg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Q1(c,p){if(c){c=c.split("&");for(var j=0;j<c.length;j++){var M=c[j].indexOf("="),z=null;if(0<=M){var Q=c[j].substring(0,M);z=c[j].substring(M+1)}else Q=c[j];p(Q,z?decodeURIComponent(z.replace(/\+/g," ")):"")}}}function Jn(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Jn){this.h=c.h,Wl(this,c.j),this.o=c.o,this.g=c.g,Hl(this,c.s),this.l=c.l;var p=c.i,j=new Ka;j.i=p.i,p.g&&(j.g=new Map(p.g),j.h=p.h),Ug(this,j),this.m=c.m}else c&&(p=String(c).match(zg))?(this.h=!1,Wl(this,p[1]||"",!0),this.o=Wa(p[2]||""),this.g=Wa(p[3]||"",!0),Hl(this,p[4]),this.l=Wa(p[5]||"",!0),Ug(this,p[6]||"",!0),this.m=Wa(p[7]||"")):(this.h=!1,this.i=new Ka(null,this.h))}Jn.prototype.toString=function(){var c=[],p=this.j;p&&c.push(Ha(p,Bg,!0),":");var j=this.g;return(j||p=="file")&&(c.push("//"),(p=this.o)&&c.push(Ha(p,Bg,!0),"@"),c.push(encodeURIComponent(String(j)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),j=this.s,j!=null&&c.push(":",String(j))),(j=this.l)&&(this.g&&j.charAt(0)!="/"&&c.push("/"),c.push(Ha(j,j.charAt(0)=="/"?J1:X1,!0))),(j=this.i.toString())&&c.push("?",j),(j=this.m)&&c.push("#",Ha(j,e_)),c.join("")};function Sr(c){return new Jn(c)}function Wl(c,p,j){c.j=j?Wa(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function Hl(c,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);c.s=p}else c.s=null}function Ug(c,p,j){p instanceof Ka?(c.i=p,t_(c.i,c.h)):(j||(p=Ha(p,Z1)),c.i=new Ka(p,c.h))}function at(c,p,j){c.i.set(p,j)}function Kl(c){return at(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Wa(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Ha(c,p,j){return typeof c=="string"?(c=encodeURI(c).replace(p,Y1),j&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function Y1(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var Bg=/[#\/\?@]/g,X1=/[#\?:]/g,J1=/[#\?]/g,Z1=/[#\?@]/g,e_=/#/g;function Ka(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function sn(c){c.g||(c.g=new Map,c.h=0,c.i&&Q1(c.i,function(p,j){c.add(decodeURIComponent(p.replace(/\+/g," ")),j)}))}t=Ka.prototype,t.add=function(c,p){sn(this),this.i=null,c=Di(this,c);var j=this.g.get(c);return j||this.g.set(c,j=[]),j.push(p),this.h+=1,this};function qg(c,p){sn(c),p=Di(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function Gg(c,p){return sn(c),p=Di(c,p),c.g.has(p)}t.forEach=function(c,p){sn(this),this.g.forEach(function(j,M){j.forEach(function(z){c.call(p,z,M,this)},this)},this)},t.na=function(){sn(this);const c=Array.from(this.g.values()),p=Array.from(this.g.keys()),j=[];for(let M=0;M<p.length;M++){const z=c[M];for(let Q=0;Q<z.length;Q++)j.push(p[M])}return j},t.V=function(c){sn(this);let p=[];if(typeof c=="string")Gg(this,c)&&(p=p.concat(this.g.get(Di(this,c))));else{c=Array.from(this.g.values());for(let j=0;j<c.length;j++)p=p.concat(c[j])}return p},t.set=function(c,p){return sn(this),this.i=null,c=Di(this,c),Gg(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},t.get=function(c,p){return c?(c=this.V(c),0<c.length?String(c[0]):p):p};function Wg(c,p,j){qg(c,p),0<j.length&&(c.i=null,c.g.set(Di(c,p),P(j)),c.h+=j.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(var j=0;j<p.length;j++){var M=p[j];const Q=encodeURIComponent(String(M)),ce=this.V(M);for(M=0;M<ce.length;M++){var z=Q;ce[M]!==""&&(z+="="+encodeURIComponent(String(ce[M]))),c.push(z)}}return this.i=c.join("&")};function Di(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function t_(c,p){p&&!c.j&&(sn(c),c.i=null,c.g.forEach(function(j,M){var z=M.toLowerCase();M!=z&&(qg(this,M),Wg(this,z,j))},c)),c.j=p}function s_(c,p){const j=new qa;if(l.Image){const M=new Image;M.onload=x(rn,j,"TestLoadImage: loaded",!0,p,M),M.onerror=x(rn,j,"TestLoadImage: error",!1,p,M),M.onabort=x(rn,j,"TestLoadImage: abort",!1,p,M),M.ontimeout=x(rn,j,"TestLoadImage: timeout",!1,p,M),l.setTimeout(function(){M.ontimeout&&M.ontimeout()},1e4),M.src=c}else p(!1)}function r_(c,p){const j=new qa,M=new AbortController,z=setTimeout(()=>{M.abort(),rn(j,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:M.signal}).then(Q=>{clearTimeout(z),Q.ok?rn(j,"TestPingServer: ok",!0,p):rn(j,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(z),rn(j,"TestPingServer: error",!1,p)})}function rn(c,p,j,M,z){try{z&&(z.onload=null,z.onerror=null,z.onabort=null,z.ontimeout=null),M(j)}catch{}}function n_(){this.g=new $1}function i_(c,p,j){const M=j||"";try{$g(c,function(z,Q){let ce=z;u(z)&&(ce=zu(z)),p.push(M+Q+"="+encodeURIComponent(ce))})}catch(z){throw p.push(M+"type="+encodeURIComponent("_badmap")),z}}function Ql(c){this.l=c.Ub||null,this.j=c.eb||!1}y(Ql,Uu),Ql.prototype.g=function(){return new Yl(this.l,this.j)},Ql.prototype.i=function(c){return function(){return c}}({});function Yl(c,p){Me.call(this),this.D=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(Yl,Me),t=Yl.prototype,t.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=p,this.readyState=1,Ya(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(p.body=c),(this.D||l).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Qa(this)),this.readyState=0},t.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Ya(this)),this.g&&(this.readyState=3,Ya(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Hg(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function Hg(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}t.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?Qa(this):Ya(this),this.readyState==3&&Hg(this)}},t.Ra=function(c){this.g&&(this.response=this.responseText=c,Qa(this))},t.Qa=function(c){this.g&&(this.response=c,Qa(this))},t.ga=function(){this.g&&Qa(this)};function Qa(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Ya(c)}t.setRequestHeader=function(c,p){this.u.append(c,p)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var j=p.next();!j.done;)j=j.value,c.push(j[0]+": "+j[1]),j=p.next();return c.join(`\r
`)};function Ya(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Yl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Kg(c){let p="";return R(c,function(j,M){p+=M,p+=":",p+=j,p+=`\r
`}),p}function Ju(c,p,j){e:{for(M in j){var M=!1;break e}M=!0}M||(j=Kg(j),typeof c=="string"?j!=null&&encodeURIComponent(String(j)):at(c,p,j))}function yt(c){Me.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(yt,Me);var a_=/^https?$/i,o_=["POST","PUT"];t=yt.prototype,t.Ha=function(c){this.J=c},t.ea=function(c,p,j,M){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Gu.g(),this.v=this.o?Ng(this.o):Ng(Gu),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(Q){Qg(this,Q);return}if(c=j||"",j=new Map(this.headers),M)if(Object.getPrototypeOf(M)===Object.prototype)for(var z in M)j.set(z,M[z]);else if(typeof M.keys=="function"&&typeof M.get=="function")for(const Q of M.keys())j.set(Q,M.get(Q));else throw Error("Unknown input type for opt_headers: "+String(M));M=Array.from(j.keys()).find(Q=>Q.toLowerCase()=="content-type"),z=l.FormData&&c instanceof l.FormData,!(0<=Array.prototype.indexOf.call(o_,p,void 0))||M||z||j.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,ce]of j)this.g.setRequestHeader(Q,ce);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Jg(this),this.u=!0,this.g.send(c),this.u=!1}catch(Q){Qg(this,Q)}};function Qg(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.m=5,Yg(c),Xl(c)}function Yg(c){c.A||(c.A=!0,nt(c,"complete"),nt(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,nt(this,"complete"),nt(this,"abort"),Xl(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xl(this,!0)),yt.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Xg(this):this.bb())},t.bb=function(){Xg(this)};function Xg(c){if(c.h&&typeof o<"u"&&(!c.v[1]||Er(c)!=4||c.Z()!=2)){if(c.u&&Er(c)==4)Fa(c.Ea,0,c);else if(nt(c,"readystatechange"),Er(c)==4){c.h=!1;try{const ce=c.Z();e:switch(ce){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var j;if(!(j=p)){var M;if(M=ce===0){var z=String(c.D).match(zg)[1]||null;!z&&l.self&&l.self.location&&(z=l.self.location.protocol.slice(0,-1)),M=!a_.test(z?z.toLowerCase():"")}j=M}if(j)nt(c,"complete"),nt(c,"success");else{c.m=6;try{var Q=2<Er(c)?c.g.statusText:""}catch{Q=""}c.l=Q+" ["+c.Z()+"]",Yg(c)}}finally{Xl(c)}}}}function Xl(c,p){if(c.g){Jg(c);const j=c.g,M=c.v[0]?()=>{}:null;c.g=null,c.v=null,p||nt(c,"ready");try{j.onreadystatechange=M}catch{}}}function Jg(c){c.I&&(l.clearTimeout(c.I),c.I=null)}t.isActive=function(){return!!this.g};function Er(c){return c.g?c.g.readyState:0}t.Z=function(){try{return 2<Er(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),F1(p)}};function Zg(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function l_(c){const p={};c=(c.g&&2<=Er(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let M=0;M<c.length;M++){if(k(c[M]))continue;var j=w(c[M]);const z=j[0];if(j=j[1],typeof j!="string")continue;j=j.trim();const Q=p[z]||[];p[z]=Q,Q.push(j)}v(p,function(M){return M.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xa(c,p,j){return j&&j.internalChannelParams&&j.internalChannelParams[c]||p}function ex(c){this.Aa=0,this.i=[],this.j=new qa,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xa("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xa("baseRetryDelayMs",5e3,c),this.cb=Xa("retryDelaySeedMs",1e4,c),this.Wa=Xa("forwardChannelMaxRetries",2,c),this.wa=Xa("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new Mg(c&&c.concurrentRequestLimit),this.Da=new n_,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=ex.prototype,t.la=8,t.G=1,t.connect=function(c,p,j,M){ns(0),this.W=c,this.H=p||{},j&&M!==void 0&&(this.H.OSID=j,this.H.OAID=M),this.F=this.X,this.I=cx(this,null,this.W),Zl(this)};function Zu(c){if(tx(c),c.G==3){var p=c.U++,j=Sr(c.I);if(at(j,"SID",c.K),at(j,"RID",p),at(j,"TYPE","terminate"),Ja(c,j),p=new tn(c,c.j,p),p.L=2,p.v=Kl(Sr(j)),j=!1,l.navigator&&l.navigator.sendBeacon)try{j=l.navigator.sendBeacon(p.v.toString(),"")}catch{}!j&&l.Image&&(new Image().src=p.v,j=!0),j||(p.g=dx(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Gl(p)}lx(c)}function Jl(c){c.g&&(tm(c),c.g.cancel(),c.g=null)}function tx(c){Jl(c),c.u&&(l.clearTimeout(c.u),c.u=null),ec(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&l.clearTimeout(c.s),c.s=null)}function Zl(c){if(!Lg(c.h)&&!c.s){c.s=!0;var p=c.Ga;X||Z(),W||(X(),W=!0),re.add(p,c),c.B=0}}function c_(c,p){return Vg(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=p.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Ba(f(c.Ga,c,p),ox(c,c.B)),c.B++,!0)}t.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const z=new tn(this,this.j,c);let Q=this.o;if(this.S&&(Q?(Q=b(Q),g(Q,this.S)):Q=this.S),this.m!==null||this.O||(z.H=Q,Q=null),this.P)e:{for(var p=0,j=0;j<this.i.length;j++){t:{var M=this.i[j];if("__data__"in M.map&&(M=M.map.__data__,typeof M=="string")){M=M.length;break t}M=void 0}if(M===void 0)break;if(p+=M,4096<p){p=j;break e}if(p===4096||j===this.i.length-1){p=j+1;break e}}p=1e3}else p=1e3;p=rx(this,z,p),j=Sr(this.I),at(j,"RID",c),at(j,"CVER",22),this.D&&at(j,"X-HTTP-Session-Id",this.D),Ja(this,j),Q&&(this.O?p="headers="+encodeURIComponent(String(Kg(Q)))+"&"+p:this.m&&Ju(j,this.m,Q)),Xu(this.h,z),this.Ua&&at(j,"TYPE","init"),this.P?(at(j,"$req",p),at(j,"SID","null"),z.T=!0,Hu(z,j,null)):Hu(z,j,p),this.G=2}}else this.G==3&&(c?sx(this,c):this.i.length==0||Lg(this.h)||sx(this))};function sx(c,p){var j;p?j=p.l:j=c.U++;const M=Sr(c.I);at(M,"SID",c.K),at(M,"RID",j),at(M,"AID",c.T),Ja(c,M),c.m&&c.o&&Ju(M,c.m,c.o),j=new tn(c,c.j,j,c.B+1),c.m===null&&(j.H=c.o),p&&(c.i=p.D.concat(c.i)),p=rx(c,j,1e3),j.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Xu(c.h,j),Hu(j,M,p)}function Ja(c,p){c.H&&R(c.H,function(j,M){at(p,M,j)}),c.l&&$g({},function(j,M){at(p,M,j)})}function rx(c,p,j){j=Math.min(c.i.length,j);var M=c.l?f(c.l.Na,c.l,c):null;e:{var z=c.i;let Q=-1;for(;;){const ce=["count="+j];Q==-1?0<j?(Q=z[0].g,ce.push("ofs="+Q)):Q=0:ce.push("ofs="+Q);let rt=!0;for(let Vt=0;Vt<j;Vt++){let Qe=z[Vt].g;const Ht=z[Vt].map;if(Qe-=Q,0>Qe)Q=Math.max(0,z[Vt].g-100),rt=!1;else try{i_(Ht,ce,"req"+Qe+"_")}catch{M&&M(Ht)}}if(rt){M=ce.join("&");break e}}}return c=c.i.splice(0,j),p.D=c,M}function nx(c){if(!c.g&&!c.u){c.Y=1;var p=c.Fa;X||Z(),W||(X(),W=!0),re.add(p,c),c.v=0}}function em(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Ba(f(c.Fa,c),ox(c,c.v)),c.v++,!0)}t.Fa=function(){if(this.u=null,ix(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Ba(f(this.ab,this),c)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ns(10),Jl(this),ix(this))};function tm(c){c.A!=null&&(l.clearTimeout(c.A),c.A=null)}function ix(c){c.g=new tn(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var p=Sr(c.qa);at(p,"RID","rpc"),at(p,"SID",c.K),at(p,"AID",c.T),at(p,"CI",c.F?"0":"1"),!c.F&&c.ja&&at(p,"TO",c.ja),at(p,"TYPE","xmlhttp"),Ja(c,p),c.m&&c.o&&Ju(p,c.m,c.o),c.L&&(c.g.I=c.L);var j=c.g;c=c.ia,j.L=1,j.v=Kl(Sr(p)),j.m=null,j.P=!0,Rg(j,c)}t.Za=function(){this.C!=null&&(this.C=null,Jl(this),em(this),ns(19))};function ec(c){c.C!=null&&(l.clearTimeout(c.C),c.C=null)}function ax(c,p){var j=null;if(c.g==p){ec(c),tm(c),c.g=null;var M=2}else if(Yu(c.h,p))j=p.D,Og(c.h,p),M=1;else return;if(c.G!=0){if(p.o)if(M==1){j=p.m?p.m.length:0,p=Date.now()-p.F;var z=c.B;M=Ul(),nt(M,new Ig(M,j)),Zl(c)}else nx(c);else if(z=p.s,z==3||z==0&&0<p.X||!(M==1&&c_(c,p)||M==2&&em(c)))switch(j&&0<j.length&&(p=c.h,p.i=p.i.concat(j)),z){case 1:Zn(c,5);break;case 4:Zn(c,10);break;case 3:Zn(c,6);break;default:Zn(c,2)}}}function ox(c,p){let j=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(j*=2),j*p}function Zn(c,p){if(c.j.info("Error code "+p),p==2){var j=f(c.fb,c),M=c.Xa;const z=!M;M=new Jn(M||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Wl(M,"https"),Kl(M),z?s_(M.toString(),j):r_(M.toString(),j)}else ns(2);c.G=0,c.l&&c.l.sa(p),lx(c),tx(c)}t.fb=function(c){c?(this.j.info("Successfully pinged google.com"),ns(2)):(this.j.info("Failed to ping google.com"),ns(1))};function lx(c){if(c.G=0,c.ka=[],c.l){const p=Fg(c.h);(p.length!=0||c.i.length!=0)&&(_(c.ka,p),_(c.ka,c.i),c.h.i.length=0,P(c.i),c.i.length=0),c.l.ra()}}function cx(c,p,j){var M=j instanceof Jn?Sr(j):new Jn(j);if(M.g!="")p&&(M.g=p+"."+M.g),Hl(M,M.s);else{var z=l.location;M=z.protocol,p=p?p+"."+z.hostname:z.hostname,z=+z.port;var Q=new Jn(null);M&&Wl(Q,M),p&&(Q.g=p),z&&Hl(Q,z),j&&(Q.l=j),M=Q}return j=c.D,p=c.ya,j&&p&&at(M,j,p),at(M,"VER",c.la),Ja(c,M),M}function dx(c,p,j){if(p&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Ca&&!c.pa?new yt(new Ql({eb:j})):new yt(c.pa),p.Ha(c.J),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function ux(){}t=ux.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function tc(){}tc.prototype.g=function(c,p){return new ks(c,p)};function ks(c,p){Me.call(this),this.g=new ex(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(c?c["X-WebChannel-Client-Profile"]=p.va:c={"X-WebChannel-Client-Profile":p.va}),this.g.S=c,(c=p&&p.Sb)&&!k(c)&&(this.g.m=c),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!k(p)&&(this.g.D=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new Mi(this)}y(ks,Me),ks.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ks.prototype.close=function(){Zu(this.g)},ks.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var j={};j.__data__=c,c=j}else this.u&&(j={},j.__data__=zu(c),c=j);p.i.push(new W1(p.Ya++,c)),p.G==3&&Zl(p)},ks.prototype.N=function(){this.g.l=null,delete this.j,Zu(this.g),delete this.g,ks.aa.N.call(this)};function mx(c){Bu.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const j in p){c=j;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}y(mx,Bu);function hx(){qu.call(this),this.status=1}y(hx,qu);function Mi(c){this.g=c}y(Mi,ux),Mi.prototype.ua=function(){nt(this.g,"a")},Mi.prototype.ta=function(c){nt(this.g,new mx(c))},Mi.prototype.sa=function(c){nt(this.g,new hx)},Mi.prototype.ra=function(){nt(this.g,"b")},tc.prototype.createWebChannel=tc.prototype.g,ks.prototype.send=ks.prototype.o,ks.prototype.open=ks.prototype.m,ks.prototype.close=ks.prototype.close,Xj=function(){return new tc},Yj=function(){return Ul()},Qj=Yn,Yh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Bl.NO_ERROR=0,Bl.TIMEOUT=8,Bl.HTTP_ERROR=6,qc=Bl,kg.COMPLETE="complete",Kj=kg,_g.EventType=za,za.OPEN="a",za.CLOSE="b",za.ERROR="c",za.MESSAGE="d",Me.prototype.listen=Me.prototype.K,fo=_g,yt.prototype.listenOnce=yt.prototype.L,yt.prototype.getLastError=yt.prototype.Ka,yt.prototype.getLastErrorCode=yt.prototype.Ba,yt.prototype.getStatus=yt.prototype.Z,yt.prototype.getResponseJson=yt.prototype.Oa,yt.prototype.getResponseText=yt.prototype.oa,yt.prototype.send=yt.prototype.ea,yt.prototype.setWithCredentials=yt.prototype.Ha,Hj=yt}).apply(typeof jc<"u"?jc:typeof self<"u"?self:typeof window<"u"?window:{});const my="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Jt.UNAUTHENTICATED=new Jt(null),Jt.GOOGLE_CREDENTIALS=new Jt("google-credentials-uid"),Jt.FIRST_PARTY=new Jt("first-party-uid"),Jt.MOCK_USER=new Jt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pa="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi=new pf("@firebase/firestore");function oo(){return yi.logLevel}function ve(t,...e){if(yi.logLevel<=Ue.DEBUG){const s=e.map(Af);yi.debug(`Firestore (${Pa}): ${t}`,...s)}}function Hr(t,...e){if(yi.logLevel<=Ue.ERROR){const s=e.map(Af);yi.error(`Firestore (${Pa}): ${t}`,...s)}}function wa(t,...e){if(yi.logLevel<=Ue.WARN){const s=e.map(Af);yi.warn(`Firestore (${Pa}): ${t}`,...s)}}function Af(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ie(t="Unexpected state"){const e=`FIRESTORE (${Pa}) INTERNAL ASSERTION FAILED: `+t;throw Hr(e),new Error(e)}function tt(t,e){t||Ie()}function Pe(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ge extends jr{constructor(e,s){super(e,s),this.code=e,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(){this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jj{constructor(e,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class WT{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,s){e.enqueueRetryable(()=>s(Jt.UNAUTHENTICATED))}shutdown(){}}class HT{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,s){this.changeListener=s,e.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class KT{constructor(e){this.t=e,this.currentUser=Jt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,s){tt(this.o===void 0);let n=this.i;const i=d=>this.i!==n?(n=this.i,s(d)):Promise.resolve();let a=new Vr;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Vr,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const d=a;e.enqueueRetryable(async()=>{await d.promise,await i(this.currentUser)})},l=d=>{ve("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(d=>l(d)),setTimeout(()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?l(d):(ve("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Vr)}},0),o()}getToken(){const e=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(n=>this.i!==e?(ve("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(tt(typeof n.accessToken=="string"),new Jj(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return tt(e===null||typeof e=="string"),new Jt(e)}}class QT{constructor(e,s,n){this.l=e,this.h=s,this.P=n,this.type="FirstParty",this.user=Jt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class YT{constructor(e,s,n){this.l=e,this.h=s,this.P=n}getToken(){return Promise.resolve(new QT(this.l,this.h,this.P))}start(e,s){e.enqueueRetryable(()=>s(Jt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class XT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class JT{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,s){tt(this.o===void 0);const n=a=>{a.error!=null&&ve("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.R;return this.R=a.token,ve("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?s(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>n(a))};const i=a=>{ve("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(a=>i(a)),setTimeout(()=>{if(!this.appCheck){const a=this.A.getImmediate({optional:!0});a?i(a):ve("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(s=>s?(tt(typeof s.token=="string"),this.R=s.token,new XT(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZT(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(s);else for(let n=0;n<t;n++)s[n]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=ZT(40);for(let a=0;a<i.length;++a)n.length<20&&i[a]<s&&(n+=e.charAt(i[a]%e.length))}return n}}function Ye(t,e){return t<e?-1:t>e?1:0}function ja(t,e,s){return t.length===e.length&&t.every((n,i)=>s(n,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e,s){if(this.seconds=e,this.nanoseconds=s,s<0)throw new ge(te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new ge(te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(e<-62135596800)throw new ge(te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ge(te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return J.fromMillis(Date.now())}static fromDate(e){return J.fromMillis(e.getTime())}static fromMillis(e){const s=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*s));return new J(s,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ye(this.nanoseconds,e.nanoseconds):Ye(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Re(e)}static min(){return new Re(new J(0,0))}static max(){return new Re(new J(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(e,s,n){s===void 0?s=0:s>e.length&&Ie(),n===void 0?n=e.length-s:n>e.length-s&&Ie(),this.segments=e,this.offset=s,this.len=n}get length(){return this.len}isEqual(e){return ol.comparator(this,e)===0}child(e){const s=this.segments.slice(this.offset,this.limit());return e instanceof ol?e.forEach(n=>{s.push(n)}):s.push(e),this.construct(s)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}forEach(e){for(let s=this.offset,n=this.limit();s<n;s++)e(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,s){const n=Math.min(e.length,s.length);for(let i=0;i<n;i++){const a=e.get(i),o=s.get(i);if(a<o)return-1;if(a>o)return 1}return e.length<s.length?-1:e.length>s.length?1:0}}class lt extends ol{construct(e,s,n){return new lt(e,s,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const s=[];for(const n of e){if(n.indexOf("//")>=0)throw new ge(te.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);s.push(...n.split("/").filter(i=>i.length>0))}return new lt(s)}static emptyPath(){return new lt([])}}const e4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ut extends ol{construct(e,s,n){return new Ut(e,s,n)}static isValidIdentifier(e){return e4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ut.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ut(["__name__"])}static fromServerFormat(e){const s=[];let n="",i=0;const a=()=>{if(n.length===0)throw new ge(te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(n),n=""};let o=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new ge(te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new ge(te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(n+=l,i++):(a(),i++)}if(a(),o)throw new ge(te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ut(s)}static emptyPath(){return new Ut([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.path=e}static fromPath(e){return new Se(lt.fromString(e))}static fromName(e){return new Se(lt.fromString(e).popFirst(5))}static empty(){return new Se(lt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&lt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,s){return lt.comparator(e.path,s.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Se(new lt(e.slice()))}}function t4(t,e){const s=t.toTimestamp().seconds,n=t.toTimestamp().nanoseconds+1,i=Re.fromTimestamp(n===1e9?new J(s+1,0):new J(s,n));return new Vn(i,Se.empty(),e)}function s4(t){return new Vn(t.readTime,t.key,-1)}class Vn{constructor(e,s,n){this.readTime=e,this.documentKey=s,this.largestBatchId=n}static min(){return new Vn(Re.min(),Se.empty(),-1)}static max(){return new Vn(Re.max(),Se.empty(),-1)}}function r4(t,e){let s=t.readTime.compareTo(e.readTime);return s!==0?s:(s=Se.comparator(t.documentKey,e.documentKey),s!==0?s:Ye(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n4="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class i4{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tl(t){if(t.code!==te.FAILED_PRECONDITION||t.message!==n4)throw t;ve("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(e){return this.next(void 0,e)}next(e,s){return this.callbackAttached&&Ie(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(e,this.result):new ie((n,i)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(n,i)},this.catchCallback=a=>{this.wrapFailure(s,a).next(n,i)}})}toPromise(){return new Promise((e,s)=>{this.next(e,s)})}wrapUserFunction(e){try{const s=e();return s instanceof ie?s:ie.resolve(s)}catch(s){return ie.reject(s)}}wrapSuccess(e,s){return e?this.wrapUserFunction(()=>e(s)):ie.resolve(s)}wrapFailure(e,s){return e?this.wrapUserFunction(()=>e(s)):ie.reject(s)}static resolve(e){return new ie((s,n)=>{s(e)})}static reject(e){return new ie((s,n)=>{n(e)})}static waitFor(e){return new ie((s,n)=>{let i=0,a=0,o=!1;e.forEach(l=>{++i,l.next(()=>{++a,o&&a===i&&s()},d=>n(d))}),o=!0,a===i&&s()})}static or(e){let s=ie.resolve(!1);for(const n of e)s=s.next(i=>i?ie.resolve(i):n());return s}static forEach(e,s){const n=[];return e.forEach((i,a)=>{n.push(s.call(this,i,a))}),this.waitFor(n)}static mapArray(e,s){return new ie((n,i)=>{const a=e.length,o=new Array(a);let l=0;for(let d=0;d<a;d++){const u=d;s(e[u]).next(m=>{o[u]=m,++l,l===a&&n(o)},m=>i(m))}})}static doWhile(e,s){return new ie((n,i)=>{const a=()=>{e()===!0?s().next(()=>{a()},i):n()};a()})}}function a4(t){const e=t.match(/Android ([\d.]+)/i),s=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function Rl(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(e,s){this.previousValue=e,s&&(s.sequenceNumberHandler=n=>this.ie(n),this.se=n=>s.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}If.oe=-1;function yu(t){return t==null}function Td(t){return t===0&&1/t==-1/0}function o4(t){return typeof t=="number"&&Number.isInteger(t)&&!Td(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hy(t){let e=0;for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e++;return e}function Ci(t,e){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&e(s,t[s])}function eN(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,s){this.comparator=e,this.root=s||$t.EMPTY}insert(e,s){return new xt(this.comparator,this.root.insert(e,s,this.comparator).copy(null,null,$t.BLACK,null,null))}remove(e){return new xt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$t.BLACK,null,null))}get(e){let s=this.root;for(;!s.isEmpty();){const n=this.comparator(e,s.key);if(n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}indexOf(e){let s=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return s+n.left.size;i<0?n=n.left:(s+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((s,n)=>(e(s,n),!1))}toString(){const e=[];return this.inorderTraversal((s,n)=>(e.push(`${s}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nc(this.root,e,this.comparator,!0)}}class Nc{constructor(e,s,n,i){this.isReverse=i,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=s?n(e.key,s):1,s&&i&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const s={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class $t{constructor(e,s,n,i,a){this.key=e,this.value=s,this.color=n??$t.RED,this.left=i??$t.EMPTY,this.right=a??$t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,s,n,i,a){return new $t(e??this.key,s??this.value,n??this.color,i??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,n){let i=this;const a=n(e,i.key);return i=a<0?i.copy(null,null,null,i.left.insert(e,s,n),null):a===0?i.copy(null,s,null,null,null):i.copy(null,null,null,null,i.right.insert(e,s,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return $t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,s){let n,i=this;if(s(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,s),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),s(e,i.key)===0){if(i.right.isEmpty())return $t.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,s))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,$t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,$t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ie();const e=this.left.check();if(e!==this.right.check())throw Ie();return e+(this.isRed()?0:1)}}$t.EMPTY=null,$t.RED=!0,$t.BLACK=!1;$t.EMPTY=new class{constructor(){this.size=0}get key(){throw Ie()}get value(){throw Ie()}get color(){throw Ie()}get left(){throw Ie()}get right(){throw Ie()}copy(e,s,n,i,a){return this}insert(e,s,n){return new $t(e,s)}remove(e,s){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.comparator=e,this.data=new xt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((s,n)=>(e(s),!1))}forEachInRange(e,s){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;s(i.key)}}forEachWhile(e,s){let n;for(n=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const s=this.data.getIteratorFrom(e);return s.hasNext()?s.getNext().key:null}getIterator(){return new py(this.data.getIterator())}getIteratorFrom(e){return new py(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let s=this;return s.size<e.size&&(s=e,e=this),e.forEach(n=>{s=s.add(n)}),s}isEqual(e){if(!(e instanceof qt)||this.size!==e.size)return!1;const s=this.data.getIterator(),n=e.data.getIterator();for(;s.hasNext();){const i=s.getNext().key,a=n.getNext().key;if(this.comparator(i,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(s=>{e.push(s)}),e}toString(){const e=[];return this.forEach(s=>e.push(s)),"SortedSet("+e.toString()+")"}copy(e){const s=new qt(this.comparator);return s.data=e,s}}class py{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e){this.fields=e,e.sort(Ut.comparator)}static empty(){return new Rs([])}unionWith(e){let s=new qt(Ut.comparator);for(const n of this.fields)s=s.add(n);for(const n of e)s=s.add(n);return new Rs(s.toArray())}covers(e){for(const s of this.fields)if(s.isPrefixOf(e))return!0;return!1}isEqual(e){return ja(this.fields,e.fields,(s,n)=>s.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.binaryString=e}static fromBase64String(e){const s=function(i){try{return atob(i)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new tN("Invalid base64 string: "+a):a}}(e);return new Wt(s)}static fromUint8Array(e){const s=function(i){let a="";for(let o=0;o<i.length;++o)a+=String.fromCharCode(i[o]);return a}(e);return new Wt(s)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const n=new Uint8Array(s.length);for(let i=0;i<s.length;i++)n[i]=s.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ye(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wt.EMPTY_BYTE_STRING=new Wt("");const l4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function On(t){if(tt(!!t),typeof t=="string"){let e=0;const s=l4.exec(t);if(tt(!!s),s[1]){let i=s[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:wt(t.seconds),nanos:wt(t.nanos)}}function wt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function vi(t){return typeof t=="string"?Wt.fromBase64String(t):Wt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kf(t){var e,s;return((s=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="server_timestamp"}function Cf(t){const e=t.mapValue.fields.__previous_value__;return kf(e)?Cf(e):e}function ll(t){const e=On(t.mapValue.fields.__local_write_time__.timestampValue);return new J(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c4{constructor(e,s,n,i,a,o,l,d,u){this.databaseId=e,this.appId=s,this.persistenceKey=n,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=d,this.useFetchStreams=u}}class cl{constructor(e,s){this.projectId=e,this.database=s||"(default)"}static empty(){return new cl("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof cl&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _c={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function bi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?kf(t)?4:u4(t)?9007199254740991:d4(t)?10:11:Ie()}function yr(t,e){if(t===e)return!0;const s=bi(t);if(s!==bi(e))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ll(t).isEqual(ll(e));case 3:return function(i,a){if(typeof i.timestampValue=="string"&&typeof a.timestampValue=="string"&&i.timestampValue.length===a.timestampValue.length)return i.timestampValue===a.timestampValue;const o=On(i.timestampValue),l=On(a.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,a){return vi(i.bytesValue).isEqual(vi(a.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,a){return wt(i.geoPointValue.latitude)===wt(a.geoPointValue.latitude)&&wt(i.geoPointValue.longitude)===wt(a.geoPointValue.longitude)}(t,e);case 2:return function(i,a){if("integerValue"in i&&"integerValue"in a)return wt(i.integerValue)===wt(a.integerValue);if("doubleValue"in i&&"doubleValue"in a){const o=wt(i.doubleValue),l=wt(a.doubleValue);return o===l?Td(o)===Td(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return ja(t.arrayValue.values||[],e.arrayValue.values||[],yr);case 10:case 11:return function(i,a){const o=i.mapValue.fields||{},l=a.mapValue.fields||{};if(hy(o)!==hy(l))return!1;for(const d in o)if(o.hasOwnProperty(d)&&(l[d]===void 0||!yr(o[d],l[d])))return!1;return!0}(t,e);default:return Ie()}}function dl(t,e){return(t.values||[]).find(s=>yr(s,e))!==void 0}function Na(t,e){if(t===e)return 0;const s=bi(t),n=bi(e);if(s!==n)return Ye(s,n);switch(s){case 0:case 9007199254740991:return 0;case 1:return Ye(t.booleanValue,e.booleanValue);case 2:return function(a,o){const l=wt(a.integerValue||a.doubleValue),d=wt(o.integerValue||o.doubleValue);return l<d?-1:l>d?1:l===d?0:isNaN(l)?isNaN(d)?0:-1:1}(t,e);case 3:return fy(t.timestampValue,e.timestampValue);case 4:return fy(ll(t),ll(e));case 5:return Ye(t.stringValue,e.stringValue);case 6:return function(a,o){const l=vi(a),d=vi(o);return l.compareTo(d)}(t.bytesValue,e.bytesValue);case 7:return function(a,o){const l=a.split("/"),d=o.split("/");for(let u=0;u<l.length&&u<d.length;u++){const m=Ye(l[u],d[u]);if(m!==0)return m}return Ye(l.length,d.length)}(t.referenceValue,e.referenceValue);case 8:return function(a,o){const l=Ye(wt(a.latitude),wt(o.latitude));return l!==0?l:Ye(wt(a.longitude),wt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return gy(t.arrayValue,e.arrayValue);case 10:return function(a,o){var l,d,u,m;const h=a.fields||{},f=o.fields||{},x=(l=h.value)===null||l===void 0?void 0:l.arrayValue,y=(d=f.value)===null||d===void 0?void 0:d.arrayValue,P=Ye(((u=x==null?void 0:x.values)===null||u===void 0?void 0:u.length)||0,((m=y==null?void 0:y.values)===null||m===void 0?void 0:m.length)||0);return P!==0?P:gy(x,y)}(t.mapValue,e.mapValue);case 11:return function(a,o){if(a===_c.mapValue&&o===_c.mapValue)return 0;if(a===_c.mapValue)return 1;if(o===_c.mapValue)return-1;const l=a.fields||{},d=Object.keys(l),u=o.fields||{},m=Object.keys(u);d.sort(),m.sort();for(let h=0;h<d.length&&h<m.length;++h){const f=Ye(d[h],m[h]);if(f!==0)return f;const x=Na(l[d[h]],u[m[h]]);if(x!==0)return x}return Ye(d.length,m.length)}(t.mapValue,e.mapValue);default:throw Ie()}}function fy(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ye(t,e);const s=On(t),n=On(e),i=Ye(s.seconds,n.seconds);return i!==0?i:Ye(s.nanos,n.nanos)}function gy(t,e){const s=t.values||[],n=e.values||[];for(let i=0;i<s.length&&i<n.length;++i){const a=Na(s[i],n[i]);if(a)return a}return Ye(s.length,n.length)}function _a(t){return Xh(t)}function Xh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(s){const n=On(s);return`time(${n.seconds},${n.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(s){return vi(s).toBase64()}(t.bytesValue):"referenceValue"in t?function(s){return Se.fromName(s).toString()}(t.referenceValue):"geoPointValue"in t?function(s){return`geo(${s.latitude},${s.longitude})`}(t.geoPointValue):"arrayValue"in t?function(s){let n="[",i=!0;for(const a of s.values||[])i?i=!1:n+=",",n+=Xh(a);return n+"]"}(t.arrayValue):"mapValue"in t?function(s){const n=Object.keys(s.fields||{}).sort();let i="{",a=!0;for(const o of n)a?a=!1:i+=",",i+=`${o}:${Xh(s.fields[o])}`;return i+"}"}(t.mapValue):Ie()}function xy(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Jh(t){return!!t&&"integerValue"in t}function Tf(t){return!!t&&"arrayValue"in t}function yy(t){return!!t&&"nullValue"in t}function vy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Gc(t){return!!t&&"mapValue"in t}function d4(t){var e,s;return((s=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="__vector__"}function To(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ci(t.mapValue.fields,(s,n)=>e.mapValue.fields[s]=To(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let s=0;s<(t.arrayValue.values||[]).length;++s)e.arrayValue.values[s]=To(t.arrayValue.values[s]);return e}return Object.assign({},t)}function u4(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vs{constructor(e){this.value=e}static empty(){return new vs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let s=this.value;for(let n=0;n<e.length-1;++n)if(s=(s.mapValue.fields||{})[e.get(n)],!Gc(s))return null;return s=(s.mapValue.fields||{})[e.lastSegment()],s||null}}set(e,s){this.getFieldsMap(e.popLast())[e.lastSegment()]=To(s)}setAll(e){let s=Ut.emptyPath(),n={},i=[];e.forEach((o,l)=>{if(!s.isImmediateParentOf(l)){const d=this.getFieldsMap(s);this.applyChanges(d,n,i),n={},i=[],s=l.popLast()}o?n[l.lastSegment()]=To(o):i.push(l.lastSegment())});const a=this.getFieldsMap(s);this.applyChanges(a,n,i)}delete(e){const s=this.field(e.popLast());Gc(s)&&s.mapValue.fields&&delete s.mapValue.fields[e.lastSegment()]}isEqual(e){return yr(this.value,e.value)}getFieldsMap(e){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=s.mapValue.fields[e.get(n)];Gc(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},s.mapValue.fields[e.get(n)]=i),s=i}return s.mapValue.fields}applyChanges(e,s,n){Ci(s,(i,a)=>e[i]=a);for(const i of n)delete e[i]}clone(){return new vs(To(this.value))}}function sN(t){const e=[];return Ci(t.fields,(s,n)=>{const i=new Ut([s]);if(Gc(n)){const a=sN(n.mapValue).fields;if(a.length===0)e.push(i);else for(const o of a)e.push(i.child(o))}else e.push(i)}),new Rs(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e,s,n,i,a,o,l){this.key=e,this.documentType=s,this.version=n,this.readTime=i,this.createTime=a,this.data=o,this.documentState=l}static newInvalidDocument(e){return new es(e,0,Re.min(),Re.min(),Re.min(),vs.empty(),0)}static newFoundDocument(e,s,n,i){return new es(e,1,s,Re.min(),n,i,0)}static newNoDocument(e,s){return new es(e,2,s,Re.min(),Re.min(),vs.empty(),0)}static newUnknownDocument(e,s){return new es(e,3,s,Re.min(),Re.min(),vs.empty(),2)}convertToFoundDocument(e,s){return!this.createTime.isEqual(Re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof es&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new es(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rd{constructor(e,s){this.position=e,this.inclusive=s}}function by(t,e,s){let n=0;for(let i=0;i<t.position.length;i++){const a=e[i],o=t.position[i];if(a.field.isKeyField()?n=Se.comparator(Se.fromName(o.referenceValue),s.key):n=Na(o,s.data.field(a.field)),a.dir==="desc"&&(n*=-1),n!==0)break}return n}function wy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let s=0;s<t.position.length;s++)if(!yr(t.position[s],e.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(e,s="asc"){this.field=e,this.dir=s}}function m4(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rN=class{};class At extends rN{constructor(e,s,n){super(),this.field=e,this.op=s,this.value=n}static create(e,s,n){return e.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(e,s,n):new p4(e,s,n):s==="array-contains"?new x4(e,n):s==="in"?new y4(e,n):s==="not-in"?new v4(e,n):s==="array-contains-any"?new b4(e,n):new At(e,s,n)}static createKeyFieldInFilter(e,s,n){return s==="in"?new f4(e,n):new g4(e,n)}matches(e){const s=e.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(Na(s,this.value)):s!==null&&bi(this.value)===bi(s)&&this.matchesComparison(Na(s,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ie()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ar extends rN{constructor(e,s){super(),this.filters=e,this.op=s,this.ae=null}static create(e,s){return new ar(e,s)}matches(e){return nN(this)?this.filters.find(s=>!s.matches(e))===void 0:this.filters.find(s=>s.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,s)=>e.concat(s.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function nN(t){return t.op==="and"}function iN(t){return h4(t)&&nN(t)}function h4(t){for(const e of t.filters)if(e instanceof ar)return!1;return!0}function Zh(t){if(t instanceof At)return t.field.canonicalString()+t.op.toString()+_a(t.value);if(iN(t))return t.filters.map(e=>Zh(e)).join(",");{const e=t.filters.map(s=>Zh(s)).join(",");return`${t.op}(${e})`}}function aN(t,e){return t instanceof At?function(n,i){return i instanceof At&&n.op===i.op&&n.field.isEqual(i.field)&&yr(n.value,i.value)}(t,e):t instanceof ar?function(n,i){return i instanceof ar&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((a,o,l)=>a&&aN(o,i.filters[l]),!0):!1}(t,e):void Ie()}function oN(t){return t instanceof At?function(s){return`${s.field.canonicalString()} ${s.op} ${_a(s.value)}`}(t):t instanceof ar?function(s){return s.op.toString()+" {"+s.getFilters().map(oN).join(" ,")+"}"}(t):"Filter"}class p4 extends At{constructor(e,s,n){super(e,s,n),this.key=Se.fromName(n.referenceValue)}matches(e){const s=Se.comparator(e.key,this.key);return this.matchesComparison(s)}}class f4 extends At{constructor(e,s){super(e,"in",s),this.keys=lN("in",s)}matches(e){return this.keys.some(s=>s.isEqual(e.key))}}class g4 extends At{constructor(e,s){super(e,"not-in",s),this.keys=lN("not-in",s)}matches(e){return!this.keys.some(s=>s.isEqual(e.key))}}function lN(t,e){var s;return(((s=e.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(n=>Se.fromName(n.referenceValue))}class x4 extends At{constructor(e,s){super(e,"array-contains",s)}matches(e){const s=e.data.field(this.field);return Tf(s)&&dl(s.arrayValue,this.value)}}class y4 extends At{constructor(e,s){super(e,"in",s)}matches(e){const s=e.data.field(this.field);return s!==null&&dl(this.value.arrayValue,s)}}class v4 extends At{constructor(e,s){super(e,"not-in",s)}matches(e){if(dl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=e.data.field(this.field);return s!==null&&!dl(this.value.arrayValue,s)}}class b4 extends At{constructor(e,s){super(e,"array-contains-any",s)}matches(e){const s=e.data.field(this.field);return!(!Tf(s)||!s.arrayValue.values)&&s.arrayValue.values.some(n=>dl(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4{constructor(e,s=null,n=[],i=[],a=null,o=null,l=null){this.path=e,this.collectionGroup=s,this.orderBy=n,this.filters=i,this.limit=a,this.startAt=o,this.endAt=l,this.ue=null}}function jy(t,e=null,s=[],n=[],i=null,a=null,o=null){return new w4(t,e,s,n,i,a,o)}function Rf(t){const e=Pe(t);if(e.ue===null){let s=e.path.canonicalString();e.collectionGroup!==null&&(s+="|cg:"+e.collectionGroup),s+="|f:",s+=e.filters.map(n=>Zh(n)).join(","),s+="|ob:",s+=e.orderBy.map(n=>function(a){return a.field.canonicalString()+a.dir}(n)).join(","),yu(e.limit)||(s+="|l:",s+=e.limit),e.startAt&&(s+="|lb:",s+=e.startAt.inclusive?"b:":"a:",s+=e.startAt.position.map(n=>_a(n)).join(",")),e.endAt&&(s+="|ub:",s+=e.endAt.inclusive?"a:":"b:",s+=e.endAt.position.map(n=>_a(n)).join(",")),e.ue=s}return e.ue}function Pf(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<t.orderBy.length;s++)if(!m4(t.orderBy[s],e.orderBy[s]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(!aN(t.filters[s],e.filters[s]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!wy(t.startAt,e.startAt)&&wy(t.endAt,e.endAt)}function ep(t){return Se.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(e,s=null,n=[],i=[],a=null,o="F",l=null,d=null){this.path=e,this.collectionGroup=s,this.explicitOrderBy=n,this.filters=i,this.limit=a,this.limitType=o,this.startAt=l,this.endAt=d,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function j4(t,e,s,n,i,a,o,l){return new Da(t,e,s,n,i,a,o,l)}function vu(t){return new Da(t)}function Ny(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function cN(t){return t.collectionGroup!==null}function Ro(t){const e=Pe(t);if(e.ce===null){e.ce=[];const s=new Set;for(const a of e.explicitOrderBy)e.ce.push(a),s.add(a.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new qt(Ut.comparator);return o.filters.forEach(d=>{d.getFlattenedFilters().forEach(u=>{u.isInequality()&&(l=l.add(u.field))})}),l})(e).forEach(a=>{s.has(a.canonicalString())||a.isKeyField()||e.ce.push(new ul(a,n))}),s.has(Ut.keyField().canonicalString())||e.ce.push(new ul(Ut.keyField(),n))}return e.ce}function gr(t){const e=Pe(t);return e.le||(e.le=N4(e,Ro(t))),e.le}function N4(t,e){if(t.limitType==="F")return jy(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const a=i.dir==="desc"?"asc":"desc";return new ul(i.field,a)});const s=t.endAt?new Rd(t.endAt.position,t.endAt.inclusive):null,n=t.startAt?new Rd(t.startAt.position,t.startAt.inclusive):null;return jy(t.path,t.collectionGroup,e,t.filters,t.limit,s,n)}}function tp(t,e){const s=t.filters.concat([e]);return new Da(t.path,t.collectionGroup,t.explicitOrderBy.slice(),s,t.limit,t.limitType,t.startAt,t.endAt)}function Pd(t,e,s){return new Da(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,s,t.startAt,t.endAt)}function bu(t,e){return Pf(gr(t),gr(e))&&t.limitType===e.limitType}function dN(t){return`${Rf(gr(t))}|lt:${t.limitType}`}function Oi(t){return`Query(target=${function(s){let n=s.path.canonicalString();return s.collectionGroup!==null&&(n+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(n+=`, filters: [${s.filters.map(i=>oN(i)).join(", ")}]`),yu(s.limit)||(n+=", limit: "+s.limit),s.orderBy.length>0&&(n+=`, orderBy: [${s.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),s.startAt&&(n+=", startAt: ",n+=s.startAt.inclusive?"b:":"a:",n+=s.startAt.position.map(i=>_a(i)).join(",")),s.endAt&&(n+=", endAt: ",n+=s.endAt.inclusive?"a:":"b:",n+=s.endAt.position.map(i=>_a(i)).join(",")),`Target(${n})`}(gr(t))}; limitType=${t.limitType})`}function wu(t,e){return e.isFoundDocument()&&function(n,i){const a=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(a):Se.isDocumentKey(n.path)?n.path.isEqual(a):n.path.isImmediateParentOf(a)}(t,e)&&function(n,i){for(const a of Ro(n))if(!a.field.isKeyField()&&i.data.field(a.field)===null)return!1;return!0}(t,e)&&function(n,i){for(const a of n.filters)if(!a.matches(i))return!1;return!0}(t,e)&&function(n,i){return!(n.startAt&&!function(o,l,d){const u=by(o,l,d);return o.inclusive?u<=0:u<0}(n.startAt,Ro(n),i)||n.endAt&&!function(o,l,d){const u=by(o,l,d);return o.inclusive?u>=0:u>0}(n.endAt,Ro(n),i))}(t,e)}function _4(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function uN(t){return(e,s)=>{let n=!1;for(const i of Ro(t)){const a=S4(i,e,s);if(a!==0)return a;n=n||i.field.isKeyField()}return 0}}function S4(t,e,s){const n=t.field.isKeyField()?Se.comparator(e.key,s.key):function(a,o,l){const d=o.data.field(a),u=l.data.field(a);return d!==null&&u!==null?Na(d,u):Ie()}(t.field,e,s);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Ie()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,s){this.mapKeyFn=e,this.equalsFn=s,this.inner={},this.innerSize=0}get(e){const s=this.mapKeyFn(e),n=this.inner[s];if(n!==void 0){for(const[i,a]of n)if(this.equalsFn(i,e))return a}}has(e){return this.get(e)!==void 0}set(e,s){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,s]],void this.innerSize++;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return void(i[a]=[e,s]);i.push([e,s]),this.innerSize++}delete(e){const s=this.mapKeyFn(e),n=this.inner[s];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[s]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ci(this.inner,(s,n)=>{for(const[i,a]of n)e(i,a)})}isEmpty(){return eN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4=new xt(Se.comparator);function Kr(){return E4}const mN=new xt(Se.comparator);function go(...t){let e=mN;for(const s of t)e=e.insert(s.key,s);return e}function hN(t){let e=mN;return t.forEach((s,n)=>e=e.insert(s,n.overlayedDocument)),e}function oi(){return Po()}function pN(){return Po()}function Po(){return new Ma(t=>t.toString(),(t,e)=>t.isEqual(e))}const A4=new xt(Se.comparator),I4=new qt(Se.comparator);function ze(...t){let e=I4;for(const s of t)e=e.add(s);return e}const k4=new qt(Ye);function C4(){return k4}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Td(e)?"-0":e}}function fN(t){return{integerValue:""+t}}function T4(t,e){return o4(e)?fN(e):Df(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(){this._=void 0}}function R4(t,e,s){return t instanceof Dd?function(i,a){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return a&&kf(a)&&(a=Cf(a)),a&&(o.fields.__previous_value__=a),{mapValue:o}}(s,e):t instanceof ml?xN(t,e):t instanceof hl?yN(t,e):function(i,a){const o=gN(i,a),l=_y(o)+_y(i.Pe);return Jh(o)&&Jh(i.Pe)?fN(l):Df(i.serializer,l)}(t,e)}function P4(t,e,s){return t instanceof ml?xN(t,e):t instanceof hl?yN(t,e):s}function gN(t,e){return t instanceof Md?function(n){return Jh(n)||function(a){return!!a&&"doubleValue"in a}(n)}(e)?e:{integerValue:0}:null}class Dd extends ju{}class ml extends ju{constructor(e){super(),this.elements=e}}function xN(t,e){const s=vN(e);for(const n of t.elements)s.some(i=>yr(i,n))||s.push(n);return{arrayValue:{values:s}}}class hl extends ju{constructor(e){super(),this.elements=e}}function yN(t,e){let s=vN(e);for(const n of t.elements)s=s.filter(i=>!yr(i,n));return{arrayValue:{values:s}}}class Md extends ju{constructor(e,s){super(),this.serializer=e,this.Pe=s}}function _y(t){return wt(t.integerValue||t.doubleValue)}function vN(t){return Tf(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function D4(t,e){return t.field.isEqual(e.field)&&function(n,i){return n instanceof ml&&i instanceof ml||n instanceof hl&&i instanceof hl?ja(n.elements,i.elements,yr):n instanceof Md&&i instanceof Md?yr(n.Pe,i.Pe):n instanceof Dd&&i instanceof Dd}(t.transform,e.transform)}class M4{constructor(e,s){this.version=e,this.transformResults=s}}class _s{constructor(e,s){this.updateTime=e,this.exists=s}static none(){return new _s}static exists(e){return new _s(void 0,e)}static updateTime(e){return new _s(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wc(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Nu{}function bN(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new _u(t.key,_s.none()):new Pl(t.key,t.data,_s.none());{const s=t.data,n=vs.empty();let i=new qt(Ut.comparator);for(let a of e.fields)if(!i.has(a)){let o=s.field(a);o===null&&a.length>1&&(a=a.popLast(),o=s.field(a)),o===null?n.delete(a):n.set(a,o),i=i.add(a)}return new Qn(t.key,n,new Rs(i.toArray()),_s.none())}}function L4(t,e,s){t instanceof Pl?function(i,a,o){const l=i.value.clone(),d=Ey(i.fieldTransforms,a,o.transformResults);l.setAll(d),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,s):t instanceof Qn?function(i,a,o){if(!Wc(i.precondition,a))return void a.convertToUnknownDocument(o.version);const l=Ey(i.fieldTransforms,a,o.transformResults),d=a.data;d.setAll(wN(i)),d.setAll(l),a.convertToFoundDocument(o.version,d).setHasCommittedMutations()}(t,e,s):function(i,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,s)}function Do(t,e,s,n){return t instanceof Pl?function(a,o,l,d){if(!Wc(a.precondition,o))return l;const u=a.value.clone(),m=Ay(a.fieldTransforms,d,o);return u.setAll(m),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,s,n):t instanceof Qn?function(a,o,l,d){if(!Wc(a.precondition,o))return l;const u=Ay(a.fieldTransforms,d,o),m=o.data;return m.setAll(wN(a)),m.setAll(u),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(h=>h.field))}(t,e,s,n):function(a,o,l){return Wc(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,s)}function V4(t,e){let s=null;for(const n of t.fieldTransforms){const i=e.data.field(n.field),a=gN(n.transform,i||null);a!=null&&(s===null&&(s=vs.empty()),s.set(n.field,a))}return s||null}function Sy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&ja(n,i,(a,o)=>D4(a,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Pl extends Nu{constructor(e,s,n,i=[]){super(),this.key=e,this.value=s,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Qn extends Nu{constructor(e,s,n,i,a=[]){super(),this.key=e,this.data=s,this.fieldMask=n,this.precondition=i,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function wN(t){const e=new Map;return t.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const n=t.data.field(s);e.set(s,n)}}),e}function Ey(t,e,s){const n=new Map;tt(t.length===s.length);for(let i=0;i<s.length;i++){const a=t[i],o=a.transform,l=e.data.field(a.field);n.set(a.field,P4(o,l,s[i]))}return n}function Ay(t,e,s){const n=new Map;for(const i of t){const a=i.transform,o=s.data.field(i.field);n.set(i.field,R4(a,o,e))}return n}class _u extends Nu{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class O4 extends Nu{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(e,s,n,i){this.batchId=e,this.localWriteTime=s,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,s){const n=s.mutationResults;for(let i=0;i<this.mutations.length;i++){const a=this.mutations[i];a.key.isEqual(e.key)&&L4(a,e,n[i])}}applyToLocalView(e,s){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(s=Do(n,e,s,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(s=Do(n,e,s,this.localWriteTime));return s}applyToLocalDocumentSet(e,s){const n=pN();return this.mutations.forEach(i=>{const a=e.get(i.key),o=a.overlayedDocument;let l=this.applyToLocalView(o,a.mutatedFields);l=s.has(i.key)?null:l;const d=bN(o,l);d!==null&&n.set(i.key,d),o.isValidDocument()||o.convertToNoDocument(Re.min())}),n}keys(){return this.mutations.reduce((e,s)=>e.add(s.key),ze())}isEqual(e){return this.batchId===e.batchId&&ja(this.mutations,e.mutations,(s,n)=>Sy(s,n))&&ja(this.baseMutations,e.baseMutations,(s,n)=>Sy(s,n))}}class Mf{constructor(e,s,n,i){this.batch=e,this.commitVersion=s,this.mutationResults=n,this.docVersions=i}static from(e,s,n){tt(e.mutations.length===n.length);let i=function(){return A4}();const a=e.mutations;for(let o=0;o<a.length;o++)i=i.insert(a[o].key,n[o].version);return new Mf(e,s,n,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{constructor(e,s){this.largestBatchId=e,this.mutation=s}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4{constructor(e,s){this.count=e,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t,Ge;function U4(t){switch(t){default:return Ie();case te.CANCELLED:case te.UNKNOWN:case te.DEADLINE_EXCEEDED:case te.RESOURCE_EXHAUSTED:case te.INTERNAL:case te.UNAVAILABLE:case te.UNAUTHENTICATED:return!1;case te.INVALID_ARGUMENT:case te.NOT_FOUND:case te.ALREADY_EXISTS:case te.PERMISSION_DENIED:case te.FAILED_PRECONDITION:case te.ABORTED:case te.OUT_OF_RANGE:case te.UNIMPLEMENTED:case te.DATA_LOSS:return!0}}function jN(t){if(t===void 0)return Hr("GRPC error has no .code"),te.UNKNOWN;switch(t){case _t.OK:return te.OK;case _t.CANCELLED:return te.CANCELLED;case _t.UNKNOWN:return te.UNKNOWN;case _t.DEADLINE_EXCEEDED:return te.DEADLINE_EXCEEDED;case _t.RESOURCE_EXHAUSTED:return te.RESOURCE_EXHAUSTED;case _t.INTERNAL:return te.INTERNAL;case _t.UNAVAILABLE:return te.UNAVAILABLE;case _t.UNAUTHENTICATED:return te.UNAUTHENTICATED;case _t.INVALID_ARGUMENT:return te.INVALID_ARGUMENT;case _t.NOT_FOUND:return te.NOT_FOUND;case _t.ALREADY_EXISTS:return te.ALREADY_EXISTS;case _t.PERMISSION_DENIED:return te.PERMISSION_DENIED;case _t.FAILED_PRECONDITION:return te.FAILED_PRECONDITION;case _t.ABORTED:return te.ABORTED;case _t.OUT_OF_RANGE:return te.OUT_OF_RANGE;case _t.UNIMPLEMENTED:return te.UNIMPLEMENTED;case _t.DATA_LOSS:return te.DATA_LOSS;default:return Ie()}}(Ge=_t||(_t={}))[Ge.OK=0]="OK",Ge[Ge.CANCELLED=1]="CANCELLED",Ge[Ge.UNKNOWN=2]="UNKNOWN",Ge[Ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ge[Ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ge[Ge.NOT_FOUND=5]="NOT_FOUND",Ge[Ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ge[Ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ge[Ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ge[Ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ge[Ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ge[Ge.ABORTED=10]="ABORTED",Ge[Ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ge[Ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ge[Ge.INTERNAL=13]="INTERNAL",Ge[Ge.UNAVAILABLE=14]="UNAVAILABLE",Ge[Ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B4(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q4=new di([4294967295,4294967295],0);function Iy(t){const e=B4().encode(t),s=new Wj;return s.update(e),new Uint8Array(s.digest())}function ky(t){const e=new DataView(t.buffer),s=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new di([s,n],0),new di([i,a],0)]}class Lf{constructor(e,s,n){if(this.bitmap=e,this.padding=s,this.hashCount=n,s<0||s>=8)throw new xo(`Invalid padding: ${s}`);if(n<0)throw new xo(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new xo(`Invalid hash count: ${n}`);if(e.length===0&&s!==0)throw new xo(`Invalid padding when bitmap length is 0: ${s}`);this.Ie=8*e.length-s,this.Te=di.fromNumber(this.Ie)}Ee(e,s,n){let i=e.add(s.multiply(di.fromNumber(n)));return i.compare(q4)===1&&(i=new di([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const s=Iy(e),[n,i]=ky(s);for(let a=0;a<this.hashCount;a++){const o=this.Ee(n,i,a);if(!this.de(o))return!1}return!0}static create(e,s,n){const i=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Lf(a,i,s);return n.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;const s=Iy(e),[n,i]=ky(s);for(let a=0;a<this.hashCount;a++){const o=this.Ee(n,i,a);this.Ae(o)}}Ae(e){const s=Math.floor(e/8),n=e%8;this.bitmap[s]|=1<<n}}class xo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e,s,n,i,a){this.snapshotVersion=e,this.targetChanges=s,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,s,n){const i=new Map;return i.set(e,Dl.createSynthesizedTargetChangeForCurrentChange(e,s,n)),new Su(Re.min(),i,new xt(Ye),Kr(),ze())}}class Dl{constructor(e,s,n,i,a){this.resumeToken=e,this.current=s,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,s,n){return new Dl(n,s,ze(),ze(),ze())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,s,n,i){this.Re=e,this.removedTargetIds=s,this.key=n,this.Ve=i}}class NN{constructor(e,s){this.targetId=e,this.me=s}}class _N{constructor(e,s,n=Wt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=s,this.resumeToken=n,this.cause=i}}class Cy{constructor(){this.fe=0,this.ge=Ry(),this.pe=Wt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ze(),s=ze(),n=ze();return this.ge.forEach((i,a)=>{switch(a){case 0:e=e.add(i);break;case 2:s=s.add(i);break;case 1:n=n.add(i);break;default:Ie()}}),new Dl(this.pe,this.ye,e,s,n)}Ce(){this.we=!1,this.ge=Ry()}Fe(e,s){this.we=!0,this.ge=this.ge.insert(e,s)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,tt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class G4{constructor(e){this.Le=e,this.Be=new Map,this.ke=Kr(),this.qe=Ty(),this.Qe=new xt(Ye)}Ke(e){for(const s of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(s,e.Ve):this.Ue(s,e.key,e.Ve);for(const s of e.removedTargetIds)this.Ue(s,e.key,e.Ve)}We(e){this.forEachTarget(e,s=>{const n=this.Ge(s);switch(e.state){case 0:this.ze(s)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(s);break;case 3:this.ze(s)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(s)&&(this.je(s),n.De(e.resumeToken));break;default:Ie()}})}forEachTarget(e,s){e.targetIds.length>0?e.targetIds.forEach(s):this.Be.forEach((n,i)=>{this.ze(i)&&s(i)})}He(e){const s=e.targetId,n=e.me.count,i=this.Je(s);if(i){const a=i.target;if(ep(a))if(n===0){const o=new Se(a.path);this.Ue(s,o,es.newNoDocument(o,Re.min()))}else tt(n===1);else{const o=this.Ye(s);if(o!==n){const l=this.Ze(e),d=l?this.Xe(l,e,o):1;if(d!==0){this.je(s);const u=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(s,u)}}}}}Ze(e){const s=e.me.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:a=0}=s;let o,l;try{o=vi(n).toUint8Array()}catch(d){if(d instanceof tN)return wa("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{l=new Lf(o,i,a)}catch(d){return wa(d instanceof xo?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return l.Ie===0?null:l}Xe(e,s,n){return s.me.count===n-this.nt(e,s.targetId)?0:2}nt(e,s){const n=this.Le.getRemoteKeysForTarget(s);let i=0;return n.forEach(a=>{const o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.Ue(s,a,null),i++)}),i}rt(e){const s=new Map;this.Be.forEach((a,o)=>{const l=this.Je(o);if(l){if(a.current&&ep(l.target)){const d=new Se(l.target.path);this.ke.get(d)!==null||this.it(o,d)||this.Ue(o,d,es.newNoDocument(d,e))}a.be&&(s.set(o,a.ve()),a.Ce())}});let n=ze();this.qe.forEach((a,o)=>{let l=!0;o.forEachWhile(d=>{const u=this.Je(d);return!u||u.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(n=n.add(a))}),this.ke.forEach((a,o)=>o.setReadTime(e));const i=new Su(e,s,this.Qe,this.ke,n);return this.ke=Kr(),this.qe=Ty(),this.Qe=new xt(Ye),i}$e(e,s){if(!this.ze(e))return;const n=this.it(e,s.key)?2:0;this.Ge(e).Fe(s.key,n),this.ke=this.ke.insert(s.key,s),this.qe=this.qe.insert(s.key,this.st(s.key).add(e))}Ue(e,s,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,s)?i.Fe(s,1):i.Me(s),this.qe=this.qe.insert(s,this.st(s).delete(e)),n&&(this.ke=this.ke.insert(s,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const s=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+s.addedDocuments.size-s.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let s=this.Be.get(e);return s||(s=new Cy,this.Be.set(e,s)),s}st(e){let s=this.qe.get(e);return s||(s=new qt(Ye),this.qe=this.qe.insert(e,s)),s}ze(e){const s=this.Je(e)!==null;return s||ve("WatchChangeAggregator","Detected inactive target",e),s}Je(e){const s=this.Be.get(e);return s&&s.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Cy),this.Le.getRemoteKeysForTarget(e).forEach(s=>{this.Ue(e,s,null)})}it(e,s){return this.Le.getRemoteKeysForTarget(e).has(s)}}function Ty(){return new xt(Se.comparator)}function Ry(){return new xt(Se.comparator)}const W4={asc:"ASCENDING",desc:"DESCENDING"},H4={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},K4={and:"AND",or:"OR"};class Q4{constructor(e,s){this.databaseId=e,this.useProto3Json=s}}function sp(t,e){return t.useProto3Json||yu(e)?e:{value:e}}function Ld(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function SN(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Y4(t,e){return Ld(t,e.toTimestamp())}function xr(t){return tt(!!t),Re.fromTimestamp(function(s){const n=On(s);return new J(n.seconds,n.nanos)}(t))}function Vf(t,e){return rp(t,e).canonicalString()}function rp(t,e){const s=function(i){return new lt(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?s:s.child(e)}function EN(t){const e=lt.fromString(t);return tt(TN(e)),e}function np(t,e){return Vf(t.databaseId,e.path)}function Om(t,e){const s=EN(e);if(s.get(1)!==t.databaseId.projectId)throw new ge(te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+t.databaseId.projectId);if(s.get(3)!==t.databaseId.database)throw new ge(te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+t.databaseId.database);return new Se(IN(s))}function AN(t,e){return Vf(t.databaseId,e)}function X4(t){const e=EN(t);return e.length===4?lt.emptyPath():IN(e)}function ip(t){return new lt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function IN(t){return tt(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Py(t,e,s){return{name:np(t,e),fields:s.value.mapValue.fields}}function J4(t,e){let s;if("targetChange"in e){e.targetChange;const n=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Ie()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],a=function(u,m){return u.useProto3Json?(tt(m===void 0||typeof m=="string"),Wt.fromBase64String(m||"")):(tt(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Wt.fromUint8Array(m||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(u){const m=u.code===void 0?te.UNKNOWN:jN(u.code);return new ge(m,u.message||"")}(o);s=new _N(n,i,a,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const i=Om(t,n.document.name),a=xr(n.document.updateTime),o=n.document.createTime?xr(n.document.createTime):Re.min(),l=new vs({mapValue:{fields:n.document.fields}}),d=es.newFoundDocument(i,a,o,l),u=n.targetIds||[],m=n.removedTargetIds||[];s=new Hc(u,m,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const i=Om(t,n.document),a=n.readTime?xr(n.readTime):Re.min(),o=es.newNoDocument(i,a),l=n.removedTargetIds||[];s=new Hc([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const i=Om(t,n.document),a=n.removedTargetIds||[];s=new Hc([],a,i,null)}else{if(!("filter"in e))return Ie();{e.filter;const n=e.filter;n.targetId;const{count:i=0,unchangedNames:a}=n,o=new z4(i,a),l=n.targetId;s=new NN(l,o)}}return s}function Z4(t,e){let s;if(e instanceof Pl)s={update:Py(t,e.key,e.value)};else if(e instanceof _u)s={delete:np(t,e.key)};else if(e instanceof Qn)s={update:Py(t,e.key,e.data),updateMask:lR(e.fieldMask)};else{if(!(e instanceof O4))return Ie();s={verify:np(t,e.key)}}return e.fieldTransforms.length>0&&(s.updateTransforms=e.fieldTransforms.map(n=>function(a,o){const l=o.transform;if(l instanceof Dd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ml)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof hl)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Md)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw Ie()}(0,n))),e.precondition.isNone||(s.currentDocument=function(i,a){return a.updateTime!==void 0?{updateTime:Y4(i,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Ie()}(t,e.precondition)),s}function eR(t,e){return t&&t.length>0?(tt(e!==void 0),t.map(s=>function(i,a){let o=i.updateTime?xr(i.updateTime):xr(a);return o.isEqual(Re.min())&&(o=xr(a)),new M4(o,i.transformResults||[])}(s,e))):[]}function tR(t,e){return{documents:[AN(t,e.path)]}}function sR(t,e){const s={structuredQuery:{}},n=e.path;let i;e.collectionGroup!==null?(i=n,s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),s.structuredQuery.from=[{collectionId:n.lastSegment()}]),s.parent=AN(t,i);const a=function(u){if(u.length!==0)return CN(ar.create(u,"and"))}(e.filters);a&&(s.structuredQuery.where=a);const o=function(u){if(u.length!==0)return u.map(m=>function(f){return{field:Fi(f.field),direction:iR(f.dir)}}(m))}(e.orderBy);o&&(s.structuredQuery.orderBy=o);const l=sp(t,e.limit);return l!==null&&(s.structuredQuery.limit=l),e.startAt&&(s.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(s.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:s,parent:i}}function rR(t){let e=X4(t.parent);const s=t.structuredQuery,n=s.from?s.from.length:0;let i=null;if(n>0){tt(n===1);const m=s.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let a=[];s.where&&(a=function(h){const f=kN(h);return f instanceof ar&&iN(f)?f.getFilters():[f]}(s.where));let o=[];s.orderBy&&(o=function(h){return h.map(f=>function(y){return new ul($i(y.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(s.orderBy));let l=null;s.limit&&(l=function(h){let f;return f=typeof h=="object"?h.value:h,yu(f)?null:f}(s.limit));let d=null;s.startAt&&(d=function(h){const f=!!h.before,x=h.values||[];return new Rd(x,f)}(s.startAt));let u=null;return s.endAt&&(u=function(h){const f=!h.before,x=h.values||[];return new Rd(x,f)}(s.endAt)),j4(e,i,o,a,l,"F",d,u)}function nR(t,e){const s=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ie()}}(e.purpose);return s==null?null:{"goog-listen-tags":s}}function kN(t){return t.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const n=$i(s.unaryFilter.field);return At.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=$i(s.unaryFilter.field);return At.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=$i(s.unaryFilter.field);return At.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=$i(s.unaryFilter.field);return At.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ie()}}(t):t.fieldFilter!==void 0?function(s){return At.create($i(s.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ie()}}(s.fieldFilter.op),s.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(s){return ar.create(s.compositeFilter.filters.map(n=>kN(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ie()}}(s.compositeFilter.op))}(t):Ie()}function iR(t){return W4[t]}function aR(t){return H4[t]}function oR(t){return K4[t]}function Fi(t){return{fieldPath:t.canonicalString()}}function $i(t){return Ut.fromServerFormat(t.fieldPath)}function CN(t){return t instanceof At?function(s){if(s.op==="=="){if(vy(s.value))return{unaryFilter:{field:Fi(s.field),op:"IS_NAN"}};if(yy(s.value))return{unaryFilter:{field:Fi(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(vy(s.value))return{unaryFilter:{field:Fi(s.field),op:"IS_NOT_NAN"}};if(yy(s.value))return{unaryFilter:{field:Fi(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fi(s.field),op:aR(s.op),value:s.value}}}(t):t instanceof ar?function(s){const n=s.getFilters().map(i=>CN(i));return n.length===1?n[0]:{compositeFilter:{op:oR(s.op),filters:n}}}(t):Ie()}function lR(t){const e=[];return t.fields.forEach(s=>e.push(s.canonicalString())),{fieldPaths:e}}function TN(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e,s,n,i,a=Re.min(),o=Re.min(),l=Wt.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=s,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=d}withSequenceNumber(e){return new bn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,s){return new bn(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(e){this.ct=e}}function dR(t){const e=rR({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Pd(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(){this.un=new mR}addToCollectionParentIndex(e,s){return this.un.add(s),ie.resolve()}getCollectionParents(e,s){return ie.resolve(this.un.getEntries(s))}addFieldIndex(e,s){return ie.resolve()}deleteFieldIndex(e,s){return ie.resolve()}deleteAllFieldIndexes(e){return ie.resolve()}createTargetIndexes(e,s){return ie.resolve()}getDocumentsMatchingTarget(e,s){return ie.resolve(null)}getIndexType(e,s){return ie.resolve(0)}getFieldIndexes(e,s){return ie.resolve([])}getNextCollectionGroupToUpdate(e){return ie.resolve(null)}getMinOffset(e,s){return ie.resolve(Vn.min())}getMinOffsetFromCollectionGroup(e,s){return ie.resolve(Vn.min())}updateCollectionGroup(e,s,n){return ie.resolve()}updateIndexEntries(e,s){return ie.resolve()}}class mR{constructor(){this.index={}}add(e){const s=e.lastSegment(),n=e.popLast(),i=this.index[s]||new qt(lt.comparator),a=!i.has(n);return this.index[s]=i.add(n),a}has(e){const s=e.lastSegment(),n=e.popLast(),i=this.index[s];return i&&i.has(n)}getEntries(e){return(this.index[e]||new qt(lt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Sa(0)}static kn(){return new Sa(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(){this.changes=new Ma(e=>e.toString(),(e,s)=>e.isEqual(s)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,s){this.assertNotApplied(),this.changes.set(e,es.newInvalidDocument(e).setReadTime(s))}getEntry(e,s){this.assertNotApplied();const n=this.changes.get(s);return n!==void 0?ie.resolve(n):this.getFromCache(e,s)}getEntries(e,s){return this.getAllFromCache(e,s)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(e,s){this.overlayedDocument=e,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(e,s,n,i){this.remoteDocumentCache=e,this.mutationQueue=s,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,s){let n=null;return this.documentOverlayCache.getOverlay(e,s).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,s))).next(i=>(n!==null&&Do(n.mutation,i,Rs.empty(),J.now()),i))}getDocuments(e,s){return this.remoteDocumentCache.getEntries(e,s).next(n=>this.getLocalViewOfDocuments(e,n,ze()).next(()=>n))}getLocalViewOfDocuments(e,s,n=ze()){const i=oi();return this.populateOverlays(e,i,s).next(()=>this.computeViews(e,s,i,n).next(a=>{let o=go();return a.forEach((l,d)=>{o=o.insert(l,d.overlayedDocument)}),o}))}getOverlayedDocuments(e,s){const n=oi();return this.populateOverlays(e,n,s).next(()=>this.computeViews(e,s,n,ze()))}populateOverlays(e,s,n){const i=[];return n.forEach(a=>{s.has(a)||i.push(a)}),this.documentOverlayCache.getOverlays(e,i).next(a=>{a.forEach((o,l)=>{s.set(o,l)})})}computeViews(e,s,n,i){let a=Kr();const o=Po(),l=function(){return Po()}();return s.forEach((d,u)=>{const m=n.get(u.key);i.has(u.key)&&(m===void 0||m.mutation instanceof Qn)?a=a.insert(u.key,u):m!==void 0?(o.set(u.key,m.mutation.getFieldMask()),Do(m.mutation,u,m.mutation.getFieldMask(),J.now())):o.set(u.key,Rs.empty())}),this.recalculateAndSaveOverlays(e,a).next(d=>(d.forEach((u,m)=>o.set(u,m)),s.forEach((u,m)=>{var h;return l.set(u,new pR(m,(h=o.get(u))!==null&&h!==void 0?h:null))}),l))}recalculateAndSaveOverlays(e,s){const n=Po();let i=new xt((o,l)=>o-l),a=ze();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,s).next(o=>{for(const l of o)l.keys().forEach(d=>{const u=s.get(d);if(u===null)return;let m=n.get(d)||Rs.empty();m=l.applyToLocalView(u,m),n.set(d,m);const h=(i.get(l.batchId)||ze()).add(d);i=i.insert(l.batchId,h)})}).next(()=>{const o=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),u=d.key,m=d.value,h=pN();m.forEach(f=>{if(!a.has(f)){const x=bN(s.get(f),n.get(f));x!==null&&h.set(f,x),a=a.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return ie.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,s){return this.remoteDocumentCache.getEntries(e,s).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,s,n,i){return function(o){return Se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(e,s.path):cN(s)?this.getDocumentsMatchingCollectionGroupQuery(e,s,n,i):this.getDocumentsMatchingCollectionQuery(e,s,n,i)}getNextDocuments(e,s,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,s,n,i).next(a=>{const o=i-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,s,n.largestBatchId,i-a.size):ie.resolve(oi());let l=-1,d=a;return o.next(u=>ie.forEach(u,(m,h)=>(l<h.largestBatchId&&(l=h.largestBatchId),a.get(m)?ie.resolve():this.remoteDocumentCache.getEntry(e,m).next(f=>{d=d.insert(m,f)}))).next(()=>this.populateOverlays(e,u,a)).next(()=>this.computeViews(e,d,u,ze())).next(m=>({batchId:l,changes:hN(m)})))})}getDocumentsMatchingDocumentQuery(e,s){return this.getDocument(e,new Se(s)).next(n=>{let i=go();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,s,n,i){const a=s.collectionGroup;let o=go();return this.indexManager.getCollectionParents(e,a).next(l=>ie.forEach(l,d=>{const u=function(h,f){return new Da(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(s,d.child(a));return this.getDocumentsMatchingCollectionQuery(e,u,n,i).next(m=>{m.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,s,n,i){let a;return this.documentOverlayCache.getOverlaysForCollection(e,s.path,n.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,s,n,a,i))).next(o=>{a.forEach((d,u)=>{const m=u.getKey();o.get(m)===null&&(o=o.insert(m,es.newInvalidDocument(m)))});let l=go();return o.forEach((d,u)=>{const m=a.get(d);m!==void 0&&Do(m.mutation,u,Rs.empty(),J.now()),wu(s,u)&&(l=l.insert(d,u))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,s){return ie.resolve(this.hr.get(s))}saveBundleMetadata(e,s){return this.hr.set(s.id,function(i){return{id:i.id,version:i.version,createTime:xr(i.createTime)}}(s)),ie.resolve()}getNamedQuery(e,s){return ie.resolve(this.Pr.get(s))}saveNamedQuery(e,s){return this.Pr.set(s.name,function(i){return{name:i.name,query:dR(i.bundledQuery),readTime:xr(i.readTime)}}(s)),ie.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(){this.overlays=new xt(Se.comparator),this.Ir=new Map}getOverlay(e,s){return ie.resolve(this.overlays.get(s))}getOverlays(e,s){const n=oi();return ie.forEach(s,i=>this.getOverlay(e,i).next(a=>{a!==null&&n.set(i,a)})).next(()=>n)}saveOverlays(e,s,n){return n.forEach((i,a)=>{this.ht(e,s,a)}),ie.resolve()}removeOverlaysForBatchId(e,s,n){const i=this.Ir.get(n);return i!==void 0&&(i.forEach(a=>this.overlays=this.overlays.remove(a)),this.Ir.delete(n)),ie.resolve()}getOverlaysForCollection(e,s,n){const i=oi(),a=s.length+1,o=new Se(s.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const d=l.getNext().value,u=d.getKey();if(!s.isPrefixOf(u.path))break;u.path.length===a&&d.largestBatchId>n&&i.set(d.getKey(),d)}return ie.resolve(i)}getOverlaysForCollectionGroup(e,s,n,i){let a=new xt((u,m)=>u-m);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===s&&u.largestBatchId>n){let m=a.get(u.largestBatchId);m===null&&(m=oi(),a=a.insert(u.largestBatchId,m)),m.set(u.getKey(),u)}}const l=oi(),d=a.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((u,m)=>l.set(u,m)),!(l.size()>=i)););return ie.resolve(l)}ht(e,s,n){const i=this.overlays.get(n.key);if(i!==null){const o=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new $4(s,n));let a=this.Ir.get(s);a===void 0&&(a=ze(),this.Ir.set(s,a)),this.Ir.set(s,a.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(){this.sessionToken=Wt.EMPTY_BYTE_STRING}getSessionToken(e){return ie.resolve(this.sessionToken)}setSessionToken(e,s){return this.sessionToken=s,ie.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(){this.Tr=new qt(Pt.Er),this.dr=new qt(Pt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,s){const n=new Pt(e,s);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,s){e.forEach(n=>this.addReference(n,s))}removeReference(e,s){this.Vr(new Pt(e,s))}mr(e,s){e.forEach(n=>this.removeReference(n,s))}gr(e){const s=new Se(new lt([])),n=new Pt(s,e),i=new Pt(s,e+1),a=[];return this.dr.forEachInRange([n,i],o=>{this.Vr(o),a.push(o.key)}),a}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const s=new Se(new lt([])),n=new Pt(s,e),i=new Pt(s,e+1);let a=ze();return this.dr.forEachInRange([n,i],o=>{a=a.add(o.key)}),a}containsKey(e){const s=new Pt(e,0),n=this.Tr.firstAfterOrEqual(s);return n!==null&&e.isEqual(n.key)}}class Pt{constructor(e,s){this.key=e,this.wr=s}static Er(e,s){return Se.comparator(e.key,s.key)||Ye(e.wr,s.wr)}static Ar(e,s){return Ye(e.wr,s.wr)||Se.comparator(e.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,s){this.indexManager=e,this.referenceDelegate=s,this.mutationQueue=[],this.Sr=1,this.br=new qt(Pt.Er)}checkEmpty(e){return ie.resolve(this.mutationQueue.length===0)}addMutationBatch(e,s,n,i){const a=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new F4(a,s,n,i);this.mutationQueue.push(o);for(const l of i)this.br=this.br.add(new Pt(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ie.resolve(o)}lookupMutationBatch(e,s){return ie.resolve(this.Dr(s))}getNextMutationBatchAfterBatchId(e,s){const n=s+1,i=this.vr(n),a=i<0?0:i;return ie.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return ie.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return ie.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,s){const n=new Pt(s,0),i=new Pt(s,Number.POSITIVE_INFINITY),a=[];return this.br.forEachInRange([n,i],o=>{const l=this.Dr(o.wr);a.push(l)}),ie.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,s){let n=new qt(Ye);return s.forEach(i=>{const a=new Pt(i,0),o=new Pt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([a,o],l=>{n=n.add(l.wr)})}),ie.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,s){const n=s.path,i=n.length+1;let a=n;Se.isDocumentKey(a)||(a=a.child(""));const o=new Pt(new Se(a),0);let l=new qt(Ye);return this.br.forEachWhile(d=>{const u=d.key.path;return!!n.isPrefixOf(u)&&(u.length===i&&(l=l.add(d.wr)),!0)},o),ie.resolve(this.Cr(l))}Cr(e){const s=[];return e.forEach(n=>{const i=this.Dr(n);i!==null&&s.push(i)}),s}removeMutationBatch(e,s){tt(this.Fr(s.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return ie.forEach(s.mutations,i=>{const a=new Pt(i.key,s.batchId);return n=n.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,s){const n=new Pt(s,0),i=this.br.firstAfterOrEqual(n);return ie.resolve(s.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ie.resolve()}Fr(e,s){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const s=this.vr(e);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(e){this.Mr=e,this.docs=function(){return new xt(Se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,s){const n=s.key,i=this.docs.get(n),a=i?i.size:0,o=this.Mr(s);return this.docs=this.docs.insert(n,{document:s.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const s=this.docs.get(e);s&&(this.docs=this.docs.remove(e),this.size-=s.size)}getEntry(e,s){const n=this.docs.get(s);return ie.resolve(n?n.document.mutableCopy():es.newInvalidDocument(s))}getEntries(e,s){let n=Kr();return s.forEach(i=>{const a=this.docs.get(i);n=n.insert(i,a?a.document.mutableCopy():es.newInvalidDocument(i))}),ie.resolve(n)}getDocumentsMatchingQuery(e,s,n,i){let a=Kr();const o=s.path,l=new Se(o.child("")),d=this.docs.getIteratorFrom(l);for(;d.hasNext();){const{key:u,value:{document:m}}=d.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||r4(s4(m),n)<=0||(i.has(m.key)||wu(s,m))&&(a=a.insert(m.key,m.mutableCopy()))}return ie.resolve(a)}getAllFromCollectionGroup(e,s,n,i){Ie()}Or(e,s){return ie.forEach(this.docs,n=>s(n))}newChangeBuffer(e){return new wR(this)}getSize(e){return ie.resolve(this.size)}}class wR extends hR{constructor(e){super(),this.cr=e}applyChanges(e){const s=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?s.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),ie.waitFor(s)}getFromCache(e,s){return this.cr.getEntry(e,s)}getAllFromCache(e,s){return this.cr.getEntries(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e){this.persistence=e,this.Nr=new Ma(s=>Rf(s),Pf),this.lastRemoteSnapshotVersion=Re.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Of,this.targetCount=0,this.kr=Sa.Bn()}forEachTarget(e,s){return this.Nr.forEach((n,i)=>s(i)),ie.resolve()}getLastRemoteSnapshotVersion(e){return ie.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ie.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ie.resolve(this.highestTargetId)}setTargetsMetadata(e,s,n){return n&&(this.lastRemoteSnapshotVersion=n),s>this.Lr&&(this.Lr=s),ie.resolve()}Kn(e){this.Nr.set(e.target,e);const s=e.targetId;s>this.highestTargetId&&(this.kr=new Sa(s),this.highestTargetId=s),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,s){return this.Kn(s),this.targetCount+=1,ie.resolve()}updateTargetData(e,s){return this.Kn(s),ie.resolve()}removeTargetData(e,s){return this.Nr.delete(s.target),this.Br.gr(s.targetId),this.targetCount-=1,ie.resolve()}removeTargets(e,s,n){let i=0;const a=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=s&&n.get(l.targetId)===null&&(this.Nr.delete(o),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),ie.waitFor(a).next(()=>i)}getTargetCount(e){return ie.resolve(this.targetCount)}getTargetData(e,s){const n=this.Nr.get(s)||null;return ie.resolve(n)}addMatchingKeys(e,s,n){return this.Br.Rr(s,n),ie.resolve()}removeMatchingKeys(e,s,n){this.Br.mr(s,n);const i=this.persistence.referenceDelegate,a=[];return i&&s.forEach(o=>{a.push(i.markPotentiallyOrphaned(e,o))}),ie.waitFor(a)}removeMatchingKeysForTargetId(e,s){return this.Br.gr(s),ie.resolve()}getMatchingKeysForTargetId(e,s){const n=this.Br.yr(s);return ie.resolve(n)}containsKey(e,s){return ie.resolve(this.Br.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,s){this.qr={},this.overlays={},this.Qr=new If(0),this.Kr=!1,this.Kr=!0,this.$r=new yR,this.referenceDelegate=e(this),this.Ur=new jR(this),this.indexManager=new uR,this.remoteDocumentCache=function(i){return new bR(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new cR(s),this.Gr=new gR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let s=this.overlays[e.toKey()];return s||(s=new xR,this.overlays[e.toKey()]=s),s}getMutationQueue(e,s){let n=this.qr[e.toKey()];return n||(n=new vR(s,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,s,n){ve("MemoryPersistence","Starting transaction:",e);const i=new _R(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(a=>this.referenceDelegate.jr(i).next(()=>a)).toPromise().then(a=>(i.raiseOnCommittedEvent(),a))}Hr(e,s){return ie.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,s)))}}class _R extends i4{constructor(e){super(),this.currentSequenceNumber=e}}class Ff{constructor(e){this.persistence=e,this.Jr=new Of,this.Yr=null}static Zr(e){return new Ff(e)}get Xr(){if(this.Yr)return this.Yr;throw Ie()}addReference(e,s,n){return this.Jr.addReference(n,s),this.Xr.delete(n.toString()),ie.resolve()}removeReference(e,s,n){return this.Jr.removeReference(n,s),this.Xr.add(n.toString()),ie.resolve()}markPotentiallyOrphaned(e,s){return this.Xr.add(s.toString()),ie.resolve()}removeTarget(e,s){this.Jr.gr(s.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,s.targetId).next(i=>{i.forEach(a=>this.Xr.add(a.toString()))}).next(()=>n.removeTargetData(e,s))}zr(){this.Yr=new Set}jr(e){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ie.forEach(this.Xr,n=>{const i=Se.fromPath(n);return this.ei(e,i).next(a=>{a||s.removeEntry(i,Re.min())})}).next(()=>(this.Yr=null,s.apply(e)))}updateLimboDocument(e,s){return this.ei(e,s).next(n=>{n?this.Xr.delete(s.toString()):this.Xr.add(s.toString())})}Wr(e){return 0}ei(e,s){return ie.or([()=>ie.resolve(this.Jr.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(e,s),()=>this.persistence.Hr(e,s)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e,s,n,i){this.targetId=e,this.fromCache=s,this.$i=n,this.Ui=i}static Wi(e,s){let n=ze(),i=ze();for(const a of s.docChanges)switch(a.type){case 0:n=n.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}return new $f(e,s.fromCache,n,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return pI()?8:a4(rs())>0?6:4}()}initialize(e,s){this.Ji=e,this.indexManager=s,this.Gi=!0}getDocumentsMatchingQuery(e,s,n,i){const a={result:null};return this.Yi(e,s).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.Zi(e,s,i,n).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new SR;return this.Xi(e,s,o).next(l=>{if(a.result=l,this.zi)return this.es(e,s,o,l.size)})}).next(()=>a.result)}es(e,s,n,i){return n.documentReadCount<this.ji?(oo()<=Ue.DEBUG&&ve("QueryEngine","SDK will not create cache indexes for query:",Oi(s),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ie.resolve()):(oo()<=Ue.DEBUG&&ve("QueryEngine","Query:",Oi(s),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(oo()<=Ue.DEBUG&&ve("QueryEngine","The SDK decides to create cache indexes for query:",Oi(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gr(s))):ie.resolve())}Yi(e,s){if(Ny(s))return ie.resolve(null);let n=gr(s);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(s.limit!==null&&i===1&&(s=Pd(s,null,"F"),n=gr(s)),this.indexManager.getDocumentsMatchingTarget(e,n).next(a=>{const o=ze(...a);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,n).next(d=>{const u=this.ts(s,l);return this.ns(s,u,o,d.readTime)?this.Yi(e,Pd(s,null,"F")):this.rs(e,u,s,d)}))})))}Zi(e,s,n,i){return Ny(s)||i.isEqual(Re.min())?ie.resolve(null):this.Ji.getDocuments(e,n).next(a=>{const o=this.ts(s,a);return this.ns(s,o,n,i)?ie.resolve(null):(oo()<=Ue.DEBUG&&ve("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Oi(s)),this.rs(e,o,s,t4(i,-1)).next(l=>l))})}ts(e,s){let n=new qt(uN(e));return s.forEach((i,a)=>{wu(e,a)&&(n=n.add(a))}),n}ns(e,s,n,i){if(e.limit===null)return!1;if(n.size!==s.size)return!0;const a=e.limitType==="F"?s.last():s.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(i)>0)}Xi(e,s,n){return oo()<=Ue.DEBUG&&ve("QueryEngine","Using full collection scan to execute query:",Oi(s)),this.Ji.getDocumentsMatchingQuery(e,s,Vn.min(),n)}rs(e,s,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(a=>(s.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,s,n,i){this.persistence=e,this.ss=s,this.serializer=i,this.os=new xt(Ye),this._s=new Ma(a=>Rf(a),Pf),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fR(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>e.collect(s,this.os))}}function IR(t,e,s,n){return new AR(t,e,s,n)}async function RN(t,e){const s=Pe(t);return await s.persistence.runTransaction("Handle user change","readonly",n=>{let i;return s.mutationQueue.getAllMutationBatches(n).next(a=>(i=a,s.ls(e),s.mutationQueue.getAllMutationBatches(n))).next(a=>{const o=[],l=[];let d=ze();for(const u of i){o.push(u.batchId);for(const m of u.mutations)d=d.add(m.key)}for(const u of a){l.push(u.batchId);for(const m of u.mutations)d=d.add(m.key)}return s.localDocuments.getDocuments(n,d).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:l}))})})}function kR(t,e){const s=Pe(t);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),a=s.cs.newChangeBuffer({trackRemovals:!0});return function(l,d,u,m){const h=u.batch,f=h.keys();let x=ie.resolve();return f.forEach(y=>{x=x.next(()=>m.getEntry(d,y)).next(P=>{const _=u.docVersions.get(y);tt(_!==null),P.version.compareTo(_)<0&&(h.applyToRemoteDocument(P,u),P.isValidDocument()&&(P.setReadTime(u.commitVersion),m.addEntry(P)))})}),x.next(()=>l.mutationQueue.removeMutationBatch(d,h))}(s,n,e,a).next(()=>a.apply(n)).next(()=>s.mutationQueue.performConsistencyCheck(n)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(l){let d=ze();for(let u=0;u<l.mutationResults.length;++u)l.mutationResults[u].transformResults.length>0&&(d=d.add(l.batch.mutations[u].key));return d}(e))).next(()=>s.localDocuments.getDocuments(n,i))})}function PN(t){const e=Pe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",s=>e.Ur.getLastRemoteSnapshotVersion(s))}function CR(t,e){const s=Pe(t),n=e.snapshotVersion;let i=s.os;return s.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=s.cs.newChangeBuffer({trackRemovals:!0});i=s.os;const l=[];e.targetChanges.forEach((m,h)=>{const f=i.get(h);if(!f)return;l.push(s.Ur.removeMatchingKeys(a,m.removedDocuments,h).next(()=>s.Ur.addMatchingKeys(a,m.addedDocuments,h)));let x=f.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(h)!==null?x=x.withResumeToken(Wt.EMPTY_BYTE_STRING,Re.min()).withLastLimboFreeSnapshotVersion(Re.min()):m.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(m.resumeToken,n)),i=i.insert(h,x),function(P,_,C){return P.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0}(f,x,m)&&l.push(s.Ur.updateTargetData(a,x))});let d=Kr(),u=ze();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&l.push(s.persistence.referenceDelegate.updateLimboDocument(a,m))}),l.push(TR(a,o,e.documentUpdates).next(m=>{d=m.Ps,u=m.Is})),!n.isEqual(Re.min())){const m=s.Ur.getLastRemoteSnapshotVersion(a).next(h=>s.Ur.setTargetsMetadata(a,a.currentSequenceNumber,n));l.push(m)}return ie.waitFor(l).next(()=>o.apply(a)).next(()=>s.localDocuments.getLocalViewOfDocuments(a,d,u)).next(()=>d)}).then(a=>(s.os=i,a))}function TR(t,e,s){let n=ze(),i=ze();return s.forEach(a=>n=n.add(a)),e.getEntries(t,n).next(a=>{let o=Kr();return s.forEach((l,d)=>{const u=a.get(l);d.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(Re.min())?(e.removeEntry(l,d.readTime),o=o.insert(l,d)):!u.isValidDocument()||d.version.compareTo(u.version)>0||d.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(d),o=o.insert(l,d)):ve("LocalStore","Ignoring outdated watch update for ",l,". Current version:",u.version," Watch version:",d.version)}),{Ps:o,Is:i}})}function RR(t,e){const s=Pe(t);return s.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),s.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function PR(t,e){const s=Pe(t);return s.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return s.Ur.getTargetData(n,e).next(a=>a?(i=a,ie.resolve(i)):s.Ur.allocateTargetId(n).next(o=>(i=new bn(e,o,"TargetPurposeListen",n.currentSequenceNumber),s.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=s.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(s.os=s.os.insert(n.targetId,n),s._s.set(e,n.targetId)),n})}async function ap(t,e,s){const n=Pe(t),i=n.os.get(e),a=s?"readwrite":"readwrite-primary";try{s||await n.persistence.runTransaction("Release target",a,o=>n.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!Rl(o))throw o;ve("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(i.target)}function Dy(t,e,s){const n=Pe(t);let i=Re.min(),a=ze();return n.persistence.runTransaction("Execute query","readwrite",o=>function(d,u,m){const h=Pe(d),f=h._s.get(m);return f!==void 0?ie.resolve(h.os.get(f)):h.Ur.getTargetData(u,m)}(n,o,gr(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,l.targetId).next(d=>{a=d})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,s?i:Re.min(),s?a:ze())).next(l=>(DR(n,_4(e),l),{documents:l,Ts:a})))}function DR(t,e,s){let n=t.us.get(e)||Re.min();s.forEach((i,a)=>{a.readTime.compareTo(n)>0&&(n=a.readTime)}),t.us.set(e,n)}class My{constructor(){this.activeTargetIds=C4()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class MR{constructor(){this.so=new My,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,s,n){}addLocalQueryTarget(e,s=!0){return s&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,s,n){this.oo[e]=s}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new My,Promise.resolve()}handleUserChange(e,s,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ve("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ve("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sc=null;function Fm(){return Sc===null?Sc=function(){return 268435456+Math.round(2147483648*Math.random())}():Sc++,"0x"+Sc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt="WebChannelConnection";class FR extends class{constructor(s){this.databaseInfo=s,this.databaseId=s.databaseId;const n=s.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+s.host,this.vo=`projects/${i}/databases/${a}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${a}`}get Fo(){return!1}Mo(s,n,i,a,o){const l=Fm(),d=this.xo(s,n.toUriEncodedString());ve("RestConnection",`Sending RPC '${s}' ${l}:`,d,i);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,a,o),this.No(s,d,u,i).then(m=>(ve("RestConnection",`Received RPC '${s}' ${l}: `,m),m),m=>{throw wa("RestConnection",`RPC '${s}' ${l} failed with error: `,m,"url: ",d,"request:",i),m})}Lo(s,n,i,a,o,l){return this.Mo(s,n,i,a,o)}Oo(s,n,i){s["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Pa}(),s["Content-Type"]="text/plain",this.databaseInfo.appId&&(s["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((a,o)=>s[o]=a),i&&i.headers.forEach((a,o)=>s[o]=a)}xo(s,n){const i=VR[s];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,s,n,i){const a=Fm();return new Promise((o,l)=>{const d=new Hj;d.setWithCredentials(!0),d.listenOnce(Kj.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case qc.NO_ERROR:const m=d.getResponseJson();ve(Xt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),o(m);break;case qc.TIMEOUT:ve(Xt,`RPC '${e}' ${a} timed out`),l(new ge(te.DEADLINE_EXCEEDED,"Request time out"));break;case qc.HTTP_ERROR:const h=d.getStatus();if(ve(Xt,`RPC '${e}' ${a} failed with status:`,h,"response text:",d.getResponseText()),h>0){let f=d.getResponseJson();Array.isArray(f)&&(f=f[0]);const x=f==null?void 0:f.error;if(x&&x.status&&x.message){const y=function(_){const C=_.toLowerCase().replace(/_/g,"-");return Object.values(te).indexOf(C)>=0?C:te.UNKNOWN}(x.status);l(new ge(y,x.message))}else l(new ge(te.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new ge(te.UNAVAILABLE,"Connection failed."));break;default:Ie()}}finally{ve(Xt,`RPC '${e}' ${a} completed.`)}});const u=JSON.stringify(i);ve(Xt,`RPC '${e}' ${a} sending request:`,i),d.send(s,"POST",u,n,15)})}Bo(e,s,n){const i=Fm(),a=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Xj(),l=Yj(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(d.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(d.useFetchStreams=!0),this.Oo(d.initMessageHeaders,s,n),d.encodeInitMessageHeaders=!0;const m=a.join("");ve(Xt,`Creating RPC '${e}' stream ${i}: ${m}`,d);const h=o.createWebChannel(m,d);let f=!1,x=!1;const y=new OR({Io:_=>{x?ve(Xt,`Not sending because RPC '${e}' stream ${i} is closed:`,_):(f||(ve(Xt,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),ve(Xt,`RPC '${e}' stream ${i} sending:`,_),h.send(_))},To:()=>h.close()}),P=(_,C,k)=>{_.listen(C,T=>{try{k(T)}catch(S){setTimeout(()=>{throw S},0)}})};return P(h,fo.EventType.OPEN,()=>{x||(ve(Xt,`RPC '${e}' stream ${i} transport opened.`),y.yo())}),P(h,fo.EventType.CLOSE,()=>{x||(x=!0,ve(Xt,`RPC '${e}' stream ${i} transport closed`),y.So())}),P(h,fo.EventType.ERROR,_=>{x||(x=!0,wa(Xt,`RPC '${e}' stream ${i} transport errored:`,_),y.So(new ge(te.UNAVAILABLE,"The operation could not be completed")))}),P(h,fo.EventType.MESSAGE,_=>{var C;if(!x){const k=_.data[0];tt(!!k);const T=k,S=T.error||((C=T[0])===null||C===void 0?void 0:C.error);if(S){ve(Xt,`RPC '${e}' stream ${i} received error:`,S);const D=S.status;let R=function(N){const g=_t[N];if(g!==void 0)return jN(g)}(D),v=S.message;R===void 0&&(R=te.INTERNAL,v="Unknown error status: "+D+" with message "+S.message),x=!0,y.So(new ge(R,v)),h.close()}else ve(Xt,`RPC '${e}' stream ${i} received:`,k),y.bo(k)}}),P(l,Qj.STAT_EVENT,_=>{_.stat===Yh.PROXY?ve(Xt,`RPC '${e}' stream ${i} detected buffering proxy`):_.stat===Yh.NOPROXY&&ve(Xt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.wo()},0),y}}function $m(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eu(t){return new Q4(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DN{constructor(e,s,n=1e3,i=1.5,a=6e4){this.ui=e,this.timerId=s,this.ko=n,this.qo=i,this.Qo=a,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const s=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,s-n);i>0&&ve("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${s} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MN{constructor(e,s,n,i,a,o,l,d){this.ui=e,this.Ho=n,this.Jo=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new DN(e,s)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,s){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():s&&s.code===te.RESOURCE_EXHAUSTED?(Hr(s.toString()),Hr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):s&&s.code===te.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(s)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),s=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===s&&this.P_(n,i)},n=>{e(()=>{const i=new ge(te.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,s){const n=this.h_(this.Yo);this.stream=this.T_(e,s),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ve("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return s=>{this.ui.enqueueAndForget(()=>this.Yo===e?s():(ve("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $R extends MN{constructor(e,s,n,i,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,n,i,o),this.serializer=a}T_(e,s){return this.connection.Bo("Listen",e,s)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const s=J4(this.serializer,e),n=function(a){if(!("targetChange"in a))return Re.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?Re.min():o.readTime?xr(o.readTime):Re.min()}(e);return this.listener.d_(s,n)}A_(e){const s={};s.database=ip(this.serializer),s.addTarget=function(a,o){let l;const d=o.target;if(l=ep(d)?{documents:tR(a,d)}:{query:sR(a,d)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=SN(a,o.resumeToken);const u=sp(a,o.expectedCount);u!==null&&(l.expectedCount=u)}else if(o.snapshotVersion.compareTo(Re.min())>0){l.readTime=Ld(a,o.snapshotVersion.toTimestamp());const u=sp(a,o.expectedCount);u!==null&&(l.expectedCount=u)}return l}(this.serializer,e);const n=nR(this.serializer,e);n&&(s.labels=n),this.a_(s)}R_(e){const s={};s.database=ip(this.serializer),s.removeTarget=e,this.a_(s)}}class zR extends MN{constructor(e,s,n,i,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,n,i,o),this.serializer=a}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,s){return this.connection.Bo("Write",e,s)}E_(e){return tt(!!e.streamToken),this.lastStreamToken=e.streamToken,tt(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){tt(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const s=eR(e.writeResults,e.commitTime),n=xr(e.commitTime);return this.listener.g_(n,s)}p_(){const e={};e.database=ip(this.serializer),this.a_(e)}m_(e){const s={streamToken:this.lastStreamToken,writes:e.map(n=>Z4(this.serializer,n))};this.a_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR extends class{}{constructor(e,s,n,i){super(),this.authCredentials=e,this.appCheckCredentials=s,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new ge(te.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,s,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Mo(e,rp(s,n),i,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ge(te.UNKNOWN,a.toString())})}Lo(e,s,n,i,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,rp(s,n),i,o,l,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ge(te.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class BR{constructor(e,s){this.asyncQueue=e,this.onlineStateHandler=s,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const s=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Hr(s),this.D_=!1):ve("OnlineStateTracker",s)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(e,s,n,i,a){this.localStore=e,this.datastore=s,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=a,this.k_._o(o=>{n.enqueueAndForget(async()=>{Ti(this)&&(ve("RemoteStore","Restarting streams for network reachability change."),await async function(d){const u=Pe(d);u.L_.add(4),await Ml(u),u.q_.set("Unknown"),u.L_.delete(4),await Au(u)}(this))})}),this.q_=new BR(n,i)}}async function Au(t){if(Ti(t))for(const e of t.B_)await e(!0)}async function Ml(t){for(const e of t.B_)await e(!1)}function LN(t,e){const s=Pe(t);s.N_.has(e.targetId)||(s.N_.set(e.targetId,e),qf(s)?Bf(s):La(s).r_()&&Uf(s,e))}function zf(t,e){const s=Pe(t),n=La(s);s.N_.delete(e),n.r_()&&VN(s,e),s.N_.size===0&&(n.r_()?n.o_():Ti(s)&&s.q_.set("Unknown"))}function Uf(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Re.min())>0){const s=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(s)}La(t).A_(e)}function VN(t,e){t.Q_.xe(e),La(t).R_(e)}function Bf(t){t.Q_=new G4({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),La(t).start(),t.q_.v_()}function qf(t){return Ti(t)&&!La(t).n_()&&t.N_.size>0}function Ti(t){return Pe(t).L_.size===0}function ON(t){t.Q_=void 0}async function GR(t){t.q_.set("Online")}async function WR(t){t.N_.forEach((e,s)=>{Uf(t,e)})}async function HR(t,e){ON(t),qf(t)?(t.q_.M_(e),Bf(t)):t.q_.set("Unknown")}async function KR(t,e,s){if(t.q_.set("Online"),e instanceof _N&&e.state===2&&e.cause)try{await async function(i,a){const o=a.cause;for(const l of a.targetIds)i.N_.has(l)&&(await i.remoteSyncer.rejectListen(l,o),i.N_.delete(l),i.Q_.removeTarget(l))}(t,e)}catch(n){ve("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Vd(t,n)}else if(e instanceof Hc?t.Q_.Ke(e):e instanceof NN?t.Q_.He(e):t.Q_.We(e),!s.isEqual(Re.min()))try{const n=await PN(t.localStore);s.compareTo(n)>=0&&await function(a,o){const l=a.Q_.rt(o);return l.targetChanges.forEach((d,u)=>{if(d.resumeToken.approximateByteSize()>0){const m=a.N_.get(u);m&&a.N_.set(u,m.withResumeToken(d.resumeToken,o))}}),l.targetMismatches.forEach((d,u)=>{const m=a.N_.get(d);if(!m)return;a.N_.set(d,m.withResumeToken(Wt.EMPTY_BYTE_STRING,m.snapshotVersion)),VN(a,d);const h=new bn(m.target,d,u,m.sequenceNumber);Uf(a,h)}),a.remoteSyncer.applyRemoteEvent(l)}(t,s)}catch(n){ve("RemoteStore","Failed to raise snapshot:",n),await Vd(t,n)}}async function Vd(t,e,s){if(!Rl(e))throw e;t.L_.add(1),await Ml(t),t.q_.set("Offline"),s||(s=()=>PN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ve("RemoteStore","Retrying IndexedDB access"),await s(),t.L_.delete(1),await Au(t)})}function FN(t,e){return e().catch(s=>Vd(t,s,e))}async function Iu(t){const e=Pe(t),s=Fn(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;QR(e);)try{const i=await RR(e.localStore,n);if(i===null){e.O_.length===0&&s.o_();break}n=i.batchId,YR(e,i)}catch(i){await Vd(e,i)}$N(e)&&zN(e)}function QR(t){return Ti(t)&&t.O_.length<10}function YR(t,e){t.O_.push(e);const s=Fn(t);s.r_()&&s.V_&&s.m_(e.mutations)}function $N(t){return Ti(t)&&!Fn(t).n_()&&t.O_.length>0}function zN(t){Fn(t).start()}async function XR(t){Fn(t).p_()}async function JR(t){const e=Fn(t);for(const s of t.O_)e.m_(s.mutations)}async function ZR(t,e,s){const n=t.O_.shift(),i=Mf.from(n,e,s);await FN(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Iu(t)}async function eP(t,e){e&&Fn(t).V_&&await async function(n,i){if(function(o){return U4(o)&&o!==te.ABORTED}(i.code)){const a=n.O_.shift();Fn(n).s_(),await FN(n,()=>n.remoteSyncer.rejectFailedWrite(a.batchId,i)),await Iu(n)}}(t,e),$N(t)&&zN(t)}async function Vy(t,e){const s=Pe(t);s.asyncQueue.verifyOperationInProgress(),ve("RemoteStore","RemoteStore received new credentials");const n=Ti(s);s.L_.add(3),await Ml(s),n&&s.q_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(e),s.L_.delete(3),await Au(s)}async function tP(t,e){const s=Pe(t);e?(s.L_.delete(2),await Au(s)):e||(s.L_.add(2),await Ml(s),s.q_.set("Unknown"))}function La(t){return t.K_||(t.K_=function(s,n,i){const a=Pe(s);return a.w_(),new $R(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(t.datastore,t.asyncQueue,{Eo:GR.bind(null,t),Ro:WR.bind(null,t),mo:HR.bind(null,t),d_:KR.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),qf(t)?Bf(t):t.q_.set("Unknown")):(await t.K_.stop(),ON(t))})),t.K_}function Fn(t){return t.U_||(t.U_=function(s,n,i){const a=Pe(s);return a.w_(),new zR(n,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,i)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:XR.bind(null,t),mo:eP.bind(null,t),f_:JR.bind(null,t),g_:ZR.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Iu(t)):(await t.U_.stop(),t.O_.length>0&&(ve("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e,s,n,i,a){this.asyncQueue=e,this.timerId=s,this.targetTimeMs=n,this.op=i,this.removalCallback=a,this.deferred=new Vr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,s,n,i,a){const o=Date.now()+n,l=new Gf(e,s,o,i,a);return l.start(n),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ge(te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wf(t,e){if(Hr("AsyncQueue",`${e}: ${t}`),Rl(t))return new ge(te.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.comparator=e?(s,n)=>e(s,n)||Se.comparator(s.key,n.key):(s,n)=>Se.comparator(s.key,n.key),this.keyedMap=go(),this.sortedSet=new xt(this.comparator)}static emptySet(e){return new da(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const s=this.keyedMap.get(e);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((s,n)=>(e(s),!1))}add(e){const s=this.delete(e.key);return s.copy(s.keyedMap.insert(e.key,e),s.sortedSet.insert(e,null))}delete(e){const s=this.get(e);return s?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(s)):this}isEqual(e){if(!(e instanceof da)||this.size!==e.size)return!1;const s=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;s.hasNext();){const i=s.getNext().key,a=n.getNext().key;if(!i.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(s=>{e.push(s.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,s){const n=new da;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=s,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(){this.W_=new xt(Se.comparator)}track(e){const s=e.doc.key,n=this.W_.get(s);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(s,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(s,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(s,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(s,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(s):e.type===1&&n.type===2?this.W_=this.W_.insert(s,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(s,{type:2,doc:e.doc}):Ie():this.W_=this.W_.insert(s,e)}G_(){const e=[];return this.W_.inorderTraversal((s,n)=>{e.push(n)}),e}}class Ea{constructor(e,s,n,i,a,o,l,d,u){this.query=e,this.docs=s,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=u}static fromInitialDocuments(e,s,n,i,a){const o=[];return s.forEach(l=>{o.push({type:0,doc:l})}),new Ea(e,s,da.emptySet(s),o,n,i,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&bu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const s=this.docChanges,n=e.docChanges;if(s.length!==n.length)return!1;for(let i=0;i<s.length;i++)if(s[i].type!==n[i].type||!s[i].doc.isEqual(n[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class rP{constructor(){this.queries=Fy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(s,n){const i=Pe(s),a=i.queries;i.queries=Fy(),a.forEach((o,l)=>{for(const d of l.j_)d.onError(n)})})(this,new ge(te.ABORTED,"Firestore shutting down"))}}function Fy(){return new Ma(t=>dN(t),bu)}async function Hf(t,e){const s=Pe(t);let n=3;const i=e.query;let a=s.queries.get(i);a?!a.H_()&&e.J_()&&(n=2):(a=new sP,n=e.J_()?0:1);try{switch(n){case 0:a.z_=await s.onListen(i,!0);break;case 1:a.z_=await s.onListen(i,!1);break;case 2:await s.onFirstRemoteStoreListen(i)}}catch(o){const l=Wf(o,`Initialization of query '${Oi(e.query)}' failed`);return void e.onError(l)}s.queries.set(i,a),a.j_.push(e),e.Z_(s.onlineState),a.z_&&e.X_(a.z_)&&Qf(s)}async function Kf(t,e){const s=Pe(t),n=e.query;let i=3;const a=s.queries.get(n);if(a){const o=a.j_.indexOf(e);o>=0&&(a.j_.splice(o,1),a.j_.length===0?i=e.J_()?0:1:!a.H_()&&e.J_()&&(i=2))}switch(i){case 0:return s.queries.delete(n),s.onUnlisten(n,!0);case 1:return s.queries.delete(n),s.onUnlisten(n,!1);case 2:return s.onLastRemoteStoreUnlisten(n);default:return}}function nP(t,e){const s=Pe(t);let n=!1;for(const i of e){const a=i.query,o=s.queries.get(a);if(o){for(const l of o.j_)l.X_(i)&&(n=!0);o.z_=i}}n&&Qf(s)}function iP(t,e,s){const n=Pe(t),i=n.queries.get(e);if(i)for(const a of i.j_)a.onError(s);n.queries.delete(e)}function Qf(t){t.Y_.forEach(e=>{e.next()})}var op,$y;($y=op||(op={})).ea="default",$y.Cache="cache";class Yf{constructor(e,s,n){this.query=e,this.ta=s,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)i.type!==3&&n.push(i);e=new Ea(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let s=!1;return this.na?this.ia(e)&&(this.ta.next(e),s=!0):this.sa(e,this.onlineState)&&(this.oa(e),s=!0),this.ra=e,s}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let s=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),s=!0),s}sa(e,s){if(!e.fromCache||!this.J_())return!0;const n=s!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||s==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const s=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}oa(e){e=Ea.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==op.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(e){this.key=e}}class BN{constructor(e){this.key=e}}class aP{constructor(e,s){this.query=e,this.Ta=s,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ze(),this.mutatedKeys=ze(),this.Aa=uN(e),this.Ra=new da(this.Aa)}get Va(){return this.Ta}ma(e,s){const n=s?s.fa:new Oy,i=s?s.Ra:this.Ra;let a=s?s.mutatedKeys:this.mutatedKeys,o=i,l=!1;const d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,h)=>{const f=i.get(m),x=wu(this.query,h)?h:null,y=!!f&&this.mutatedKeys.has(f.key),P=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let _=!1;f&&x?f.data.isEqual(x.data)?y!==P&&(n.track({type:3,doc:x}),_=!0):this.ga(f,x)||(n.track({type:2,doc:x}),_=!0,(d&&this.Aa(x,d)>0||u&&this.Aa(x,u)<0)&&(l=!0)):!f&&x?(n.track({type:0,doc:x}),_=!0):f&&!x&&(n.track({type:1,doc:f}),_=!0,(d||u)&&(l=!0)),_&&(x?(o=o.add(x),a=P?a.add(m):a.delete(m)):(o=o.delete(m),a=a.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),a=a.delete(m.key),n.track({type:1,doc:m})}return{Ra:o,fa:n,ns:l,mutatedKeys:a}}ga(e,s){return e.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(e,s,n,i){const a=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((m,h)=>function(x,y){const P=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ie()}};return P(x)-P(y)}(m.type,h.type)||this.Aa(m.doc,h.doc)),this.pa(n),i=i!=null&&i;const l=s&&!i?this.ya():[],d=this.da.size===0&&this.current&&!i?1:0,u=d!==this.Ea;return this.Ea=d,o.length!==0||u?{snapshot:new Ea(this.query,e.Ra,a,o,e.mutatedKeys,d===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Oy,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(s=>this.Ta=this.Ta.add(s)),e.modifiedDocuments.forEach(s=>{}),e.removedDocuments.forEach(s=>this.Ta=this.Ta.delete(s)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ze(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const s=[];return e.forEach(n=>{this.da.has(n)||s.push(new BN(n))}),this.da.forEach(n=>{e.has(n)||s.push(new UN(n))}),s}ba(e){this.Ta=e.Ts,this.da=ze();const s=this.ma(e.documents);return this.applyChanges(s,!0)}Da(){return Ea.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class oP{constructor(e,s,n){this.query=e,this.targetId=s,this.view=n}}class lP{constructor(e){this.key=e,this.va=!1}}class cP{constructor(e,s,n,i,a,o){this.localStore=e,this.remoteStore=s,this.eventManager=n,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ma(l=>dN(l),bu),this.Ma=new Map,this.xa=new Set,this.Oa=new xt(Se.comparator),this.Na=new Map,this.La=new Of,this.Ba={},this.ka=new Map,this.qa=Sa.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function dP(t,e,s=!0){const n=QN(t);let i;const a=n.Fa.get(e);return a?(n.sharedClientState.addLocalQueryTarget(a.targetId),i=a.view.Da()):i=await qN(n,e,s,!0),i}async function uP(t,e){const s=QN(t);await qN(s,e,!0,!1)}async function qN(t,e,s,n){const i=await PR(t.localStore,gr(e)),a=i.targetId,o=t.sharedClientState.addLocalQueryTarget(a,s);let l;return n&&(l=await mP(t,e,a,o==="current",i.resumeToken)),t.isPrimaryClient&&s&&LN(t.remoteStore,i),l}async function mP(t,e,s,n,i){t.Ka=(h,f,x)=>async function(P,_,C,k){let T=_.view.ma(C);T.ns&&(T=await Dy(P.localStore,_.query,!1).then(({documents:v})=>_.view.ma(v,T)));const S=k&&k.targetChanges.get(_.targetId),D=k&&k.targetMismatches.get(_.targetId)!=null,R=_.view.applyChanges(T,P.isPrimaryClient,S,D);return Uy(P,_.targetId,R.wa),R.snapshot}(t,h,f,x);const a=await Dy(t.localStore,e,!0),o=new aP(e,a.Ts),l=o.ma(a.documents),d=Dl.createSynthesizedTargetChangeForCurrentChange(s,n&&t.onlineState!=="Offline",i),u=o.applyChanges(l,t.isPrimaryClient,d);Uy(t,s,u.wa);const m=new oP(e,s,o);return t.Fa.set(e,m),t.Ma.has(s)?t.Ma.get(s).push(e):t.Ma.set(s,[e]),u.snapshot}async function hP(t,e,s){const n=Pe(t),i=n.Fa.get(e),a=n.Ma.get(i.targetId);if(a.length>1)return n.Ma.set(i.targetId,a.filter(o=>!bu(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await ap(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),s&&zf(n.remoteStore,i.targetId),lp(n,i.targetId)}).catch(Tl)):(lp(n,i.targetId),await ap(n.localStore,i.targetId,!0))}async function pP(t,e){const s=Pe(t),n=s.Fa.get(e),i=s.Ma.get(n.targetId);s.isPrimaryClient&&i.length===1&&(s.sharedClientState.removeLocalQueryTarget(n.targetId),zf(s.remoteStore,n.targetId))}async function fP(t,e,s){const n=jP(t);try{const i=await function(o,l){const d=Pe(o),u=J.now(),m=l.reduce((x,y)=>x.add(y.key),ze());let h,f;return d.persistence.runTransaction("Locally write mutations","readwrite",x=>{let y=Kr(),P=ze();return d.cs.getEntries(x,m).next(_=>{y=_,y.forEach((C,k)=>{k.isValidDocument()||(P=P.add(C))})}).next(()=>d.localDocuments.getOverlayedDocuments(x,y)).next(_=>{h=_;const C=[];for(const k of l){const T=V4(k,h.get(k.key).overlayedDocument);T!=null&&C.push(new Qn(k.key,T,sN(T.value.mapValue),_s.exists(!0)))}return d.mutationQueue.addMutationBatch(x,u,C,l)}).next(_=>{f=_;const C=_.applyToLocalDocumentSet(h,P);return d.documentOverlayCache.saveOverlays(x,_.batchId,C)})}).then(()=>({batchId:f.batchId,changes:hN(h)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,l,d){let u=o.Ba[o.currentUser.toKey()];u||(u=new xt(Ye)),u=u.insert(l,d),o.Ba[o.currentUser.toKey()]=u}(n,i.batchId,s),await Ll(n,i.changes),await Iu(n.remoteStore)}catch(i){const a=Wf(i,"Failed to persist write");s.reject(a)}}async function GN(t,e){const s=Pe(t);try{const n=await CR(s.localStore,e);e.targetChanges.forEach((i,a)=>{const o=s.Na.get(a);o&&(tt(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?tt(o.va):i.removedDocuments.size>0&&(tt(o.va),o.va=!1))}),await Ll(s,n,e)}catch(n){await Tl(n)}}function zy(t,e,s){const n=Pe(t);if(n.isPrimaryClient&&s===0||!n.isPrimaryClient&&s===1){const i=[];n.Fa.forEach((a,o)=>{const l=o.view.Z_(e);l.snapshot&&i.push(l.snapshot)}),function(o,l){const d=Pe(o);d.onlineState=l;let u=!1;d.queries.forEach((m,h)=>{for(const f of h.j_)f.Z_(l)&&(u=!0)}),u&&Qf(d)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function gP(t,e,s){const n=Pe(t);n.sharedClientState.updateQueryState(e,"rejected",s);const i=n.Na.get(e),a=i&&i.key;if(a){let o=new xt(Se.comparator);o=o.insert(a,es.newNoDocument(a,Re.min()));const l=ze().add(a),d=new Su(Re.min(),new Map,new xt(Ye),o,l);await GN(n,d),n.Oa=n.Oa.remove(a),n.Na.delete(e),Xf(n)}else await ap(n.localStore,e,!1).then(()=>lp(n,e,s)).catch(Tl)}async function xP(t,e){const s=Pe(t),n=e.batch.batchId;try{const i=await kR(s.localStore,e);HN(s,n,null),WN(s,n),s.sharedClientState.updateMutationState(n,"acknowledged"),await Ll(s,i)}catch(i){await Tl(i)}}async function yP(t,e,s){const n=Pe(t);try{const i=await function(o,l){const d=Pe(o);return d.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let m;return d.mutationQueue.lookupMutationBatch(u,l).next(h=>(tt(h!==null),m=h.keys(),d.mutationQueue.removeMutationBatch(u,h))).next(()=>d.mutationQueue.performConsistencyCheck(u)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(u,m,l)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,m)).next(()=>d.localDocuments.getDocuments(u,m))})}(n.localStore,e);HN(n,e,s),WN(n,e),n.sharedClientState.updateMutationState(e,"rejected",s),await Ll(n,i)}catch(i){await Tl(i)}}function WN(t,e){(t.ka.get(e)||[]).forEach(s=>{s.resolve()}),t.ka.delete(e)}function HN(t,e,s){const n=Pe(t);let i=n.Ba[n.currentUser.toKey()];if(i){const a=i.get(e);a&&(s?a.reject(s):a.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function lp(t,e,s=null){t.sharedClientState.removeLocalQueryTarget(e);for(const n of t.Ma.get(e))t.Fa.delete(n),s&&t.Ca.$a(n,s);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(n=>{t.La.containsKey(n)||KN(t,n)})}function KN(t,e){t.xa.delete(e.path.canonicalString());const s=t.Oa.get(e);s!==null&&(zf(t.remoteStore,s),t.Oa=t.Oa.remove(e),t.Na.delete(s),Xf(t))}function Uy(t,e,s){for(const n of s)n instanceof UN?(t.La.addReference(n.key,e),vP(t,n)):n instanceof BN?(ve("SyncEngine","Document no longer in limbo: "+n.key),t.La.removeReference(n.key,e),t.La.containsKey(n.key)||KN(t,n.key)):Ie()}function vP(t,e){const s=e.key,n=s.path.canonicalString();t.Oa.get(s)||t.xa.has(n)||(ve("SyncEngine","New document in limbo: "+s),t.xa.add(n),Xf(t))}function Xf(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const s=new Se(lt.fromString(e)),n=t.qa.next();t.Na.set(n,new lP(s)),t.Oa=t.Oa.insert(s,n),LN(t.remoteStore,new bn(gr(vu(s.path)),n,"TargetPurposeLimboResolution",If.oe))}}async function Ll(t,e,s){const n=Pe(t),i=[],a=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((l,d)=>{o.push(n.Ka(d,e,s).then(u=>{var m;if((u||s)&&n.isPrimaryClient){const h=u?!u.fromCache:(m=s==null?void 0:s.targetChanges.get(d.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(d.targetId,h?"current":"not-current")}if(u){i.push(u);const h=$f.Wi(d.targetId,u);a.push(h)}}))}),await Promise.all(o),n.Ca.d_(i),await async function(d,u){const m=Pe(d);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>ie.forEach(u,f=>ie.forEach(f.$i,x=>m.persistence.referenceDelegate.addReference(h,f.targetId,x)).next(()=>ie.forEach(f.Ui,x=>m.persistence.referenceDelegate.removeReference(h,f.targetId,x)))))}catch(h){if(!Rl(h))throw h;ve("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const f=h.targetId;if(!h.fromCache){const x=m.os.get(f),y=x.snapshotVersion,P=x.withLastLimboFreeSnapshotVersion(y);m.os=m.os.insert(f,P)}}}(n.localStore,a))}async function bP(t,e){const s=Pe(t);if(!s.currentUser.isEqual(e)){ve("SyncEngine","User change. New user:",e.toKey());const n=await RN(s.localStore,e);s.currentUser=e,function(a,o){a.ka.forEach(l=>{l.forEach(d=>{d.reject(new ge(te.CANCELLED,o))})}),a.ka.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Ll(s,n.hs)}}function wP(t,e){const s=Pe(t),n=s.Na.get(e);if(n&&n.va)return ze().add(n.key);{let i=ze();const a=s.Ma.get(e);if(!a)return i;for(const o of a){const l=s.Fa.get(o);i=i.unionWith(l.view.Va)}return i}}function QN(t){const e=Pe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=GN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=wP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gP.bind(null,e),e.Ca.d_=nP.bind(null,e.eventManager),e.Ca.$a=iP.bind(null,e.eventManager),e}function jP(t){const e=Pe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=xP.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yP.bind(null,e),e}class Od{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Eu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,s){return null}Ha(e,s){return null}za(e){return IR(this.persistence,new ER,e.initialUser,this.serializer)}Ga(e){return new NR(Ff.Zr,this.serializer)}Wa(e){return new MR}async terminate(){var e,s;(e=this.gcScheduler)===null||e===void 0||e.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Od.provider={build:()=>new Od};class cp{async initialize(e,s){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>zy(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=bP.bind(null,this.syncEngine),await tP(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new rP}()}createDatastore(e){const s=Eu(e.databaseInfo.databaseId),n=function(a){return new FR(a)}(e.databaseInfo);return function(a,o,l,d){return new UR(a,o,l,d)}(e.authCredentials,e.appCheckCredentials,n,s)}createRemoteStore(e){return function(n,i,a,o,l){return new qR(n,i,a,o,l)}(this.localStore,this.datastore,e.asyncQueue,s=>zy(this.syncEngine,s,0),function(){return Ly.D()?new Ly:new LR}())}createSyncEngine(e,s){return function(i,a,o,l,d,u,m){const h=new cP(i,a,o,l,d,u);return m&&(h.Qa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,s)}async terminate(){var e,s;await async function(i){const a=Pe(i);ve("RemoteStore","RemoteStore shutting down."),a.L_.add(5),await Ml(a),a.k_.shutdown(),a.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}cp.provider={build:()=>new cp};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Hr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,s){setTimeout(()=>{this.muted||e(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(e,s,n,i,a){this.authCredentials=e,this.appCheckCredentials=s,this.asyncQueue=n,this.databaseInfo=i,this.user=Jt.UNAUTHENTICATED,this.clientId=Zj.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(n,async o=>{ve("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(n,o=>(ve("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(s){const n=Wf(s,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function zm(t,e){t.asyncQueue.verifyOperationInProgress(),ve("FirestoreClient","Initializing OfflineComponentProvider");const s=t.configuration;await e.initialize(s);let n=s.initialUser;t.setCredentialChangeListener(async i=>{n.isEqual(i)||(await RN(e.localStore,i),n=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function By(t,e){t.asyncQueue.verifyOperationInProgress();const s=await _P(t);ve("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(s,t.configuration),t.setCredentialChangeListener(n=>Vy(e.remoteStore,n)),t.setAppCheckTokenChangeListener((n,i)=>Vy(e.remoteStore,i)),t._onlineComponents=e}async function _P(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ve("FirestoreClient","Using user provided OfflineComponentProvider");try{await zm(t,t._uninitializedComponentsProvider._offline)}catch(e){const s=e;if(!function(i){return i.name==="FirebaseError"?i.code===te.FAILED_PRECONDITION||i.code===te.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(s))throw s;wa("Error using user provided cache. Falling back to memory cache: "+s),await zm(t,new Od)}}else ve("FirestoreClient","Using default OfflineComponentProvider"),await zm(t,new Od);return t._offlineComponents}async function YN(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ve("FirestoreClient","Using user provided OnlineComponentProvider"),await By(t,t._uninitializedComponentsProvider._online)):(ve("FirestoreClient","Using default OnlineComponentProvider"),await By(t,new cp))),t._onlineComponents}function SP(t){return YN(t).then(e=>e.syncEngine)}async function Fd(t){const e=await YN(t),s=e.eventManager;return s.onListen=dP.bind(null,e.syncEngine),s.onUnlisten=hP.bind(null,e.syncEngine),s.onFirstRemoteStoreListen=uP.bind(null,e.syncEngine),s.onLastRemoteStoreUnlisten=pP.bind(null,e.syncEngine),s}function EP(t,e,s={}){const n=new Vr;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,d,u){const m=new Jf({next:f=>{m.Za(),o.enqueueAndForget(()=>Kf(a,h));const x=f.docs.has(l);!x&&f.fromCache?u.reject(new ge(te.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&f.fromCache&&d&&d.source==="server"?u.reject(new ge(te.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new Yf(vu(l.path),m,{includeMetadataChanges:!0,_a:!0});return Hf(a,h)}(await Fd(t),t.asyncQueue,e,s,n)),n.promise}function AP(t,e,s={}){const n=new Vr;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,d,u){const m=new Jf({next:f=>{m.Za(),o.enqueueAndForget(()=>Kf(a,h)),f.fromCache&&d.source==="server"?u.reject(new ge(te.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(f)},error:f=>u.reject(f)}),h=new Yf(l,m,{includeMetadataChanges:!0,_a:!0});return Hf(a,h)}(await Fd(t),t.asyncQueue,e,s,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JN(t,e,s){if(!s)throw new ge(te.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function IP(t,e,s,n){if(e===!0&&n===!0)throw new ge(te.INVALID_ARGUMENT,`${t} and ${s} cannot be used together.`)}function Gy(t){if(!Se.isDocumentKey(t))throw new ge(te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Wy(t){if(Se.isDocumentKey(t))throw new ge(te.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ku(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ie()}function Ss(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ge(te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=ku(t);throw new ge(te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${s}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(e){var s,n;if(e.host===void 0){if(e.ssl!==void 0)throw new ge(te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(s=e.ssl)===null||s===void 0||s;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ge(te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}IP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=XN((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new ge(te.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new ge(te.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new ge(te.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cu{constructor(e,s,n,i){this._authCredentials=e,this._appCheckCredentials=s,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ge(te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ge(te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hy(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new WT;switch(n.type){case"firstParty":return new YT(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new ge(te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const n=qy.get(s);n&&(ve("ComponentProvider","Removing Datastore"),qy.delete(s),n.terminate())}(this),Promise.resolve()}}function kP(t,e,s,n={}){var i;const a=(t=Ss(t,Cu))._getSettings(),o=`${e}:${s}`;if(a.host!=="firestore.googleapis.com"&&a.host!==o&&wa("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),n.mockUserToken){let l,d;if(typeof n.mockUserToken=="string")l=n.mockUserToken,d=Jt.MOCK_USER;else{l=rj(n.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const u=n.mockUserToken.sub||n.mockUserToken.user_id;if(!u)throw new ge(te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Jt(u)}t._authCredentials=new HT(new Jj(l,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e,s,n){this.converter=s,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new en(this.firestore,e,this._query)}}class ts{constructor(e,s,n){this.converter=s,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ts(this.firestore,e,this._key)}}class Rn extends en{constructor(e,s,n){super(e,s,vu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ts(this.firestore,null,new Se(e))}withConverter(e){return new Rn(this.firestore,e,this._path)}}function je(t,e,...s){if(t=st(t),JN("collection","path",e),t instanceof Cu){const n=lt.fromString(e,...s);return Wy(n),new Rn(t,null,n)}{if(!(t instanceof ts||t instanceof Rn))throw new ge(te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(lt.fromString(e,...s));return Wy(n),new Rn(t.firestore,null,n)}}function me(t,e,...s){if(t=st(t),arguments.length===1&&(e=Zj.newId()),JN("doc","path",e),t instanceof Cu){const n=lt.fromString(e,...s);return Gy(n),new ts(t,null,new Se(n))}{if(!(t instanceof ts||t instanceof Rn))throw new ge(te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(lt.fromString(e,...s));return Gy(n),new ts(t.firestore,t instanceof Rn?t.converter:null,new Se(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new DN(this,"async_queue_retry"),this.Vu=()=>{const n=$m();n&&ve("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const s=$m();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const s=$m();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const s=new Vr;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Rl(e))throw e;ve("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const s=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const i=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(n);throw Hr("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.du=!1,n))));return this.mu=s,s}enqueueAfterDelay(e,s,n){this.fu(),this.Ru.indexOf(e)>-1&&(s=0);const i=Gf.createAndSchedule(this,e,s,n,a=>this.yu(a));return this.Tu.push(i),i}fu(){this.Eu&&Ie()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const s of this.Tu)if(s.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((s,n)=>s.targetTimeMs-n.targetTimeMs);for(const s of this.Tu)if(s.skipDelay(),e!=="all"&&s.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const s=this.Tu.indexOf(e);this.Tu.splice(s,1)}}function Qy(t){return function(s,n){if(typeof s!="object"||s===null)return!1;const i=s;for(const a of n)if(a in i&&typeof i[a]=="function")return!0;return!1}(t,["next","error","complete"])}class Qr extends Cu{constructor(e,s,n,i){super(e,s,n,i),this.type="firestore",this._queue=new Ky,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ky(e),this._firestoreClient=void 0,await e}}}function CP(t,e){const s=typeof t=="object"?t:pu(),n=typeof t=="string"?t:"(default)",i=El(s,"firestore").getImmediate({identifier:n});if(!i._initialized){const a=hf("firestore");a&&kP(i,...a)}return i}function Vl(t){if(t._terminated)throw new ge(te.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||TP(t),t._firestoreClient}function TP(t){var e,s,n;const i=t._freezeSettings(),a=function(l,d,u,m){return new c4(l,d,u,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,XN(m.experimentalLongPollingOptions),m.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((s=i.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new NP(t._authCredentials,t._appCheckCredentials,t._queue,a,t._componentsProvider&&function(l){const d=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(d),_online:d}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Aa(Wt.fromBase64String(e))}catch(s){throw new ge(te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(e){return new Aa(Wt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(...e){for(let s=0;s<e.length;++s)if(e[s].length===0)throw new ge(te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ut(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(e,s){if(!isFinite(e)||e<-90||e>90)throw new ge(te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(s)||s<-180||s>180)throw new ge(te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=e,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ye(this._lat,e._lat)||Ye(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e){this._values=(e||[]).map(s=>s)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RP=/^__.*__$/;class PP{constructor(e,s,n){this.data=e,this.fieldMask=s,this.fieldTransforms=n}toMutation(e,s){return this.fieldMask!==null?new Qn(e,this.data,this.fieldMask,s,this.fieldTransforms):new Pl(e,this.data,s,this.fieldTransforms)}}class ZN{constructor(e,s,n){this.data=e,this.fieldMask=s,this.fieldTransforms=n}toMutation(e,s){return new Qn(e,this.data,this.fieldMask,s,this.fieldTransforms)}}function e1(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ie()}}class sg{constructor(e,s,n,i,a,o){this.settings=e,this.databaseId=s,this.serializer=n,this.ignoreUndefinedProperties=i,a===void 0&&this.vu(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new sg(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var s;const n=(s=this.path)===null||s===void 0?void 0:s.child(e),i=this.Fu({path:n,xu:!1});return i.Ou(e),i}Nu(e){var s;const n=(s=this.path)===null||s===void 0?void 0:s.child(e),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return $d(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(s=>e.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>e.isPrefixOf(s.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(e1(this.Cu)&&RP.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class DP{constructor(e,s,n){this.databaseId=e,this.ignoreUndefinedProperties=s,this.serializer=n||Eu(e)}Qu(e,s,n,i=!1){return new sg({Cu:e,methodName:s,qu:n,path:Ut.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Tu(t){const e=t._freezeSettings(),s=Eu(t._databaseId);return new DP(t._databaseId,!!e.ignoreUndefinedProperties,s)}function t1(t,e,s,n,i,a={}){const o=t.Qu(a.merge||a.mergeFields?2:0,e,s,i);rg("Data must be an object, but it was:",o,n);const l=n1(n,o);let d,u;if(a.merge)d=new Rs(o.fieldMask),u=o.fieldTransforms;else if(a.mergeFields){const m=[];for(const h of a.mergeFields){const f=dp(e,h,s);if(!o.contains(f))throw new ge(te.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);a1(m,f)||m.push(f)}d=new Rs(m),u=o.fieldTransforms.filter(h=>d.covers(h.field))}else d=null,u=o.fieldTransforms;return new PP(new vs(l),d,u)}class Ru extends Zf{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ru}}function s1(t,e,s,n){const i=t.Qu(1,e,s);rg("Data must be an object, but it was:",i,n);const a=[],o=vs.empty();Ci(n,(d,u)=>{const m=ng(e,d,s);u=st(u);const h=i.Nu(m);if(u instanceof Ru)a.push(m);else{const f=Fl(u,h);f!=null&&(a.push(m),o.set(m,f))}});const l=new Rs(a);return new ZN(o,l,i.fieldTransforms)}function r1(t,e,s,n,i,a){const o=t.Qu(1,e,s),l=[dp(e,n,s)],d=[i];if(a.length%2!=0)throw new ge(te.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<a.length;f+=2)l.push(dp(e,a[f])),d.push(a[f+1]);const u=[],m=vs.empty();for(let f=l.length-1;f>=0;--f)if(!a1(u,l[f])){const x=l[f];let y=d[f];y=st(y);const P=o.Nu(x);if(y instanceof Ru)u.push(x);else{const _=Fl(y,P);_!=null&&(u.push(x),m.set(x,_))}}const h=new Rs(u);return new ZN(m,h,o.fieldTransforms)}function MP(t,e,s,n=!1){return Fl(s,t.Qu(n?4:3,e))}function Fl(t,e){if(i1(t=st(t)))return rg("Unsupported field value:",e,t),n1(t,e);if(t instanceof Zf)return function(n,i){if(!e1(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);const a=n._toFieldTransform(i);a&&i.fieldTransforms.push(a)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,i){const a=[];let o=0;for(const l of n){let d=Fl(l,i.Lu(o));d==null&&(d={nullValue:"NULL_VALUE"}),a.push(d),o++}return{arrayValue:{values:a}}}(t,e)}return function(n,i){if((n=st(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return T4(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const a=J.fromDate(n);return{timestampValue:Ld(i.serializer,a)}}if(n instanceof J){const a=new J(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ld(i.serializer,a)}}if(n instanceof eg)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Aa)return{bytesValue:SN(i.serializer,n._byteString)};if(n instanceof ts){const a=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(a))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Vf(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof tg)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Bu("VectorValues must only contain numeric values.");return Df(l.serializer,d)})}}}}}}(n,i);throw i.Bu(`Unsupported field value: ${ku(n)}`)}(t,e)}function n1(t,e){const s={};return eN(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ci(t,(n,i)=>{const a=Fl(i,e.Mu(n));a!=null&&(s[n]=a)}),{mapValue:{fields:s}}}function i1(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof J||t instanceof eg||t instanceof Aa||t instanceof ts||t instanceof Zf||t instanceof tg)}function rg(t,e,s){if(!i1(s)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(s)){const n=ku(s);throw n==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+n)}}function dp(t,e,s){if((e=st(e))instanceof Ol)return e._internalPath;if(typeof e=="string")return ng(t,e);throw $d("Field path arguments must be of type string or ",t,!1,void 0,s)}const LP=new RegExp("[~\\*/\\[\\]]");function ng(t,e,s){if(e.search(LP)>=0)throw $d(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,s);try{return new Ol(...e.split("."))._internalPath}catch{throw $d(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,s)}}function $d(t,e,s,n,i){const a=n&&!n.isEmpty(),o=i!==void 0;let l=`Function ${e}() called with invalid data`;s&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(a||o)&&(d+=" (found",a&&(d+=` in field ${n}`),o&&(d+=` in document ${i}`),d+=")"),new ge(te.INVALID_ARGUMENT,l+t+d)}function a1(t,e){return t.some(s=>s.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o1{constructor(e,s,n,i,a){this._firestore=e,this._userDataWriter=s,this._key=n,this._document=i,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new ts(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new VP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const s=this._document.data.field(Pu("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s)}}}class VP extends o1{data(){return super.data()}}function Pu(t,e){return typeof e=="string"?ng(t,e):e instanceof Ol?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ge(te.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ig{}class ag extends ig{}function Ne(t,e,...s){let n=[];e instanceof ig&&n.push(e),n=n.concat(s),function(a){const o=a.filter(d=>d instanceof og).length,l=a.filter(d=>d instanceof Du).length;if(o>1||o>0&&l>0)throw new ge(te.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)t=i._apply(t);return t}class Du extends ag{constructor(e,s,n){super(),this._field=e,this._op=s,this._value=n,this.type="where"}static _create(e,s,n){return new Du(e,s,n)}_apply(e){const s=this._parse(e);return c1(e._query,s),new en(e.firestore,e.converter,tp(e._query,s))}_parse(e){const s=Tu(e.firestore);return function(a,o,l,d,u,m,h){let f;if(u.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new ge(te.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Xy(h,m);const x=[];for(const y of h)x.push(Yy(d,a,y));f={arrayValue:{values:x}}}else f=Yy(d,a,h)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Xy(h,m),f=MP(l,o,h,m==="in"||m==="not-in");return At.create(u,m,f)}(e._query,"where",s,e.firestore._databaseId,this._field,this._op,this._value)}}function oe(t,e,s){const n=e,i=Pu("where",t);return Du._create(i,n,s)}class og extends ig{constructor(e,s){super(),this.type=e,this._queryConstraints=s}static _create(e,s){return new og(e,s)}_parse(e){const s=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return s.length===1?s[0]:ar.create(s,this._getOperator())}_apply(e){const s=this._parse(e);return s.getFilters().length===0?e:(function(i,a){let o=i;const l=a.getFlattenedFilters();for(const d of l)c1(o,d),o=tp(o,d)}(e._query,s),new en(e.firestore,e.converter,tp(e._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class lg extends ag{constructor(e,s){super(),this._field=e,this._direction=s,this.type="orderBy"}static _create(e,s){return new lg(e,s)}_apply(e){const s=function(i,a,o){if(i.startAt!==null)throw new ge(te.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new ge(te.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ul(a,o)}(e._query,this._field,this._direction);return new en(e.firestore,e.converter,function(i,a){const o=i.explicitOrderBy.concat([a]);return new Da(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,s))}}function wi(t,e="asc"){const s=e,n=Pu("orderBy",t);return lg._create(n,s)}class cg extends ag{constructor(e,s,n){super(),this.type=e,this._limit=s,this._limitType=n}static _create(e,s,n){return new cg(e,s,n)}_apply(e){return new en(e.firestore,e.converter,Pd(e._query,this._limit,this._limitType))}}function OP(t){return cg._create("limit",t,"F")}function Yy(t,e,s){if(typeof(s=st(s))=="string"){if(s==="")throw new ge(te.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cN(e)&&s.indexOf("/")!==-1)throw new ge(te.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const n=e.path.child(lt.fromString(s));if(!Se.isDocumentKey(n))throw new ge(te.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return xy(t,new Se(n))}if(s instanceof ts)return xy(t,s._key);throw new ge(te.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ku(s)}.`)}function Xy(t,e){if(!Array.isArray(t)||t.length===0)throw new ge(te.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function c1(t,e){const s=function(i,a){for(const o of i)for(const l of o.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(s!==null)throw s===e.op?new ge(te.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ge(te.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${s.toString()}' filters.`)}class FP{convertValue(e,s="none"){switch(bi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,s);case 5:return e.stringValue;case 6:return this.convertBytes(vi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,s);case 11:return this.convertObject(e.mapValue,s);case 10:return this.convertVectorValue(e.mapValue);default:throw Ie()}}convertObject(e,s){return this.convertObjectMap(e.fields,s)}convertObjectMap(e,s="none"){const n={};return Ci(e,(i,a)=>{n[i]=this.convertValue(a,s)}),n}convertVectorValue(e){var s,n,i;const a=(i=(n=(s=e.fields)===null||s===void 0?void 0:s.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(o=>wt(o.doubleValue));return new tg(a)}convertGeoPoint(e){return new eg(wt(e.latitude),wt(e.longitude))}convertArray(e,s){return(e.values||[]).map(n=>this.convertValue(n,s))}convertServerTimestamp(e,s){switch(s){case"previous":const n=Cf(e);return n==null?null:this.convertValue(n,s);case"estimate":return this.convertTimestamp(ll(e));default:return null}}convertTimestamp(e){const s=On(e);return new J(s.seconds,s.nanos)}convertDocumentKey(e,s){const n=lt.fromString(e);tt(TN(n));const i=new cl(n.get(1),n.get(3)),a=new Se(n.popFirst(5));return i.isEqual(s)||Hr(`Document ${a} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(t,e,s){let n;return n=t?s&&(s.merge||s.mergeFields)?t.toFirestore(e,s):t.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e,s){this.hasPendingWrites=e,this.fromCache=s}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class u1 extends o1{constructor(e,s,n,i,a,o){super(e,s,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const s=new Kc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,s={}){if(this._document){const n=this._document.data.field(Pu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,s.serverTimestamps)}}}class Kc extends u1{data(e={}){return super.data(e)}}class m1{constructor(e,s,n,i){this._firestore=e,this._userDataWriter=s,this._snapshot=i,this.metadata=new yo(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(s=>e.push(s)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,s){this._snapshot.docs.forEach(n=>{e.call(s,new Kc(this._firestore,this._userDataWriter,n.key,n,new yo(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const s=!!e.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new ge(te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(i,a){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(l=>{const d=new Kc(i._firestore,i._userDataWriter,l.doc.key,l.doc,new yo(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:d,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>a||l.type!==3).map(l=>{const d=new Kc(i._firestore,i._userDataWriter,l.doc.key,l.doc,new yo(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,m=-1;return l.type!==0&&(u=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),m=o.indexOf(l.doc.key)),{type:$P(l.type),doc:d,oldIndex:u,newIndex:m}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function $P(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ie()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(t){t=Ss(t,ts);const e=Ss(t.firestore,Qr);return EP(Vl(e),t._key).then(s=>h1(e,t,s))}class dg extends FP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Aa(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new ts(this.firestore,null,s)}}function _e(t){t=Ss(t,en);const e=Ss(t.firestore,Qr),s=Vl(e),n=new dg(e);return l1(t._query),AP(s,t._query).then(i=>new m1(e,n,t,i))}function Ze(t,e,s){t=Ss(t,ts);const n=Ss(t.firestore,Qr),i=d1(t.converter,e,s);return Mu(n,[t1(Tu(n),"setDoc",t._key,i,t.converter!==null,s).toMutation(t._key,_s.none())])}function pt(t,e,s,...n){t=Ss(t,ts);const i=Ss(t.firestore,Qr),a=Tu(i);let o;return o=typeof(e=st(e))=="string"||e instanceof Ol?r1(a,"updateDoc",t._key,e,s,n):s1(a,"updateDoc",t._key,e),Mu(i,[o.toMutation(t._key,_s.exists(!0))])}function Ds(t){return Mu(Ss(t.firestore,Qr),[new _u(t._key,_s.none())])}function zP(t,...e){var s,n,i;t=st(t);let a={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Qy(e[o])||(a=e[o],o++);const l={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(Qy(e[o])){const h=e[o];e[o]=(s=h.next)===null||s===void 0?void 0:s.bind(h),e[o+1]=(n=h.error)===null||n===void 0?void 0:n.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let d,u,m;if(t instanceof ts)u=Ss(t.firestore,Qr),m=vu(t._key.path),d={next:h=>{e[o]&&e[o](h1(u,t,h))},error:e[o+1],complete:e[o+2]};else{const h=Ss(t,en);u=Ss(h.firestore,Qr),m=h._query;const f=new dg(u);d={next:x=>{e[o]&&e[o](new m1(u,f,h,x))},error:e[o+1],complete:e[o+2]},l1(t._query)}return function(f,x,y,P){const _=new Jf(P),C=new Yf(x,_,y);return f.asyncQueue.enqueueAndForget(async()=>Hf(await Fd(f),C)),()=>{_.Za(),f.asyncQueue.enqueueAndForget(async()=>Kf(await Fd(f),C))}}(Vl(u),m,l,d)}function Mu(t,e){return function(n,i){const a=new Vr;return n.asyncQueue.enqueueAndForget(async()=>fP(await SP(n),i,a)),a.promise}(Vl(t),e)}function h1(t,e,s){const n=s.docs.get(e._key),i=new dg(t);return new u1(t,i,e._key,n,new yo(s.hasPendingWrites,s.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,s){this._firestore=e,this._commitHandler=s,this._mutations=[],this._committed=!1,this._dataReader=Tu(e)}set(e,s,n){this._verifyNotCommitted();const i=Um(e,this._firestore),a=d1(i.converter,s,n),o=t1(this._dataReader,"WriteBatch.set",i._key,a,i.converter!==null,n);return this._mutations.push(o.toMutation(i._key,_s.none())),this}update(e,s,n,...i){this._verifyNotCommitted();const a=Um(e,this._firestore);let o;return o=typeof(s=st(s))=="string"||s instanceof Ol?r1(this._dataReader,"WriteBatch.update",a._key,s,n,i):s1(this._dataReader,"WriteBatch.update",a._key,s),this._mutations.push(o.toMutation(a._key,_s.exists(!0))),this}delete(e){this._verifyNotCommitted();const s=Um(e,this._firestore);return this._mutations=this._mutations.concat(new _u(s._key,_s.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ge(te.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Um(t,e){if((t=st(t)).firestore!==e)throw new ge(te.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jy(t){return Vl(t=Ss(t,Qr)),new UP(t,e=>Mu(t,e))}(function(e,s=!0){(function(i){Pa=i})(Ii),Ln(new qr("firestore",(n,{instanceIdentifier:i,options:a})=>{const o=n.getProvider("app").getImmediate(),l=new Qr(new KT(n.getProvider("auth-internal")),new JT(n.getProvider("app-check-internal")),function(u,m){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new ge(te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cl(u.options.projectId,m)}(o,i),o);return a=Object.assign({useFetchStreams:s},a),l._setSettings(a),l},"PUBLIC").setMultipleInstances(!0)),Bs(my,"4.7.3",e),Bs(my,"4.7.3","esm2017")})();var BP="firebase",qP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bs(BP,qP,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p1="firebasestorage.googleapis.com",GP="storageBucket",WP=2*60*1e3,HP=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r extends jr{constructor(e,s,n=0){super(Bm(e),`Firebase Storage: ${s} (${Bm(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,_r.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Bm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var vr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(vr||(vr={}));function Bm(t){return"storage/"+t}function KP(){const t="An unknown error occurred, please check the error payload for server response.";return new _r(vr.UNKNOWN,t)}function QP(){return new _r(vr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function YP(){return new _r(vr.CANCELED,"User canceled the upload/download.")}function XP(t){return new _r(vr.INVALID_URL,"Invalid URL '"+t+"'.")}function JP(t){return new _r(vr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Zy(t){return new _r(vr.INVALID_ARGUMENT,t)}function f1(){return new _r(vr.APP_DELETED,"The Firebase app was deleted.")}function ZP(t){return new _r(vr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e,s){this.bucket=e,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,s){let n;try{n=er.makeFromUrl(e,s)}catch{return new er(e,"")}if(n.path==="")return n;throw JP(e)}static makeFromUrl(e,s){let n=null;const i="([A-Za-z0-9.\\-_]+)";function a(S){S.path.charAt(S.path.length-1)==="/"&&(S.path_=S.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+i+o,"i"),d={bucket:1,path:3};function u(S){S.path_=decodeURIComponent(S.path)}const m="v[A-Za-z0-9_]+",h=s.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",x=new RegExp(`^https?://${h}/${m}/b/${i}/o${f}`,"i"),y={bucket:1,path:3},P=s===p1?"(?:storage.googleapis.com|storage.cloud.google.com)":s,_="([^?#]*)",C=new RegExp(`^https?://${P}/${i}/${_}`,"i"),T=[{regex:l,indices:d,postModify:a},{regex:x,indices:y,postModify:u},{regex:C,indices:{bucket:1,path:2},postModify:u}];for(let S=0;S<T.length;S++){const D=T[S],R=D.regex.exec(e);if(R){const v=R[D.indices.bucket];let b=R[D.indices.path];b||(b=""),n=new er(v,b),D.postModify(n);break}}if(n==null)throw XP(e);return n}}class e5{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t5(t,e,s){let n=1,i=null,a=null,o=!1,l=0;function d(){return l===2}let u=!1;function m(..._){u||(u=!0,e.apply(null,_))}function h(_){i=setTimeout(()=>{i=null,t(x,d())},_)}function f(){a&&clearTimeout(a)}function x(_,...C){if(u){f();return}if(_){f(),m.call(null,_,...C);return}if(d()||o){f(),m.call(null,_,...C);return}n<64&&(n*=2);let T;l===1?(l=2,T=0):T=(n+Math.random())*1e3,h(T)}let y=!1;function P(_){y||(y=!0,f(),!u&&(i!==null?(_||(l=2),clearTimeout(i),h(0)):_||(l=1)))}return h(0),a=setTimeout(()=>{o=!0,P(!0)},s),P}function s5(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r5(t){return t!==void 0}function ev(t,e,s,n){if(n<e)throw Zy(`Invalid value for '${t}'. Expected ${e} or greater.`);if(n>s)throw Zy(`Invalid value for '${t}'. Expected ${s} or less.`)}function n5(t){const e=encodeURIComponent;let s="?";for(const n in t)if(t.hasOwnProperty(n)){const i=e(n)+"="+e(t[n]);s=s+i+"&"}return s=s.slice(0,-1),s}var zd;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(zd||(zd={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i5(t,e){const s=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,a=e.indexOf(t)!==-1;return s||i||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5{constructor(e,s,n,i,a,o,l,d,u,m,h,f=!0){this.url_=e,this.method_=s,this.headers_=n,this.body_=i,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=d,this.timeout_=u,this.progressCallback_=m,this.connectionFactory_=h,this.retry=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,y)=>{this.resolve_=x,this.reject_=y,this.start_()})}start_(){const e=(n,i)=>{if(i){n(!1,new Ec(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=l=>{const d=l.loaded,u=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(d,u)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const l=a.getErrorCode()===zd.NO_ERROR,d=a.getStatus();if(!l||i5(d,this.additionalRetryCodes_)&&this.retry){const m=a.getErrorCode()===zd.ABORT;n(!1,new Ec(!1,null,m));return}const u=this.successCodes_.indexOf(d)!==-1;n(!0,new Ec(u,a))})},s=(n,i)=>{const a=this.resolve_,o=this.reject_,l=i.connection;if(i.wasSuccessCode)try{const d=this.callback_(l,l.getResponse());r5(d)?a(d):a()}catch(d){o(d)}else if(l!==null){const d=KP();d.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,d)):o(d)}else if(i.canceled){const d=this.appDelete_?f1():YP();o(d)}else{const d=QP();o(d)}};this.canceled_?s(!1,new Ec(!1,null,!0)):this.backoffId_=t5(e,s,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&s5(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ec{constructor(e,s,n){this.wasSuccessCode=e,this.connection=s,this.canceled=!!n}}function o5(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function l5(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function c5(t,e){e&&(t["X-Firebase-GMPID"]=e)}function d5(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function u5(t,e,s,n,i,a,o=!0){const l=n5(t.urlParams),d=t.url+l,u=Object.assign({},t.headers);return c5(u,e),o5(u,s),l5(u,a),d5(u,n),new a5(d,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function h5(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,s){this._service=e,s instanceof er?this._location=s:this._location=er.makeFromUrl(s,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,s){return new Ud(e,s)}get root(){const e=new er(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return h5(this._location.path)}get storage(){return this._service}get parent(){const e=m5(this._location.path);if(e===null)return null;const s=new er(this._location.bucket,e);return new Ud(this._service,s)}_throwIfRoot(e){if(this._location.path==="")throw ZP(e)}}function tv(t,e){const s=e==null?void 0:e[GP];return s==null?null:er.makeFromBucketSpec(s,t)}function p5(t,e,s,n={}){t.host=`${e}:${s}`,t._protocol="http";const{mockUserToken:i}=n;i&&(t._overrideAuthToken=typeof i=="string"?i:rj(i,t.app.options.projectId))}class f5{constructor(e,s,n,i,a){this.app=e,this._authProvider=s,this._appCheckProvider=n,this._url=i,this._firebaseVersion=a,this._bucket=null,this._host=p1,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=WP,this._maxUploadRetryTime=HP,this._requests=new Set,i!=null?this._bucket=er.makeFromBucketSpec(i,this._host):this._bucket=tv(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=er.makeFromBucketSpec(this._url,e):this._bucket=tv(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ev("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ev("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const s=await e.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ud(this,e)}_makeRequest(e,s,n,i,a=!0){if(this._deleted)return new e5(f1());{const o=u5(e,this._appId,n,i,s,this._firebaseVersion,a);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,s){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,s,n,i).getPromise()}}const sv="@firebase/storage",rv="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g1="storage";function g5(t=pu(),e){t=st(t);const n=El(t,g1).getImmediate({identifier:e}),i=hf("storage");return i&&x5(n,...i),n}function x5(t,e,s,n={}){p5(t,e,s,n)}function y5(t,{instanceIdentifier:e}){const s=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new f5(s,n,i,e,Ii)}function v5(){Ln(new qr(g1,y5,"PUBLIC").setMultipleInstances(!0)),Bs(sv,rv,""),Bs(sv,rv,"esm2017")}v5();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x1="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(e,s,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||s.get().then(i=>this.messaging=i,()=>{}),this.appCheck||n.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const s=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return s.error?null:s.token}return null}async getContext(e){const s=await this.getAuthToken(),n=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:s,messagingToken:n,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const up="us-central1";class w5{constructor(e,s,n,i,a=up,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new b5(s,n,i),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=up}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const s=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${s}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${s}.cloudfunctions.net/${e}`}}function j5(t,e,s){t.emulatorOrigin=`http://${e}:${s}`}const nv="@firebase/functions",iv="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N5="auth-internal",_5="app-check-internal",S5="messaging-internal";function E5(t,e){const s=(n,{instanceIdentifier:i})=>{const a=n.getProvider("app").getImmediate(),o=n.getProvider(N5),l=n.getProvider(S5),d=n.getProvider(_5);return new w5(a,o,l,d,i,t)};Ln(new qr(x1,s,"PUBLIC").setMultipleInstances(!0)),Bs(nv,iv,e),Bs(nv,iv,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A5(t=pu(),e=up){const n=El(st(t),x1).getImmediate({identifier:e}),i=hf("functions");return i&&I5(n,...i),n}function I5(t,e,s){j5(st(t),e,s)}E5(fetch.bind(self));const k5={apiKey:"AIzaSyBS9dLh1WJEpeMpqqday6I4ptNelQVvmrs",authDomain:"saas-915ec.firebaseapp.com",projectId:"saas-915ec",storageBucket:"saas-915ec.appspot.com",messagingSenderId:"1029638100897",appId:"1:1029638100897:web:acb7e6fe5453e0872b5de0"},Lu=aj(k5),H=CP(Lu),We=Gj(Lu);g5(Lu);A5(Lu);We.useDeviceLanguage();const ug=t=>["superadmin@saaspos.mg","admin@saaspos.mg","manager@saaspos.mg","cashier@saaspos.mg","reader@saaspos.mg"].includes(t.toLowerCase()),C5=t=>t==="demo-establishment-main",mg=t=>t.toLowerCase()==="superadmin@saaspos.mg",T5=async t=>{console.log("🔧 Création d'un document utilisateur par défaut pour:",t.uid);const e=t.email||"";let s="reader",n=!1,i=!1,a=!1,o="";e==="superadmin@saaspos.mg"?(s="superadmin",n=!0,i=!0,o="SYSTEM_ADMIN"):e==="admin@saaspos.mg"?(s="admin",a=!0,o="demo-establishment-main"):e==="manager@saaspos.mg"?(s="manager",o="demo-establishment-main"):e==="cashier@saaspos.mg"?(s="cashier",o="demo-establishment-main"):e==="reader@saaspos.mg"?(s="reader",o="demo-establishment-main"):(s="admin",a=!0,o=`establishment_${t.uid}`);const l={id:t.uid,email:e,name:t.displayName||e.split("@")[0],role:s,establishmentId:o,isActive:!0,isSuperAdmin:n,isSystemAdmin:i,isClientAdmin:a,lastLogin:J.now(),createdAt:J.now(),updatedAt:J.now()};try{await Ze(me(H,"users",t.uid),l),console.log("✅ Document utilisateur créé avec succès:",t.uid)}catch(u){throw console.error("❌ Erreur lors de la création du document utilisateur:",u),new Error("Impossible de créer le profil utilisateur")}return{id:t.uid,email:e,name:l.name,role:s,establishmentId:o,isActive:!0,isSuperAdmin:n,isSystemAdmin:i,isClientAdmin:a,lastLogin:new Date,createdAt:new Date,updatedAt:new Date}},y1=async t=>{var e,s,n;try{console.log("🔍 Récupération des données utilisateur pour:",t);const i=await hs(me(H,"users",t));if(!i.exists())return console.log("ℹ️ Données utilisateur non trouvées dans Firestore pour:",t),null;const a=i.data(),o={id:t,email:a.email,name:a.name,role:a.role,establishmentId:a.establishmentId,isActive:a.isActive??!0,lastLogin:((e=a.lastLogin)==null?void 0:e.toDate())||null,createdAt:((s=a.createdAt)==null?void 0:s.toDate())||new Date,updatedAt:((n=a.updatedAt)==null?void 0:n.toDate())||new Date,isSuperAdmin:a.isSuperAdmin||!1,isSystemAdmin:a.isSystemAdmin||!1,isClientAdmin:a.isClientAdmin||!1};return console.log("✅ Données utilisateur récupérées:",t,{role:o.role,isSystemAdmin:o.isSystemAdmin,establishmentId:o.establishmentId}),o}catch(i){return console.error("❌ Erreur lors de la récupération des données utilisateur:",i),null}},R5=async(t,e)=>{try{if(!We)throw new Error("Firebase Auth n'est pas initialisé");console.log("🔑 Tentative de connexion pour:",t),await TC(We,_f);const s=await il(We,t,e);if(!s.user)throw new Error("Aucun utilisateur retourné");let n=await y1(s.user.uid);n||(console.log("🔧 Aucun document utilisateur trouvé, création d'un document par défaut..."),n=await T5(s.user));try{await Ze(me(H,"users",s.user.uid),{lastLogin:J.now(),updatedAt:J.now()},{merge:!0})}catch(i){console.warn("⚠️ Impossible de mettre à jour la dernière connexion:",i)}return console.log("✅ Connexion réussie:",s.user.uid,{role:n.role,isSystemAdmin:n.isSystemAdmin,establishmentId:n.establishmentId}),n}catch(s){console.error("❌ Erreur lors de la connexion:",s);const n=s.code,i=s.message||"";let a;if(n==="auth/invalid-credential"||i.includes("auth/invalid-credential"))a="Email ou mot de passe incorrect";else switch(n){case"auth/user-not-found":a="Cet email n'est pas enregistré. Créez d'abord un compte.";break;case"auth/wrong-password":a="Mot de passe incorrect.";break;case"auth/invalid-email":a="Format d'email invalide.";break;case"auth/user-disabled":a="Ce compte a été désactivé.";break;case"auth/too-many-requests":a="Trop de tentatives. Veuillez réessayez plus tard.";break;case"auth/network-request-failed":a="Problème de connexion réseau.";break;default:i.includes("invalid-credential")||i.includes("wrong-password")||i.includes("user-not-found")?a="Email ou mot de passe incorrect":a=`Erreur de connexion: ${s.message}`;break}throw new Error(a)}},P5=async t=>{try{if(console.log("📝 Tentative d'inscription pour:",t.email),ug(t.email))throw new Error("Cet email est réservé pour la démonstration. Veuillez utiliser une autre adresse email.");if(mg(t.email))throw new Error("Cet email est réservé pour l'administration système. Veuillez utiliser une autre adresse email.");const e=await nl(We,t.email,t.password);if(!e.user)throw new Error("Aucun utilisateur créé");await al(e.user,{displayName:t.name});const s=`establishment_${Date.now()}`,n={id:s,name:t.establishmentName,address:"",phone:"",email:t.email,currency:"MGA",taxRate:20,authorizedUsers:[e.user.uid],createdAt:J.now(),updatedAt:J.now()};await Ze(me(H,"establishments",s),n);const i={id:e.user.uid,email:t.email,name:t.name,role:"admin",establishmentId:s,isActive:!0,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:!0,lastLogin:null,createdAt:J.now(),updatedAt:J.now()};await Ze(me(H,"users",e.user.uid),i);const a=[{id:"beverages",name:"Boissons",color:"blue"},{id:"food",name:"Alimentation",color:"green"},{id:"household",name:"Ménage",color:"purple"},{id:"electronics",name:"Électronique",color:"yellow"},{id:"clothing",name:"Vêtements",color:"pink"},{id:"health",name:"Santé & Beauté",color:"indigo"}];for(const l of a){const d={...l,establishmentId:s,createdAt:J.now()};await Ze(me(H,"categories",`${s}_${l.id}`),d)}const o={id:e.user.uid,email:t.email,name:t.name,role:"admin",establishmentId:s,isActive:!0,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:!0,lastLogin:null,createdAt:new Date,updatedAt:new Date};return console.log("✅ Inscription réussie:",e.user.uid),o}catch(e){console.error("❌ Erreur lors de l'inscription:",e);let s;switch(e.code){case"auth/email-already-in-use":s="Cet email est déjà utilisé.";break;case"auth/weak-password":s="Mot de passe trop faible (min 6 caractères).";break;case"auth/invalid-email":s="Format d'email invalide.";break;case"auth/operation-not-allowed":s="Inscription par email/mot de passe non activée.";break;default:s=e.message||"Erreur d'inscription";break}throw new Error(s)}},D5=async()=>{try{await ca(We),localStorage.clear(),sessionStorage.clear(),window.location.href="/login"}catch(t){throw console.error("Erreur lors de la déconnexion:",t),t}},M5=async(t,e)=>{try{if(console.log("🗑️ Tentative de suppression complète de l'utilisateur:",t,e),ug(e))throw new Error("Les comptes de démonstration ne peuvent pas être supprimés.");if(mg(e))throw new Error("Les comptes Super Admin système ne peuvent pas être supprimés par cette méthode.");await Ds(me(H,"users",t)),console.log("✅ Document Firestore supprimé"),console.log("⚠️ La suppression complète de Firebase Auth nécessite la console Firebase");try{const s=Ne(je(H,"users"),oe("email","==",e)),n=await _e(s);if(!n.empty){console.log("⚠️ Des documents utilisateur avec cet email existent encore:",n.size);for(const i of n.docs)await Ds(i.ref),console.log("✅ Document supplémentaire supprimé:",i.id)}}catch(s){console.error("❌ Erreur lors de la recherche de documents supplémentaires:",s)}}catch(s){throw console.error("❌ Erreur lors de la suppression complète de l'utilisateur:",s),s}},L5=()=>We.currentUser,V5=t=>DC(We,t),O5=()=>!!We.currentUser,as={signIn:R5,signUp:P5,logout:D5,getCurrentUser:L5,onAuthStateChange:V5,isAuthenticated:O5,getUserById:y1,deleteUserCompletely:M5,isDemoEmail:ug,isDemoEstablishment:C5,isSuperAdminEmail:mg},Le=ZA((t,e)=>({user:null,isLoading:!0,error:null,isInitialized:!1,signIn:async s=>{t({isLoading:!0,error:null});try{const n=await as.signIn(s.email,s.password);t({user:n,isLoading:!1})}catch(n){throw t({error:n.message||"Erreur de connexion",isLoading:!1}),n}},signUp:async s=>{t({isLoading:!0,error:null});try{const n=await as.signUp(s);t({user:n,isLoading:!1})}catch(n){throw t({error:n.message||"Erreur d'inscription",isLoading:!1}),n}},signOut:async()=>{t({isLoading:!0});try{await as.logout(),t({user:null,isLoading:!1})}catch(s){throw t({error:s.message||"Erreur de déconnexion",isLoading:!1}),s}},clearError:()=>t({error:null}),setLoading:s=>t({isLoading:s}),setUser:s=>t({user:s}),initialize:()=>{e().isInitialized||(t({isInitialized:!0}),as.onAuthStateChange(async s=>{if(s)try{const n=await as.getUserById(s.uid);n===null?(console.log("ℹ️ Données utilisateur en cours de création..."),t({user:null,isLoading:!1,error:null})):t({user:n,isLoading:!1,error:null})}catch(n){console.error("❌ Erreur lors de la récupération des données utilisateur:",n),t({user:null,isLoading:!1,error:null})}else t({user:null,isLoading:!1,error:null})}))}}));/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var F5={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $5=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),le=(t,e)=>{const s=A.forwardRef(({color:n="currentColor",size:i=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:l="",children:d,...u},m)=>A.createElement("svg",{ref:m,...F5,width:i,height:i,stroke:n,strokeWidth:o?Number(a)*24/Number(i):a,className:["lucide",`lucide-${$5(t)}`,l].join(" "),...u},[...e.map(([h,f])=>A.createElement(h,f)),...Array.isArray(d)?d:[d]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z5=le("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=le("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=le("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U5=le("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B5=le("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v1=le("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mp=le("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=le("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vu=le("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1=le("Barcode",[["path",{d:"M3 5v14",key:"1nt18q"}],["path",{d:"M8 5v14",key:"1ybrkv"}],["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"M17 5v14",key:"ycjyhj"}],["path",{d:"M21 5v14",key:"nzette"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q5=le("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G5=le("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=le("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const av=le("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=le("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W5=le("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=le("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w1=le("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j1=le("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=le("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=le("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=le("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H5=le("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qm=le("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=le("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N1=le("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=le("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=le("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=le("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K5=le("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pl=le("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=le("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xr=le("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1=le("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q5=le("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y5=le("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X5=le("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1=le("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=le("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=le("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J5=le("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ov=le("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=le("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lo=le("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=le("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bd=le("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z5=le("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=le("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=le("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e6=le("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gd=le("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wd=le("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=le("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=le("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=le("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=le("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=le("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=le("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ji=le("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=le("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=le("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=le("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=le("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=le("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wr=le("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=le("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=le("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=le("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t6=le("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=le("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ni=le("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const or=le("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lv=le("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fu=le("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s6=le("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=le("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=le("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r6=le("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n6=le("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i6=le("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=le("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=le("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=le("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),cv=[{id:"dashboard",label:"Dashboard",path:"/",icon:J5,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",requiredRoles:["admin","manager","cashier","reader"]},{id:"pos",label:"Point de Vente",path:"/pos",icon:br,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",requiredRoles:["admin","manager","cashier"]},{id:"cash-register",label:"Caisse",path:"/cash-register",icon:kt,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",requiredRoles:["admin","manager","cashier"]},{id:"products",label:"Produits",path:"/products",icon:ht,color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",requiredRoles:["admin","manager","reader"]},{id:"categories",label:"Catégories",path:"/categories",icon:zn,color:"text-pink-600",bgColor:"bg-pink-50",borderColor:"border-pink-200",requiredRoles:["admin","manager"]},{id:"stores",label:"Magasins",path:"/stores",icon:Yr,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",requiredRoles:["admin","manager","reader"]},{id:"customers",label:"Clients",path:"/customers",icon:Ke,color:"text-indigo-600",bgColor:"bg-indigo-50",borderColor:"border-indigo-200",requiredRoles:["admin","manager","reader"]},{id:"sales",label:"Ventes",path:"/sales",icon:ds,color:"text-teal-600",bgColor:"bg-teal-50",borderColor:"border-teal-200",requiredRoles:["admin","manager","cashier","reader"]},{id:"receipts",label:"Reçus",path:"/receipts",icon:Xr,color:"text-emerald-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200",requiredRoles:["admin","manager","cashier","reader"]},{id:"expenses",label:"Dépenses",path:"/expenses",icon:Ni,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",requiredRoles:["admin","manager","reader"]},{id:"reports",label:"Rapports",path:"/reports",icon:Vu,color:"text-cyan-600",bgColor:"bg-cyan-50",borderColor:"border-cyan-200",requiredRoles:["admin","manager","reader"]},{id:"settings",label:"Paramètres",path:"/settings",icon:$n,color:"text-gray-600",bgColor:"bg-gray-50",borderColor:"border-gray-200",requiredRoles:["admin"]}],a6=[{id:"subscription",label:"Abonnement",path:"/subscription",icon:N1,color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",requiredRoles:["admin"]}],o6=[{id:"admin-payments",label:"Validation Paiements",path:"/admin/payments",icon:Lt,color:"text-emerald-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200",requiredRoles:["admin"]}],l6=({collapsed:t,onToggleCollapse:e,mobileOpen:s,onMobileToggle:n})=>{const i=Ei(),a=jl(),{user:o,signOut:l}=Le(),[d,u]=A.useState(!1),m=(v,b)=>{a(v),window.innerWidth<1024&&n(),L.success(`Navigation vers ${b}`,{duration:2e3,icon:"🚀"})},h=()=>{l(),L.success("À bientôt ! Déconnexion réussie",{duration:3e3,icon:"👋"})},f=v=>v==="/"?i.pathname==="/":i.pathname.startsWith(v),y=(v=>{switch(v){case"admin":return{label:"Administrateur",color:"bg-gradient-to-r from-red-500 to-red-600 text-white",icon:Xe,description:"Accès complet"};case"manager":return{label:"Gérant",color:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",icon:Ke,description:"Gestion établissement"};case"cashier":return{label:"Caissier",color:"bg-gradient-to-r from-green-500 to-green-600 text-white",icon:br,description:"Ventes et caisse"};case"reader":return{label:"Lecteur",color:"bg-gradient-to-r from-purple-500 to-purple-600 text-white",icon:Eye,description:"Consultation seule"};default:return{label:v,color:"bg-gradient-to-r from-gray-500 to-gray-600 text-white",icon:Ke,description:"Utilisateur"}}})((o==null?void 0:o.role)||""),P=y.icon,C=(()=>{if((o==null?void 0:o.isSystemAdmin)===!0)return[...o6];if(o!=null&&o.establishmentId&&(o==null?void 0:o.establishmentId)!=="SYSTEM_ADMIN"){const v=cv.filter(N=>{var g;return(g=N.requiredRoles)==null?void 0:g.includes((o==null?void 0:o.role)||"")}),b=a6.filter(N=>{var g;return(g=N.requiredRoles)==null?void 0:g.includes((o==null?void 0:o.role)||"")});return[...v,...b]}return cv.filter(v=>{var b;return(b=v.requiredRoles)==null?void 0:b.includes((o==null?void 0:o.role)||"")})})(),T=(o==null?void 0:o.isSystemAdmin)===!0?{title:"SaaS POS Admin",subtitle:"Système"}:{title:"Nirina Nirina Pos",subtitle:"Madagascar"},D=(o==null?void 0:o.isSystemAdmin)===!0?{background:"bg-gradient-to-b from-gray-900 to-gray-800",border:"border-gray-700",header:"border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900",text:"text-gray-300",hoverBg:"hover:bg-gray-700",hoverText:"hover:text-white",activeText:"text-white",activeBg:"bg-gray-700",activeBorder:"border-gray-600",iconText:"text-gray-400",iconHover:"group-hover:text-white",titleGradient:"from-gray-200 to-gray-100",subtitleText:"text-gray-400",userProfileBg:"border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900",userCardBg:"bg-gray-700 border-gray-600",userCardText:"text-white",userCardSubtext:"text-gray-400",userBadgeBg:"bg-red-600",userBadgeText:"text-red-100",logoutText:"text-gray-300",logoutHoverBg:"hover:bg-gray-700",logoutHoverText:"hover:text-white"}:{background:"bg-white",border:"border-gray-200",header:"border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",text:"text-gray-600",hoverBg:"hover:bg-gray-100",hoverText:"hover:text-gray-900",activeText:"text-blue-600",activeBg:"bg-blue-50",activeBorder:"border-blue-200",iconText:"text-gray-400",iconHover:"group-hover:text-blue-600",titleGradient:"from-blue-600 to-blue-800",subtitleText:"text-gray-500",userProfileBg:"border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100",userCardBg:"bg-white border-gray-100",userCardText:"text-gray-900",userCardSubtext:"text-gray-500",userBadgeBg:"bg-blue-100",userBadgeText:"text-blue-800",logoutText:"text-red-600",logoutHoverBg:"hover:bg-red-50",logoutHoverText:"hover:text-red-700"},R=()=>r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-sm w-full",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Confirmer la déconnexion"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Êtes-vous sûr de vouloir vous déconnecter ?"}),r.jsxs("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md",children:"Annuler"}),r.jsx("button",{onClick:()=>{u(!1),h()},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md",children:"Déconnexion"})]})]})});return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:`hidden lg:flex lg:flex-col lg:fixed lg:inset-y-0 ${D.background} ${D.border} shadow-xl transition-all duration-300 z-30 ${t?"lg:w-16":"lg:w-64"}`,children:[r.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${D.header}`,children:[!t&&r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-lg transform hover:scale-105 transition-transform overflow-hidden",children:(o==null?void 0:o.isSystemAdmin)===!0?r.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center",children:r.jsx(Xe,{className:"w-6 h-6 text-white"})}):r.jsxs(r.Fragment,{children:[r.jsx("img",{src:"/nirina.jpg",alt:"Logo Nirina Nirina Pos",className:"w-full h-full object-cover",onError:v=>{var b;v.currentTarget.style.display="none",(b=v.currentTarget.nextElementSibling)==null||b.classList.remove("hidden")}}),r.jsx("div",{className:"hidden w-full h-full bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center",children:r.jsx(Ms,{className:"w-6 h-6 text-white"})})]})}),r.jsxs("div",{children:[r.jsx("h1",{className:`text-lg font-bold bg-gradient-to-r ${D.titleGradient} text-transparent bg-clip-text`,children:T.title}),r.jsx("p",{className:`text-xs font-medium ${D.subtitleText}`,children:T.subtitle})]})]}),r.jsx("button",{onClick:e,className:`p-2 rounded-lg transition-all duration-200 group ${D.hoverBg} hover:shadow-md`,title:t?"Étendre le menu":"Réduire le menu",children:t?r.jsx(Ou,{className:`w-5 h-5 transition-colors ${D.iconText} ${D.iconHover}`}):r.jsx(hp,{className:`w-5 h-5 transition-colors ${D.iconText} ${D.iconHover}`})})]}),r.jsx("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:C.map(v=>{const b=v.icon,N=f(v.path);return r.jsxs("button",{onClick:()=>m(v.path,v.label),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 group relative ${N?`${D.activeBg} ${D.activeText} shadow-md border ${D.activeBorder} transform scale-105`:`${D.text} ${D.hoverBg} ${D.hoverText} hover:shadow-sm`}`,title:t?v.label:"",children:[r.jsx(b,{className:`w-5 h-5 flex-shrink-0 transition-all duration-200 ${N?`${D.activeText} transform scale-110`:`${D.iconText} ${D.iconHover} group-hover:scale-105`}`}),!t&&r.jsx("span",{className:"font-medium text-sm transition-all duration-200",children:v.label}),N&&!t&&r.jsx("div",{className:"ml-auto",children:r.jsx(gl,{className:"w-4 h-4 text-current opacity-60"})}),N&&r.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-8 bg-current rounded-r-full opacity-80"})]},v.id)})}),r.jsx("div",{className:`p-4 border-t ${D.userProfileBg}`,children:t?r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center mx-auto shadow-md ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-gradient-to-r from-red-500 to-red-600 text-white":y.color}`,children:(o==null?void 0:o.isSystemAdmin)===!0?r.jsx(Xe,{className:"w-5 h-5"}):r.jsx(P,{className:"w-5 h-5"})}),r.jsx("button",{onClick:()=>u(!0),className:`w-full p-2 rounded-lg transition-all duration-200 hover:shadow-sm ${D.logoutText} ${D.logoutHoverBg} ${D.logoutHoverText}`,title:"Déconnexion",children:r.jsx(Lo,{className:"w-5 h-5 mx-auto hover:scale-110 transition-transform"})})]}):r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-xl shadow-sm border ${D.userCardBg}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shadow-md ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-gradient-to-r from-red-500 to-red-600 text-white":y.color}`,children:(o==null?void 0:o.isSystemAdmin)===!0?r.jsx(Xe,{className:"w-5 h-5"}):r.jsx(P,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-sm font-medium truncate ${D.userCardText}`,children:o==null?void 0:o.name}),r.jsx("p",{className:`text-xs truncate ${D.userCardSubtext}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin Système":y.description}),r.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full mt-1 ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-red-600 text-red-100":`${D.userBadgeBg} ${D.userBadgeText}`}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin":y.label})]})]}),r.jsxs("button",{onClick:()=>u(!0),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 group hover:shadow-sm ${D.logoutText} ${D.logoutHoverBg} ${D.logoutHoverText}`,children:[r.jsx(Lo,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),r.jsx("span",{className:"font-medium text-sm",children:"Déconnexion"})]})]})})]}),r.jsxs("div",{className:`lg:hidden fixed inset-y-0 left-0 z-50 w-64 ${D.background} ${D.border} shadow-2xl transform transition-transform duration-300 ${s?"translate-x-0":"-translate-x-full"}`,children:[r.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${D.header}`,children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center shadow-lg overflow-hidden",children:(o==null?void 0:o.isSystemAdmin)===!0?r.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-600 to-red-700 rounded-xl flex items-center justify-center",children:r.jsx(Xe,{className:"w-6 h-6 text-white"})}):r.jsxs(r.Fragment,{children:[r.jsx("img",{src:"/nirina.jpg",alt:"Logo Nirina Nirina Pos",className:"w-full h-full object-cover",onError:v=>{var b;v.currentTarget.style.display="none",(b=v.currentTarget.nextElementSibling)==null||b.classList.remove("hidden")}}),r.jsx("div",{className:"hidden w-full h-full bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center",children:r.jsx(Ms,{className:"w-6 h-6 text-white"})})]})}),r.jsxs("div",{children:[r.jsx("h1",{className:`text-lg font-bold bg-gradient-to-r ${D.titleGradient} text-transparent bg-clip-text`,children:T.title}),r.jsx("p",{className:`text-xs font-medium ${D.subtitleText}`,children:T.subtitle})]})]}),r.jsx("button",{onClick:n,className:`p-2 rounded-lg transition-all duration-200 ${D.hoverBg} hover:shadow-md`,children:r.jsx(hp,{className:`w-5 h-5 ${D.iconText}`})})]}),r.jsx("nav",{className:"flex-1 p-4 space-y-2 overflow-y-auto",children:C.map(v=>{const b=v.icon,N=f(v.path);return r.jsxs("button",{onClick:()=>m(v.path,v.label),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 relative ${N?`${D.activeBg} ${D.activeText} shadow-md border ${D.activeBorder}`:`${D.text} ${D.hoverBg} ${D.hoverText} hover:shadow-sm`}`,children:[r.jsx(b,{className:`w-5 h-5 transition-all duration-200 ${N?`${D.activeText} transform scale-110`:D.iconText}`}),r.jsx("span",{className:"font-medium text-sm",children:v.label}),N&&r.jsx("div",{className:"ml-auto",children:r.jsx(gl,{className:"w-4 h-4 text-current opacity-60"})}),N&&r.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 w-1 h-8 bg-current rounded-r-full opacity-80"})]},v.id)})}),r.jsx("div",{className:`p-4 border-t ${D.userProfileBg}`,children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-xl shadow-sm border ${D.userCardBg}`,children:[r.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shadow-md ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-gradient-to-r from-red-500 to-red-600 text-white":y.color}`,children:(o==null?void 0:o.isSystemAdmin)===!0?r.jsx(Xe,{className:"w-5 h-5"}):r.jsx(P,{className:"w-5 h-5"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:`text-sm font-medium truncate ${D.userCardText}`,children:o==null?void 0:o.name}),r.jsx("p",{className:`text-xs truncate ${D.userCardSubtext}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin Système":y.description}),r.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full mt-1 ${(o==null?void 0:o.isSystemAdmin)===!0?"bg-red-600 text-red-100":`${D.userBadgeBg} ${D.userBadgeText}`}`,children:(o==null?void 0:o.isSystemAdmin)===!0?"Super Admin":y.label})]})]}),r.jsxs("button",{onClick:()=>u(!0),className:`w-full flex items-center space-x-3 px-3 py-3 rounded-xl transition-all duration-200 hover:shadow-sm ${D.logoutText} ${D.logoutHoverBg} ${D.logoutHoverText}`,children:[r.jsx(Lo,{className:"w-5 h-5"}),r.jsx("span",{className:"font-medium text-sm",children:"Déconnexion"})]})]})})]}),d&&r.jsx(R,{})]})},c6={"/":"Tableau de bord","/pos":"Point de Vente","/cash-register":"Gestion de Caisse","/products":"Gestion des Produits","/categories":"Gestion des Catégories","/stores":"Gestion des Magasins","/customers":"Gestion des Clients","/sales":"Historique des Ventes","/receipts":"Historique des Reçus","/expenses":"Gestion des Dépenses","/reports":"Rapports & Analytics","/settings":"Paramètres","/subscription":"Gestion de l'Abonnement","/admin/payments":"Validation des Paiements"},d6=({onMenuToggle:t,onSidebarToggle:e,sidebarCollapsed:s})=>{const n=Ei(),i=jl(),{user:a,signOut:o}=Le(),[l,d]=A.useState(!1),[u,m]=A.useState(""),[h,f]=A.useState(!1),x=c6[n.pathname]||"Page",y=[{id:1,type:"warning",message:"Stock faible: Coca Cola 50cl (5 restants)",time:"5 min"},{id:2,type:"info",message:"Nouvelle vente: 15,800 Ar",time:"12 min"},{id:3,type:"success",message:"Sauvegarde automatique effectuée",time:"1h"}],_=(R=>{switch(R){case"admin":return{label:"Administrateur",color:"bg-red-100 text-red-800",icon:Xe};case"manager":return{label:"Gérant",color:"bg-blue-100 text-blue-800",icon:Ke};case"cashier":return{label:"Caissier",color:"bg-green-100 text-green-800",icon:br};case"reader":return{label:"Lecteur",color:"bg-purple-100 text-purple-800",icon:Vu};default:return{label:R,color:"bg-gray-100 text-gray-800",icon:St}}})((a==null?void 0:a.role)||""),C=_.icon,k=R=>{R.preventDefault(),u.trim()&&L.success(`Recherche: "${u}"`)},T=()=>{o(),d(!1),L.success("Déconnexion réussie")},S=R=>{switch(R){case"warning":return"⚠️";case"info":return"ℹ️";case"success":return"✅";default:return"📢"}},D=R=>{switch(R){case"warning":return"border-l-orange-500 bg-orange-50";case"info":return"border-l-blue-500 bg-blue-50";case"success":return"border-l-green-500 bg-green-50";default:return"border-l-gray-500 bg-gray-50"}};return r.jsxs("header",{className:"bg-white border-b border-gray-200 shadow-sm relative z-20",children:[r.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:t,className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Menu",children:r.jsx(Z5,{className:"w-5 h-5 text-gray-600"})}),r.jsx("button",{onClick:e,className:"hidden lg:block p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Réduire/Étendre le menu",children:s?r.jsx(Ou,{className:"w-5 h-5 text-gray-600"}):r.jsx(hp,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:x}),r.jsx("p",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),r.jsx("div",{className:"hidden md:flex flex-1 max-w-md mx-8",children:r.jsxs("form",{onSubmit:k,className:"relative w-full",children:[r.jsx(Is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:u,onChange:R=>m(R.target.value),placeholder:"Rechercher produits, clients, ventes...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]})}),r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>f(!h),className:"relative p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Notifications",children:[r.jsx(q5,{className:"w-5 h-5 text-gray-600"}),y.length>0&&r.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-medium",children:y.length})]}),h&&r.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[r.jsx("div",{className:"px-4 py-2 border-b border-gray-100",children:r.jsx("h3",{className:"font-semibold text-gray-900",children:"Notifications"})}),r.jsx("div",{className:"max-h-64 overflow-y-auto",children:y.map(R=>r.jsx("div",{className:`px-4 py-3 border-l-4 ${D(R.type)} hover:bg-gray-50 cursor-pointer`,children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("span",{className:"text-lg",children:S(R.type)}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm text-gray-900",children:R.message}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Il y a ",R.time]})]})]})},R.id))}),r.jsx("div",{className:"px-4 py-2 border-t border-gray-100",children:r.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Voir toutes les notifications"})})]})]}),r.jsx("button",{onClick:()=>i("/settings"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Paramètres",children:r.jsx($n,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>d(!l),className:"flex items-center space-x-3 pl-4 border-l border-gray-200 hover:bg-gray-50 rounded-lg p-2 transition-colors",children:[r.jsxs("div",{className:"hidden sm:block text-right",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:a==null?void 0:a.name}),r.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full ${_.color}`,children:_.label})]}),r.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:r.jsx(C,{className:"w-4 h-4 text-white"})})]}),l&&r.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[r.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:r.jsx(C,{className:"w-5 h-5 text-white"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:a==null?void 0:a.name}),r.jsx("p",{className:"text-sm text-gray-600",children:a==null?void 0:a.email}),r.jsx("span",{className:`inline-flex px-2 py-0.5 text-xs font-medium rounded-full ${_.color} mt-1`,children:_.label})]})]})}),r.jsxs("div",{className:"py-2",children:[r.jsxs("button",{onClick:()=>{i("/settings"),d(!1)},className:"w-full flex items-center space-x-3 px-4 py-2 text-gray-700 hover:bg-gray-50 transition-colors",children:[r.jsx($n,{className:"w-4 h-4"}),r.jsx("span",{children:"Paramètres du compte"})]}),r.jsxs("button",{onClick:T,className:"w-full flex items-center space-x-3 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors",children:[r.jsx(Lo,{className:"w-4 h-4"}),r.jsx("span",{children:"Déconnexion"})]})]})]})]})]})]}),r.jsx("div",{className:"md:hidden px-6 pb-4",children:r.jsxs("form",{onSubmit:k,className:"relative",children:[r.jsx(Is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:u,onChange:R=>m(R.target.value),placeholder:"Rechercher...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),(l||h)&&r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{d(!1),f(!1)}})]})},gs=({children:t})=>{const[e,s]=A.useState(!1),[n,i]=A.useState(!1);return A.useEffect(()=>(n?document.body.classList.add("mobile-sidebar-open"):document.body.classList.remove("mobile-sidebar-open"),()=>{document.body.classList.remove("mobile-sidebar-open")}),[n]),A.useEffect(()=>{const a=()=>{window.innerWidth>=1024&&n&&i(!1)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[n]),r.jsxs("div",{className:"h-screen flex bg-gray-50",children:[r.jsx(l6,{collapsed:e,onToggleCollapse:()=>s(!e),mobileOpen:n,onMobileToggle:()=>i(!n)}),r.jsxs("div",{className:`flex-1 flex flex-col overflow-hidden transition-all duration-300 ${e?"lg:ml-16":"lg:ml-64"}`,children:[r.jsx(d6,{onMenuToggle:()=>i(!n),onSidebarToggle:()=>s(!e),sidebarCollapsed:e}),r.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50",children:r.jsx("div",{className:"p-4 md:p-6 pb-16 md:pb-6",children:t})})]}),n&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>i(!1)})]})},O=({variant:t="primary",size:e="md",fullWidth:s=!1,children:n,className:i="",disabled:a,...o})=>{const l="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",d={primary:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500",secondary:"bg-gray-600 hover:bg-gray-700 text-white focus:ring-gray-500",success:"bg-green-600 hover:bg-green-700 text-white focus:ring-green-500",warning:"bg-orange-600 hover:bg-orange-700 text-white focus:ring-orange-500",danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",ghost:"bg-transparent hover:bg-gray-100 text-gray-700 focus:ring-gray-500",outline:"bg-transparent border border-gray-300 hover:bg-gray-50 text-gray-700 focus:ring-blue-500"},u={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},m=s?"w-full":"";return r.jsx("button",{className:`${l} ${d[t]} ${u[e]} ${m} ${i}`,disabled:a,...o,children:n})},fe=({label:t,error:e,leftIcon:s,rightIcon:n,className:i="",...a})=>r.jsxs("div",{className:"w-full",children:[t&&r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),r.jsxs("div",{className:"relative",children:[s&&r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s}),r.jsx("input",{className:`block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${s?"pl-10":""} ${n?"pr-10":""} ${e?"border-red-300":""} ${i}`,...a}),n&&r.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:n})]}),e&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:e})]}),G=({children:t,className:e="",padding:s="md"})=>{const n={none:"",sm:"p-4",md:"p-6",lg:"p-8"};return r.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 ${n[s]} ${e}`,children:t})},u6=({onSubmit:t,onSwitchToSignUp:e,onForgotPassword:s,isLoading:n=!1})=>{const[i,a]=A.useState(""),[o,l]=A.useState(""),[d,u]=A.useState(!1),[m,h]=A.useState({}),[f,x]=A.useState(!1),[y,P]=A.useState(""),[_,C]=A.useState(!1),k=async S=>{S.preventDefault(),h({});const D={};if(i||(D.email="L'email est requis"),o||(D.password="Le mot de passe est requis"),Object.keys(D).length>0){h(D);return}try{await t(i,o)}catch{}},T=async S=>{if(S.preventDefault(),!y.trim()){h({email:"L'email est requis pour réinitialiser le mot de passe"});return}if(!/\S+@\S+\.\S+/.test(y)){h({email:"Format d'email invalide"});return}C(!0);try{s&&await s(y),x(!1)}catch{}finally{C(!1)}};return r.jsxs(G,{className:"w-full max-w-md mx-auto",padding:"lg",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:r.jsx(Xe,{className:"w-8 h-8 text-white"})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Connexion Sécurisée"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Accédez à votre espace SaaS POS"})]}),f?r.jsxs("form",{onSubmit:T,className:"space-y-6",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:r.jsx("p",{className:"text-sm text-blue-800",children:"Entrez votre adresse email ci-dessous. Nous vous enverrons un lien pour réinitialiser votre mot de passe."})}),r.jsx(fe,{label:"Adresse email",type:"email",value:y,onChange:S=>P(S.target.value),leftIcon:r.jsx(It,{className:"w-5 h-5 text-gray-400"}),placeholder:"votre@email.com",error:m.email,required:!0,disabled:_}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(O,{type:"button",variant:"ghost",fullWidth:!0,disabled:_,onClick:()=>x(!1),children:"Annuler"}),r.jsx(O,{type:"submit",fullWidth:!0,disabled:_,children:_?"Envoi en cours...":"Envoyer le lien"})]})]}):r.jsxs("form",{onSubmit:k,className:"space-y-6",children:[r.jsx(fe,{label:"Adresse email",type:"email",value:i,onChange:S=>a(S.target.value),leftIcon:r.jsx(It,{className:"w-5 h-5 text-gray-400"}),placeholder:"votre@email.com",error:m.email,required:!0,disabled:n}),r.jsx(fe,{label:"Mot de passe",type:d?"text":"password",value:o,onChange:S=>l(S.target.value),leftIcon:r.jsx(cs,{className:"w-5 h-5 text-gray-400"}),rightIcon:r.jsx("button",{type:"button",onClick:()=>u(!d),className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:n,children:d?r.jsx(pl,{className:"w-5 h-5"}):r.jsx(As,{className:"w-5 h-5"})}),placeholder:"••••••••",error:m.password,required:!0,disabled:n}),r.jsx(O,{type:"submit",fullWidth:!0,disabled:n,className:"mt-8",children:n?"Connexion en cours...":"Se connecter"})]}),r.jsx("div",{className:"mt-6 text-center",children:!f&&r.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:text-blue-700 font-medium",disabled:n,onClick:()=>{x(!0),P(i)},children:"Mot de passe oublié ?"})}),e&&!f&&r.jsx("div",{className:"mt-4 text-center",children:r.jsxs("p",{className:"text-sm text-gray-600",children:["Pas encore de compte ?"," ",r.jsx("button",{type:"button",onClick:e,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:n,children:"Créer un compte"})]})}),r.jsx("div",{className:"mt-4 text-center text-xs text-gray-500",children:r.jsx("p",{children:"🔒 Connexion sécurisée avec Firebase Authentication"})})]})},m6=({onSubmit:t,onSwitchToLogin:e,isLoading:s=!1})=>{const[n,i]=A.useState({email:"",password:"",confirmPassword:"",name:"",establishmentName:""}),[a,o]=A.useState(!1),[l,d]=A.useState(!1),[u,m]=A.useState({}),h=(y,P)=>{i(_=>({..._,[y]:P})),u[y]&&m(_=>({..._,[y]:""}))},f=()=>{const y={};return n.name.trim()||(y.name="Le nom est requis"),n.email.trim()?/\S+@\S+\.\S+/.test(n.email)||(y.email="Format d'email invalide"):y.email="L'email est requis",n.password?n.password.length<6&&(y.password="Le mot de passe doit contenir au moins 6 caractères"):y.password="Le mot de passe est requis",n.confirmPassword?n.password!==n.confirmPassword&&(y.confirmPassword="Les mots de passe ne correspondent pas"):y.confirmPassword="Confirmez votre mot de passe",n.establishmentName.trim()||(y.establishmentName="Le nom de l'établissement est requis"),m(y),Object.keys(y).length===0},x=async y=>{if(y.preventDefault(),!!f())try{await t(n.email,n.password,n.name,n.establishmentName)}catch{}};return r.jsxs(G,{className:"w-full max-w-md mx-auto",padding:"lg",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-green-600 to-green-700 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg",children:r.jsx(Xe,{className:"w-8 h-8 text-white"})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Créer votre compte"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Démarrez avec SaaS POS Madagascar"})]}),r.jsxs("form",{onSubmit:x,className:"space-y-6",children:[r.jsx(fe,{label:"Nom complet *",type:"text",value:n.name,onChange:y=>h("name",y.target.value),leftIcon:r.jsx(St,{className:"w-5 h-5 text-gray-400"}),placeholder:"Votre nom complet",error:u.name,required:!0,disabled:s}),r.jsx(fe,{label:"Nom de l'établissement *",type:"text",value:n.establishmentName,onChange:y=>h("establishmentName",y.target.value),leftIcon:r.jsx(Yr,{className:"w-5 h-5 text-gray-400"}),placeholder:"Ex: Mon Commerce",error:u.establishmentName,required:!0,disabled:s}),r.jsx(fe,{label:"Adresse email *",type:"email",value:n.email,onChange:y=>h("email",y.target.value),leftIcon:r.jsx(It,{className:"w-5 h-5 text-gray-400"}),placeholder:"votre@email.com",error:u.email,required:!0,disabled:s}),r.jsx(fe,{label:"Mot de passe *",type:a?"text":"password",value:n.password,onChange:y=>h("password",y.target.value),leftIcon:r.jsx(cs,{className:"w-5 h-5 text-gray-400"}),rightIcon:r.jsx("button",{type:"button",onClick:()=>o(!a),className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:s,children:a?r.jsx(pl,{className:"w-5 h-5"}):r.jsx(As,{className:"w-5 h-5"})}),placeholder:"••••••••",error:u.password,required:!0,disabled:s}),r.jsx(fe,{label:"Confirmer le mot de passe *",type:l?"text":"password",value:n.confirmPassword,onChange:y=>h("confirmPassword",y.target.value),leftIcon:r.jsx(cs,{className:"w-5 h-5 text-gray-400"}),rightIcon:r.jsx("button",{type:"button",onClick:()=>d(!l),className:"text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:s,children:l?r.jsx(pl,{className:"w-5 h-5"}):r.jsx(As,{className:"w-5 h-5"})}),placeholder:"••••••••",error:u.confirmPassword,required:!0,disabled:s}),r.jsx(O,{type:"submit",fullWidth:!0,disabled:s,className:"mt-8",children:s?"Création du compte...":"Créer mon compte"})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsxs("p",{className:"text-sm text-gray-600",children:["Vous avez déjà un compte ?"," ",r.jsx("button",{type:"button",onClick:e,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:s,children:"Se connecter"})]})}),r.jsxs("div",{className:"mt-4 text-center text-xs text-gray-500",children:[r.jsx("p",{children:"🔒 Données sécurisées avec Firebase"}),r.jsx("p",{className:"mt-1",children:"En créant un compte, vous acceptez nos conditions d'utilisation"})]})]})},h6=()=>{const{user:t,signIn:e,signUp:s,error:n,isLoading:i,clearError:a}=Le(),[o,l]=A.useState(!1),[d,u]=A.useState(!1),[m,h]=A.useState(!1),[f,x]=A.useState(!1),[y,P]=A.useState(null),[_,C]=A.useState(""),[k,T]=A.useState(!1);if(t)return r.jsx(zw,{to:"/",replace:!0});const S=async(N,g)=>{a();try{await e({email:N,password:g}),L.success("Connexion réussie !"),u(!1)}catch(w){w.message.includes("auth/invalid-credential")||w.message.includes("Email ou mot de passe incorrect")?["superadmin@saaspos.mg","admin@saaspos.mg","manager@saaspos.mg","cashier@saaspos.mg","reader@saaspos.mg"].includes(N)?(u(!0),L.error("Comptes de démonstration non configurés. Veuillez configurer le système d'abord.")):L.error("Email ou mot de passe incorrect"):L.error(w.message||"Erreur de connexion")}},D=async(N,g,w,I)=>{a();try{await s({email:N,password:g,name:w,establishmentName:I}),L.success("Compte créé avec succès ! Bienvenue !")}catch(E){L.error(E.message||"Erreur lors de la création du compte")}},R=async N=>{a(),h(!0);try{const g={url:window.location.origin+"/login",handleCodeInApp:!1};await Nf(We,N,g),console.log(`Email de réinitialisation envoyé à: ${N}`),L.success("Email de réinitialisation envoyé ! Vérifiez votre boîte de réception et vos spams.")}catch(g){console.error("Erreur lors de l'envoi de l'email de réinitialisation:",g);let w="Erreur lors de l'envoi de l'email";switch(g.code){case"auth/user-not-found":w="Aucun compte trouvé avec cette adresse email";break;case"auth/invalid-email":w="Format d'email invalide";break;case"auth/too-many-requests":w="Trop de tentatives. Veuillez réessayer plus tard.";break;default:w=g.message||"Erreur lors de l'envoi de l'email"}L.error(w)}finally{h(!1)}},v=N=>{P(N),T(!0),C("")},b=()=>{if(!y)return;if(_!=="demo2025"){L.error("Mot de passe de démonstration incorrect");return}const w={admin:{email:"admin@saaspos.mg",password:"admin123"},manager:{email:"manager@saaspos.mg",password:"manager123"},cashier:{email:"cashier@saaspos.mg",password:"cashier123"},reader:{email:"reader@saaspos.mg",password:"reader123"}}[y];w&&S(w.email,w.password),T(!1),P(null)};return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:r.jsxs("div",{className:"w-full max-w-md",children:[o?r.jsx(m6,{onSubmit:D,onSwitchToLogin:()=>l(!1),isLoading:i}):r.jsx(u6,{onSubmit:S,onSwitchToSignUp:()=>l(!0),onForgotPassword:R,isLoading:i||m}),d&&r.jsx("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-amber-800 mb-2",children:"Configuration requise"}),r.jsx("p",{className:"text-sm text-amber-700 mb-3",children:"Les comptes de démonstration n'existent pas encore dans votre projet Firebase. Vous devez d'abord configurer le système pour créer ces comptes."}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(k0,{to:"/setup",className:"inline-flex items-center px-3 py-2 border border-amber-300 shadow-sm text-sm leading-4 font-medium rounded-md text-amber-700 bg-amber-50 hover:bg-amber-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-colors",children:[r.jsx($n,{className:"w-4 h-4 mr-2"}),"Configurer le système"]}),r.jsx("button",{onClick:()=>u(!1),className:"text-sm text-amber-600 hover:text-amber-800 px-2 py-1",children:"Fermer"})]})]})]})}),n&&!d&&r.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx("p",{className:"text-sm text-red-600",children:n}),(n.includes("auth/invalid-credential")||n.includes("Email ou mot de passe incorrect"))&&r.jsx("div",{className:"mt-3",children:r.jsxs(k0,{to:"/setup",className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[r.jsx($n,{className:"w-4 h-4 mr-2"}),"Configurer le système"]})})]}),!o&&r.jsx("div",{className:"mt-6 text-center",children:r.jsx("button",{onClick:()=>x(!0),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Accéder à la démonstration"})}),f&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Xe,{className:"w-8 h-8 text-blue-600"})}),r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Accès à la démonstration"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Sélectionnez un rôle pour explorer les fonctionnalités du système"})]}),r.jsxs("div",{className:"space-y-3 mb-6",children:[r.jsxs("button",{onClick:()=>v("admin"),className:"w-full flex justify-between items-center p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:"font-medium text-blue-900",children:"Admin Client"}),r.jsx("p",{className:"text-sm text-blue-700",children:"Gestion complète"})]}),r.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:"Accès sécurisé"})]}),r.jsxs("button",{onClick:()=>v("manager"),className:"w-full flex justify-between items-center p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors",children:[r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:"font-medium text-green-900",children:"Gérant"}),r.jsx("p",{className:"text-sm text-green-700",children:"Gestion établissement"})]}),r.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium",children:"Accès sécurisé"})]}),r.jsxs("button",{onClick:()=>v("cashier"),className:"w-full flex justify-between items-center p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors",children:[r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:"font-medium text-yellow-900",children:"Caissier"}),r.jsx("p",{className:"text-sm text-yellow-700",children:"Ventes uniquement"})]}),r.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium",children:"Accès sécurisé"})]}),r.jsxs("button",{onClick:()=>v("reader"),className:"w-full flex justify-between items-center p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors",children:[r.jsxs("div",{className:"text-left",children:[r.jsx("p",{className:"font-medium text-purple-900",children:"Lecteur"}),r.jsx("p",{className:"text-sm text-purple-700",children:"Consultation seule"})]}),r.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs font-medium",children:"Accès sécurisé"})]})]}),r.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-gray-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-gray-700",children:[r.jsx("p",{className:"font-medium",children:"Environnement de démonstration"}),r.jsx("p",{className:"mt-1",children:"Ces comptes vous permettent d'explorer les fonctionnalités du système dans un environnement isolé et sécurisé."})]})]})}),r.jsx("div",{className:"flex justify-end",children:r.jsx(O,{variant:"ghost",onClick:()=>x(!1),children:"Fermer"})})]})}),k&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(cs,{className:"w-8 h-8 text-blue-600"})}),r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Authentification requise"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Veuillez saisir le mot de passe de démonstration pour accéder au compte"})]}),r.jsxs("div",{className:"space-y-4 mb-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mot de passe de démonstration"}),r.jsx("input",{type:"password",value:_,onChange:N=>C(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Entrez le mot de passe de démonstration"})]}),r.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-blue-700",children:[r.jsx("p",{className:"font-medium",children:"Information"}),r.jsxs("p",{className:"mt-1",children:["Le mot de passe de démonstration est : ",r.jsx("strong",{children:"demo2025"})]}),r.jsx("p",{className:"mt-1",children:"Ce mot de passe est requis pour protéger l'accès aux comptes de démonstration."})]})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(O,{variant:"ghost",onClick:()=>{T(!1),P(null)},children:"Annuler"}),r.jsx(O,{onClick:b,disabled:!_,children:"Accéder à la démo"})]})]})})]})})},p6=()=>{const[t,e]=A.useState(!1),[s,n]=A.useState(null),i=async(l,d=1e4)=>{const u=new Promise((m,h)=>{setTimeout(()=>h(new Error(`Opération expirée après ${d}ms`)),d)});return Promise.race([l,u])},a=async()=>{var l,d,u;e(!0),n(null);try{console.log("🚀 Début de la configuration des comptes..."),n({success:!1,message:"Initialisation de la configuration...",step:"init"}),n({success:!1,message:"Création du Super Admin système...",step:"super-admin"});let m="",h=!1;try{We.currentUser&&(await i(ca(We),5e3),console.log("🔓 Déconnexion de l'utilisateur actuel")),console.log("🔐 Tentative de création du Super Admin...");const S=await i(nl(We,"superadmin@saaspos.mg","superadmin123"),1e4);await i(al(S.user,{displayName:"Super Administrateur Système"}),5e3),m=S.user.uid,h=!0,console.log("✅ Nouveau Super Admin créé:",m)}catch(S){if(S.code==="auth/email-already-in-use"){console.log("⚠️ Le Super Admin existe déjà, tentative de connexion...");try{await new Promise(R=>setTimeout(R,1e3)),m=(await i(il(We,"superadmin@saaspos.mg","superadmin123"),1e4)).user.uid,console.log("✅ Connexion Super Admin réussie:",m)}catch(D){if(console.error("❌ Erreur de connexion Super Admin:",D),D.code==="auth/invalid-credential"){n({success:!1,message:"Le compte superadmin@saaspos.mg existe déjà avec un mot de passe différent. Veuillez supprimer ce compte de la console Firebase Authentication et réessayer.",requiresManualAction:!0,error:"Compte existant avec mot de passe différent"}),e(!1);return}else throw D}}else throw(l=S.message)!=null&&l.includes("expirée")?new Error("Timeout lors de la création du Super Admin. Vérifiez votre connexion internet et les règles Firestore."):S}const f={id:m,email:"superadmin@saaspos.mg",name:"Super Administrateur Système",role:"admin",establishmentId:"SYSTEM_ADMIN",isActive:!0,isSuperAdmin:!0,isSystemAdmin:!0,isClientAdmin:!1,lastLogin:null,createdAt:J.now(),updatedAt:J.now()};try{(await i(hs(me(H,"users",m)),8e3)).exists()?(console.log("⚠️ Document Super Admin existe déjà"),await i(pt(me(H,"users",m),{isSuperAdmin:!0,isSystemAdmin:!0,updatedAt:J.now()}),1e4),console.log("✅ Document Super Admin mis à jour avec les flags corrects")):(await i(Ze(me(H,"users",m),f),1e4),console.log("✅ Document Super Admin créé"))}catch(S){throw console.error("❌ Erreur lors de la création du document Super Admin:",S),new Error(`Impossible de créer le document Super Admin: ${S.message}`)}n({success:!1,message:"Création de l'établissement de démonstration...",step:"establishment"});const x="demo-establishment-main",y={id:x,name:"SaaS POS Madagascar - Demo Client",address:"Antananarivo, Madagascar",nif:"1234567890",stat:"12345678901234",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",currency:"MGA",taxRate:20,authorizedUsers:[],isDemo:!0,createdAt:J.now(),updatedAt:J.now()};try{console.log("📝 Tentative de création de l'établissement..."),(await i(hs(me(H,"establishments",x)),8e3)).exists()?(console.log("⚠️ Établissement existe déjà, mise à jour..."),await i(Ze(me(H,"establishments",x),y,{merge:!0}),1e4),console.log("✅ Établissement mis à jour")):(console.log("🏢 Création du nouvel établissement..."),await i(Ze(me(H,"establishments",x),y),15e3),console.log("✅ Établissement créé avec succès"))}catch(S){console.error("❌ Erreur lors de la création de l'établissement:",S),console.log("⚠️ Continuons malgré l'erreur d'établissement...")}n({success:!1,message:"Création des comptes clients de démonstration...",step:"client-users"});const P=[{email:"admin@saaspos.mg",password:"admin123",name:"Admin Client Demo",role:"admin",isClientAdmin:!0},{email:"manager@saaspos.mg",password:"manager123",name:"Gérant Principal",role:"manager",isClientAdmin:!1},{email:"cashier@saaspos.mg",password:"cashier123",name:"Marie Caissière",role:"cashier",isClientAdmin:!1},{email:"reader@saaspos.mg",password:"reader123",name:"Jean Lecteur",role:"reader",isClientAdmin:!1}],_=["superadmin@saaspos.mg"];for(const S of P)try{console.log(`🔐 Création du compte client: ${S.email}`),We.currentUser&&await i(ca(We),5e3);const D=await i(nl(We,S.email,S.password),1e4);await i(al(D.user,{displayName:S.name}),5e3);const R={id:D.user.uid,email:S.email,name:S.name,role:S.role,establishmentId:x,isActive:!0,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:S.isClientAdmin,lastLogin:null,createdAt:J.now(),updatedAt:J.now()};await i(Ze(me(H,"users",D.user.uid),R),1e4),_.push(S.email),console.log(`✅ Compte client créé: ${S.email}`)}catch(D){D.code==="auth/email-already-in-use"?(console.log(`⚠️ Le compte ${S.email} existe déjà`),_.push(S.email)):D.code==="auth/invalid-credential"?(console.log(`⚠️ Le compte ${S.email} existe avec un mot de passe différent`),_.push(S.email)):console.error(`❌ Erreur création ${S.email}:`,D)}n({success:!1,message:"Création de l'abonnement d'essai pour le client...",step:"subscription"});try{const S=new Date(Date.now()+12096e5),D={id:`sub_${x}`,establishmentId:x,establishmentName:"SaaS POS Madagascar - Demo Client",plan:"trial",status:"trial",startDate:J.now(),endDate:J.fromDate(S),trialEndDate:J.fromDate(S),monthlyPrice:0,nextPaymentDate:J.fromDate(S),createdAt:J.now(),updatedAt:J.now()};await Ze(me(H,"subscriptions",`sub_${x}`),D),console.log("✅ Abonnement d'essai créé pour le client")}catch{console.log("⚠️ Erreur lors de la création de l'abonnement, continuons...")}We.currentUser&&await i(ca(We),5e3),n({success:!1,message:"Création des données de démonstration...",step:"demo-data"});const C=[{id:"beverages",name:"Boissons",color:"blue"},{id:"food",name:"Alimentation",color:"green"},{id:"household",name:"Ménage",color:"purple"},{id:"electronics",name:"Électronique",color:"yellow"},{id:"clothing",name:"Vêtements",color:"pink"},{id:"health",name:"Santé & Beauté",color:"indigo"}];for(const S of C)try{const D={id:S.id,name:S.name,color:S.color,establishmentId:x,createdAt:J.now()};await i(Ze(me(H,"categories",`${x}_${S.id}`),D),8e3)}catch{console.log(`⚠️ Catégorie ${S.name} existe peut-être déjà ou timeout`)}console.log("✅ Catégories créées");const k=[{name:"Coca Cola 50cl",reference:"CC001",salePrice:1500,purchasePrice:1200,stock:50,minStock:10,categoryId:`${x}_beverages`,taxRate:20,unit:"piece",brand:"Coca-Cola",barcode:"123456789012",description:"Boisson gazeuse rafraîchissante"},{name:"Pain de mie complet",reference:"PM001",salePrice:2500,purchasePrice:2e3,stock:5,minStock:15,categoryId:`${x}_food`,taxRate:20,unit:"piece",brand:"Boulangerie Locale",barcode:"234567890123",description:"Pain de mie aux céréales complètes"},{name:"Savon de Marseille",reference:"SM001",salePrice:1200,purchasePrice:800,stock:30,minStock:10,categoryId:`${x}_household`,taxRate:20,unit:"piece",brand:"Le Petit Marseillais",barcode:"678901234567",description:"Savon naturel à l'huile d'olive"}];for(let S=0;S<k.length;S++)try{const R={...k[S],establishmentId:x,isActive:!0,createdAt:J.now(),updatedAt:J.now()};await i(Ze(me(H,"products",`${x}_product_${S+1}`),R),8e3)}catch{console.log(`⚠️ Produit ${k[S].name} existe peut-être déjà ou timeout`)}console.log("✅ Produits créés");const T=[{name:"Rakoto Jean",email:"rakoto.jean@email.mg",phone:"+261 34 12 345 67",address:"Antananarivo, Madagascar",loyaltyPoints:150,totalSpent:125e3},{name:"Rasoa Marie",email:"rasoa.marie@email.mg",phone:"+261 33 98 765 43",address:"Fianarantsoa, Madagascar",loyaltyPoints:89,totalSpent:89300}];for(let S=0;S<T.length;S++)try{const R={...T[S],establishmentId:x,isActive:!0,lastPurchase:J.now(),createdAt:J.now(),updatedAt:J.now()};await i(Ze(me(H,"customers",`${x}_customer_${S+1}`),R),8e3)}catch{console.log(`⚠️ Client ${T[S].name} existe peut-être déjà ou timeout`)}console.log("✅ Clients créés"),n({success:!0,message:"Configuration terminée avec succès !",createdUsers:_}),console.log("🎉 Configuration complète terminée !")}catch(m){console.error("❌ Erreur lors de la configuration:",m);let h=m.message||"Une erreur inattendue s'est produite";((d=m.message)!=null&&d.includes("Timeout")||(u=m.message)!=null&&u.includes("expirée"))&&(h=`${m.message}

Suggestions :
• Vérifiez votre connexion internet
• Vérifiez les règles Firestore dans la console Firebase
• Assurez-vous que les règles permettent les opérations d'écriture`),n({success:!1,message:`Erreur: ${h}`,error:m.message})}finally{e(!1)}},o=()=>{n(null),a()};return r.jsx("div",{className:"max-w-2xl mx-auto p-6",children:r.jsxs(G,{className:"p-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:r.jsx(Ke,{className:"w-8 h-8 text-blue-600"})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Configuration du Système SaaS POS"}),r.jsx("p",{className:"text-gray-600",children:"Configurez le Super Admin système et les comptes clients de démonstration"})]}),!s&&r.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Pn,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-amber-800",children:[r.jsx("p",{className:"font-medium mb-2",children:"Comptes qui seront créés :"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"font-semibold text-amber-900 mb-1",children:"🔧 Super Admin Système :"}),r.jsxs("ul",{className:"space-y-1 ml-4",children:[r.jsxs("li",{children:["• ",r.jsx("strong",{children:"superadmin@saaspos.mg"})," - Super Admin (mot de passe: superadmin123)"]}),r.jsx("li",{className:"text-xs",children:"→ Gère tous les paiements et validations du système"})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"font-semibold text-amber-900 mb-1",children:"👥 Comptes Clients Demo :"}),r.jsxs("ul",{className:"space-y-1 ml-4",children:[r.jsxs("li",{children:["• ",r.jsx("strong",{children:"admin@saaspos.mg"})," - Admin Client (mot de passe: admin123)"]}),r.jsxs("li",{children:["• ",r.jsx("strong",{children:"manager@saaspos.mg"})," - Gérant (mot de passe: manager123)"]}),r.jsxs("li",{children:["• ",r.jsx("strong",{children:"cashier@saaspos.mg"})," - Caissier (mot de passe: cashier123)"]}),r.jsxs("li",{children:["• ",r.jsx("strong",{children:"reader@saaspos.mg"})," - Lecteur (mot de passe: reader123)"]}),r.jsx("li",{className:"text-xs",children:"→ Ont un abonnement d'essai et gèrent leur établissement"})]})]}),r.jsx("p",{className:"mt-3 text-xs",children:"⚠️ Cette opération créera également des données de démonstration (produits, catégories, clients)."})]})]})}),s&&r.jsx("div",{className:`border rounded-lg p-4 mb-6 ${s.success?"bg-green-50 border-green-200":s.requiresManualAction?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:r.jsxs("div",{className:"flex items-start",children:[s.success?r.jsx(Lt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}):s.requiresManualAction?r.jsx(Pn,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}):r.jsx(Pn,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:`text-sm ${s.success?"text-green-800":s.requiresManualAction?"text-yellow-800":"text-red-800"}`,children:[r.jsx("p",{className:"font-medium whitespace-pre-line",children:s.message}),s.success&&s.createdUsers&&r.jsxs("div",{className:"mt-3",children:[r.jsx("p",{className:"mb-2 font-medium",children:"✅ Comptes configurés :"}),r.jsx("ul",{className:"ml-4 space-y-1",children:s.createdUsers.map(l=>r.jsxs("li",{children:["• ",l]},l))}),r.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[r.jsx("p",{className:"text-blue-800 font-medium text-xs mb-2",children:"🎉 Configuration terminée !"}),r.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Super Admin :"})," superadmin@saaspos.mg (gère les validations)"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Client Demo :"})," admin@saaspos.mg (a un abonnement d'essai)"]})]})]})]}),s.requiresManualAction&&r.jsxs("div",{className:"mt-3 p-3 bg-yellow-100 border border-yellow-300 rounded",children:[r.jsx("p",{className:"text-yellow-800 font-medium text-xs mb-2",children:"🔧 Action manuelle requise :"}),r.jsxs("ol",{className:"text-yellow-800 text-xs ml-4 space-y-1",children:[r.jsxs("li",{children:["1. Allez dans la ",r.jsx("a",{href:"https://console.firebase.google.com",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"console Firebase"})]}),r.jsx("li",{children:"2. Sélectionnez votre projet"}),r.jsx("li",{children:'3. Allez dans "Authentication" → "Users"'}),r.jsx("li",{children:"4. Supprimez l'utilisateur problématique"}),r.jsx("li",{children:'5. Revenez ici et cliquez sur "Réessayer"'})]})]}),!s.success&&!s.requiresManualAction&&s.error&&r.jsx("div",{className:"mt-2 p-2 bg-red-100 border border-red-200 rounded text-xs",children:r.jsxs("p",{children:[r.jsx("strong",{children:"Détail de l'erreur :"})," ",s.error]})}),t&&s.step&&r.jsxs("div",{className:"mt-2 flex items-center",children:[r.jsx(ov,{className:"w-4 h-4 animate-spin mr-2"}),r.jsxs("span",{className:"text-xs",children:["Étape en cours: ",s.step]})]})]})]})}),r.jsxs("div",{className:"flex justify-center gap-3",children:[r.jsx(O,{onClick:a,disabled:t||(s==null?void 0:s.success)===!0,className:"px-8 py-3",children:t?r.jsxs(r.Fragment,{children:[r.jsx(ov,{className:"w-4 h-4 mr-2 animate-spin"}),"Configuration en cours..."]}):s!=null&&s.success?r.jsxs(r.Fragment,{children:[r.jsx(Lt,{className:"w-4 h-4 mr-2"}),"Configuration terminée"]}):r.jsxs(r.Fragment,{children:[r.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Configurer le système"]})}),s&&!s.success&&!t&&r.jsxs(O,{onClick:o,variant:"ghost",className:"px-6 py-3",children:[r.jsx(qs,{className:"w-4 h-4 mr-2"}),"Réessayer"]})]}),(s==null?void 0:s.success)&&r.jsxs("div",{className:"mt-6 text-center",children:[r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Vous pouvez maintenant vous connecter avec les comptes configurés !"}),r.jsx(O,{onClick:()=>window.location.href="/login",variant:"ghost",className:"mt-3",children:"Aller à la page de connexion"})]}),r.jsx("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Xe,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"🔧 Architecture du système"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-2",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Super Admin :"})," Gère les validations de paiements de tous les clients"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Admin Client :"})," Gère son établissement et a un abonnement"]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Séparation claire :"}),` Le menu "Validation Paiements" n'apparaît que pour le Super Admin`]})]})]})]})})]})})},f6=()=>{const{user:t,isLoading:e,signOut:s}=Le();return A.useEffect(()=>{t&&!e&&s()},[t,e,s]),r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12",children:r.jsx(p6,{})})},fg=({indexUrl:t,title:e="Index de base de données requis",description:s="Pour des performances optimales, un index composite doit être créé dans Firebase. Les données sont actuellement chargées avec une méthode alternative."})=>r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[r.jsx(Pn,{className:"w-5 h-5 text-amber-600 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"text-sm font-medium text-amber-800",children:e}),r.jsx("p",{className:"text-sm text-amber-700 mt-1",children:s}),r.jsxs(O,{variant:"ghost",size:"sm",className:"mt-2 text-amber-800 hover:text-amber-900 hover:bg-amber-100",onClick:()=>window.open(t,"_blank"),children:["Créer l'index maintenant",r.jsx(mp,{className:"w-4 h-4 ml-1"})]})]})]})}),g6=()=>{const[t,e]=A.useState({dailySales:0,totalProfit:0,products:0}),[s,n]=A.useState(!0),[i,a]=A.useState(!1),{user:o}=Le();A.useEffect(()=>{(async()=>{if(o!=null&&o.establishmentId){n(!0),a(!1);try{const u=new Date;u.setHours(0,0,0,0);let m=0,h=0;try{const P=Ne(je(H,"sales"),oe("establishmentId","==",o.establishmentId),oe("status","==","completed"),oe("createdAt",">=",J.fromDate(u))),_=await _e(P);m=_.docs.reduce((C,k)=>C+k.data().total,0);for(const C of _.docs){const k=C.data();if(k.items&&Array.isArray(k.items))for(const T of k.items)try{const S=me(H,"products",T.productId),D=await hs(S);if(D.exists()){const v=D.data().purchasePrice||0,b=T.unitPrice,N=T.quantity,g=(b-v)*N;h+=g}}catch{console.warn("Erreur lors de la récupération du produit:",T.productId)}}}catch(P){if(P.code==="failed-precondition"&&P.message.includes("index")){a(!0),console.warn("Index composite requis pour les ventes. Chargement des données alternatives...");const _=Ne(je(H,"sales"),oe("establishmentId","==",o.establishmentId)),C=await _e(_),k=J.fromDate(u),T=C.docs.filter(S=>{const D=S.data();return D.status==="completed"&&D.createdAt&&D.createdAt.toMillis()>=k.toMillis()});m=T.reduce((S,D)=>S+(D.data().total||0),0);for(const S of T){const D=S.data();if(D.items&&Array.isArray(D.items))for(const R of D.items)try{const v=me(H,"products",R.productId),b=await hs(v);if(b.exists()){const g=b.data().purchasePrice||0,w=R.unitPrice,I=R.quantity,E=(w-g)*I;h+=E}}catch{console.warn("Erreur lors de la récupération du produit:",R.productId)}}}else throw P}const f=Ne(je(H,"products"),oe("establishmentId","==",o.establishmentId)),y=(await _e(f)).size;e({dailySales:m,totalProfit:h,products:y})}catch(u){console.error("Erreur lors du chargement des statistiques:",u)}finally{n(!1)}}})()},[o==null?void 0:o.establishmentId]);const l=d=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(d).replace("MGA","Ar");return s?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((d,u)=>r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"animate-pulse flex items-center",children:[r.jsx("div",{className:"p-3 rounded-lg bg-gray-200 mr-4"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),r.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"})]})]})},u))}):r.jsxs("div",{className:"space-y-6",children:[i&&r.jsx(fg,{indexUrl:"https://console.firebase.google.com/v1/r/project/saas-915ec/firestore/indexes?create_composite=Ckhwcm9qZWN0cy9zYWFzLTkxNWVjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9zYWxlcy9pbmRleGVzL18QARoTCg9lc3RhYmxpc2htZW50SWQQARoKCgZzdGF0dXMQARoNCgljcmVhdGVkQXQQARoMCghfX25hbWVfXxAB"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-lg bg-blue-100",children:r.jsx(kt,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"ml-4 flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ventes du jour"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l(t.dailySales)}),r.jsxs("div",{className:"ml-2 flex items-center text-sm text-green-600",children:[r.jsx(mp,{className:"w-4 h-4"}),r.jsx("span",{className:"ml-1",children:"+12.5%"})]})]})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-lg bg-purple-100",children:r.jsx(or,{className:"w-6 h-6 text-purple-600"})}),r.jsxs("div",{className:"ml-4 flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bénéfices"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l(t.totalProfit)}),r.jsxs("div",{className:"ml-2 flex items-center text-sm text-green-600",children:[r.jsx(mp,{className:"w-4 h-4"}),r.jsx("span",{className:"ml-1",children:"+8.2%"})]})]})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 rounded-lg bg-orange-100",children:r.jsx(ht,{className:"w-6 h-6 text-orange-600"})}),r.jsxs("div",{className:"ml-4 flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Produits en stock"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t.products}),r.jsxs("div",{className:"ml-2 flex items-center text-sm text-red-600",children:[r.jsx(U5,{className:"w-4 h-4"}),r.jsx("span",{className:"ml-1",children:"-3.2%"})]})]})]})]})})]})]})},x6=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(!0),[i,a]=A.useState(!1),{user:o}=Le();return A.useEffect(()=>{(async()=>{if(o!=null&&o.establishmentId){n(!0),a(!1);try{const d=new Date;d.setHours(0,0,0,0);try{const u=Ne(je(H,"sales"),oe("establishmentId","==",o.establishmentId),oe("status","==","completed"),oe("createdAt",">=",J.fromDate(d)),wi("createdAt","desc"),OP(5)),m=await _e(u);if(m.empty){e([]),n(!1);return}const h=m.docs.map(f=>{const x=f.data();return{id:f.id.substring(f.id.length-3),customer:x.customerName||"Client anonyme",amount:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x.total).replace("MGA","Ar"),time:x.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),method:x.paymentMethod==="cash"?"Espèces":x.paymentMethod==="card"?"Carte":x.paymentMethod==="mvola"?"MVola":x.paymentMethod==="orange_money"?"Orange Money":x.paymentMethod==="airtel_money"?"Airtel Money":"Autre"}});e(h)}catch(u){if(u.code==="failed-precondition"&&u.message.includes("index")){a(!0),console.warn("Index composite requis pour les ventes récentes. Chargement des données alternatives...");const m=Ne(je(H,"sales"),oe("establishmentId","==",o.establishmentId)),h=await _e(m),f=J.fromDate(d),x=h.docs.filter(P=>{const _=P.data();return _.status==="completed"&&_.createdAt&&_.createdAt.toMillis()>=f.toMillis()}).sort((P,_)=>_.data().createdAt.toMillis()-P.data().createdAt.toMillis()).slice(0,5);if(x.length===0){e([]),n(!1);return}const y=x.map(P=>{const _=P.data();return{id:P.id.substring(P.id.length-3),customer:_.customerName||"Client anonyme",amount:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(_.total).replace("MGA","Ar"),time:_.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),method:_.paymentMethod==="cash"?"Espèces":_.paymentMethod==="card"?"Carte":_.paymentMethod==="mvola"?"MVola":_.paymentMethod==="orange_money"?"Orange Money":_.paymentMethod==="airtel_money"?"Airtel Money":"Autre"}});e(y)}else throw u}}catch(d){console.error("Erreur lors du chargement des ventes récentes:",d),e([])}finally{n(!1)}}})()},[o==null?void 0:o.establishmentId]),s?r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ventes récentes"}),r.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(5)].map((l,d)=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]})]},d))})]}):r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ventes récentes"}),i&&r.jsx("div",{className:"mb-4",children:r.jsx(fg,{indexUrl:"https://console.firebase.google.com/v1/r/project/saas-915ec/firestore/indexes?create_composite=Ckhwcm9qZWN0cy9zYWFzLTkxNWVjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9zYWxlcy9pbmRleGVzL18QARoTCg9lc3RhYmxpc2htZW50SWQQARoKCgZzdGF0dXMQARoNCgljcmVhdGVkQXQQAhoMCghfX25hbWVfXxAC"})}),t.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(br,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500",children:"Aucune vente aujourd'hui"}),r.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Les ventes du jour apparaîtront ici"})]}):r.jsx("div",{className:"overflow-hidden",children:r.jsx("div",{className:"space-y-3",children:t.map(l=>r.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:r.jsxs("span",{className:"text-sm font-medium text-blue-700",children:["#",l.id]})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:l.customer}),r.jsx("p",{className:"text-sm text-gray-500",children:l.time})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"font-semibold text-gray-900",children:l.amount}),r.jsx("p",{className:"text-sm text-gray-500",children:l.method})]})]},l.id))})})]})},y6=()=>{const t=jl(),e=[{label:"Nouvelle vente",icon:br,color:"blue",onClick:()=>t("/pos")},{label:"Ajouter produit",icon:ht,color:"green",onClick:()=>t("/products")},{label:"Nouveau client",icon:Ke,color:"purple",onClick:()=>t("/customers")}];return r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Actions rapides"}),r.jsx("div",{className:"space-y-3",children:e.map((s,n)=>r.jsx("button",{onClick:s.onClick,className:`w-full p-3 text-left bg-${s.color}-50 hover:bg-${s.color}-100 rounded-lg transition-colors`,children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(s.icon,{className:`w-5 h-5 text-${s.color}-600`}),r.jsx("span",{className:`ml-3 font-medium text-${s.color}-700`,children:s.label})]})},n))})]})},v6=()=>{const[t,e]=A.useState([]),[s,n]=A.useState([]),[i,a]=A.useState([]),[o,l]=A.useState(!0),[d,u]=A.useState(0),[m,h]=A.useState(0),{user:f}=Le();A.useEffect(()=>{(async()=>{if(f!=null&&f.establishmentId){l(!0);try{await x(),await y(),P()}catch(D){console.error("Erreur lors du chargement des analyses:",D)}finally{l(!1)}}})()},[f==null?void 0:f.establishmentId]);const x=async()=>{if(f!=null&&f.establishmentId)try{const S=Ne(je(H,"customers"),oe("establishmentId","==",f.establishmentId),oe("isActive","==",!0)),v=(await _e(S)).docs.map(b=>{const N=b.data();return{id:b.id,name:N.name,email:N.email||"",orderCount:Math.floor(Math.random()*15)+1,totalSpent:N.totalSpent||0,country:"Madagascar",avatar:_(N.name)}}).sort((b,N)=>N.totalSpent-b.totalSpent).slice(0,5);e(v)}catch(S){console.error("Erreur lors du chargement des clients:",S)}},y=async()=>{if(f!=null&&f.establishmentId)try{const S=Ne(je(H,"categories"),oe("establishmentId","==",f.establishmentId)),R=(await _e(S)).docs.map(E=>({id:E.id,name:E.data().name,color:E.data().color}));u(R.length);const v=Ne(je(H,"products"),oe("establishmentId","==",f.establishmentId),oe("isActive","==",!0)),b=await _e(v);h(b.size);const N=["blue","green","purple","orange","red","yellow"],g=R.map((E,ee)=>({category:E.name,amount:Math.floor(Math.random()*5e5)+5e4,percentage:0,color:N[ee%N.length]})),w=g.reduce((E,ee)=>E+ee.amount,0),I=g.map(E=>({...E,percentage:w>0?E.amount/w*100:0}));n(I)}catch(S){console.error("Erreur lors du chargement des ventes par catégorie:",S)}},P=()=>{const S=[];for(let D=0;D<7;D++)for(let R=0;R<24;R++){let v=0;R>=8&&R<=20?R===12||R===18?v=Math.random()*.4+.6:R>=10&&R<=16?v=Math.random()*.3+.3:v=Math.random()*.2+.1:v=Math.random()*.1,S.push({hour:R,day:D,intensity:v})}a(S)},_=S=>{const D=["👨‍💼","👩‍💼","👨‍🎓","👩‍🎓","👨‍💻","👩‍💻","👨‍🔬","👩‍🔬"],R=S.length%D.length;return D[R]},C=S=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(S).replace("MGA","Ar"),k=S=>["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"][S],T=S=>S>=.8?"bg-blue-600":S>=.6?"bg-blue-500":S>=.4?"bg-blue-400":S>=.2?"bg-blue-300":S>=.1?"bg-blue-200":"bg-gray-100";return o?r.jsxs("div",{className:"space-y-6",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Analyses & Statistiques"}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[...Array(3)].map((S,D)=>r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"animate-pulse space-y-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-3 bg-gray-200 rounded"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]})},D))})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Analyses & Statistiques"}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsxs(G,{padding:"md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Ke,{className:"w-5 h-5 mr-2 text-blue-600"}),"Top Clients"]}),r.jsxs(O,{variant:"ghost",size:"sm",children:[r.jsx(As,{className:"w-4 h-4 mr-1"}),"Voir tout"]})]}),r.jsx("div",{className:"space-y-3",children:t.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Ke,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Aucun client trouvé"}),r.jsx("p",{className:"text-gray-400 text-xs",children:"Les meilleurs clients apparaîtront ici"})]}):t.map((S,D)=>r.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-lg",children:S.avatar})})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:S.name}),D<3&&r.jsx(fl,{className:"w-3 h-3 text-yellow-500 ml-1"})]}),r.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[r.jsxs("span",{children:["🇲🇬 ",S.country]}),r.jsx("span",{className:"mx-1",children:"•"}),r.jsxs("span",{children:[S.orderCount," commandes"]})]})]}),r.jsx("div",{className:"text-right",children:r.jsx("p",{className:"text-sm font-semibold text-blue-600",children:C(S.totalSpent)})})]},S.id))})]}),r.jsxs(G,{padding:"md",children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Wd,{className:"w-5 h-5 mr-2 text-purple-600"}),"Répartition des Ventes"]})}),s.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Wd,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Aucune donnée de vente"}),r.jsx("p",{className:"text-gray-400 text-xs",children:"Les ventes par catégorie apparaîtront ici"})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-4",children:[r.jsx("div",{className:"w-32 h-32 rounded-full border-8 border-gray-200 relative overflow-hidden",children:s.map((S,D)=>{const R={blue:"border-blue-500",green:"border-green-500",purple:"border-purple-500",orange:"border-orange-500",red:"border-red-500",yellow:"border-yellow-500"};return r.jsx("div",{className:`absolute inset-0 rounded-full border-4 ${R[S.color]||"border-gray-500"}`,style:{clipPath:`polygon(50% 50%, 50% 0%, ${50+S.percentage/100*50}% 0%, 50% 50%)`}},D)})}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-xs text-gray-600",children:"Total"}),r.jsx("p",{className:"text-sm font-bold text-gray-900",children:s.length})]})})]}),r.jsx("div",{className:"space-y-2",children:s.slice(0,4).map((S,D)=>{const R={blue:"bg-blue-500",green:"bg-green-500",purple:"bg-purple-500",orange:"bg-orange-500",red:"bg-red-500",yellow:"bg-yellow-500"};return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:`w-3 h-3 rounded-full ${R[S.color]||"bg-gray-500"}`}),r.jsx("span",{className:"text-sm text-gray-700 truncate",children:S.category})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[S.percentage.toFixed(1),"%"]}),r.jsx("p",{className:"text-xs text-gray-500",children:C(S.amount)})]})]},D)})}),r.jsx("div",{className:"pt-4 border-t border-gray-200",children:r.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-center mb-1",children:[r.jsx(zn,{className:"w-4 h-4 text-purple-600 mr-1"}),r.jsx("span",{className:"text-2xl font-bold text-purple-600",children:d})]}),r.jsx("p",{className:"text-xs text-gray-600",children:"Catégories"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-center mb-1",children:[r.jsx(ht,{className:"w-4 h-4 text-blue-600 mr-1"}),r.jsx("span",{className:"text-2xl font-bold text-blue-600",children:m})]}),r.jsx("p",{className:"text-xs text-gray-600",children:"Produits"})]})]})})]})]}),r.jsxs(G,{padding:"md",children:[r.jsx("div",{className:"flex items-center justify-between mb-4",children:r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(z5,{className:"w-5 h-5 mr-2 text-green-600"}),"Activité des Commandes"]})}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Intensité par jour et heure"}),r.jsxs("div",{className:"grid grid-cols-13 gap-1 mb-2",children:[r.jsx("div",{className:"text-xs text-gray-500"}),[0,6,12,18].map(S=>r.jsxs("div",{className:"text-xs text-gray-500 text-center col-span-3",children:[S,"h"]},S))]}),r.jsx("div",{className:"space-y-1",children:[0,1,2,3,4,5,6].map(S=>r.jsxs("div",{className:"grid grid-cols-13 gap-1",children:[r.jsx("div",{className:"text-xs text-gray-500 flex items-center",children:k(S)}),[...Array(12)].map((D,R)=>{const v=R*2,b=i.find(g=>g.day===S&&g.hour===v),N=(b==null?void 0:b.intensity)||0;return r.jsx("div",{className:`w-4 h-4 rounded-sm ${T(N)} transition-all hover:scale-110`,title:`${k(S)} ${v}h: ${Math.round(N*100)}% d'activité`},R)})]},S))}),r.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs text-gray-500",children:[r.jsx("span",{children:"Moins"}),r.jsxs("div",{className:"flex space-x-1",children:[r.jsx("div",{className:"w-3 h-3 bg-gray-100 rounded-sm"}),r.jsx("div",{className:"w-3 h-3 bg-blue-200 rounded-sm"}),r.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-sm"}),r.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-sm"}),r.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-sm"})]}),r.jsx("span",{children:"Plus"})]})]}),r.jsx("div",{className:"pt-4 border-t border-gray-200",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Es,{className:"w-4 h-4 text-green-600 mr-2"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Pic d'activité"})]}),r.jsx("span",{className:"text-sm font-semibold text-green-600",children:"12h - 14h"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(ut,{className:"w-4 h-4 text-blue-600 mr-2"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Jour le plus actif"})]}),r.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"Vendredi"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(or,{className:"w-4 h-4 text-purple-600 mr-2"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Tendance"})]}),r.jsx("span",{className:"text-sm font-semibold text-purple-600",children:"+15.3%"})]})]})})]})]})]})]})},b6=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tableau de bord"}),r.jsxs("div",{className:"text-sm text-gray-500",children:["Aujourd'hui, ",new Date().toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),r.jsx(g6,{}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsx("div",{className:"lg:col-span-2",children:r.jsx(x6,{})}),r.jsx("div",{children:r.jsx(y6,{})})]}),r.jsx(v6,{})]}),E1=({onStoreSelect:t,selectedStore:e,onClose:s})=>{const[n,i]=A.useState([]),[a,o]=A.useState(!0),{user:l}=Le();A.useEffect(()=>{(async()=>{if(l!=null&&l.establishmentId)try{o(!0);const m=Ne(je(H,"stores"),oe("establishmentId","==",l.establishmentId),oe("isActive","==",!0)),f=(await _e(m)).docs.map(x=>{var P,_;const y=x.data();return{id:x.id,name:y.name,address:y.address,phone:y.phone||"",email:y.email||"",establishmentId:y.establishmentId,isActive:y.isActive!==!1,isMainStore:y.isMainStore||!1,createdAt:((P=y.createdAt)==null?void 0:P.toDate())||new Date,updatedAt:((_=y.updatedAt)==null?void 0:_.toDate())||new Date}});if(i(f),!e&&f.length>0){const x=f.find(y=>y.isMainStore);t(x?x.id:f[0].id)}}catch(m){console.error("Erreur lors du chargement des magasins:",m)}finally{o(!1)}})()},[l==null?void 0:l.establishmentId,e,t]);const d=u=>{t(u),s&&s()};return a?r.jsxs("div",{className:"text-center p-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des magasins..."})]}):n.length===0?r.jsxs("div",{className:"text-center p-4",children:[r.jsx(Yr,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-600 font-medium",children:"Aucun magasin disponible"}),r.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Créez d'abord un magasin dans les paramètres"})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Yr,{className:"w-5 h-5 mr-2 text-blue-600"}),"Sélectionner un magasin"]}),r.jsx("div",{className:"space-y-3",children:n.map(u=>r.jsxs("button",{onClick:()=>d(u.id),className:`w-full flex items-center justify-between p-3 rounded-lg border-2 transition-colors ${e===u.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${u.isMainStore?"bg-blue-100":"bg-gray-100"}`,children:r.jsx(Ms,{className:`w-5 h-5 ${u.isMainStore?"text-blue-600":"text-gray-600"}`})}),r.jsxs("div",{className:"ml-3 text-left",children:[r.jsx("p",{className:"font-medium text-gray-900",children:u.name}),r.jsx("p",{className:"text-sm text-gray-500",children:u.address}),u.isMainStore&&r.jsx("span",{className:"inline-flex px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-800 mt-1",children:"Magasin principal"})]})]}),e===u.id&&r.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:r.jsx(w1,{className:"w-4 h-4 text-white"})})]},u.id))}),s&&r.jsx("div",{className:"flex justify-end",children:r.jsx(O,{variant:"ghost",onClick:s,children:"Fermer"})})]})},vo=["","un","deux","trois","quatre","cinq","six","sept","huit","neuf","dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"],w6=["","","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"],j6=[{value:1e9,name:"milliard"},{value:1e6,name:"million"},{value:1e3,name:"mille"},{value:100,name:"cent"}];function N6(t){if(t<20)return vo[t];const e=Math.floor(t/10),s=t%10;if(e===7)return s===0?"soixante-dix":`soixante-${vo[10+s]}`;if(e===9)return s===0?"quatre-vingt-dix":`quatre-vingt-${vo[10+s]}`;{const n=w6[e];return s===0?n:s===1&&(e===2||e===3||e===4||e===5||e===6)?`${n} et un`:`${n}-${vo[s]}`}}function dv(t){if(t===0)return"";const e=Math.floor(t/100),s=t%100;let n="";if(e>0&&(e===1?n="cent":n=`${vo[e]} cents`),s>0){const i=N6(s);n?n+=` ${i}`:n=i}return n}function _6(t){if(t===0)return"zéro";let e="",s=t;for(const n of j6){const i=Math.floor(s/n.value);if(i>0){const a=dv(i);n.value===1e3?i===1?e+="mille ":e+=`${a} mille `:(e+=`${a} ${n.name}`,i>1&&(e+="s"),e+=" "),s%=n.value}}return s>0&&(e+=dv(s)),e.trim()}function A1(t){if(isNaN(t)||t<0)return"montant invalide";const e=Math.round(t);if(e===0)return"zéro ariary";const s=_6(e);return e===1?`${s} ariary`:`${s} ariary`}function Hd(t){return`Arrêté à la somme de : ${A1(t)}.`}function I1(t){return A1(t)}class $l{constructor(e=0,s="Network Error"){this.status=e,this.text=s}}const S6=()=>{if(!(typeof localStorage>"u"))return{get:t=>Promise.resolve(localStorage.getItem(t)),set:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),remove:t=>Promise.resolve(localStorage.removeItem(t))}},zt={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:S6()},gg=t=>t?typeof t=="string"?{publicKey:t}:t.toString()==="[object Object]"?t:{}:{},E6=(t,e="https://api.emailjs.com")=>{if(!t)return;const s=gg(t);zt.publicKey=s.publicKey,zt.blockHeadless=s.blockHeadless,zt.storageProvider=s.storageProvider,zt.blockList=s.blockList,zt.limitRate=s.limitRate,zt.origin=s.origin||e},k1=async(t,e,s={})=>{const n=await fetch(zt.origin+t,{method:"POST",headers:s,body:e}),i=await n.text(),a=new $l(n.status,i);if(n.ok)return a;throw a},C1=(t,e,s)=>{if(!t||typeof t!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},A6=t=>{if(t&&t.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},T1=t=>t.webdriver||!t.languages||t.languages.length===0,R1=()=>new $l(451,"Unavailable For Headless Browser"),I6=(t,e)=>{if(!Array.isArray(t))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"},k6=t=>{var e;return!((e=t.list)!=null&&e.length)||!t.watchVariable},C6=(t,e)=>t instanceof FormData?t.get(e):t[e],P1=(t,e)=>{if(k6(t))return!1;I6(t.list,t.watchVariable);const s=C6(e,t.watchVariable);return typeof s!="string"?!1:t.list.includes(s)},D1=()=>new $l(403,"Forbidden"),T6=(t,e)=>{if(typeof t!="number"||t<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"},R6=async(t,e,s)=>{const n=Number(await s.get(t)||0);return e-Date.now()+n},M1=async(t,e,s)=>{if(!e.throttle||!s)return!1;T6(e.throttle,e.id);const n=e.id||t;return await R6(n,e.throttle,s)>0?!0:(await s.set(n,Date.now().toString()),!1)},L1=()=>new $l(429,"Too Many Requests"),P6=async(t,e,s,n)=>{const i=gg(n),a=i.publicKey||zt.publicKey,o=i.blockHeadless||zt.blockHeadless,l=i.storageProvider||zt.storageProvider,d={...zt.blockList,...i.blockList},u={...zt.limitRate,...i.limitRate};return o&&T1(navigator)?Promise.reject(R1()):(C1(a,t,e),A6(s),s&&P1(d,s)?Promise.reject(D1()):await M1(location.pathname,u,l)?Promise.reject(L1()):k1("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:a,service_id:t,template_id:e,template_params:s}),{"Content-type":"application/json"}))},D6=t=>{if(!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},M6=t=>typeof t=="string"?document.querySelector(t):t,L6=async(t,e,s,n)=>{const i=gg(n),a=i.publicKey||zt.publicKey,o=i.blockHeadless||zt.blockHeadless,l=zt.storageProvider||i.storageProvider,d={...zt.blockList,...i.blockList},u={...zt.limitRate,...i.limitRate};if(o&&T1(navigator))return Promise.reject(R1());const m=M6(s);C1(a,t,e),D6(m);const h=new FormData(m);return P1(d,h)?Promise.reject(D1()):await M1(location.pathname,u,l)?Promise.reject(L1()):(h.append("lib_version","4.4.1"),h.append("service_id",t),h.append("template_id",e),h.append("user_id",a),k1("/api/v1.0/email/send-form",h))},$u={init:E6,send:P6,sendForm:L6,EmailJSResponseStatus:$l};let xg={serviceId:"ton_service_id",templateId:"ton_template_id",publicKey:"ton_public_key"};const yg=async t=>{try{const e=await hs(me(H,"emailConfigs",t));if(e.exists()){const s=e.data();return xg=s,s.publicKey&&s.publicKey!=="ton_public_key"&&($u.init(s.publicKey),console.log("✅ EmailJS initialisé avec la configuration depuis Firestore")),!0}else return console.log("ℹ️ Aucune configuration EmailJS trouvée dans Firestore"),!1}catch(e){return console.error("Erreur lors du chargement de la configuration EmailJS:",e),!1}},vg=()=>xg,V6=async(t,e,s,n)=>{try{const i={serviceId:e,templateId:s,publicKey:n};return xg=i,n&&n!=="ton_public_key"&&($u.init(n),console.log("✅ EmailJS initialisé avec la nouvelle configuration")),await Ze(me(H,"emailConfigs",t),i),{saved:!0}}catch(i){return console.error("Erreur lors de la mise à jour de la configuration EmailJS:",i),{saved:!1,error:i}}},O6=async()=>{try{const t=vg();if(!t.serviceId||!t.templateId||!t.publicKey||t.serviceId==="ton_service_id"||t.templateId==="ton_template_id"||t.publicKey==="ton_public_key")return{success:!1,message:"Configuration EmailJS incomplète ou non configurée"};const e={to_email:"test@example.com",to_name:"Test",establishment_name:"Test Establishment",receipt_number:"TEST-001",date:new Date().toLocaleDateString("fr-FR"),total_amount:"1000 Ar",items_content:"Article de test x1 - 1000 Ar",payment_method:"Test"};return await $u.send(t.serviceId,t.templateId,e,t.publicKey),{success:!0,message:"Configuration EmailJS valide - Email de test envoyé"}}catch(t){return console.error("Erreur lors du test EmailJS:",t),{success:!1,message:"Erreur lors du test de configuration",error:t}}},F6=async(t,e)=>{try{const s=vg();if(!s.serviceId||!s.templateId||!s.publicKey||s.serviceId==="ton_service_id"||s.templateId==="ton_template_id"||s.publicKey==="ton_public_key")return{success:!1,message:"EmailJS n'est pas configuré. Veuillez configurer EmailJS dans les paramètres."};const n=t.items.map(l=>`<tr><td>${l.name}</td><td>${l.quantity}</td><td>${new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l.unitPrice).replace("MGA","Ar")}</td><td>${new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l.total).replace("MGA","Ar")}</td></tr>`).join(""),i=l=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l).replace("MGA","Ar"),a=l=>({cash:"Espèces",card:"Carte bancaire",mvola:"Mvola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[l]||l,o={establishment_name:t.establishmentInfo.name,establishment_address:t.establishmentInfo.address,establishment_phone:t.establishmentInfo.phone,establishment_email:t.establishmentInfo.email,establishment_nif:t.establishmentInfo.nif||"",establishment_stat:t.establishmentInfo.stat||"",receipt_number:t.receiptNumber,date:t.date.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),cashier_name:t.cashierName,customer_name:t.customerName||"Client anonyme",items_content:n,subtotal:i(t.subtotal),tax_amount:i(t.taxAmount),total_amount:i(t.total),payment_method:a(t.paymentMethod),payment_amount:i(t.paymentAmount),change_amount:t.changeAmount>0?i(t.changeAmount):"0 Ar",amount_in_words:t.amountInWords||"",to_email:e,to_name:t.customerName||"Client"};return await $u.send(s.serviceId,s.templateId,o,s.publicKey),{success:!0,message:"Reçu envoyé par email avec succès"}}catch(s){return console.error("Erreur lors de l'envoi du reçu par email:",s),{success:!1,message:"Erreur lors de l'envoi de l'email",error:s}}},V1=({receiptData:t,onClose:e,onPrint:s,onEmailSend:n})=>{const[i,a]=gn.useState(t.customerEmail||""),[o,l]=gn.useState(!1),[d,u]=gn.useState(!1),{user:m}=Le();gn.useEffect(()=>{(async()=>{m!=null&&m.establishmentId&&await yg(m.establishmentId)})()},[m==null?void 0:m.establishmentId]);const h=_=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(_).replace("MGA","Ar"),f=_=>_.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),x=_=>({cash:"Espèces",card:"Carte bancaire",mvola:"MVola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[_]||_,y=async()=>{if(!i.trim()){alert("Veuillez saisir une adresse email");return}if(!/\S+@\S+\.\S+/.test(i)){alert("Format d'email invalide");return}u(!0);try{console.log("📧 Tentative d'envoi d'email à:",i);const _={...t,amountInWords:I1(t.total)},C=await F6(_,i);C.success?(alert("Email envoyé avec succès !"),l(!1),n&&n(i)):(alert(`Erreur lors de l'envoi de l'email: ${C.message}`),console.error("Détails de l'erreur:",C.error))}catch(_){console.error("Erreur inattendue lors de l'envoi:",_),alert("Erreur inattendue lors de l'envoi de l'email")}finally{u(!1)}},P=()=>{const _=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Reçu ${t.receiptNumber}</title>
        <style>
          body { font-family: 'Courier New', monospace; max-width: 300px; margin: 0 auto; padding: 20px; }
          .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
          .company-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
          .company-info { font-size: 12px; line-height: 1.4; }
          .receipt-info { margin: 15px 0; }
          .items-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
          .items-table th, .items-table td { text-align: left; padding: 5px 0; border-bottom: 1px dashed #ccc; }
          .items-table th { font-weight: bold; }
          .total-section { border-top: 2px solid #000; padding-top: 10px; margin-top: 15px; }
          .total-line { display: flex; justify-content: space-between; margin: 3px 0; }
          .grand-total { font-weight: bold; font-size: 16px; border-top: 1px solid #000; padding-top: 5px; margin-top: 5px; }
          .footer { text-align: center; margin-top: 20px; border-top: 2px solid #000; padding-top: 10px; font-size: 12px; }
          .amount-in-words { margin-top: 15px; padding-top: 10px; border-top: 1px dashed #000; font-style: italic; font-size: 10px; }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="company-name">${t.establishmentInfo.name}</div>
          <div class="company-info">
            ${t.establishmentInfo.address}<br>
            Tél: ${t.establishmentInfo.phone}<br>
            Email: ${t.establishmentInfo.email}
            ${t.establishmentInfo.nif?`<br>NIF: ${t.establishmentInfo.nif}`:""}
            ${t.establishmentInfo.stat?`<br>STAT: ${t.establishmentInfo.stat}`:""}
          </div>
        </div>
        
        <div class="receipt-info">
          <div><strong>Reçu N°:</strong> ${t.receiptNumber}</div>
          <div><strong>Date:</strong> ${f(t.date)}</div>
          <div><strong>Caissier:</strong> ${t.cashierName}</div>
          ${t.customerName?`<div><strong>Client:</strong> ${t.customerName}</div>`:""}
        </div>
        
        <table class="items-table">
          <thead>
            <tr>
              <th>Article</th>
              <th>Qté</th>
              <th>P.U.</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            ${t.items.map(S=>`
              <tr>
                <td>${S.name}</td>
                <td>${S.quantity}</td>
                <td>${h(S.unitPrice)}</td>
                <td>${h(S.total)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
        
        <div class="total-section">
          <div class="total-line">
            <span>Sous-total (HT):</span>
            <span>${h(t.subtotal)}</span>
          </div>
          <div class="total-line">
            <span>TVA (20%):</span>
            <span>${h(t.taxAmount)}</span>
          </div>
          <div class="total-line grand-total">
            <span>TOTAL TTC:</span>
            <span>${h(t.total)}</span>
          </div>
          
          <div style="margin-top: 15px;">
            <div class="total-line">
              <span>Paiement (${x(t.paymentMethod)}):</span>
              <span>${h(t.paymentAmount)}</span>
            </div>
            ${t.changeAmount>0?`
              <div class="total-line">
                <span>Rendu:</span>
                <span>${h(t.changeAmount)}</span>
              </div>
            `:""}
          </div>
          
          <div class="amount-in-words">
            ${Hd(t.total)}
          </div>
        </div>
        
        <div class="footer">
          <div>Merci de votre visite !</div>
          <div style="margin-top: 10px; font-size: 10px;">
            Conservez ce reçu pour tout échange ou remboursement
          </div>
        </div>
      </body>
      </html>
    `,C=new Blob([_],{type:"text/html"}),k=window.URL.createObjectURL(C),T=document.createElement("a");T.href=k,T.download=`recu_${t.receiptNumber}.html`,T.click(),window.URL.revokeObjectURL(k)};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(ds,{className:"w-5 h-5 mr-2"}),"Reçu de vente"]}),r.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-4 bg-gray-50 font-mono text-sm",children:[r.jsxs("div",{className:"text-center border-b-2 border-black pb-3 mb-4",children:[r.jsx("div",{className:"font-bold text-lg",children:t.establishmentInfo.name}),r.jsxs("div",{className:"text-xs mt-1",children:[t.establishmentInfo.address,r.jsx("br",{}),"Tél: ",t.establishmentInfo.phone,r.jsx("br",{}),"Email: ",t.establishmentInfo.email,t.establishmentInfo.nif&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),"NIF: ",t.establishmentInfo.nif]}),t.establishmentInfo.stat&&r.jsxs(r.Fragment,{children:[r.jsx("br",{}),"STAT: ",t.establishmentInfo.stat]})]})]}),r.jsxs("div",{className:"mb-4 text-xs",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Reçu N°:"}),r.jsx("span",{className:"font-bold",children:t.receiptNumber})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Date:"}),r.jsx("span",{children:f(t.date)})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Caissier:"}),r.jsx("span",{children:t.cashierName})]}),t.customerName&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Client:"}),r.jsx("span",{children:t.customerName})]})]}),r.jsxs("div",{className:"border-t border-dashed border-gray-400 pt-2 mb-4",children:[r.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs font-bold mb-2",children:[r.jsx("span",{children:"Article"}),r.jsx("span",{className:"text-center",children:"Qté"}),r.jsx("span",{className:"text-right",children:"P.U."}),r.jsx("span",{className:"text-right",children:"Total"})]}),t.items.map((_,C)=>r.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs mb-1",children:[r.jsx("span",{className:"truncate",children:_.name}),r.jsx("span",{className:"text-center",children:_.quantity}),r.jsx("span",{className:"text-right",children:h(_.unitPrice)}),r.jsx("span",{className:"text-right font-semibold",children:h(_.total)})]},C))]}),r.jsxs("div",{className:"border-t-2 border-black pt-2 text-xs",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Sous-total (HT):"}),r.jsx("span",{children:h(t.subtotal)})]}),t.taxAmount>0&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"TVA (20%):"}),r.jsx("span",{children:h(t.taxAmount)})]}),r.jsxs("div",{className:"flex justify-between font-bold text-base border-t border-dashed border-gray-400 pt-1 mt-1",children:[r.jsx("span",{children:"TOTAL TTC:"}),r.jsx("span",{children:h(t.total)})]}),r.jsxs("div",{className:"mt-3 pt-2 border-t border-dashed border-gray-400",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("span",{children:["Paiement (",x(t.paymentMethod),"):"]}),r.jsx("span",{children:h(t.paymentAmount)})]}),t.changeAmount>0&&r.jsxs("div",{className:"flex justify-between font-semibold",children:[r.jsx("span",{children:"Rendu:"}),r.jsx("span",{children:h(t.changeAmount)})]})]})]}),r.jsxs("div",{className:"text-center mt-4 pt-3 border-t-2 border-black text-xs",children:[r.jsx("div",{className:"font-semibold",children:"Merci de votre visite !"}),r.jsx("div",{className:"mt-2 text-xs",children:"Conservez ce reçu pour tout échange ou remboursement"}),r.jsx("div",{className:"mt-3 pt-2 border-t border-dashed border-gray-400 text-xs italic",children:Hd(t.total)})]})]}),r.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-3",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs(O,{variant:"ghost",onClick:s,className:"flex items-center justify-center",children:[r.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Imprimer"]}),r.jsxs(O,{variant:"ghost",onClick:P,className:"flex items-center justify-center",children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]}),o?r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email du client"}),r.jsx("input",{type:"email",value:i,onChange:_=>a(_.target.value),placeholder:"client@email.com",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(O,{variant:"ghost",onClick:()=>l(!1),disabled:d,className:"flex-1",children:"Annuler"}),r.jsx(O,{onClick:y,disabled:d||!i.trim(),className:"flex-1",children:d?"Envoi en cours...":"Envoyer"})]})]}):r.jsxs(O,{fullWidth:!0,variant:"outline",onClick:()=>l(!0),className:"flex items-center justify-center",children:[r.jsx(It,{className:"w-4 h-4 mr-2"}),"Envoyer par email"]}),r.jsx(O,{variant:"ghost",fullWidth:!0,onClick:e,children:"Fermer"})]})]})})},$6=[{id:"cash",name:"Espèces",icon:Va,color:"green"},{id:"card",name:"Carte",icon:Hs,color:"blue"},{id:"mvola",name:"Mvola",icon:rr,color:"red"},{id:"orange_money",name:"Orange Money",icon:rr,color:"orange"},{id:"airtel_money",name:"Airtel Money",icon:rr,color:"red"}],z6=()=>{var Ve;const[t,e]=A.useState("all"),[s,n]=A.useState(""),[i,a]=A.useState([]),[o,l]=A.useState(!1),[d,u]=A.useState("cash"),[m,h]=A.useState(0),[f,x]=A.useState(!1),[y,P]=A.useState([]),[_,C]=A.useState(""),[k,T]=A.useState(!1),[S,D]=A.useState(!1),[R,v]=A.useState(null),[b,N]=A.useState(null),[g,w]=A.useState([]),[I,E]=A.useState([]),[ee,V]=A.useState(!0),{user:F}=Le(),X=async()=>{if(F!=null&&F.establishmentId)try{const B=Ne(je(H,"stores"),oe("establishmentId","==",F.establishmentId),oe("isActive","==",!0)),Ce=(await _e(B)).docs.map(Te=>{var De,qe;const Be=Te.data();return{id:Te.id,name:Be.name,address:Be.address,phone:Be.phone||"",email:Be.email||"",establishmentId:Be.establishmentId,isActive:Be.isActive!==!1,isMainStore:Be.isMainStore||!1,createdAt:((De=Be.createdAt)==null?void 0:De.toDate())||new Date,updatedAt:((qe=Be.updatedAt)==null?void 0:qe.toDate())||new Date}});P(Ce);const Je=Ce.find(Te=>Te.isMainStore);Je?C(Je.id):Ce.length>0&&C(Ce[0].id),Ce.length>1&&T(!0)}catch(B){console.error("Erreur lors du chargement des magasins:",B)}},W=async()=>{if(F!=null&&F.establishmentId)try{const B=Ne(je(H,"categories"),oe("establishmentId","==",F.establishmentId)),Ce=(await _e(B)).docs.map(Je=>{const Te=Je.data();return{id:Je.id,name:Te.name,color:Te.color}});E(Ce)}catch(B){console.error("Erreur lors du chargement des catégories:",B)}},re=async()=>{if(F!=null&&F.establishmentId)try{const B=Ne(je(H,"products"),oe("establishmentId","==",F.establishmentId),oe("isActive","==",!0)),Ce=(await _e(B)).docs.map(Je=>{const Te=Je.data(),Be=I.find(De=>De.id===Te.categoryId);return{id:Je.id,name:Te.name,salePrice:Te.salePrice,stock:Te.stock,storeStock:Te.storeStock||{},categoryId:Te.categoryId,category:(Be==null?void 0:Be.name)||"Autre",taxRate:Te.taxRate||0,image:"📦",unit:Te.unit||"pièce"}});w(Ce)}catch(B){console.error("Erreur lors du chargement des produits:",B),L.error("Erreur lors du chargement des produits")}};A.useEffect(()=>{const B=async()=>{V(!0),await X(),await W(),await Z(),V(!1)};F!=null&&F.establishmentId&&B()},[F==null?void 0:F.establishmentId]);const Z=async()=>{if(F!=null&&F.establishmentId)try{const B=await hs(me(H,"establishments",F.establishmentId));if(B.exists()){const pe=B.data();N({name:pe.name||"Nirina Nirina Pos Madagascar",address:pe.address||"Antananarivo, Madagascar",phone:pe.phone||"+261 34 12 345 67",email:pe.email||"contact@saaspos.mg",nif:pe.nif||"",stat:pe.stat||""})}else N({name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""})}catch(B){console.error("Erreur lors du chargement des informations établissement:",B),N({name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""})}};A.useEffect(()=>{I.length>0&&re()},[I]),A.useEffect(()=>{_&&I.length>0&&re()},[_]);const se=B=>{if(!_)return B.stock;if(B.storeStock&&B.storeStock[_]!==void 0)return B.storeStock[_];const pe=y.find(Ce=>Ce.isMainStore);return pe&&pe.id===_?B.stock:0},Y=g.filter(B=>{const pe=t==="all"||B.categoryId===t,Ce=B.name.toLowerCase().includes(s.toLowerCase()),Te=se(B)>0;return pe&&Ce&&Te}),U=B=>{const pe=se(B);if(pe<=0){L.error("Produit en rupture de stock dans ce magasin");return}const Ce=i.find(Je=>Je.productId===B.id);if(Ce){if(Ce.quantity>=pe){L.error("Stock insuffisant dans ce magasin");return}a(i.map(Je=>Je.productId===B.id?{...Je,quantity:Je.quantity+1}:Je))}else a([...i,{id:`cart_${Date.now()}`,productId:B.id,name:B.name,price:B.salePrice,quantity:1,image:B.image||"📦",taxRate:B.taxRate,unit:B.unit,applyTax:!0}]);L.success(`${B.name} ajouté au panier`)},K=B=>{a(i.filter(pe=>pe.productId!==B))},de=(B,pe)=>{if(pe===0)K(B);else{const Ce=g.find(Je=>Je.id===B);if(Ce){const Je=se(Ce);if(pe>Je){L.error("Stock insuffisant dans ce magasin");return}a(i.map(Te=>Te.productId===B?{...Te,quantity:pe}:Te))}}},ne=B=>{a(i.map(pe=>pe.productId===B?{...pe,applyTax:!pe.applyTax}:pe))},be=()=>i.reduce((B,pe)=>{const Ce=pe.applyTax&&pe.taxRate>0?pe.price/(1+pe.taxRate/100):pe.price;return B+Ce*pe.quantity},0),ke=()=>i.reduce((B,pe)=>{if(!pe.applyTax||pe.taxRate<=0)return B;const Ce=pe.price/(1+pe.taxRate/100),Je=(pe.price-Ce)*pe.quantity;return B+Je},0),Fe=()=>i.reduce((B,pe)=>B+pe.price*pe.quantity,0),ue=()=>d==="cash"&&m>0?Math.max(0,m-Fe()):0,we=()=>{const B=new Date,pe=B.getFullYear(),Ce=String(B.getMonth()+1).padStart(2,"0"),Je=String(B.getDate()).padStart(2,"0"),Te=B.getTime().toString().slice(-6);return`REC-${pe}${Ce}${Je}-${Te}`},ye=async()=>{var B,pe;if(i.length===0){L.error("Le panier est vide");return}if(d==="cash"&&m<Fe()){L.error("Montant insuffisant");return}if(!(F!=null&&F.establishmentId)){L.error("Établissement non trouvé");return}if(!_){L.error("Veuillez sélectionner un magasin");return}x(!0);try{const Ce=we(),Je={receiptNumber:Ce,cashierId:F.id,cashierName:F.name,customerId:null,customerName:"Client anonyme",establishmentId:F.establishmentId,storeId:_,items:i.map(De=>({id:`item_${Date.now()}_${Math.random()}`,productId:De.productId,productName:De.name,quantity:De.quantity,unitPrice:De.price,taxRate:De.taxRate,discount:0,total:De.price*De.quantity})),subtotal:be(),taxAmount:ke(),discount:0,total:Fe(),paymentMethod:d,paymentAmount:d==="cash"?m:Fe(),changeAmount:ue(),status:"completed",createdAt:J.now()},Te=`sale_${Date.now()}`;await Ze(me(H,"sales",Te),Je);for(const De of i){const qe=g.find(Me=>Me.id===De.productId);if(qe){const Me={...qe.storeStock||{}};Me[_]!==void 0?Me[_]=Math.max(0,Me[_]-De.quantity):((B=y.find(zl=>zl.id===_))==null?void 0:B.isMainStore)?Me[_]=Math.max(0,qe.stock-De.quantity):Me[_]=0;const Ri=((pe=y.find(Fa=>Fa.id===_))==null?void 0:pe.isMainStore)?Math.max(0,qe.stock-De.quantity):qe.stock;await pt(me(H,"products",De.productId),{stock:Ri,storeStock:Me,updatedAt:J.now()})}}await re();const Be={receiptNumber:Ce,date:new Date,cashierName:F.name,customerName:"Client anonyme",items:i.map(De=>({name:De.name,quantity:De.quantity,unitPrice:De.price,total:De.price*De.quantity})),subtotal:be(),taxAmount:ke(),total:Fe(),paymentMethod:d,paymentAmount:d==="cash"?m:Fe(),changeAmount:ue(),amountInWords:getAmountInWords(Fe()),establishmentInfo:b||{name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""}};v(Be),a([]),l(!1),h(0),L.success(`Vente ${Ce} enregistrée avec succès !`,{duration:5e3,icon:"🎉"}),setTimeout(()=>{L(De=>r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("span",{children:"Vente terminée ! Voulez-vous afficher le reçu ?"}),r.jsx("button",{onClick:()=>{D(!0),L.dismiss(De.id)},className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"Voir le reçu"})]}),{duration:6e3})},1e3)}catch(Ce){console.error("Erreur lors du traitement de la vente:",Ce),L.error("Erreur lors du traitement de la vente")}finally{x(!1)}},$=B=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(B).replace("MGA","Ar"),q=B=>{i.length>0?window.confirm("Changer de magasin videra votre panier actuel. Continuer ?")&&(a([]),C(B),T(!1)):(C(B),T(!1))},he=()=>{if(R){const B=window.open("","_blank");B&&(B.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>Reçu ${R.receiptNumber}</title>
            <style>
              body { font-family: 'Courier New', monospace; max-width: 300px; margin: 0; padding: 10px; }
              .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
              .company-name { font-size: 16px; font-weight: bold; margin-bottom: 5px; }
              .company-info { font-size: 10px; line-height: 1.4; }
              .receipt-info { margin: 10px 0; font-size: 10px; }
              .items { margin: 10px 0; }
              .item { display: flex; justify-content: space-between; font-size: 10px; margin: 2px 0; }
              .totals { border-top: 2px solid #000; padding-top: 10px; margin-top: 15px; font-size: 10px; }
              .total-line { display: flex; justify-content: space-between; margin: 2px 0; }
              .grand-total { font-weight: bold; font-size: 12px; border-top: 1px solid #000; padding-top: 5px; margin-top: 5px; }
              .footer { text-align: center; margin-top: 15px; border-top: 2px solid #000; padding-top: 10px; font-size: 10px; }
              @media print { body { margin: 0; padding: 5px; } }
            </style>
          </head>
          <body>
            <div class="header">
              <div class="company-name">${R.establishmentInfo.name}</div>
              <div class="company-info">
                ${R.establishmentInfo.address}<br>
                Tél: ${R.establishmentInfo.phone}<br>
                Email: ${R.establishmentInfo.email}
              </div>
            </div>
            
            <div class="receipt-info">
              <div><strong>Reçu N°:</strong> ${R.receiptNumber}</div>
              <div><strong>Date:</strong> ${R.date.toLocaleDateString("fr-FR")} ${R.date.toLocaleTimeString("fr-FR")}</div>
              <div><strong>Caissier:</strong> ${R.cashierName}</div>
            </div>
            
            <div class="items">
              ${R.items.map(pe=>`
                <div class="item">
                  <span>${pe.name} x${pe.quantity}</span>
                  <span>${$(pe.total)}</span>
                </div>
              `).join("")}
            </div>
            
            <div class="totals">
              <div class="total-line">
                <span>Sous-total:</span>
                <span>${$(R.subtotal)}</span>
              </div>
              <div class="total-line">
                <span>TVA:</span>
                <span>${$(R.taxAmount)}</span>
              </div>
              <div class="total-line grand-total">
                <span>TOTAL:</span>
                <span>${$(R.total)}</span>
              </div>
              <div class="total-line">
                <span>Payé:</span>
                <span>${$(R.paymentAmount)}</span>
              </div>
              ${R.changeAmount>0?`
                <div class="total-line">
                  <span>Rendu:</span>
                  <span>${$(R.changeAmount)}</span>
                </div>
              `:""}
            </div>
            
            <div class="amount-in-words" style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #000; font-style: italic; font-size: 10px;">
              ${Hd(R.total)}
            </div>
            
            <div class="footer">
              Merci de votre visite !
            </div>
          </body>
          </html>
        `),B.document.close(),B.print())}},Ae=B=>{L.success(`Reçu envoyé à ${B}`,{duration:4e3,icon:"📧"})};return ee?r.jsx("div",{className:"h-full flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Chargement du point de vente..."})]})}):r.jsxs("div",{className:"h-full flex flex-col gap-6",children:[r.jsxs("div",{className:"flex items-center justify-between bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ms,{className:"w-5 h-5 text-blue-600 mr-2"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Magasin actuel:"}),r.jsx("p",{className:"font-semibold text-blue-900",children:_?((Ve=y.find(B=>B.id===_))==null?void 0:Ve.name)||"Magasin inconnu":"Aucun magasin sélectionné"})]})]}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>T(!0),className:"text-blue-600 hover:bg-blue-100",children:"Changer de magasin"})]}),r.jsxs("div",{className:"flex-1 flex gap-6",children:[r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Point de Vente"}),r.jsx("div",{className:"w-80",children:r.jsx(fe,{placeholder:"Rechercher produit...",value:s,onChange:B=>n(B.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})})})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("button",{onClick:()=>e("all"),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${t==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Tous (",g.filter(B=>se(B)>0).length,")"]}),I.map(B=>{const pe=g.filter(Ce=>Ce.categoryId===B.id&&se(Ce)>0);return r.jsxs("button",{onClick:()=>e(B.id),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${t===B.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[B.name," (",pe.length,")"]},B.id)})]}),Y.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(ht,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun produit disponible"}),r.jsx("p",{className:"text-gray-500",children:g.length===0?'Ajoutez des produits dans la section "Produits"':"Aucun produit ne correspond à votre recherche ou n'est disponible dans ce magasin"})]}):r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:Y.map(B=>{const pe=se(B);return r.jsx(G,{padding:"sm",className:"cursor-pointer hover:shadow-md transition-shadow",children:r.jsxs("div",{onClick:()=>U(B),children:[r.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:r.jsx("span",{className:"text-4xl",children:B.image})}),r.jsx("h3",{className:"font-medium text-sm text-gray-900 mb-1 line-clamp-2",children:B.name}),r.jsx("p",{className:"text-xs text-gray-500 mb-2",children:B.category}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"font-bold text-blue-600",children:$(B.salePrice)}),r.jsxs("span",{className:`text-xs ${pe<=5?"text-red-500":"text-gray-500"}`,children:["Stock: ",pe]})]})]})},B.id)})})]})}),r.jsx("div",{className:"w-96",children:r.jsxs(G,{padding:"none",className:"h-full flex flex-col",children:[r.jsx("div",{className:"p-4 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(br,{className:"w-5 h-5 mr-2"}),"Panier (",i.length,")"]}),i.length>0&&r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>a([]),children:"Vider"})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:i.length===0?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(br,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),r.jsx("p",{children:"Panier vide"}),r.jsx("p",{className:"text-sm",children:"Ajoutez des produits pour commencer"})]}):r.jsx("div",{className:"space-y-3",children:i.map(B=>r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[r.jsx("div",{className:"text-2xl",children:B.image}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-sm text-gray-900",children:B.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[$(B.price)," / ",B.unit]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>de(B.productId,B.quantity-1),className:"w-6 h-6 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center",children:r.jsx(qd,{className:"w-3 h-3"})}),r.jsx("span",{className:"w-8 text-center text-sm font-medium",children:B.quantity}),r.jsx("button",{onClick:()=>de(B.productId,B.quantity+1),className:"w-6 h-6 rounded-full bg-blue-100 hover:bg-blue-200 flex items-center justify-center text-blue-600",children:r.jsx(Rt,{className:"w-3 h-3"})})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"font-semibold text-sm",children:$(B.price*B.quantity)}),B.taxRate>0&&r.jsxs("button",{onClick:()=>ne(B.productId),className:`text-xs px-2 py-1 rounded-full mt-1 transition-colors ${B.applyTax?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:B.applyTax?"Cliquer pour désactiver la TVA":"Cliquer pour activer la TVA",children:["TVA ",B.taxRate,"% ",B.applyTax?"✓":"✗"]}),r.jsx("button",{onClick:()=>K(B.productId),className:"text-red-500 hover:text-red-700 mt-1",children:r.jsx(bt,{className:"w-3 h-3"})})]})]},B.id))})}),i.length>0&&r.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-4",children:[r.jsxs("div",{className:"space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Sous-total:"}),r.jsx("span",{children:$(be())})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"TVA:"}),r.jsx("span",{children:$(ke())})]}),r.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[r.jsx("span",{children:"Total:"}),r.jsx("span",{className:"text-blue-600",children:$(Fe())})]})]}),o?r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"grid grid-cols-2 gap-2",children:$6.map(B=>r.jsxs("button",{onClick:()=>u(B.id),className:`p-3 rounded-lg border-2 transition-colors flex items-center justify-center ${d===B.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[r.jsx(B.icon,{className:"w-4 h-4 mr-2"}),r.jsx("span",{className:"text-sm",children:B.name})]},B.id))}),d==="cash"&&r.jsxs("div",{children:[r.jsx(fe,{label:"Montant reçu (Ar)",type:"number",value:m||"",onChange:B=>h(Number(B.target.value)),placeholder:"0"}),m>0&&r.jsx("div",{className:"mt-2 p-2 bg-green-50 rounded text-sm",children:r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{children:"Rendu:"}),r.jsx("span",{className:"font-bold",children:$(ue())})]})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>l(!1),children:"Retour"}),r.jsx(O,{variant:"success",fullWidth:!0,onClick:ye,disabled:f||d==="cash"&&m<Fe()||!_,children:f?"Traitement...":"Finaliser"})]})]}):r.jsx(O,{fullWidth:!0,size:"lg",onClick:()=>l(!0),children:"Procéder au paiement"})]})]})})]}),k&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-md",padding:"lg",children:r.jsx(E1,{onStoreSelect:q,selectedStore:_,onClose:()=>T(!1)})})}),S&&R&&r.jsx(V1,{receiptData:R,onClose:()=>D(!1),onPrint:he,onEmailSend:Ae})]})},U6=()=>r.jsx("div",{className:"h-full",children:r.jsx(z6,{})}),uv=[{id:"piece",name:"Pièce"},{id:"kg",name:"Kilogramme"},{id:"g",name:"Gramme"},{id:"l",name:"Litre"},{id:"ml",name:"Millilitre"},{id:"box",name:"Boîte"},{id:"pack",name:"Pack"}],B6=({product:t,onSubmit:e,onCancel:s,isLoading:n=!1})=>{const[i,a]=A.useState([]),[o,l]=A.useState([]),[d,u]=A.useState(!0),[m,h]=A.useState(!0),{user:f}=Le(),[x,y]=A.useState({}),[P,_]=A.useState({name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||"",reference:(t==null?void 0:t.reference)||"",barcode:(t==null?void 0:t.barcode)||"",categoryId:(t==null?void 0:t.categoryId)||"",brand:(t==null?void 0:t.brand)||"",salePrice:(t==null?void 0:t.salePrice)||"",purchasePrice:(t==null?void 0:t.purchasePrice)||"",taxRate:(t==null?void 0:t.taxRate)||20,stock:(t==null?void 0:t.stock)||"",minStock:(t==null?void 0:t.minStock)||"",unit:(t==null?void 0:t.unit)||"piece",isActive:(t==null?void 0:t.isActive)!==!1}),[C,k]=A.useState({});A.useEffect(()=>{(async()=>{if(f!=null&&f.establishmentId)try{u(!0);const I=Ne(je(H,"categories"),oe("establishmentId","==",f.establishmentId)),ee=(await _e(I)).docs.map(V=>{const F=V.data();return{id:V.id,name:F.name,color:F.color}});a(ee)}catch(I){console.error("Erreur lors du chargement des catégories:",I)}finally{u(!1)}})()},[f==null?void 0:f.establishmentId]),A.useEffect(()=>{(async()=>{if(f!=null&&f.establishmentId)try{h(!0);const I=Ne(je(H,"stores"),oe("establishmentId","==",f.establishmentId),oe("isActive","==",!0)),ee=(await _e(I)).docs.map(V=>{const F=V.data();return{id:V.id,name:F.name,isMainStore:F.isMainStore||!1}});l(ee)}catch(I){console.error("Erreur lors du chargement des magasins:",I)}finally{h(!1)}})()},[f==null?void 0:f.establishmentId]),A.useEffect(()=>{if(t&&o.length>0){const w={};t.storeStock?o.forEach(I=>{w[I.id]=t.storeStock[I.id]||0}):o.forEach(I=>{w[I.id]=I.isMainStore?t.stock:0}),y(w)}else if(o.length>0){const w={};o.forEach(I=>{w[I.id]=0}),y(w)}},[t,o]);const T=(w,I)=>{_(E=>({...E,[w]:I})),C[w]&&k(E=>({...E,[w]:""}))},S=(w,I)=>{const E=parseInt(I),ee=isNaN(E)?0:E;y(V=>({...V,[w]:ee}))},D=()=>{const w=i.find(ee=>ee.id===P.categoryId),I=w?w.name.substring(0,2).toUpperCase():"PR",E=Math.floor(Math.random()*1e3).toString().padStart(3,"0");T("reference",`${I}${E}`)},R=()=>{const w=Math.floor(Math.random()*1e12).toString().padStart(12,"0");T("barcode",w)},v=()=>{const w={};return P.name.trim()||(w.name="Le nom est requis"),P.reference.trim()||(w.reference="La référence est requise"),P.categoryId||(w.categoryId="La catégorie est requise"),(!P.salePrice||Number(P.salePrice)<=0)&&(w.salePrice="Le prix de vente doit être supérieur à 0"),(!P.purchasePrice||Number(P.purchasePrice)<=0)&&(w.purchasePrice="Le prix d'achat doit être supérieur à 0"),Number(P.salePrice)<=Number(P.purchasePrice)&&(w.salePrice="Le prix de vente doit être supérieur au prix d'achat"),o.length===0?(!P.stock||Number(P.stock)<0)&&(w.stock="Le stock doit être supérieur ou égal à 0"):Object.values(x).reduce((E,ee)=>E+ee,0)<0&&(w.storeStock="Le stock total doit être supérieur ou égal à 0"),(!P.minStock||Number(P.minStock)<0)&&(w.minStock="Le stock minimum doit être supérieur ou égal à 0"),k(w),Object.keys(w).length===0},b=w=>{if(w.preventDefault(),v()){let I=0;o.length>0?I=Object.values(x).reduce((ee,V)=>ee+V,0):I=Number(P.stock);const E={...P,salePrice:Number(P.salePrice),purchasePrice:Number(P.purchasePrice),taxRate:Number(P.taxRate),stock:I,minStock:Number(P.minStock),storeStock:x};e(E)}},N=()=>{const w=Number(P.salePrice)||0,I=Number(P.purchasePrice)||0;return I>0?((w-I)/I*100).toFixed(1):"0"},g=()=>Object.values(x).reduce((w,I)=>w+I,0);return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Modifier le produit":"Ajouter un produit"}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:b,className:"p-6",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r.jsx("div",{className:"lg:col-span-1",children:r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx(ht,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Image du produit"}),r.jsxs(O,{variant:"ghost",size:"sm",className:"mt-2",children:[r.jsx(Fu,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]})}),r.jsx("div",{className:"space-y-3",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:P.isActive,onChange:w=>T("isActive",w.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Produit actif"})]})})]})}),r.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations générales"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(fe,{label:"Nom du produit *",value:P.name,onChange:w=>T("name",w.target.value),error:C.name,placeholder:"Ex: MacBook Pro 13 pouces"})}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{value:P.description,onChange:w=>T("description",w.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description détaillée du produit..."})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(fe,{label:"Référence *",value:P.reference,onChange:w=>T("reference",w.target.value),error:C.reference,placeholder:"REF001"}),r.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:D,className:"mt-6",children:"Générer"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(fe,{label:"Code-barres",value:P.barcode,onChange:w=>T("barcode",w.target.value),leftIcon:r.jsx(b1,{className:"w-4 h-4"}),placeholder:"123456789012"}),r.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:R,className:"mt-6",children:"Générer"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Catégorie *"}),d?r.jsx("div",{className:"px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:"Chargement des catégories..."}):r.jsxs("select",{value:P.categoryId,onChange:w=>T("categoryId",w.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${C.categoryId?"border-red-300":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Sélectionner une catégorie"}),i.map(w=>r.jsx("option",{value:w.id,children:w.name},w.id))]}),C.categoryId&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:C.categoryId}),i.length===0&&!d&&r.jsx("p",{className:"mt-1 text-sm text-orange-600",children:`Aucune catégorie trouvée. Créez d'abord des catégories dans la section "Catégories".`})]}),r.jsx(fe,{label:"Marque",value:P.brand,onChange:w=>T("brand",w.target.value),placeholder:"Ex: Apple, Samsung, HP..."})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Tarification"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx(fe,{label:"Prix d'achat (Ar) *",type:"number",value:P.purchasePrice,onChange:w=>T("purchasePrice",w.target.value),error:C.purchasePrice,placeholder:"1000000"}),r.jsx(fe,{label:"Prix de vente (Ar) *",type:"number",value:P.salePrice,onChange:w=>T("salePrice",w.target.value),error:C.salePrice,placeholder:"1200000"}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marge bénéficiaire"}),r.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-md",children:r.jsxs("span",{className:"text-lg font-semibold text-green-600",children:[N(),"%"]})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Taux de TVA (%)"}),r.jsxs("select",{value:P.taxRate,onChange:w=>T("taxRate",Number(w.target.value)),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:0,children:"0% (Exonéré)"}),r.jsx("option",{value:20,children:"20% (Standard Madagascar)"}),r.jsx("option",{value:5,children:"5% (Taux réduit)"}),r.jsx("option",{value:10,children:"10% (Taux intermédiaire)"})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ce taux peut être modifié lors de la vente"})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Gestion des stocks"}),o.length>0?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsxs("div",{className:"flex items-start mb-3",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Gestion multi-magasins"}),r.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Définissez le stock pour chaque magasin. Le stock total sera calculé automatiquement."})]})]}),r.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Stock par magasin"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(w=>r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3",children:r.jsx(Ms,{className:"w-4 h-4 text-blue-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("label",{className:"block text-sm font-medium text-blue-700",children:[w.name," ",w.isMainStore&&"(Principal)"]}),r.jsxs("div",{className:"mt-1 flex items-center",children:[r.jsx("input",{type:"number",min:"0",value:x[w.id]||0,onChange:I=>S(w.id,I.target.value),className:"block w-full px-3 py-2 border border-blue-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white"}),r.jsx("span",{className:"ml-2 text-sm text-blue-600",children:P.unit})]})]})]},w.id))}),r.jsxs("p",{className:"text-sm text-blue-600 mt-3",children:["Stock total: ",r.jsxs("strong",{children:[g()," ",P.unit]})]}),C.storeStock&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:C.storeStock})]}),r.jsx(fe,{label:"Stock minimum *",type:"number",value:P.minStock,onChange:w=>T("minStock",w.target.value),error:C.minStock,placeholder:"2"}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unité de mesure"}),r.jsx("select",{value:P.unit,onChange:w=>T("unit",w.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:uv.map(w=>r.jsx("option",{value:w.id,children:w.name},w.id))})]})]}):r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx(fe,{label:"Stock actuel *",type:"number",value:P.stock,onChange:w=>T("stock",w.target.value),error:C.stock,placeholder:"10"}),r.jsx(fe,{label:"Stock minimum *",type:"number",value:P.minStock,onChange:w=>T("minStock",w.target.value),error:C.minStock,placeholder:"2"}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unité de mesure"}),r.jsx("select",{value:P.unit,onChange:w=>T("unit",w.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:uv.map(w=>r.jsx("option",{value:w.id,children:w.name},w.id))})]}),r.jsx("div",{className:"md:col-span-3",children:r.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Gestion de stock simplifiée"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:`Vous n'avez pas encore configuré de magasins. Pour une gestion avancée des stocks par magasin, créez d'abord des magasins dans la section "Magasins".`})]})]})})})]})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:s,disabled:n,children:"Annuler"}),r.jsx(O,{type:"submit",disabled:n||i.length===0,children:n?"Enregistrement...":t?"Modifier":"Ajouter"})]})]})]})})},q6=[{id:"all",name:"Tous les statuts"},{id:"active",name:"Actifs"},{id:"inactive",name:"Inactifs"},{id:"low_stock",name:"Stock faible"},{id:"out_of_stock",name:"Rupture de stock"}],G6=({searchTerm:t,onSearchChange:e,selectedCategory:s,onCategoryChange:n,selectedStatus:i,onStatusChange:a,onExport:o,stats:l})=>{const[d,u]=A.useState([]),{user:m}=Le();return A.useEffect(()=>{(async()=>{if(m!=null&&m.establishmentId)try{const f=Ne(je(H,"categories"),oe("establishmentId","==",m.establishmentId)),y=(await _e(f)).docs.map(P=>{const _=P.data();return{id:P.id,name:_.name}});u(y)}catch(f){console.error("Erreur lors du chargement des catégories:",f)}})()},[m==null?void 0:m.establishmentId]),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(ht,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total produits"}),r.jsx("p",{className:"text-2xl font-bold text-blue-900",children:l.total})]})]})}),r.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(ht,{className:"w-8 h-8 text-green-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-green-600",children:"Actifs"}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:l.active})]})]})}),r.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Oe,{className:"w-8 h-8 text-orange-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Stock faible"}),r.jsx("p",{className:"text-2xl font-bold text-orange-900",children:l.lowStock})]})]})}),r.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Oe,{className:"w-8 h-8 text-red-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-red-600",children:"Rupture"}),r.jsx("p",{className:"text-2xl font-bold text-red-900",children:l.outOfStock})]})]})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(fe,{placeholder:"Rechercher par nom, référence ou code-barres...",value:t,onChange:h=>e(h.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})})}),r.jsxs("select",{value:s,onChange:h=>n(h.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Toutes les catégories"}),d.map(h=>r.jsx("option",{value:h.id,children:h.name},h.id))]}),r.jsx("select",{value:i,onChange:h=>a(h.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:q6.map(h=>r.jsx("option",{value:h.id,children:h.name},h.id))})]}),r.jsxs("div",{className:"flex justify-between items-center mt-4",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>a("low_stock"),className:i==="low_stock"?"bg-orange-100 text-orange-700":"",children:[r.jsx(Oe,{className:"w-4 h-4 mr-1"}),"Stock faible (",l.lowStock,")"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>a("out_of_stock"),className:i==="out_of_stock"?"bg-red-100 text-red-700":"",children:[r.jsx(Oe,{className:"w-4 h-4 mr-1"}),"Rupture (",l.outOfStock,")"]})]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:o,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]})]})},W6=({products:t,onEdit:e,onDelete:s,onView:n,isLoading:i=!1,userRole:a})=>{const o=h=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(h).replace("MGA","Ar"),l=(h,f)=>h===0?{status:"out",color:"red",text:"Rupture",icon:Oe}:h<=f?{status:"low",color:"orange",text:"Stock faible",icon:Oe}:{status:"good",color:"green",text:"En stock",icon:ht},d=(h,f)=>f>0?((h-f)/f*100).toFixed(1):"0",u=h=>({beverages:"bg-blue-100 text-blue-800",food:"bg-green-100 text-green-800",household:"bg-purple-100 text-purple-800",electronics:"bg-yellow-100 text-yellow-800",clothing:"bg-pink-100 text-pink-800",health:"bg-indigo-100 text-indigo-800"})[h]||"bg-gray-100 text-gray-800",m=a==="reader";return i?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((h,f)=>r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),r.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),r.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},f))})}):t.length===0?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx(ht,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun produit trouvé"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"Commencez par ajouter votre premier produit"}),!m&&r.jsxs(O,{children:[r.jsx(ht,{className:"w-4 h-4 mr-2"}),"Ajouter un produit"]})]})}):r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Référence"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Catégorie"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Prix & Marge"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(h=>{const f=l(h.stock,h.minStock),x=d(h.salePrice,h.purchasePrice),y=parseFloat(x);return r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-4",children:r.jsx(ht,{className:"w-6 h-6 text-gray-400"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.name}),r.jsxs("div",{className:"text-sm text-gray-500",children:[h.brand&&`${h.brand} • `,h.unit]}),h.barcode&&r.jsx("div",{className:"text-xs text-gray-400 font-mono",children:h.barcode})]})]})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.reference}),r.jsxs("div",{className:"text-sm text-gray-500",children:["TVA ",h.taxRate,"%"]})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${u(h.categoryId)}`,children:h.category})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"font-medium text-gray-900",children:["Vente: ",o(h.salePrice)]}),r.jsxs("div",{className:"text-gray-500",children:["Achat: ",o(h.purchasePrice)]}),r.jsxs("div",{className:`flex items-center text-xs ${y>=30?"text-green-600":y>=15?"text-orange-600":"text-red-600"}`,children:[y>=15?r.jsx(or,{className:"w-3 h-3 mr-1"}):r.jsx(Ni,{className:"w-3 h-3 mr-1"}),"Marge: ",x,"%"]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-gray-900",children:h.stock}),r.jsxs("div",{className:"text-gray-500 text-xs",children:["Min: ",h.minStock]})]}),(f.status==="low"||f.status==="out")&&r.jsx(Oe,{className:`w-4 h-4 ml-2 text-${f.color}-500`})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${h.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:h.isActive?"Actif":"Inactif"}),r.jsx("div",{children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-${f.color}-100 text-${f.color}-800`,children:f.text})})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(h),title:"Voir les détails",children:r.jsx(As,{className:"w-4 h-4"})}),!m&&r.jsxs(r.Fragment,{children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(h),title:"Modifier",children:r.jsx(wr,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(h.id),title:"Supprimer",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(ms,{className:"w-4 h-4"})})]})]})})]},h.id)})})]})})})},H6=({product:t,onClose:e,onEdit:s})=>{const n=m=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(m).replace("MGA","Ar"),i=m=>m.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),a=(m,h)=>h>0?((m-h)/h*100).toFixed(1):"0",l=t.stock===0?{label:"Rupture de stock",color:"bg-red-100 text-red-800 border-red-200",icon:r.jsx(Oe,{className:"w-4 h-4 text-red-600 mr-2"})}:t.stock<=t.minStock?{label:"Stock faible",color:"bg-orange-100 text-orange-800 border-orange-200",icon:r.jsx(Oe,{className:"w-4 h-4 text-orange-600 mr-2"})}:{label:"En stock",color:"bg-green-100 text-green-800 border-green-200",icon:r.jsx(br,{className:"w-4 h-4 text-green-600 mr-2"})},d=a(t.salePrice,t.purchasePrice),u=parseFloat(d);return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[r.jsx(ht,{className:"w-6 h-6 mr-2"}),"Détails du produit"]}),r.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex items-start gap-6",children:[r.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center",children:r.jsx(ht,{className:"w-12 h-12 text-gray-400"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:t.name}),r.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.category}),r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.isActive?"Actif":"Inactif"})]}),t.description&&r.jsx("p",{className:"text-gray-600 mt-2",children:t.description})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(zn,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Référence"}),r.jsx("p",{className:"font-semibold text-gray-900",children:t.reference})]})]}),t.barcode&&r.jsxs("div",{className:"flex items-center",children:[r.jsx(b1,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Code-barres"}),r.jsx("p",{className:"font-semibold text-gray-900 font-mono",children:t.barcode})]})]}),t.brand&&r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ks,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Marque"}),r.jsx("p",{className:"font-semibold text-gray-900",children:t.brand})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(ut,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Créé le"}),r.jsx("p",{className:"font-semibold text-gray-900",children:i(t.createdAt)})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(kt,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Prix de vente"}),r.jsx("p",{className:"font-semibold text-gray-900 text-lg",children:n(t.salePrice)})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(kt,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Prix d'achat"}),r.jsx("p",{className:"font-semibold text-gray-900",children:n(t.purchasePrice)})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(or,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Marge bénéficiaire"}),r.jsxs("p",{className:`font-semibold ${u>=30?"text-green-600":u>=15?"text-orange-600":"text-red-600"}`,children:[d,"%"]})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ks,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"TVA"}),r.jsxs("p",{className:"font-semibold text-gray-900",children:[t.taxRate,"%"]})]})]})]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[r.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Informations de stock"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Stock actuel"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.stock}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Unité: ",t.unit]})]}),r.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Stock minimum"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.minStock}),r.jsx("p",{className:"text-xs text-gray-500",children:"Seuil d'alerte"})]}),r.jsxs("div",{className:`bg-white p-3 rounded-lg border ${l.color}`,children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Statut"}),r.jsxs("p",{className:"text-lg font-bold flex items-center",children:[l.icon,l.label]}),t.stock<=t.minStock&&t.stock>0&&r.jsx("p",{className:"text-xs text-orange-600",children:"Commander bientôt"}),t.stock===0&&r.jsx("p",{className:"text-xs text-red-600",children:"Commander immédiatement"})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Valeur d'achat du stock"}),r.jsx("p",{className:"text-2xl font-bold text-blue-700",children:n(t.purchasePrice*t.stock)}),r.jsxs("p",{className:"text-sm text-blue-600",children:[t.stock," × ",n(t.purchasePrice)]})]}),r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsx("h4",{className:"font-semibold text-green-900 mb-2",children:"Valeur de vente du stock"}),r.jsx("p",{className:"text-2xl font-bold text-green-700",children:n(t.salePrice*t.stock)}),r.jsxs("p",{className:"text-sm text-green-600",children:[t.stock," × ",n(t.salePrice)]})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:e,children:"Fermer"}),r.jsx(O,{onClick:s,children:"Modifier"})]})]})})},K6=()=>{const[t,e]=A.useState([]),[s,n]=A.useState([]),[i,a]=A.useState([]),[o,l]=A.useState(""),[d,u]=A.useState("all"),[m,h]=A.useState("all"),[f,x]=A.useState(!1),[y,P]=A.useState(null),[_,C]=A.useState(!1),[k,T]=A.useState(!0),[S,D]=A.useState(null),[R,v]=A.useState(!1),{user:b}=Le(),N=async()=>{if(b!=null&&b.establishmentId)try{const Z=Ne(je(H,"stores"),oe("establishmentId","==",b.establishmentId),oe("isActive","==",!0)),Y=(await _e(Z)).docs.map(U=>{const K=U.data();return{id:U.id,name:K.name,isMainStore:K.isMainStore||!1}});a(Y)}catch(Z){console.error("Erreur lors du chargement des magasins:",Z)}},g=async()=>{if(b!=null&&b.establishmentId)try{const Z=Ne(je(H,"categories"),oe("establishmentId","==",b.establishmentId)),Y=(await _e(Z)).docs.map(U=>{const K=U.data();return{id:U.id,name:K.name,color:K.color}});n(Y)}catch(Z){console.error("Erreur lors du chargement des catégories:",Z)}},w=async()=>{if(b!=null&&b.establishmentId)try{const Z=Ne(je(H,"products"),oe("establishmentId","==",b.establishmentId)),Y=(await _e(Z)).docs.map(U=>{var ne,be;const K=U.data(),de=s.find(ke=>ke.id===K.categoryId);return{id:U.id,name:K.name,reference:K.reference,salePrice:K.salePrice,purchasePrice:K.purchasePrice,stock:K.stock,minStock:K.minStock,categoryId:K.categoryId,category:(de==null?void 0:de.name)||"Catégorie inconnue",taxRate:K.taxRate,isActive:K.isActive,unit:K.unit,brand:K.brand,barcode:K.barcode,description:K.description,establishmentId:K.establishmentId,storeStock:K.storeStock||{},createdAt:((ne=K.createdAt)==null?void 0:ne.toDate())||new Date,updatedAt:((be=K.updatedAt)==null?void 0:be.toDate())||new Date}});e(Y)}catch(Z){console.error("Erreur lors du chargement des produits:",Z),L.error("Erreur lors du chargement des produits")}};A.useEffect(()=>{const Z=async()=>{T(!0),await N(),await g(),await w(),T(!1)};b!=null&&b.establishmentId&&Z()},[b==null?void 0:b.establishmentId]),A.useEffect(()=>{s.length>0&&w()},[s]);const I=A.useMemo(()=>t.filter(Z=>{const se=Z.name.toLowerCase().includes(o.toLowerCase())||Z.reference.toLowerCase().includes(o.toLowerCase())||Z.barcode&&Z.barcode.includes(o)||Z.brand&&Z.brand.toLowerCase().includes(o.toLowerCase()),Y=d==="all"||Z.categoryId===d;let U=!0;switch(m){case"active":U=Z.isActive;break;case"inactive":U=!Z.isActive;break;case"low_stock":U=Z.stock>0&&Z.stock<=Z.minStock;break;case"out_of_stock":U=Z.stock===0;break;default:U=!0}return se&&Y&&U}),[t,o,d,m]),E=A.useMemo(()=>({total:t.length,active:t.filter(Z=>Z.isActive).length,lowStock:t.filter(Z=>Z.stock>0&&Z.stock<=Z.minStock).length,outOfStock:t.filter(Z=>Z.stock===0).length}),[t]),ee=()=>{if(s.length===0){L.error("Créez d'abord des catégories avant d'ajouter des produits");return}if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des produits");return}P(null),x(!0)},V=Z=>{if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour modifier des produits");return}P(Z),x(!0)},F=async Z=>{if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des produits");return}if(window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ?"))try{await Ds(me(H,"products",Z)),await w(),L.success("Produit supprimé avec succès")}catch(se){console.error("Erreur lors de la suppression:",se),L.error("Erreur lors de la suppression")}},X=Z=>{D(Z),v(!0)},W=async Z=>{if(!(b!=null&&b.establishmentId)){L.error("Établissement non trouvé");return}if((b==null?void 0:b.role)==="reader"){L.error("Vous n'avez pas les permissions nécessaires pour modifier des produits");return}C(!0);try{if(y)await pt(me(H,"products",y.id),{...Z,establishmentId:b.establishmentId,updatedAt:J.now()}),L.success("Produit modifié avec succès");else{const se=`product_${Date.now()}`;await Ze(me(H,"products",se),{...Z,establishmentId:b.establishmentId,createdAt:J.now(),updatedAt:J.now()}),L.success("Produit ajouté avec succès")}await w(),x(!1),P(null)}catch(se){console.error("Erreur lors de l'enregistrement:",se),L.error("Erreur lors de l'enregistrement")}finally{C(!1)}},re=()=>{const Z=[["Nom","Référence","Catégorie","Prix de vente","Prix d'achat","Stock","Stock min","Statut"],...I.map(K=>[K.name,K.reference,K.category,K.salePrice,K.purchasePrice,K.stock,K.minStock,K.isActive?"Actif":"Inactif"])].map(K=>K.join(",")).join(`
`),se=new Blob([Z],{type:"text/csv"}),Y=window.URL.createObjectURL(se),U=document.createElement("a");U.href=Y,U.download=`produits_${new Date().toISOString().split("T")[0]}.csv`,U.click(),window.URL.revokeObjectURL(Y),L.success("Export réalisé avec succès")};return k?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des données..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des Produits"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez votre catalogue de produits et suivez vos stocks"})]}),(b==null?void 0:b.role)!=="reader"&&r.jsxs(O,{onClick:ee,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Ajouter un produit"]})]}),(b==null?void 0:b.role)==="reader"&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les produits mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),s.length===0&&r.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("svg",{className:"h-5 w-5 text-orange-400",viewBox:"0 0 20 20",fill:"currentColor",children:r.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),r.jsxs("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Aucune catégorie trouvée"}),r.jsx("div",{className:"mt-2 text-sm text-orange-700",children:r.jsxs("p",{children:["Vous devez d'abord créer des catégories avant d'ajouter des produits."," ",r.jsx("button",{onClick:()=>window.location.href="/categories",className:"font-medium underline hover:text-orange-600",children:"Créer des catégories maintenant"})]})})]})]})}),r.jsx(G6,{searchTerm:o,onSearchChange:l,selectedCategory:d,onCategoryChange:u,selectedStatus:m,onStatusChange:h,onExport:re,stats:E}),r.jsx(W6,{products:I,onEdit:V,onDelete:F,onView:X,isLoading:!1,userRole:(b==null?void 0:b.role)||""}),f&&r.jsx(B6,{product:y,onSubmit:W,onCancel:()=>{x(!1),P(null)},isLoading:_}),R&&S&&r.jsx(H6,{product:S,onClose:()=>{v(!1),D(null)},onEdit:()=>{v(!1),V(S)}})]})},mv=[{id:"blue",name:"Bleu",class:"bg-blue-500"},{id:"green",name:"Vert",class:"bg-green-500"},{id:"purple",name:"Violet",class:"bg-purple-500"},{id:"orange",name:"Orange",class:"bg-orange-500"},{id:"red",name:"Rouge",class:"bg-red-500"},{id:"yellow",name:"Jaune",class:"bg-yellow-500"},{id:"pink",name:"Rose",class:"bg-pink-500"},{id:"indigo",name:"Indigo",class:"bg-indigo-500"},{id:"teal",name:"Sarcelle",class:"bg-teal-500"},{id:"gray",name:"Gris",class:"bg-gray-500"}],hv=({readOnly:t=!1})=>{const[e,s]=A.useState([]),[n,i]=A.useState(!0),[a,o]=A.useState(!1),[l,d]=A.useState(null),[u,m]=A.useState({name:"",description:"",color:"blue"}),[h,f]=A.useState({}),{user:x}=Le(),y=async()=>{if(x!=null&&x.establishmentId)try{i(!0);const D=Ne(je(H,"categories"),oe("establishmentId","==",x.establishmentId)),v=(await _e(D)).docs.map(b=>{var g;const N=b.data();return{id:b.id,name:N.name,description:N.description||"",color:N.color,establishmentId:N.establishmentId,createdAt:((g=N.createdAt)==null?void 0:g.toDate())||new Date,productCount:0}});s(v)}catch(D){console.error("Erreur lors du chargement des catégories:",D),L.error("Erreur lors du chargement des catégories")}finally{i(!1)}};A.useEffect(()=>{y()},[x==null?void 0:x.establishmentId]);const P=()=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des catégories");return}d(null),m({name:"",description:"",color:"blue"}),f({}),o(!0)},_=D=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour modifier des catégories");return}d(D),m({name:D.name,description:D.description||"",color:D.color}),f({}),o(!0)},C=()=>{const D={};return u.name.trim()||(D.name="Le nom de la catégorie est requis"),e.find(v=>v.name.toLowerCase()===u.name.toLowerCase()&&v.id!==(l==null?void 0:l.id))&&(D.name="Une catégorie avec ce nom existe déjà"),f(D),Object.keys(D).length===0},k=async D=>{if(D.preventDefault(),!(!C()||!(x!=null&&x.establishmentId)))try{if(l)await pt(me(H,"categories",l.id),{name:u.name.trim(),description:u.description.trim(),color:u.color,updatedAt:J.now()}),L.success("Catégorie modifiée avec succès");else{const R=`${x.establishmentId}_${Date.now()}`;await Ze(me(H,"categories",R),{name:u.name.trim(),description:u.description.trim(),color:u.color,establishmentId:x.establishmentId,createdAt:J.now()}),L.success("Catégorie créée avec succès")}await y(),o(!1),d(null)}catch(R){console.error("Erreur lors de la sauvegarde:",R),L.error("Erreur lors de la sauvegarde")}},T=async D=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des catégories");return}const R=e.find(v=>v.id===D);if(R){if(R.productCount&&R.productCount>0){L.error(`Impossible de supprimer: ${R.productCount} produit(s) utilisent cette catégorie`);return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer la catégorie "${R.name}" ?`))try{await Ds(me(H,"categories",D)),await y(),L.success("Catégorie supprimée avec succès")}catch(v){console.error("Erreur lors de la suppression:",v),L.error("Erreur lors de la suppression")}}},S=D=>{const R=mv.find(v=>v.id===D);return R?R.class:"bg-gray-500"};return n?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des catégories..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestion des Catégories"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Organisez vos produits avec des catégories personnalisées"})]}),!t&&r.jsxs(O,{onClick:P,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Nouvelle catégorie"]})]}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"💡 Suggestions de catégories"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🖥️ Matériel Informatique"}),r.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"• Ordinateurs portables"}),r.jsx("li",{children:"• Ordinateurs de bureau"}),r.jsx("li",{children:"• Composants PC"}),r.jsx("li",{children:"• Périphériques"}),r.jsx("li",{children:"• Accessoires"})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"🏪 Commerce Général"}),r.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"• Alimentation"}),r.jsx("li",{children:"• Boissons"}),r.jsx("li",{children:"• Produits ménagers"}),r.jsx("li",{children:"• Hygiène & Beauté"}),r.jsx("li",{children:"• Papeterie"})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"👕 Mode & Textile"}),r.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"• Vêtements Homme"}),r.jsx("li",{children:"• Vêtements Femme"}),r.jsx("li",{children:"• Vêtements Enfant"}),r.jsx("li",{children:"• Chaussures"}),r.jsx("li",{children:"• Accessoires"})]})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(D=>r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:`w-4 h-4 rounded-full ${S(D.color)}`}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:D.name}),D.description&&r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:D.description}),r.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[D.productCount||0," produit(s)"]})]})]}),!t&&r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>_(D),children:r.jsx(wr,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>T(D.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(ms,{className:"w-4 h-4"})})]})]})},D.id)),e.length===0&&r.jsxs("div",{className:"col-span-full text-center py-12",children:[r.jsx(zn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune catégorie"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"Créez votre première catégorie pour organiser vos produits"}),!t&&r.jsxs(O,{onClick:P,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Créer une catégorie"]})]})]}),a&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier la catégorie":"Nouvelle catégorie"}),r.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:k,className:"space-y-4",children:[r.jsx(fe,{label:"Nom de la catégorie *",value:u.name,onChange:D=>m({...u,name:D.target.value}),error:h.name,placeholder:"Ex: Matériel Informatique",leftIcon:r.jsx(zn,{className:"w-4 h-4"})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optionnel)"}),r.jsx("textarea",{value:u.description,onChange:D=>m({...u,description:D.target.value}),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description de la catégorie..."})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[r.jsx(e6,{className:"w-4 h-4 inline mr-1"}),"Couleur de la catégorie"]}),r.jsx("div",{className:"grid grid-cols-5 gap-2",children:mv.map(D=>r.jsx("button",{type:"button",onClick:()=>m({...u,color:D.id}),className:`w-10 h-10 rounded-lg ${D.class} border-2 transition-all ${u.color===D.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"}`,title:D.name},D.id))})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>o(!1),children:"Annuler"}),r.jsxs(O,{type:"submit",children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),l?"Modifier":"Créer"]})]})]})]})})]})},Q6=()=>{const{user:t}=Le();return(t==null?void 0:t.role)==="reader"?r.jsxs("div",{className:"space-y-6",children:[r.jsx(G,{className:"p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(zn,{className:"w-8 h-8 text-yellow-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès en lecture seule"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"En tant que Lecteur, vous pouvez uniquement consulter les catégories mais pas les modifier."}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-yellow-800",children:[r.jsx("p",{className:"font-medium",children:"Permissions limitées"}),r.jsx("p",{className:"mt-1",children:"Votre rôle actuel ne permet pas de créer, modifier ou supprimer des catégories. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})})]})}),r.jsx(hv,{readOnly:!0})]}):r.jsx("div",{className:"space-y-6",children:r.jsx(hv,{readOnly:!1})})},Y6=({customer:t,onSubmit:e,onCancel:s,isLoading:n=!1})=>{const[i,a]=A.useState({name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",address:(t==null?void 0:t.address)||"",isActive:(t==null?void 0:t.isActive)!==!1}),[o,l]=A.useState({}),d=(h,f)=>{a(x=>({...x,[h]:f})),o[h]&&l(x=>({...x,[h]:""}))},u=()=>{const h={};return i.name.trim()||(h.name="Le nom est requis"),i.email.trim()?/\S+@\S+\.\S+/.test(i.email)||(h.email="Format d'email invalide"):h.email="L'email est requis",i.phone.trim()?/^\+?[\d\s-()]+$/.test(i.phone)||(h.phone="Format de téléphone invalide"):h.phone="Le téléphone est requis",i.address.trim()||(h.address="L'adresse est requise"),l(h),Object.keys(h).length===0},m=h=>{h.preventDefault(),u()&&e(i)};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Modifier le client":"Ajouter un client"}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:m,className:"p-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations personnelles"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(fe,{label:"Nom complet *",value:i.name,onChange:h=>d("name",h.target.value),error:o.name,leftIcon:r.jsx(Ke,{className:"w-4 h-4"}),placeholder:"Ex: Rakoto Jean"})}),r.jsx(fe,{label:"Adresse email *",type:"email",value:i.email,onChange:h=>d("email",h.target.value),error:o.email,leftIcon:r.jsx(It,{className:"w-4 h-4"}),placeholder:"Ex: rakoto@email.mg"}),r.jsx(fe,{label:"Téléphone *",type:"tel",value:i.phone,onChange:h=>d("phone",h.target.value),error:o.phone,leftIcon:r.jsx(Gd,{className:"w-4 h-4"}),placeholder:"Ex: +261 34 12 345 67"}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adresse complète *"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(Bd,{className:"w-4 h-4 text-gray-400"})}),r.jsx("textarea",{value:i.address,onChange:h=>d("address",h.target.value),rows:3,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${o.address?"border-red-300":"border-gray-300"}`,placeholder:"Ex: Lot 123, Quartier ABC, Antananarivo, Madagascar"})]}),o.address&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.address})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Statut"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:i.isActive,onChange:h=>d("isActive",h.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Client actif"})]}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Les clients inactifs n'apparaîtront pas dans les recherches par défaut"})]}),t&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations fidélité"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[r.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Points fidélité"}),r.jsx("div",{className:"text-2xl font-bold text-purple-900",children:t.loyaltyPoints})]}),r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[r.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Total dépensé"}),r.jsx("div",{className:"text-2xl font-bold text-green-900",children:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(t.totalSpent).replace("MGA","Ar")})]}),r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[r.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Dernier achat"}),r.jsx("div",{className:"text-lg font-bold text-blue-900",children:t.lastPurchase?new Date(t.lastPurchase).toLocaleDateString("fr-FR"):"Jamais"})]})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:s,disabled:n,children:"Annuler"}),r.jsx(O,{type:"submit",disabled:n,children:n?"Enregistrement...":t?"Modifier":"Ajouter"})]})]})]})})},X6=({customers:t,onEdit:e,onDelete:s,onView:n,isLoading:i=!1,userRole:a})=>{const o=m=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(m).replace("MGA","Ar"),l=m=>m?new Date(m).toLocaleDateString("fr-FR"):"Jamais",d=m=>m>=200?{tier:"VIP",color:"purple"}:m>=100?{tier:"Gold",color:"yellow"}:m>=50?{tier:"Silver",color:"gray"}:{tier:"Bronze",color:"orange"},u=a==="reader";return i?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((m,h)=>r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),r.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),r.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},h))})}):t.length===0?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun client trouvé"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"Commencez par ajouter votre premier client"}),!u&&r.jsxs(O,{children:[r.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Ajouter un client"]})]})}):r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fidélité"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Achats"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(m=>{const h=d(m.loyaltyPoints);return r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:r.jsx(Ke,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.name}),r.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[r.jsx(Bd,{className:"w-3 h-3 mr-1"}),m.address]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"flex items-center text-gray-900 mb-1",children:[r.jsx(It,{className:"w-3 h-3 mr-1"}),m.email]}),r.jsxs("div",{className:"flex items-center text-gray-500",children:[r.jsx(Gd,{className:"w-3 h-3 mr-1"}),m.phone]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"flex items-center mb-1",children:[r.jsx(fl,{className:`w-4 h-4 mr-1 text-${h.color}-500`}),r.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full bg-${h.color}-100 text-${h.color}-800`,children:h.tier})]}),r.jsxs("div",{className:"text-gray-600",children:[m.loyaltyPoints," points"]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-gray-900",children:o(m.totalSpent)}),r.jsxs("div",{className:"text-gray-500",children:["Dernier: ",l(m.lastPurchase)]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${m.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:m.isActive?"Actif":"Inactif"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(m),title:"Voir les détails",children:r.jsx(As,{className:"w-4 h-4"})}),!u&&r.jsxs(r.Fragment,{children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(m),title:"Modifier",children:r.jsx(wr,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(m.id),title:"Supprimer",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(ms,{className:"w-4 h-4"})})]})]})})]},m.id)})})]})})})},J6=[{id:"all",name:"Tous les clients"},{id:"active",name:"Clients actifs"},{id:"inactive",name:"Clients inactifs"},{id:"vip",name:"Clients VIP (200+ points)"}],Z6=({searchTerm:t,onSearchChange:e,selectedStatus:s,onStatusChange:n,onExport:i,stats:a})=>{const o=l=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l).replace("MGA","Ar");return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ke,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total clients"}),r.jsx("p",{className:"text-2xl font-bold text-blue-900",children:a.total})]})]})}),r.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ke,{className:"w-8 h-8 text-green-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-green-600",children:"Clients actifs"}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:a.active})]})]})}),r.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(fl,{className:"w-8 h-8 text-purple-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Clients VIP"}),r.jsx("p",{className:"text-2xl font-bold text-purple-900",children:a.vip})]})]})}),r.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(or,{className:"w-8 h-8 text-orange-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-orange-600",children:"CA total"}),r.jsx("p",{className:"text-2xl font-bold text-orange-900",children:o(a.totalSpent)})]})]})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(fe,{placeholder:"Rechercher par nom, email ou téléphone...",value:t,onChange:l=>e(l.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})})}),r.jsx("select",{value:s,onChange:l=>n(l.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:J6.map(l=>r.jsx("option",{value:l.id,children:l.name},l.id))})]}),r.jsxs("div",{className:"flex justify-between items-center mt-4",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>n("vip"),className:s==="vip"?"bg-purple-100 text-purple-700":"",children:[r.jsx(fl,{className:"w-4 h-4 mr-1"}),"Clients VIP (",a.vip,")"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>n("active"),className:s==="active"?"bg-green-100 text-green-700":"",children:[r.jsx(Ke,{className:"w-4 h-4 mr-1"}),"Actifs (",a.active,")"]})]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:i,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]})]})},eD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(""),[i,a]=A.useState("all"),[o,l]=A.useState(!1),[d,u]=A.useState(null),[m,h]=A.useState(!1),[f,x]=A.useState(!0),{user:y}=Le(),P=(y==null?void 0:y.role)==="reader",_=async()=>{if(y!=null&&y.establishmentId)try{x(!0);const N=Ne(je(H,"customers"),oe("establishmentId","==",y.establishmentId)),w=(await _e(N)).docs.map(I=>{const E=I.data();return{id:I.id,name:E.name,email:E.email||"",phone:E.phone||"",address:E.address||"",loyaltyPoints:E.loyaltyPoints||0,totalSpent:E.totalSpent||0,lastPurchase:E.lastPurchase?E.lastPurchase.toDate().toISOString():null,createdAt:E.createdAt?E.createdAt.toDate().toISOString():new Date().toISOString(),isActive:E.isActive!==!1,establishmentId:E.establishmentId}});e(w)}catch(N){console.error("Erreur lors du chargement des clients:",N),L.error("Erreur lors du chargement des clients")}finally{x(!1)}};A.useEffect(()=>{_()},[y==null?void 0:y.establishmentId]);const C=A.useMemo(()=>t.filter(N=>{const g=N.name.toLowerCase().includes(s.toLowerCase())||N.email.toLowerCase().includes(s.toLowerCase())||N.phone.includes(s);let w=!0;switch(i){case"active":w=N.isActive;break;case"inactive":w=!N.isActive;break;case"vip":w=N.loyaltyPoints>=200;break;default:w=!0}return g&&w}),[t,s,i]),k=A.useMemo(()=>({total:t.length,active:t.filter(N=>N.isActive).length,vip:t.filter(N=>N.loyaltyPoints>=200).length,totalSpent:t.reduce((N,g)=>N+g.totalSpent,0)}),[t]),T=()=>{if(P){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des clients");return}u(null),l(!0)},S=N=>{if(P){L.error("Vous n'avez pas les permissions nécessaires pour modifier des clients");return}u(N),l(!0)},D=async N=>{if(P){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des clients");return}if(window.confirm("Êtes-vous sûr de vouloir supprimer ce client ?"))try{await Ds(me(H,"customers",N)),e(g=>g.filter(w=>w.id!==N)),L.success("Client supprimé avec succès")}catch(g){console.error("Erreur lors de la suppression du client:",g),L.error("Erreur lors de la suppression du client")}},R=N=>{L.success(`Affichage des détails de ${N.name}`)},v=async N=>{if(P){L.error("Vous n'avez pas les permissions nécessaires pour cette action");return}if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}h(!0);try{if(d)await pt(me(H,"customers",d.id),{...N,updatedAt:J.now()}),e(g=>g.map(w=>w.id===d.id?{...w,...N,updatedAt:new Date().toISOString()}:w)),L.success("Client modifié avec succès");else{const g=`customer_${Date.now()}`,w={...N,id:g,loyaltyPoints:0,totalSpent:0,lastPurchase:null,establishmentId:y.establishmentId,createdAt:J.now(),updatedAt:J.now()};await Ze(me(H,"customers",g),w),e(I=>[...I,{...w,id:g,lastPurchase:null,createdAt:new Date().toISOString(),isActive:N.isActive}]),L.success("Client ajouté avec succès")}l(!1),u(null)}catch(g){console.error("Erreur lors de l'enregistrement du client:",g),L.error("Erreur lors de l'enregistrement")}finally{h(!1)}},b=()=>{const N=[["Nom","Email","Téléphone","Adresse","Points fidélité","Total dépensé","Statut"],...C.map(E=>[E.name,E.email,E.phone,E.address,E.loyaltyPoints,E.totalSpent,E.isActive?"Actif":"Inactif"])].map(E=>E.join(",")).join(`
`),g=new Blob([N],{type:"text/csv"}),w=window.URL.createObjectURL(g),I=document.createElement("a");I.href=w,I.download=`clients_${new Date().toISOString().split("T")[0]}.csv`,I.click(),window.URL.revokeObjectURL(w),L.success("Export réalisé avec succès")};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion des Clients"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez votre base clients et programme de fidélité"})]}),!P&&r.jsxs(O,{onClick:T,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Ajouter un client"]})]}),P&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les clients mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),r.jsx(Z6,{searchTerm:s,onSearchChange:n,selectedStatus:i,onStatusChange:a,onExport:b,stats:k}),f?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des clients..."})]}):r.jsx(X6,{customers:C,onEdit:S,onDelete:D,onView:R,isLoading:!1,userRole:(y==null?void 0:y.role)||""}),o&&r.jsx(Y6,{customer:d,onSubmit:v,onCancel:()=>{l(!1),u(null)},isLoading:m})]})},tD=[{id:"all",name:"Tous les statuts"},{id:"completed",name:"Terminées"},{id:"refunded",name:"Remboursées"}],sD=[{id:"all",name:"Tous les paiements"},{id:"cash",name:"Espèces"},{id:"card",name:"Carte"},{id:"mvola",name:"Mvola"},{id:"orange_money",name:"Orange Money"},{id:"airtel_money",name:"Airtel Money"}],rD=({searchTerm:t,onSearchChange:e,selectedStatus:s,onStatusChange:n,selectedPaymentMethod:i,onPaymentMethodChange:a,dateRange:o,onDateRangeChange:l,stats:d})=>{const u=x=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x).replace("MGA","Ar"),m=()=>{const x=new Date().toISOString().split("T")[0];l({start:x,end:x})},h=()=>{const x=new Date,y=new Date(x.getTime()-7*24*60*60*1e3);l({start:y.toISOString().split("T")[0],end:x.toISOString().split("T")[0]})},f=()=>{const x=new Date,y=new Date(x.getFullYear(),x.getMonth()-1,x.getDate());l({start:y.toISOString().split("T")[0],end:x.toISOString().split("T")[0]})};return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[r.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(ds,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total ventes"}),r.jsx("p",{className:"text-2xl font-bold text-blue-900",children:d.total})]})]})}),r.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(or,{className:"w-8 h-8 text-green-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-green-600",children:"Aujourd'hui"}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:d.today})]})]})}),r.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(or,{className:"w-8 h-8 text-purple-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-purple-600",children:"CA du jour"}),r.jsx("p",{className:"text-xl font-bold text-purple-900",children:u(d.todayRevenue)})]})]})}),r.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(ds,{className:"w-8 h-8 text-orange-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Terminées"}),r.jsx("p",{className:"text-2xl font-bold text-orange-900",children:d.completed})]})]})}),r.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(pg,{className:"w-8 h-8 text-red-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-red-600",children:"Remboursées"}),r.jsx("p",{className:"text-2xl font-bold text-red-900",children:d.refunded})]})]})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[r.jsx(fe,{placeholder:"Rechercher par reçu, client ou caissier...",value:t,onChange:x=>e(x.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})}),r.jsx("select",{value:s,onChange:x=>n(x.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:tD.map(x=>r.jsx("option",{value:x.id,children:x.name},x.id))}),r.jsx("select",{value:i,onChange:x=>a(x.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:sD.map(x=>r.jsx("option",{value:x.id,children:x.name},x.id))}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"date",value:o.start,onChange:x=>l({...o,start:x.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),r.jsx("input",{type:"date",value:o.end,onChange:x=>l({...o,end:x.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(O,{variant:"ghost",size:"sm",onClick:m,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"Aujourd'hui"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:h,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"7 derniers jours"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:f,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"30 derniers jours"]})]}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>{l({start:"",end:""}),n("all"),a("all"),e("")},children:"Réinitialiser filtres"})]})]})]})},nD=({sales:t,onView:e,onPrint:s,onRefund:n,isLoading:i=!1})=>{const a=u=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(u).replace("MGA","Ar"),o=u=>new Date(u).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=u=>{switch(u){case"cash":return Va;case"card":return Hs;case"mvola":case"orange_money":case"airtel_money":return rr;default:return Hs}},d=u=>({cash:"Espèces",card:"Carte",mvola:"Mvola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[u]||u;return i?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((u,m)=>r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),r.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),r.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},m))})}):t.length===0?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx(ds,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune vente trouvée"}),r.jsx("p",{className:"text-gray-500",children:"Aucune vente ne correspond à vos critères de recherche"})]})}):r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vente"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client & Caissier"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paiement"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(u=>{const m=l(u.paymentMethod);return r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:r.jsx(ds,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.receiptNumber}),r.jsx("div",{className:"text-sm text-gray-500",children:o(u.date)})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-gray-900",children:u.customerName}),r.jsxs("div",{className:"text-gray-500",children:["par ",u.cashierName]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"font-medium text-gray-900",children:[u.items.reduce((h,f)=>h+f.quantity,0)," articles"]}),r.jsxs("div",{className:"text-gray-500 text-xs",children:[u.items.slice(0,2).map(h=>h.name).join(", "),u.items.length>2&&"..."]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center text-sm",children:[r.jsx(m,{className:"w-4 h-4 mr-2 text-gray-400"}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:d(u.paymentMethod)}),u.changeAmount>0&&r.jsxs("div",{className:"text-gray-500 text-xs",children:["Rendu: ",a(u.changeAmount)]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-bold text-gray-900",children:a(u.total)}),r.jsxs("div",{className:"text-gray-500 text-xs",children:["HT: ",a(u.subtotal)]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${u.status==="completed"?"bg-green-100 text-green-800":u.status==="refunded"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:u.status==="completed"?"Terminée":u.status==="refunded"?"Remboursée":u.status})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(u),title:"Voir les détails",children:r.jsx(As,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(u),title:"Imprimer le reçu",children:r.jsx(Oa,{className:"w-4 h-4"})}),u.status==="completed"&&r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(u.id),title:"Rembourser",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(pg,{className:"w-4 h-4"})})]})})]},u.id)})})]})})})},iD=({sale:t,onClose:e,onPrint:s,onRefund:n})=>{const i=l=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(l).replace("MGA","Ar"),a=l=>new Date(l).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),o=l=>({cash:"Espèces",card:"Carte bancaire",mvola:"Mvola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[l]||l;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[r.jsx(ds,{className:"w-6 h-6 mr-2"}),"Détails de la vente"]}),r.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(ds,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Numéro de reçu"}),r.jsx("p",{className:"font-semibold text-gray-900",children:t.receiptNumber})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(ut,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Date et heure"}),r.jsx("p",{className:"font-semibold text-gray-900",children:a(t.date)})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(St,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Client"}),r.jsx("p",{className:"font-semibold text-gray-900",children:t.customerName})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(St,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Caissier"}),r.jsx("p",{className:"font-semibold text-gray-900",children:t.cashierName})]})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Articles vendus"}),r.jsx("div",{className:"bg-gray-50 rounded-lg overflow-hidden",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Article"}),r.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Qté"}),r.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Prix unit."}),r.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:t.items.map((l,d)=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:l.name}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 text-center",children:l.quantity}),r.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 text-right",children:i(l.unitPrice)}),r.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right",children:i(l.total)})]},d))})]})})]}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Sous-total (HT):"}),r.jsx("span",{className:"font-medium",children:i(t.subtotal)})]}),r.jsxs("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"TVA (20%):"}),r.jsx("span",{className:"font-medium",children:i(t.taxAmount)})]}),r.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[r.jsx("span",{children:"Total TTC:"}),r.jsx("span",{className:"text-blue-600",children:i(t.total)})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Hs,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Méthode de paiement"}),r.jsx("p",{className:"font-semibold text-gray-900",children:o(t.paymentMethod)})]})]}),t.paymentMethod==="cash"&&t.changeAmount>0&&r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Montant reçu"}),r.jsx("p",{className:"font-semibold text-gray-900",children:i(t.paymentAmount)}),r.jsxs("p",{className:"text-sm text-green-600",children:["Rendu: ",i(t.changeAmount)]})]})]}),r.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Statut de la vente"}),r.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="refunded"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status==="completed"?"Terminée":t.status==="refunded"?"Remboursée":t.status})]})})]}),r.jsxs("div",{className:"flex justify-between gap-3 p-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:e,children:"Fermer"}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(O,{variant:"ghost",onClick:s,children:[r.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Imprimer"]}),t.status==="completed"&&r.jsxs(O,{variant:"danger",onClick:n,children:[r.jsx(pg,{className:"w-4 h-4 mr-2"}),"Rembourser"]})]})]})]})})},aD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(""),[i,a]=A.useState("all"),[o,l]=A.useState("all"),[d,u]=A.useState({start:"",end:""}),[m,h]=A.useState(null),[f,x]=A.useState(!1),[y,P]=A.useState(!0),{user:_}=Le(),C=async()=>{if(_!=null&&_.establishmentId)try{P(!0);const b=Ne(je(H,"sales"),oe("establishmentId","==",_.establishmentId),wi("createdAt","desc")),g=(await _e(b)).docs.map(w=>{var E,ee;const I=w.data();return{id:w.id,receiptNumber:I.receiptNumber,date:((ee=(E=I.createdAt)==null?void 0:E.toDate())==null?void 0:ee.toISOString())||new Date().toISOString(),cashierName:I.cashierName,customerName:I.customerName||"Client anonyme",items:I.items.map(V=>({name:V.productName,quantity:V.quantity,unitPrice:V.unitPrice,total:V.total})),subtotal:I.subtotal,taxAmount:I.taxAmount,total:I.total,paymentMethod:I.paymentMethod,paymentAmount:I.paymentAmount,changeAmount:I.changeAmount,status:I.status}});e(g)}catch(b){console.error("Erreur lors du chargement des ventes:",b),L.error("Erreur lors du chargement des ventes")}finally{P(!1)}};A.useEffect(()=>{C()},[_==null?void 0:_.establishmentId]);const k=A.useMemo(()=>t.filter(b=>{const N=b.receiptNumber.toLowerCase().includes(s.toLowerCase())||b.customerName.toLowerCase().includes(s.toLowerCase())||b.cashierName.toLowerCase().includes(s.toLowerCase()),g=i==="all"||b.status===i,w=o==="all"||b.paymentMethod===o;let I=!0;if(d.start&&d.end){const E=new Date(b.date).toISOString().split("T")[0];I=E>=d.start&&E<=d.end}return N&&g&&w&&I}),[t,s,i,o,d]),T=A.useMemo(()=>{const b=new Date().toISOString().split("T")[0],N=t.filter(g=>g.date.startsWith(b)&&g.status==="completed");return{total:t.length,today:N.length,todayRevenue:N.reduce((g,w)=>g+w.total,0),completed:t.filter(g=>g.status==="completed").length,refunded:t.filter(g=>g.status==="refunded").length}},[t]),S=b=>{h(b),x(!0)},D=b=>{L.success(`Impression du reçu ${b.receiptNumber}`)},R=async b=>{if(window.confirm("Êtes-vous sûr de vouloir rembourser cette vente ?"))try{await pt(me(H,"sales",b),{status:"refunded",updatedAt:J.now()}),await C(),L.success("Vente remboursée avec succès")}catch(N){console.error("Erreur lors du remboursement:",N),L.error("Erreur lors du remboursement")}},v=()=>{const b=[["N° Reçu","Date","Client","Caissier","Total","Paiement","Statut"],...k.map(I=>[I.receiptNumber,new Date(I.date).toLocaleDateString("fr-FR"),I.customerName,I.cashierName,I.total,I.paymentMethod,I.status])].map(I=>I.join(",")).join(`
`),N=new Blob([b],{type:"text/csv"}),g=window.URL.createObjectURL(N),w=document.createElement("a");w.href=g,w.download=`ventes_${new Date().toISOString().split("T")[0]}.csv`,w.click(),window.URL.revokeObjectURL(g),L.success("Export réalisé avec succès")};return y?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des ventes..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Historique des Ventes"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Consultez et gérez toutes vos transactions"})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(O,{variant:"ghost",onClick:v,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]}),r.jsxs(O,{children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Rapport détaillé"]})]})]}),r.jsx(rD,{searchTerm:s,onSearchChange:n,selectedStatus:i,onStatusChange:a,selectedPaymentMethod:o,onPaymentMethodChange:l,dateRange:d,onDateRangeChange:u,stats:T}),r.jsx(nD,{sales:k,onView:S,onPrint:D,onRefund:R,isLoading:!1}),f&&m&&r.jsx(iD,{sale:m,onClose:()=>{x(!1),h(null)},onPrint:()=>D(m),onRefund:()=>{R(m.id),x(!1),h(null)}})]})},oD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(""),[i,a]=A.useState("all"),[o,l]=A.useState({start:"",end:""}),[d,u]=A.useState(null),[m,h]=A.useState(!1),[f,x]=A.useState(!0),[y,P]=A.useState(null),{user:_}=Le(),C=async()=>{if(_!=null&&_.establishmentId)try{const V=await hs(me(H,"establishments",_.establishmentId));if(V.exists()){const F=V.data();P({name:F.name||"Nirina Nirina Pos Madagascar",address:F.address||"Antananarivo, Madagascar",phone:F.phone||"+261 34 12 345 67",email:F.email||"contact@saaspos.mg",nif:F.nif||"",stat:F.stat||""})}}catch(V){console.error("Erreur lors du chargement des informations établissement:",V)}},k=async()=>{if(_!=null&&_.establishmentId)try{x(!0);const V=Ne(je(H,"sales"),oe("establishmentId","==",_.establishmentId),oe("status","==","completed"),wi("createdAt","desc")),F=await _e(V),X=Ne(je(H,"stores"),oe("establishmentId","==",_.establishmentId)),W=await _e(X),re=new Map;W.docs.forEach(se=>{const Y=se.data();re.set(se.id,Y.name)});const Z=F.docs.map(se=>{var U;const Y=se.data();return{id:se.id,receiptNumber:Y.receiptNumber,date:((U=Y.createdAt)==null?void 0:U.toDate())||new Date,cashierName:Y.cashierName,customerName:Y.customerName||"Client anonyme",items:Y.items.map(K=>({name:K.productName,quantity:K.quantity,unitPrice:K.unitPrice,total:K.total})),subtotal:Y.subtotal,taxAmount:Y.taxAmount,total:Y.total,paymentMethod:Y.paymentMethod,paymentAmount:Y.paymentAmount,changeAmount:Y.changeAmount,status:Y.status,storeId:Y.storeId,storeName:Y.storeId?re.get(Y.storeId)||"Magasin inconnu":"Non spécifié"}});e(Z)}catch(V){console.error("Erreur lors du chargement des reçus:",V),L.error("Erreur lors du chargement des reçus")}finally{x(!1)}};A.useEffect(()=>{C(),k()},[_==null?void 0:_.establishmentId]);const T=t.filter(V=>{const F=V.receiptNumber.toLowerCase().includes(s.toLowerCase())||V.customerName.toLowerCase().includes(s.toLowerCase())||V.cashierName.toLowerCase().includes(s.toLowerCase()),X=i==="all"||V.paymentMethod===i;let W=!0;if(o.start&&o.end){const re=V.date.toISOString().split("T")[0];W=re>=o.start&&re<=o.end}return F&&X&&W}),S=V=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(V).replace("MGA","Ar"),D=V=>V.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),R=V=>{switch(V){case"cash":return Va;case"card":return Hs;case"mvola":case"orange_money":case"airtel_money":return rr;default:return Hs}},v=V=>({cash:"Espèces",card:"Carte",mvola:"Mvola",orange_money:"Orange Money",airtel_money:"Airtel Money"})[V]||V,b=V=>{const F={receiptNumber:V.receiptNumber,date:V.date,cashierName:V.cashierName,customerName:V.customerName,items:V.items,subtotal:V.subtotal,taxAmount:V.taxAmount,total:V.total,paymentMethod:V.paymentMethod,paymentAmount:V.paymentAmount,changeAmount:V.changeAmount,amountInWords:I1(V.total),establishmentInfo:y||{name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"",stat:""}};u(F),h(!0)},N=V=>{const F=window.open("","_blank");F&&(F.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Reçu ${V.receiptNumber}</title>
          <style>
            body { font-family: 'Courier New', monospace; max-width: 300px; margin: 0; padding: 10px; }
            .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
            .company-name { font-size: 16px; font-weight: bold; margin-bottom: 5px; }
            .company-info { font-size: 10px; line-height: 1.4; }
            .receipt-info { margin: 10px 0; font-size: 10px; }
            .items { margin: 10px 0; }
            .item { display: flex; justify-content: space-between; font-size: 10px; margin: 2px 0; }
            .totals { border-top: 2px solid #000; padding-top: 10px; margin-top: 15px; font-size: 10px; }
            .total-line { display: flex; justify-content: space-between; margin: 2px 0; }
            .grand-total { font-weight: bold; font-size: 12px; border-top: 1px solid #000; padding-top: 5px; margin-top: 5px; }
            .footer { text-align: center; margin-top: 15px; border-top: 2px solid #000; padding-top: 10px; font-size: 10px; }
            @media print { body { margin: 0; padding: 5px; } }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="company-name">${(y==null?void 0:y.name)||"Nirina Nirina Pos Madagascar"}</div>
            <div class="company-info">
              ${(y==null?void 0:y.address)||"Antananarivo, Madagascar"}<br>
              Tél: ${(y==null?void 0:y.phone)||"+261 34 12 345 67"}<br>
              Email: ${(y==null?void 0:y.email)||"contact@saaspos.mg"}
            </div>
          </div>
          
          <div class="receipt-info">
            <div><strong>Reçu N°:</strong> ${V.receiptNumber}</div>
            <div><strong>Date:</strong> ${D(V.date)}</div>
            <div><strong>Caissier:</strong> ${V.cashierName}</div>
            <div><strong>Client:</strong> ${V.customerName}</div>
          </div>
          
          <div class="items">
            ${V.items.map(X=>`
              <div class="item">
                <span>${X.name} x${X.quantity}</span>
                <span>${S(X.total)}</span>
              </div>
            `).join("")}
          </div>
          
          <div class="totals">
            <div class="total-line">
              <span>Sous-total:</span>
              <span>${S(V.subtotal)}</span>
            </div>
            <div class="total-line">
              <span>TVA:</span>
              <span>${S(V.taxAmount)}</span>
            </div>
            <div class="total-line grand-total">
              <span>TOTAL:</span>
              <span>${S(V.total)}</span>
            </div>
            <div class="total-line">
              <span>Payé (${v(V.paymentMethod)}):</span>
              <span>${S(V.paymentAmount)}</span>
            </div>
            ${V.changeAmount>0?`
              <div class="total-line">
                <span>Rendu:</span>
                <span>${S(V.changeAmount)}</span>
              </div>
            `:""}
            
            <div class="amount-in-words" style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #000; font-style: italic; font-size: 10px;">
              ${Hd(V.total)}
            </div>
          </div>
          
          <div class="footer">
            Merci de votre visite !
          </div>
        </body>
        </html>
      `),F.document.close(),F.print())},g=V=>{L.success(`Reçu envoyé à ${V}`,{duration:4e3,icon:"📧"})},w=()=>{const V=[["N° Reçu","Date","Caissier","Client","Magasin","Total","Paiement","Statut"],...T.map(re=>[re.receiptNumber,D(re.date),re.cashierName,re.customerName,re.storeName||"Non spécifié",re.total,v(re.paymentMethod),re.status])].map(re=>re.join(",")).join(`
`),F=new Blob([V],{type:"text/csv"}),X=window.URL.createObjectURL(F),W=document.createElement("a");W.href=X,W.download=`reçus_${new Date().toISOString().split("T")[0]}.csv`,W.click(),window.URL.revokeObjectURL(X),L.success("Liste des reçus exportée avec succès")},I=()=>{const V=new Date().toISOString().split("T")[0];l({start:V,end:V})},E=()=>{const V=new Date,F=new Date(V.getTime()-7*24*60*60*1e3);l({start:F.toISOString().split("T")[0],end:V.toISOString().split("T")[0]})},ee=()=>{const V=new Date,F=new Date(V.getFullYear(),V.getMonth()-1,V.getDate());l({start:F.toISOString().split("T")[0],end:V.toISOString().split("T")[0]})};return f?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des reçus..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[r.jsx(ds,{className:"w-8 h-8 mr-3 text-blue-600"}),"Historique des Reçus"]}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Consultez et gérez tous les reçus générés"})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(O,{variant:"ghost",onClick:()=>k(),children:[r.jsx(qs,{className:"w-4 h-4 mr-2"}),"Actualiser"]}),r.jsxs(O,{variant:"ghost",onClick:w,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:r.jsx(ds,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total reçus"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.length})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:r.jsx(kt,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"CA total"}),r.jsx("p",{className:"text-xl font-bold text-gray-900",children:S(t.reduce((V,F)=>V+F.total,0))})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:r.jsx(ut,{className:"w-6 h-6 text-purple-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aujourd'hui"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.filter(V=>{const F=new Date().toISOString().split("T")[0];return V.date.toISOString().split("T")[0]===F}).length})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-orange-100 rounded-lg",children:r.jsx(St,{className:"w-6 h-6 text-orange-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ticket moyen"}),r.jsx("p",{className:"text-xl font-bold text-gray-900",children:t.length>0?S(t.reduce((V,F)=>V+F.total,0)/t.length):S(0)})]})]})})]}),r.jsxs(G,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[r.jsx(fe,{placeholder:"Rechercher par n° reçu, client ou caissier...",value:s,onChange:V=>n(V.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})}),r.jsxs("select",{value:i,onChange:V=>a(V.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Tous les paiements"}),r.jsx("option",{value:"cash",children:"Espèces"}),r.jsx("option",{value:"card",children:"Carte"}),r.jsx("option",{value:"mvola",children:"Mvola"}),r.jsx("option",{value:"orange_money",children:"Orange Money"}),r.jsx("option",{value:"airtel_money",children:"Airtel Money"})]}),r.jsx("input",{type:"date",value:o.start,onChange:V=>l({...o,start:V.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Date de début"}),r.jsx("input",{type:"date",value:o.end,onChange:V=>l({...o,end:V.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Date de fin"})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(O,{variant:"ghost",size:"sm",onClick:I,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"Aujourd'hui"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:E,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"7 derniers jours"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:ee,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"30 derniers jours"]})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:[T.length," reçu(s) trouvé(s)"]})]})]}),T.length===0?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx(ds,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun reçu trouvé"}),r.jsx("p",{className:"text-gray-500",children:s||o.start||i!=="all"?"Aucun reçu ne correspond à vos critères de recherche":"Aucun reçu n'a encore été généré"})]})}):r.jsx(G,{children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reçu"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client & Caissier"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Magasin"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Articles"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paiement"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(V=>{const F=R(V.paymentMethod);return r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:r.jsx(ds,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:V.receiptNumber}),r.jsx("div",{className:"text-sm text-gray-500",children:D(V.date)})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-gray-900",children:V.customerName}),r.jsxs("div",{className:"text-gray-500",children:["par ",V.cashierName]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm",children:r.jsx("div",{className:"font-medium text-gray-900",children:V.storeName})})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"font-medium text-gray-900",children:[V.items.reduce((X,W)=>X+W.quantity,0)," articles"]}),r.jsxs("div",{className:"text-gray-500 text-xs",children:[V.items.slice(0,2).map(X=>X.name).join(", "),V.items.length>2&&"..."]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center text-sm",children:[r.jsx(F,{className:"w-4 h-4 mr-2 text-gray-400"}),r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-gray-900",children:v(V.paymentMethod)}),V.changeAmount>0&&r.jsxs("div",{className:"text-gray-500 text-xs",children:["Rendu: ",S(V.changeAmount)]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-bold text-gray-900",children:S(V.total)}),r.jsxs("div",{className:"text-gray-500 text-xs",children:["HT: ",S(V.subtotal)]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>b(V),title:"Voir le reçu",children:r.jsx(As,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>N(V),title:"Imprimer le reçu",children:r.jsx(Oa,{className:"w-4 h-4"})})]})})]},V.id)})})]})})}),m&&d&&r.jsx(V1,{receiptData:d,onClose:()=>{h(!1),u(null)},onPrint:()=>{N(d)},onEmailSend:g})]})},lD=()=>r.jsx("div",{className:"h-full",children:r.jsx(oD,{})}),cD=[{id:"all",name:"Tous les statuts"},{id:"paid",name:"Payées"},{id:"pending",name:"En attente"},{id:"cancelled",name:"Annulées"}],dD=[{id:"all",name:"Tous les paiements"},{id:"cash",name:"Espèces"},{id:"card",name:"Carte"},{id:"bank_transfer",name:"Virement bancaire"},{id:"check",name:"Chèque"}],uD=({searchTerm:t,onSearchChange:e,selectedCategory:s,onCategoryChange:n,selectedStatus:i,onStatusChange:a,selectedPaymentMethod:o,onPaymentMethodChange:l,dateRange:d,onDateRangeChange:u,onExport:m,stats:h})=>{const[f,x]=A.useState([]),{user:y}=Le();A.useEffect(()=>{(async()=>{if(y!=null&&y.establishmentId)try{const S=Ne(je(H,"expense_categories"),oe("establishmentId","==",y.establishmentId)),R=(await _e(S)).docs.map(v=>{const b=v.data();return{id:v.id,name:b.name}});x(R)}catch(S){console.error("Erreur lors du chargement des catégories:",S)}})()},[y==null?void 0:y.establishmentId]);const P=T=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(T).replace("MGA","Ar"),_=()=>{const T=new Date().toISOString().split("T")[0];u({start:T,end:T})},C=()=>{const T=new Date,S=new Date(T.getTime()-7*24*60*60*1e3);u({start:S.toISOString().split("T")[0],end:T.toISOString().split("T")[0]})},k=()=>{const T=new Date,S=new Date(T.getFullYear(),T.getMonth()-1,T.getDate());u({start:S.toISOString().split("T")[0],end:T.toISOString().split("T")[0]})};return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsx("div",{className:"bg-red-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(kt,{className:"w-8 h-8 text-red-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-red-600",children:"Total dépenses"}),r.jsx("p",{className:"text-2xl font-bold text-red-900",children:h.total})]})]})}),r.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(ut,{className:"w-8 h-8 text-orange-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Ce mois"}),r.jsx("p",{className:"text-xl font-bold text-orange-900",children:h.thisMonth}),r.jsx("p",{className:"text-xs text-orange-700",children:P(h.thisMonthAmount)})]})]})}),r.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(Oe,{className:"w-8 h-8 text-yellow-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"En attente"}),r.jsx("p",{className:"text-xl font-bold text-yellow-900",children:h.pending}),r.jsx("p",{className:"text-xs text-yellow-700",children:P(h.pendingAmount)})]})]})}),r.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(or,{className:"w-8 h-8 text-purple-600"}),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Moyenne/mois"}),r.jsx("p",{className:"text-xl font-bold text-purple-900",children:P(h.thisMonthAmount)})]})]})})]}),r.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4",children:[r.jsx(fe,{placeholder:"Rechercher par titre, fournisseur...",value:t,onChange:T=>e(T.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})}),r.jsxs("select",{value:s,onChange:T=>n(T.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Toutes les catégories"}),f.map(T=>r.jsx("option",{value:T.id,children:T.name},T.id))]}),r.jsx("select",{value:i,onChange:T=>a(T.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:cD.map(T=>r.jsx("option",{value:T.id,children:T.name},T.id))}),r.jsx("select",{value:o,onChange:T=>l(T.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:dD.map(T=>r.jsx("option",{value:T.id,children:T.name},T.id))}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"date",value:d.start,onChange:T=>u({...d,start:T.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),r.jsx("input",{type:"date",value:d.end,onChange:T=>u({...d,end:T.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(O,{variant:"ghost",size:"sm",onClick:_,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"Aujourd'hui"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:C,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"7 derniers jours"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:k,children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),"30 derniers jours"]})]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:m,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]})]})},mD=({expenses:t,onEdit:e,onDelete:s,onView:n,isLoading:i=!1,userRole:a})=>{const o=x=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(x).replace("MGA","Ar"),l=x=>x.toLocaleDateString("fr-FR"),d=x=>({cash:"Espèces",card:"Carte",bank_transfer:"Virement",check:"Chèque"})[x]||x,u=x=>{switch(x){case"paid":return r.jsx(Lt,{className:"w-4 h-4 text-green-600"});case"pending":return r.jsx(Es,{className:"w-4 h-4 text-yellow-600"});case"cancelled":return r.jsx(ua,{className:"w-4 h-4 text-red-600"});default:return r.jsx(Es,{className:"w-4 h-4 text-gray-600"})}},m=x=>({paid:"Payée",pending:"En attente",cancelled:"Annulée"})[x]||x,h=x=>{switch(x){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},f=a==="reader";return i?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8",children:r.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((x,y)=>r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),r.jsxs("div",{className:"flex-1 space-y-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/6"})]}),r.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"}),r.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded"})]},y))})}):t.length===0?r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx(kt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune dépense trouvée"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"Commencez par enregistrer votre première dépense"}),!f&&r.jsxs(O,{children:[r.jsx(kt,{className:"w-4 h-4 mr-2"}),"Ajouter une dépense"]})]})}):r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dépense"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Catégorie"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fournisseur"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(x=>r.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-4",children:r.jsx(kt,{className:"w-6 h-6 text-red-600"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[x.title,x.isRecurring&&r.jsx(hg,{className:"w-4 h-4 ml-2 text-blue-500",title:"Dépense récurrente"})]}),r.jsx("div",{className:"text-sm text-gray-500",children:x.description&&x.description.length>50?`${x.description.substring(0,50)}...`:x.description}),x.invoiceNumber&&r.jsxs("div",{className:"text-xs text-gray-400 flex items-center mt-1",children:[r.jsx(Xr,{className:"w-3 h-3 mr-1"}),x.invoiceNumber]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:x.categoryName})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-bold text-red-600 text-lg",children:o(x.amount)}),r.jsx("div",{className:"text-gray-500 text-xs",children:d(x.paymentMethod)})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm",children:x.supplier?r.jsxs("div",{className:"flex items-center",children:[r.jsx(St,{className:"w-4 h-4 mr-1 text-gray-400"}),r.jsx("span",{className:"font-medium text-gray-900",children:x.supplier})]}):r.jsx("span",{className:"text-gray-500",children:"-"})})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-gray-900",children:x.paidAt?l(x.paidAt):l(x.createdAt)}),r.jsxs("div",{className:"text-gray-500 text-xs",children:["par ",x.userName]}),x.isRecurring&&x.nextDueDate&&r.jsxs("div",{className:"text-xs text-blue-600 flex items-center mt-1",children:[r.jsx(ut,{className:"w-3 h-3 mr-1"}),"Prochaine: ",l(x.nextDueDate)]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[u(x.status),r.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${h(x.status)}`,children:m(x.status)})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>n(x),title:"Voir les détails",children:r.jsx(As,{className:"w-4 h-4"})}),!f&&r.jsxs(r.Fragment,{children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>e(x),title:"Modifier",children:r.jsx(wr,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>s(x.id),title:"Supprimer",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(ms,{className:"w-4 h-4"})})]})]})})]},x.id))})]})})})},hD=[{id:"cash",name:"Espèces"},{id:"card",name:"Carte bancaire"},{id:"bank_transfer",name:"Virement bancaire"},{id:"check",name:"Chèque"}],pD=[{id:"daily",name:"Quotidien"},{id:"weekly",name:"Hebdomadaire"},{id:"monthly",name:"Mensuel"},{id:"yearly",name:"Annuel"}],fD=({expense:t,onSubmit:e,onCancel:s,isLoading:n=!1})=>{const[i,a]=A.useState([]),[o,l]=A.useState(!0),{user:d}=Le(),[u,m]=A.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",amount:(t==null?void 0:t.amount)||"",categoryId:(t==null?void 0:t.categoryId)||"",paymentMethod:(t==null?void 0:t.paymentMethod)||"cash",supplier:(t==null?void 0:t.supplier)||"",invoiceNumber:(t==null?void 0:t.invoiceNumber)||"",isRecurring:(t==null?void 0:t.isRecurring)||!1,recurringFrequency:(t==null?void 0:t.recurringFrequency)||"monthly",nextDueDate:t!=null&&t.nextDueDate?t.nextDueDate.toISOString().split("T")[0]:"",status:(t==null?void 0:t.status)||"paid",paidAt:t!=null&&t.paidAt?t.paidAt.toISOString().split("T")[0]:new Date().toISOString().split("T")[0]}),[h,f]=A.useState({});A.useEffect(()=>{(async()=>{if(d!=null&&d.establishmentId)try{l(!0);const C=Ne(je(H,"expense_categories"),oe("establishmentId","==",d.establishmentId)),T=(await _e(C)).docs.map(S=>{const D=S.data();return{id:S.id,name:D.name,icon:D.icon,color:D.color}});a(T)}catch(C){console.error("Erreur lors du chargement des catégories:",C)}finally{l(!1)}})()},[d==null?void 0:d.establishmentId]);const x=(_,C)=>{m(k=>({...k,[_]:C})),h[_]&&f(k=>({...k,[_]:""}))},y=()=>{const _={};return u.title.trim()||(_.title="Le titre est requis"),(!u.amount||Number(u.amount)<=0)&&(_.amount="Le montant doit être supérieur à 0"),u.categoryId||(_.categoryId="La catégorie est requise"),u.paidAt||(_.paidAt="La date est requise"),u.isRecurring&&!u.nextDueDate&&(_.nextDueDate="La prochaine échéance est requise pour les dépenses récurrentes"),f(_),Object.keys(_).length===0},P=_=>{if(_.preventDefault(),y()){const C={...u,amount:Number(u.amount),paidAt:u.status==="paid"?new Date(u.paidAt):null,nextDueDate:u.isRecurring&&u.nextDueDate?new Date(u.nextDueDate):null};e(C)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:t?"Modifier la dépense":"Nouvelle dépense"}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:P,className:"p-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations générales"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(fe,{label:"Titre de la dépense *",value:u.title,onChange:_=>x("title",_.target.value),error:h.title,leftIcon:r.jsx(Xr,{className:"w-4 h-4"}),placeholder:"Ex: Loyer du magasin"})}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{value:u.description,onChange:_=>x("description",_.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description détaillée de la dépense..."})]}),r.jsx(fe,{label:"Montant (Ar) *",type:"number",value:u.amount,onChange:_=>x("amount",_.target.value),error:h.amount,leftIcon:r.jsx(kt,{className:"w-4 h-4"}),placeholder:"50000"}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Catégorie *"}),o?r.jsx("div",{className:"px-3 py-2 border border-gray-300 rounded-md bg-gray-50",children:"Chargement des catégories..."}):r.jsxs("select",{value:u.categoryId,onChange:_=>x("categoryId",_.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${h.categoryId?"border-red-300":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Sélectionner une catégorie"}),i.map(_=>r.jsxs("option",{value:_.id,children:[_.icon," ",_.name]},_.id))]}),h.categoryId&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:h.categoryId})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Détails du paiement"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Méthode de paiement"}),r.jsx("select",{value:u.paymentMethod,onChange:_=>x("paymentMethod",_.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:hD.map(_=>r.jsx("option",{value:_.id,children:_.name},_.id))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Statut"}),r.jsxs("select",{value:u.status,onChange:_=>x("status",_.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"paid",children:"Payée"}),r.jsx("option",{value:"pending",children:"En attente"}),r.jsx("option",{value:"cancelled",children:"Annulée"})]})]}),r.jsx(fe,{label:"Fournisseur",value:u.supplier,onChange:_=>x("supplier",_.target.value),leftIcon:r.jsx(St,{className:"w-4 h-4"}),placeholder:"Nom du fournisseur"}),r.jsx(fe,{label:"N° de facture",value:u.invoiceNumber,onChange:_=>x("invoiceNumber",_.target.value),leftIcon:r.jsx(Xr,{className:"w-4 h-4"}),placeholder:"FAC-2024-001"}),u.status==="paid"&&r.jsx(fe,{label:"Date de paiement *",type:"date",value:u.paidAt,onChange:_=>x("paidAt",_.target.value),error:h.paidAt,leftIcon:r.jsx(ut,{className:"w-4 h-4"})})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Récurrence"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isRecurring",checked:u.isRecurring,onChange:_=>x("isRecurring",_.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsxs("label",{htmlFor:"isRecurring",className:"ml-2 text-sm text-gray-700",children:[r.jsx(hg,{className:"w-4 h-4 inline mr-1"}),"Dépense récurrente"]})]}),u.isRecurring&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pl-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fréquence"}),r.jsx("select",{value:u.recurringFrequency,onChange:_=>x("recurringFrequency",_.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:pD.map(_=>r.jsx("option",{value:_.id,children:_.name},_.id))})]}),r.jsx(fe,{label:"Prochaine échéance *",type:"date",value:u.nextDueDate,onChange:_=>x("nextDueDate",_.target.value),error:h.nextDueDate,leftIcon:r.jsx(ut,{className:"w-4 h-4"})})]})]})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Justificatif"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx(Fu,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Téléchargez une photo de la facture ou du reçu"}),r.jsx(O,{variant:"ghost",size:"sm",children:"Choisir un fichier"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formats acceptés: JPG, PNG, PDF (max 5MB)"})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:s,disabled:n,children:"Annuler"}),r.jsx(O,{type:"submit",disabled:n||i.length===0,children:n?"Enregistrement...":t?"Modifier":"Ajouter"})]})]})]})})},pv=[{id:"red",name:"Rouge",class:"bg-red-500"},{id:"orange",name:"Orange",class:"bg-orange-500"},{id:"yellow",name:"Jaune",class:"bg-yellow-500"},{id:"green",name:"Vert",class:"bg-green-500"},{id:"blue",name:"Bleu",class:"bg-blue-500"},{id:"purple",name:"Violet",class:"bg-purple-500"},{id:"pink",name:"Rose",class:"bg-pink-500"},{id:"gray",name:"Gris",class:"bg-gray-500"}],gD=[{id:"🏠",name:"Maison",component:S1},{id:"🚗",name:"Transport",component:W5},{id:"⚡",name:"Électricité",component:gl},{id:"👥",name:"Personnel",component:Ke},{id:"💼",name:"Bureau",component:G5},{id:"🛒",name:"Achats",component:br},{id:"🔧",name:"Maintenance",component:i6},{id:"📶",name:"Internet",component:n6},{id:"☕",name:"Restauration",component:H5}],xD=({readOnly:t=!1})=>{const[e,s]=A.useState([]),[n,i]=A.useState(!0),[a,o]=A.useState(!1),[l,d]=A.useState(null),[u,m]=A.useState({name:"",description:"",color:"red",icon:"🏠"}),[h,f]=A.useState({}),{user:x}=Le(),y=async()=>{if(x!=null&&x.establishmentId)try{i(!0);const R=Ne(je(H,"expense_categories"),oe("establishmentId","==",x.establishmentId)),b=(await _e(R)).docs.map(N=>{var w;const g=N.data();return{id:N.id,name:g.name,description:g.description||"",color:g.color,icon:g.icon,isDefault:g.isDefault||!1,establishmentId:g.establishmentId,createdAt:((w=g.createdAt)==null?void 0:w.toDate())||new Date,expenseCount:0}});s(b)}catch(R){console.error("Erreur lors du chargement des catégories:",R),L.error("Erreur lors du chargement des catégories")}finally{i(!1)}},P=async()=>{if(!(x!=null&&x.establishmentId)||t){L.error("Vous n'avez pas les permissions nécessaires pour cette action");return}const R=[{name:"Loyer",description:"Loyer du local commercial",color:"red",icon:"🏠"},{name:"Électricité",description:"Factures d'électricité",color:"yellow",icon:"⚡"},{name:"Carburant",description:"Essence et transport",color:"blue",icon:"🚗"},{name:"Salaires",description:"Rémunération du personnel",color:"green",icon:"👥"},{name:"Fournitures",description:"Matériel et fournitures",color:"purple",icon:"🛒"},{name:"Maintenance",description:"Réparations et entretien",color:"orange",icon:"🔧"},{name:"Internet & Téléphone",description:"Frais de communication",color:"blue",icon:"📶"},{name:"Restauration",description:"Repas et collations",color:"pink",icon:"☕"}];try{for(const v of R){const b=`${x.establishmentId}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await Ze(me(H,"expense_categories",b),{...v,establishmentId:x.establishmentId,isDefault:!0,createdAt:J.now()})}await y(),L.success("Catégories par défaut créées")}catch(v){console.error("Erreur lors de la création des catégories par défaut:",v),L.error("Erreur lors de la création des catégories par défaut")}};A.useEffect(()=>{y()},[x==null?void 0:x.establishmentId]);const _=()=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des catégories");return}d(null),m({name:"",description:"",color:"red",icon:"🏠"}),f({}),o(!0)},C=R=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour modifier des catégories");return}d(R),m({name:R.name,description:R.description||"",color:R.color,icon:R.icon}),f({}),o(!0)},k=()=>{const R={};return u.name.trim()||(R.name="Le nom de la catégorie est requis"),e.find(b=>b.name.toLowerCase()===u.name.toLowerCase()&&b.id!==(l==null?void 0:l.id))&&(R.name="Une catégorie avec ce nom existe déjà"),f(R),Object.keys(R).length===0},T=async R=>{if(R.preventDefault(),!(!k()||!(x!=null&&x.establishmentId)||t))try{if(l)await pt(me(H,"expense_categories",l.id),{name:u.name.trim(),description:u.description.trim(),color:u.color,icon:u.icon,updatedAt:J.now()}),L.success("Catégorie modifiée avec succès");else{const v=`${x.establishmentId}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await Ze(me(H,"expense_categories",v),{name:u.name.trim(),description:u.description.trim(),color:u.color,icon:u.icon,establishmentId:x.establishmentId,isDefault:!1,createdAt:J.now()}),L.success("Catégorie créée avec succès")}await y(),o(!1),d(null)}catch(v){console.error("Erreur lors de la sauvegarde:",v),L.error("Erreur lors de la sauvegarde")}},S=async R=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des catégories");return}const v=e.find(b=>b.id===R);if(v){if(v.isDefault){L.error("Impossible de supprimer une catégorie par défaut");return}if(v.expenseCount&&v.expenseCount>0){L.error(`Impossible de supprimer: ${v.expenseCount} dépense(s) utilisent cette catégorie`);return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer la catégorie "${v.name}" ?`))try{await Ds(me(H,"expense_categories",R)),await y(),L.success("Catégorie supprimée avec succès")}catch(b){console.error("Erreur lors de la suppression:",b),L.error("Erreur lors de la suppression")}}},D=R=>{const v=pv.find(b=>b.id===R);return v?v.class:"bg-gray-500"};return n?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des catégories..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Catégories de dépenses"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Organisez vos dépenses par catégories"})]}),!t&&r.jsxs("div",{className:"flex gap-2",children:[e.length===0&&r.jsx(O,{variant:"ghost",onClick:P,children:"Créer catégories par défaut"}),r.jsxs(O,{onClick:_,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Nouvelle catégorie"]})]})]}),t&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les catégories mais pas les modifier."})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(R=>r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:`w-10 h-10 rounded-lg ${D(R.color)} flex items-center justify-center text-white text-lg`,children:R.icon}),r.jsxs("div",{children:[r.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center",children:[R.name,R.isDefault&&r.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Défaut"})]}),R.description&&r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:R.description}),r.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[R.expenseCount||0," dépense(s)"]})]})]}),!t&&r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>C(R),children:r.jsx(wr,{className:"w-4 h-4"})}),!R.isDefault&&r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>S(R.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(ms,{className:"w-4 h-4"})})]})]})},R.id)),e.length===0&&r.jsxs("div",{className:"col-span-full text-center py-12",children:[r.jsx(zn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune catégorie de dépense"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"Créez des catégories pour organiser vos dépenses"}),!t&&r.jsxs("div",{className:"flex justify-center gap-3",children:[r.jsx(O,{variant:"ghost",onClick:P,children:"Catégories par défaut"}),r.jsxs(O,{onClick:_,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Créer une catégorie"]})]})]})]}),a&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier la catégorie":"Nouvelle catégorie"}),r.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:T,className:"space-y-4",children:[r.jsx(fe,{label:"Nom de la catégorie *",value:u.name,onChange:R=>m({...u,name:R.target.value}),error:h.name,placeholder:"Ex: Loyer",leftIcon:r.jsx(zn,{className:"w-4 h-4"})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (optionnel)"}),r.jsx("textarea",{value:u.description,onChange:R=>m({...u,description:R.target.value}),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Description de la catégorie..."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Icône"}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:gD.map(R=>r.jsx("button",{type:"button",onClick:()=>m({...u,icon:R.id}),className:`p-3 rounded-lg border-2 transition-all flex items-center justify-center ${u.icon===R.id?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,title:R.name,children:r.jsx("span",{className:"text-2xl",children:R.id})},R.id))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Couleur"}),r.jsx("div",{className:"grid grid-cols-4 gap-2",children:pv.map(R=>r.jsx("button",{type:"button",onClick:()=>m({...u,color:R.id}),className:`w-12 h-12 rounded-lg ${R.class} border-2 transition-all ${u.color===R.id?"border-gray-800 scale-110":"border-gray-300 hover:border-gray-400"}`,title:R.name},R.id))})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>o(!1),children:"Annuler"}),r.jsxs(O,{type:"submit",children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),l?"Modifier":"Créer"]})]})]})]})})]})},yD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(""),[i,a]=A.useState("all"),[o,l]=A.useState("all"),[d,u]=A.useState("all"),[m,h]=A.useState({start:"",end:""}),[f,x]=A.useState(!1),[y,P]=A.useState(!1),[_,C]=A.useState(null),[k,T]=A.useState(!1),[S,D]=A.useState(!0),[R,v]=A.useState(null),[b,N]=A.useState(!1),{user:g}=Le(),w=(g==null?void 0:g.role)==="reader",I=async()=>{if(g!=null&&g.establishmentId)try{D(!0);const Y=Ne(je(H,"expenses"),oe("establishmentId","==",g.establishmentId),wi("createdAt","desc")),K=(await _e(Y)).docs.map(de=>{var be,ke,Fe,ue;const ne=de.data();return{id:de.id,title:ne.title,description:ne.description,amount:ne.amount,categoryId:ne.categoryId,categoryName:ne.categoryName,paymentMethod:ne.paymentMethod,supplier:ne.supplier,invoiceNumber:ne.invoiceNumber,isRecurring:ne.isRecurring||!1,recurringFrequency:ne.recurringFrequency,nextDueDate:(be=ne.nextDueDate)==null?void 0:be.toDate(),establishmentId:ne.establishmentId,userId:ne.userId,userName:ne.userName,status:ne.status,paidAt:(ke=ne.paidAt)==null?void 0:ke.toDate(),createdAt:((Fe=ne.createdAt)==null?void 0:Fe.toDate())||new Date,updatedAt:((ue=ne.updatedAt)==null?void 0:ue.toDate())||new Date}});e(K)}catch(Y){console.error("Erreur lors du chargement des dépenses:",Y),L.error("Erreur lors du chargement des dépenses")}finally{D(!1)}};A.useEffect(()=>{I()},[g==null?void 0:g.establishmentId]);const E=A.useMemo(()=>t.filter(Y=>{const U=Y.title.toLowerCase().includes(s.toLowerCase())||Y.supplier&&Y.supplier.toLowerCase().includes(s.toLowerCase())||Y.description&&Y.description.toLowerCase().includes(s.toLowerCase()),K=i==="all"||Y.categoryId===i,de=o==="all"||Y.status===o,ne=d==="all"||Y.paymentMethod===d;let be=!0;if(m.start&&m.end){const Fe=(Y.paidAt||Y.createdAt).toISOString().split("T")[0];be=Fe>=m.start&&Fe<=m.end}return U&&K&&de&&ne&&be}),[t,s,i,o,d,m]),ee=A.useMemo(()=>{const Y=new Date,U=new Date(Y.getFullYear(),Y.getMonth(),1),K=t.filter(ne=>(ne.paidAt||ne.createdAt)>=U&&ne.status==="paid"),de=t.filter(ne=>ne.status==="pending");return{total:t.length,thisMonth:K.length,thisMonthAmount:K.reduce((ne,be)=>ne+be.amount,0),pending:de.length,pendingAmount:de.reduce((ne,be)=>ne+be.amount,0)}},[t]),V=()=>{if(w){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des dépenses");return}C(null),x(!0)},F=Y=>{if(w){L.error("Vous n'avez pas les permissions nécessaires pour modifier des dépenses");return}C(Y),x(!0)},X=async Y=>{if(w){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des dépenses");return}if(window.confirm("Êtes-vous sûr de vouloir supprimer cette dépense ?"))try{await Ds(me(H,"expenses",Y)),await I(),L.success("Dépense supprimée avec succès")}catch(U){console.error("Erreur lors de la suppression:",U),L.error("Erreur lors de la suppression")}},W=Y=>{v(Y),N(!0)},re=async Y=>{if(!(g!=null&&g.establishmentId)){L.error("Établissement non trouvé");return}if(w){L.error("Vous n'avez pas les permissions nécessaires pour cette action");return}T(!0);try{const U=await _e(Ne(je(H,"expense_categories"),oe("__name__","==",Y.categoryId)));let K="Catégorie inconnue";if(U.empty||(K=U.docs[0].data().name),_)await pt(me(H,"expenses",_.id),{...Y,categoryName:K,establishmentId:g.establishmentId,userId:g.id,userName:g.name,updatedAt:J.now()}),L.success("Dépense modifiée avec succès");else{const de=`expense_${Date.now()}`;await Ze(me(H,"expenses",de),{...Y,categoryName:K,establishmentId:g.establishmentId,userId:g.id,userName:g.name,paidAt:Y.paidAt?J.fromDate(Y.paidAt):null,nextDueDate:Y.nextDueDate?J.fromDate(Y.nextDueDate):null,createdAt:J.now(),updatedAt:J.now()}),L.success("Dépense ajoutée avec succès")}await I(),x(!1),C(null)}catch(U){console.error("Erreur lors de l'enregistrement:",U),L.error("Erreur lors de l'enregistrement")}finally{T(!1)}},Z=()=>{const Y=[["Titre","Catégorie","Montant","Fournisseur","Date","Statut","Méthode de paiement"],...E.map(ne=>[ne.title,ne.categoryName,ne.amount,ne.supplier||"",(ne.paidAt||ne.createdAt).toLocaleDateString("fr-FR"),ne.status,ne.paymentMethod])].map(ne=>ne.join(",")).join(`
`),U=new Blob([Y],{type:"text/csv"}),K=window.URL.createObjectURL(U),de=document.createElement("a");de.href=K,de.download=`depenses_${new Date().toISOString().split("T")[0]}.csv`,de.click(),window.URL.revokeObjectURL(K),L.success("Export réalisé avec succès")},se=({expense:Y,onClose:U})=>{const K=ke=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(ke).replace("MGA","Ar"),de=ke=>ke?ke.toLocaleDateString("fr-FR"):"Non défini",ne=ke=>{switch(ke){case"paid":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},be=ke=>({cash:"Espèces",card:"Carte bancaire",bank_transfer:"Virement bancaire",check:"Chèque"})[ke]||ke;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[r.jsx(kt,{className:"w-6 h-6 mr-2 text-red-600"}),"Détails de la dépense"]}),r.jsx("button",{onClick:U,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:Y.title}),Y.description&&r.jsx("p",{className:"text-gray-700 mb-3",children:Y.description}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:Y.categoryName}),r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${ne(Y.status)}`,children:Y.status==="paid"?"Payée":Y.status==="pending"?"En attente":"Annulée"})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[r.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Montant"}),r.jsx("p",{className:"text-2xl font-bold text-red-700",children:K(Y.amount)})]}),r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsx("h4",{className:"font-medium text-blue-800 mb-1",children:"Méthode de paiement"}),r.jsx("p",{className:"text-lg font-semibold text-blue-700",children:be(Y.paymentMethod)})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[Y.supplier&&r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Fournisseur"}),r.jsx("p",{className:"text-gray-900",children:Y.supplier})]}),Y.invoiceNumber&&r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"N° de facture"}),r.jsx("p",{className:"text-gray-900 font-mono",children:Y.invoiceNumber})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Créée par"}),r.jsx("p",{className:"text-gray-900",children:Y.userName})]})]}),r.jsxs("div",{className:"space-y-4",children:[Y.paidAt&&r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Date de paiement"}),r.jsx("p",{className:"text-gray-900",children:de(Y.paidAt)})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Date de création"}),r.jsx("p",{className:"text-gray-900",children:de(Y.createdAt)})]}),Y.isRecurring&&r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Récurrence"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(hg,{className:"w-4 h-4 mr-1 text-blue-600"}),r.jsx("p",{className:"text-gray-900",children:Y.recurringFrequency==="daily"?"Quotidienne":Y.recurringFrequency==="weekly"?"Hebdomadaire":Y.recurringFrequency==="monthly"?"Mensuelle":"Annuelle"})]}),Y.nextDueDate&&r.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["Prochaine échéance: ",de(Y.nextDueDate)]})]})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:U,children:"Fermer"}),!w&&r.jsx(O,{onClick:()=>{U(),F(Y)},children:"Modifier"})]})]})})};return S?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des dépenses..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[r.jsx(Ni,{className:"w-8 h-8 mr-3 text-red-600"}),"Gestion des Dépenses"]}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Suivez et contrôlez toutes vos dépenses d'entreprise"})]}),r.jsx("div",{className:"flex gap-3",children:!w&&r.jsxs(r.Fragment,{children:[r.jsxs(O,{variant:"ghost",onClick:()=>P(!0),children:[r.jsx($n,{className:"w-4 h-4 mr-2"}),"Catégories"]}),r.jsxs(O,{onClick:V,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Nouvelle dépense"]})]})})]}),w&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les dépenses mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),r.jsx(G,{children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-red-600",children:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(ee.thisMonthAmount).replace("MGA","Ar")}),r.jsx("p",{className:"text-gray-600",children:"Dépenses ce mois"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(ee.pendingAmount).replace("MGA","Ar")}),r.jsx("p",{className:"text-gray-600",children:"En attente de paiement"})]}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-blue-600",children:ee.total}),r.jsx("p",{className:"text-gray-600",children:"Total des dépenses"})]})]})}),r.jsx(uD,{searchTerm:s,onSearchChange:n,selectedCategory:i,onCategoryChange:a,selectedStatus:o,onStatusChange:l,selectedPaymentMethod:d,onPaymentMethodChange:u,dateRange:m,onDateRangeChange:h,onExport:Z,stats:ee}),r.jsx(mD,{expenses:E,onEdit:F,onDelete:X,onView:W,isLoading:!1,userRole:(g==null?void 0:g.role)||""}),f&&r.jsx(fD,{expense:_,onSubmit:re,onCancel:()=>{x(!1),C(null)},isLoading:k}),y&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Gestion des catégories"}),r.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsx(xD,{readOnly:w})]})}),b&&R&&r.jsx(se,{expense:R,onClose:()=>{N(!1),v(null)}})]})},vD=({readOnly:t=!1})=>{const[e,s]=A.useState([]),[n,i]=A.useState(!0),[a,o]=A.useState(!1),[l,d]=A.useState(null),[u,m]=A.useState({name:"",address:"",phone:"",email:"",isMainStore:!1,isActive:!0}),[h,f]=A.useState({}),{user:x}=Le(),y=async()=>{if(x!=null&&x.establishmentId)try{i(!0);const S=Ne(je(H,"stores"),oe("establishmentId","==",x.establishmentId)),R=(await _e(S)).docs.map(v=>{var N,g;const b=v.data();return{id:v.id,name:b.name,address:b.address,phone:b.phone||"",email:b.email||"",establishmentId:b.establishmentId,isActive:b.isActive!==!1,isMainStore:b.isMainStore||!1,createdAt:((N=b.createdAt)==null?void 0:N.toDate())||new Date,updatedAt:((g=b.updatedAt)==null?void 0:g.toDate())||new Date}});s(R)}catch(S){console.error("Erreur lors du chargement des magasins:",S),L.error("Erreur lors du chargement des magasins")}finally{i(!1)}};A.useEffect(()=>{y()},[x==null?void 0:x.establishmentId]);const P=()=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour ajouter des magasins");return}d(null),m({name:"",address:"",phone:"",email:"",isMainStore:e.length===0,isActive:!0}),f({}),o(!0)},_=S=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour modifier des magasins");return}d(S),m({name:S.name,address:S.address,phone:S.phone||"",email:S.email||"",isMainStore:S.isMainStore,isActive:S.isActive}),f({}),o(!0)},C=()=>{const S={};return u.name.trim()||(S.name="Le nom du magasin est requis"),u.address.trim()||(S.address="L'adresse est requise"),e.find(R=>R.name.toLowerCase()===u.name.toLowerCase()&&R.id!==(l==null?void 0:l.id))&&(S.name="Un magasin avec ce nom existe déjà"),f(S),Object.keys(S).length===0},k=async S=>{if(S.preventDefault(),!(!C()||!(x!=null&&x.establishmentId)))try{if(l){if(l.isMainStore&&!u.isMainStore&&!e.find(R=>R.id!==l.id&&R.isMainStore)){L.error("Vous devez avoir au moins un magasin principal");return}if(!l.isMainStore&&u.isMainStore)for(const D of e)D.id!==l.id&&D.isMainStore&&await pt(me(H,"stores",D.id),{isMainStore:!1,updatedAt:J.now()});await pt(me(H,"stores",l.id),{name:u.name.trim(),address:u.address.trim(),phone:u.phone.trim(),email:u.email.trim(),isMainStore:u.isMainStore,isActive:u.isActive,updatedAt:J.now()}),L.success("Magasin modifié avec succès")}else{if(u.isMainStore)for(const R of e)R.isMainStore&&await pt(me(H,"stores",R.id),{isMainStore:!1,updatedAt:J.now()});const D=`store_${Date.now()}`;await Ze(me(H,"stores",D),{name:u.name.trim(),address:u.address.trim(),phone:u.phone.trim(),email:u.email.trim(),establishmentId:x.establishmentId,isMainStore:u.isMainStore,isActive:u.isActive,createdAt:J.now(),updatedAt:J.now()}),L.success("Magasin créé avec succès")}await y(),o(!1),d(null)}catch(D){console.error("Erreur lors de la sauvegarde:",D),L.error("Erreur lors de la sauvegarde")}},T=async S=>{if(t){L.error("Vous n'avez pas les permissions nécessaires pour supprimer des magasins");return}const D=e.find(R=>R.id===S);if(D){if(D.isMainStore){L.error("Vous ne pouvez pas supprimer le magasin principal");return}if(window.confirm(`Êtes-vous sûr de vouloir supprimer le magasin "${D.name}" ?`))try{await Ds(me(H,"stores",S)),await y(),L.success("Magasin supprimé avec succès")}catch(R){console.error("Erreur lors de la suppression:",R),L.error("Erreur lors de la suppression")}}};return n?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des magasins..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Gestion des Magasins"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos différents points de vente et emplacements"})]}),!t&&r.jsxs(O,{onClick:P,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Nouveau magasin"]})]}),t&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les magasins mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),r.jsx(G,{children:r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Yr,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Gestion multi-magasins"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsx("p",{children:"• Créez plusieurs magasins ou points de vente pour votre établissement"}),r.jsx("p",{children:"• Suivez le stock par magasin et effectuez des transferts entre eux"}),r.jsx("p",{children:"• Désignez un magasin principal qui servira de référence"}),r.jsx("p",{children:"• Chaque magasin peut avoir ses propres ventes et statistiques"})]})]})]})})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.map(S=>r.jsxs(G,{padding:"md",className:S.isMainStore?"border-blue-300":"",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${S.isMainStore?"bg-blue-100":"bg-gray-100"}`,children:S.isMainStore?r.jsx(S1,{className:"w-5 h-5 text-blue-600"}):r.jsx(Ms,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:S.name}),S.isMainStore&&r.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Principal"})]}),r.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[r.jsx(Bd,{className:"w-3 h-3 mr-1"}),S.address]}),S.phone&&r.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[r.jsx(Gd,{className:"w-3 h-3 mr-1"}),S.phone]}),S.email&&r.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[r.jsx(It,{className:"w-3 h-3 mr-1"}),S.email]})]})]}),!t&&r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>_(S),children:r.jsx(wr,{className:"w-4 h-4"})}),!S.isMainStore&&r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>T(S.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx(ms,{className:"w-4 h-4"})})]})]}),r.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${S.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:S.isActive?"Actif":"Inactif"}),r.jsxs("span",{className:"text-xs text-gray-500",children:["Créé le ",S.createdAt.toLocaleDateString()]})]})})]},S.id)),e.length===0&&r.jsxs("div",{className:"col-span-full text-center py-12",children:[r.jsx(Ms,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun magasin"}),r.jsx("p",{className:"text-gray-500 mb-6",children:"Créez votre premier magasin pour commencer à gérer vos points de vente"}),!t&&r.jsxs(O,{onClick:P,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Créer un magasin"]})]})]}),a&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier le magasin":"Nouveau magasin"}),r.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:k,className:"space-y-4",children:[r.jsx(fe,{label:"Nom du magasin *",value:u.name,onChange:S=>m({...u,name:S.target.value}),error:h.name,placeholder:"Ex: Magasin Principal",leftIcon:r.jsx(Ms,{className:"w-4 h-4"})}),r.jsx(fe,{label:"Adresse *",value:u.address,onChange:S=>m({...u,address:S.target.value}),error:h.address,placeholder:"Ex: 123 Rue Principale, Antananarivo",leftIcon:r.jsx(Bd,{className:"w-4 h-4"})}),r.jsx(fe,{label:"Téléphone",value:u.phone,onChange:S=>m({...u,phone:S.target.value}),placeholder:"Ex: +261 34 12 345 67",leftIcon:r.jsx(Gd,{className:"w-4 h-4"})}),r.jsx(fe,{label:"Email",type:"email",value:u.email,onChange:S=>m({...u,email:S.target.value}),placeholder:"Ex: magasin@example.com",leftIcon:r.jsx(It,{className:"w-4 h-4"})}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isMainStore",checked:u.isMainStore,onChange:S=>m({...u,isMainStore:S.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsx("label",{htmlFor:"isMainStore",className:"ml-2 text-sm text-gray-700",children:"Magasin principal"})]}),r.jsx("p",{className:"text-xs text-gray-500 -mt-2",children:"Le magasin principal est le magasin de référence pour votre établissement."}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:u.isActive,onChange:S=>m({...u,isActive:S.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Magasin actif"})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>o(!1),children:"Annuler"}),r.jsxs(O,{type:"submit",children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),l?"Modifier":"Créer"]})]})]})]})})]})},bD=({onClose:t,onSuccess:e,existingTransfer:s})=>{var Y;const[n,i]=A.useState([]),[a,o]=A.useState([]),[l,d]=A.useState(""),[u,m]=A.useState(""),[h,f]=A.useState([]),[x,y]=A.useState(""),[P,_]=A.useState(!1),[C,k]=A.useState(!1),[T,S]=A.useState({}),[D,R]=A.useState(""),[v,b]=A.useState(!1),[N,g]=A.useState(!1),{user:w}=Le();A.useEffect(()=>{(async()=>{if(w!=null&&w.establishmentId){_(!0);try{console.log("🔄 Chargement des données pour le transfert...");const K=Ne(je(H,"stores"),oe("establishmentId","==",w.establishmentId),oe("isActive","==",!0)),ne=(await _e(K)).docs.map(we=>{var $,q;const ye=we.data();return{id:we.id,name:ye.name,address:ye.address,phone:ye.phone||"",email:ye.email||"",establishmentId:ye.establishmentId,isActive:ye.isActive!==!1,isMainStore:ye.isMainStore||!1,createdAt:(($=ye.createdAt)==null?void 0:$.toDate())||new Date,updatedAt:((q=ye.updatedAt)==null?void 0:q.toDate())||new Date}});i(ne),console.log("✅ Magasins chargés:",ne.length);const be=ne.find(we=>we.isMainStore);be&&!s&&(d(be.id),console.log("📍 Magasin principal sélectionné comme source:",be.name));const ke=Ne(je(H,"products"),oe("establishmentId","==",w.establishmentId),oe("isActive","==",!0)),ue=(await _e(ke)).docs.map(we=>{const ye=we.data();return{id:we.id,name:ye.name,reference:ye.reference,barcode:ye.barcode,stock:ye.stock||0,unit:ye.unit||"pièce",storeStock:ye.storeStock||{},categoryId:ye.categoryId,establishmentId:ye.establishmentId,isActive:ye.isActive!==!1,salePrice:ye.salePrice||0,purchasePrice:ye.purchasePrice||0}});o(ue),console.log("✅ Produits chargés:",ue.length),s&&(d(s.sourceStoreId),m(s.destinationStoreId),f(s.items||[]),y(s.notes||""),console.log("📝 Transfert existant chargé:",s.id))}catch(K){console.error("❌ Erreur lors du chargement des données:",K),L.error("Erreur lors du chargement des données")}finally{_(!1)}}})()},[w==null?void 0:w.establishmentId,s]);const I=(U,K)=>{const de=a.find(be=>be.id===U);if(!de||!K)return 0;if(de.storeStock&&de.storeStock[K]!==void 0)return de.storeStock[K];const ne=n.find(be=>be.id===K);return ne!=null&&ne.isMainStore?de.stock:0},E=()=>{if(!l)return console.log("⚠️ Aucun magasin source sélectionné"),[];const U=a.filter(K=>{const de=!D||K.name.toLowerCase().includes(D.toLowerCase())||K.reference.toLowerCase().includes(D.toLowerCase())||K.barcode&&K.barcode.includes(D),ne=!h.some(ue=>ue.productId===K.id),be=I(K.id,l),ke=be>0,Fe=de&&ne&&ke;return(K.name.toLowerCase().includes("coca")||K.name.toLowerCase().includes("pain"))&&console.log(`🔍 Produit ${K.name}:`,{matchesSearch:de,notInTransfer:ne,hasStock:ke,stockInStore:be,isAvailable:Fe}),Fe});return console.log(`📦 Produits disponibles pour transfert: ${U.length}/${a.length}`),U},ee=U=>{const K=a.find(be=>be.id===U);if(!K){L.error("Produit non trouvé");return}if(!l){L.error("Veuillez sélectionner un magasin source");return}if(I(K.id,l)<=0){L.error("Aucun stock disponible pour ce produit dans le magasin source");return}const ne={id:`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,productId:K.id,productName:K.name,quantity:1,unit:K.unit,notes:""};f(be=>[...be,ne]),b(!1),R(""),console.log("✅ Produit ajouté au transfert:",K.name),L.success(`${K.name} ajouté au transfert`)},V=(U,K)=>{if(K<=0){F(U);return}const de=h.find(ke=>ke.id===U);if(!de)return;const ne=a.find(ke=>ke.id===de.productId);if(!ne)return;const be=I(ne.id,l);if(K>be){L.error(`Stock insuffisant. Disponible: ${be} ${ne.unit}`);return}f(ke=>ke.map(Fe=>Fe.id===U?{...Fe,quantity:K}:Fe)),console.log(`📝 Quantité mise à jour pour ${de.productName}: ${K}`)},F=U=>{const K=h.find(de=>de.id===U);f(de=>de.filter(ne=>ne.id!==U)),K&&(console.log("🗑️ Produit retiré du transfert:",K.productName),L.success("Produit retiré du transfert"))},X=()=>{const U={};l||(U.sourceStore="Le magasin source est requis"),u||(U.destinationStore="Le magasin destination est requis"),l===u&&(U.destinationStore="Les magasins source et destination doivent être différents"),h.length===0&&(U.items="Ajoutez au moins un produit au transfert");for(const K of h){const de=I(K.productId,l);if(K.quantity>de){U.items=`Stock insuffisant pour ${K.productName}. Disponible: ${de}`;break}}return S(U),Object.keys(U).length===0},W=async U=>{if(U.preventDefault(),!(!X()||!(w!=null&&w.establishmentId))){k(!0);try{const K=n.find(ke=>ke.id===l),de=n.find(ke=>ke.id===u);if(!K||!de){L.error("Magasin non trouvé");return}const ne=s?s.id:`transfer_${Date.now()}`,be={id:ne,establishmentId:w.establishmentId,sourceStoreId:l,sourceStoreName:K.name,destinationStoreId:u,destinationStoreName:de.name,items:h,status:s?s.status:"pending",notes:x,createdById:s?s.createdById:w.id,createdByName:s?s.createdByName:w.name,createdAt:s?s.createdAt:J.now(),updatedAt:J.now()};console.log("💾 Sauvegarde du transfert:",be),s?(await pt(me(H,"stock_transfers",ne),be),L.success("Transfert mis à jour avec succès")):(await Ze(me(H,"stock_transfers",ne),be),L.success("Transfert créé avec succès")),e(),t()}catch(K){console.error("❌ Erreur lors de la sauvegarde du transfert:",K),L.error("Erreur lors de la sauvegarde du transfert")}finally{k(!1)}}},re=async()=>{var U,K,de;if(!(!(w!=null&&w.establishmentId)||!s)&&window.confirm("Êtes-vous sûr de vouloir compléter ce transfert ? Cette action mettra à jour les stocks et ne pourra pas être annulée.")){k(!0);try{console.log("🚀 Début de la complétion du transfert...");for(const ne of h){const be=me(H,"products",ne.productId),ke=await hs(be);if(ke.exists()){const Fe=ke.data(),ue=Fe.storeStock||{},we=ue[l]!==void 0?ue[l]:(U=n.find(Ve=>Ve.id===l))!=null&&U.isMainStore?Fe.stock:0,ye=ue[u]!==void 0?ue[u]:0,$={...ue,[l]:Math.max(0,we-ne.quantity),[u]:ye+ne.quantity},q=(K=n.find(Ve=>Ve.id===l))==null?void 0:K.isMainStore,he=(de=n.find(Ve=>Ve.id===u))==null?void 0:de.isMainStore;let Ae=Fe.stock;q&&!he?Ae=Math.max(0,Ae-ne.quantity):!q&&he&&(Ae=Ae+ne.quantity),await pt(be,{storeStock:$,stock:Ae,updatedAt:J.now()}),console.log(`📦 Stock mis à jour pour ${ne.productName}:`,{source:`${we} → ${$[l]}`,destination:`${ye} → ${$[u]}`,global:`${Fe.stock} → ${Ae}`})}}await pt(me(H,"stock_transfers",s.id),{status:"completed",completedById:w.id,completedByName:w.name,completedAt:J.now(),updatedAt:J.now()}),console.log("✅ Transfert complété avec succès"),L.success("Transfert complété avec succès ! Les stocks ont été mis à jour."),e(),t()}catch(ne){console.error("❌ Erreur lors de la complétion du transfert:",ne),L.error("Erreur lors de la complétion du transfert")}finally{k(!1)}}},Z=async()=>{if(!l||!u){L.error("Veuillez sélectionner les magasins source et destination");return}g(!0),b(!0),setTimeout(()=>{g(!1)},500)},se=E();return P?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-2xl",padding:"lg",children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des données..."})]})})}):r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-5xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[r.jsx(ht,{className:"w-6 h-6 mr-2 text-blue-600"}),s?"Détails du transfert de stock":"Nouveau transfert de stock"]}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:W,className:"p-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Xr,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"État du système"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsxs("p",{children:["• Magasins disponibles: ",n.length]}),r.jsxs("p",{children:["• Produits actifs: ",a.length]}),r.jsxs("p",{children:["• Produits avec stock: ",a.filter(U=>I(U.id,l)>0).length]}),r.jsxs("p",{children:["• Produits disponibles pour transfert: ",se.length]})]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin source *"}),r.jsxs("select",{value:l,onChange:U=>{d(U.target.value),h.length>0&&(f([]),L.info("Produits retirés du transfert suite au changement de magasin source"))},className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${T.sourceStore?"border-red-300":"border-gray-300"}`,disabled:(s==null?void 0:s.status)==="completed",children:[r.jsx("option",{value:"",children:"Sélectionner un magasin source"}),n.map(U=>r.jsxs("option",{value:U.id,children:[U.name," ",U.isMainStore?"(Principal)":""]},U.id))]}),T.sourceStore&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:T.sourceStore})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin destination *"}),r.jsxs("select",{value:u,onChange:U=>m(U.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 ${T.destinationStore?"border-red-300":"border-gray-300"}`,disabled:(s==null?void 0:s.status)==="completed",children:[r.jsx("option",{value:"",children:"Sélectionner un magasin destination"}),n.filter(U=>U.id!==l).map(U=>r.jsxs("option",{value:U.id,children:[U.name," ",U.isMainStore?"(Principal)":""]},U.id))]}),T.destinationStore&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:T.destinationStore})]}),r.jsx("div",{className:"mx-4 flex items-center justify-center",children:r.jsx(v1,{className:"w-6 h-6 text-blue-500"})})]})]}),(!l||!u)&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Sélection requise"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Veuillez sélectionner les magasins source et destination avant d'ajouter des produits au transfert."})]})]})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Produits à transférer (",h.length,")"]}),l&&u&&(s==null?void 0:s.status)!=="completed"&&r.jsxs(O,{type:"button",variant:"primary",size:"sm",onClick:Z,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Ajouter un produit"]})]}),T.items&&r.jsx("p",{className:"mt-1 text-sm text-red-600 mb-4",children:T.items}),h.length===0?r.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[r.jsx(ht,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun produit sélectionné"}),r.jsx("p",{className:"text-gray-500 mb-4",children:!l||!u?"Sélectionnez d'abord les magasins source et destination":'Cliquez sur "Ajouter un produit" pour commencer le transfert'}),l&&u&&(s==null?void 0:s.status)!=="completed"&&r.jsxs(O,{type:"button",onClick:Z,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Sélectionner des produits"]})]}):r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock source"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité à transférer"}),r.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(U=>{const K=a.find(ne=>ne.id===U.productId),de=K?I(K.id,l):0;return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:r.jsx(ht,{className:"h-5 w-5 text-blue-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:U.productName}),r.jsxs("div",{className:"text-sm text-gray-500",children:["Réf: ",K==null?void 0:K.reference]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:r.jsxs("span",{className:`text-sm font-medium ${de>0?"text-green-600":"text-red-600"}`,children:[de," ",U.unit]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:(s==null?void 0:s.status)==="completed"?r.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[U.quantity," ",U.unit]}):r.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[r.jsx("button",{type:"button",onClick:()=>V(U.id,Math.max(1,U.quantity-1)),className:"p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",disabled:U.quantity<=1,children:r.jsx(qd,{className:"w-4 h-4 text-gray-600"})}),r.jsx("input",{type:"number",min:"1",max:de,value:U.quantity,onChange:ne=>V(U.id,parseInt(ne.target.value)||1),className:"w-20 px-2 py-1 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),r.jsx("button",{type:"button",onClick:()=>V(U.id,Math.min(de,U.quantity+1)),className:"p-1 rounded-full bg-blue-100 hover:bg-blue-200 transition-colors",disabled:U.quantity>=de,children:r.jsx(Rt,{className:"w-4 h-4 text-blue-600"})}),r.jsx("span",{className:"text-sm text-gray-500 ml-2",children:U.unit})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:(s==null?void 0:s.status)!=="completed"&&r.jsx("button",{type:"button",onClick:()=>F(U.id),className:"text-red-600 hover:text-red-900 transition-colors p-2 hover:bg-red-50 rounded-lg",title:"Supprimer ce produit",children:r.jsx(ms,{className:"w-4 h-4"})})})]},U.id)})})]})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optionnel)"}),r.jsx("textarea",{value:x,onChange:U=>y(U.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Informations supplémentaires sur ce transfert...",disabled:(s==null?void 0:s.status)==="completed"})]}),s&&r.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center",children:[s.status==="pending"?r.jsx(Es,{className:"w-5 h-5 text-yellow-600 mr-2"}):s.status==="completed"?r.jsx(Lt,{className:"w-5 h-5 text-green-600 mr-2"}):r.jsx(bt,{className:"w-5 h-5 text-red-600 mr-2"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Statut du transfert"}),r.jsx("p",{className:"text-sm text-gray-500",children:s.status==="pending"?"En attente de validation":s.status==="completed"?"Transfert complété avec succès":"Transfert annulé"})]})]}),r.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="completed"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="pending"?"En attente":s.status==="completed"?"Complété":"Annulé"})]}),s.status==="completed"&&s.completedAt&&r.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Complété le ",new Date(s.completedAt.seconds*1e3).toLocaleDateString(),"par ",s.completedByName]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:t,disabled:C,children:"Fermer"}),(s==null?void 0:s.status)==="pending"&&h.length>0&&r.jsx(O,{type:"button",variant:"success",onClick:re,disabled:C,children:C?"Traitement...":"Compléter le transfert"}),!s&&r.jsx(O,{type:"submit",disabled:C||!l||!u||h.length===0,children:C?"Enregistrement...":"Créer le transfert"})]})]}),v&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-4xl max-h-[80vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Is,{className:"w-5 h-5 mr-2 text-blue-600"}),"Sélectionner des produits à transférer"]}),r.jsx("button",{onClick:()=>{b(!1),R("")},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6",children:[r.jsx("div",{className:"mb-6",children:r.jsx(fe,{placeholder:"Rechercher par nom, référence ou code-barres...",value:D,onChange:U=>R(U.target.value),leftIcon:r.jsx(Is,{className:"w-4 h-4 text-gray-400"})})}),r.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:N?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des produits..."})]}):se.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(ht,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:l?a.length===0?"Aucun produit disponible":D?"Aucun produit trouvé":"Aucun produit avec stock disponible":"Magasin source requis"}),r.jsx("p",{className:"text-gray-500 mb-4",children:l?a.length===0?'Créez des produits dans la section "Produits"':D?"Aucun produit ne correspond à votre recherche":"Aucun produit n'a de stock disponible dans le magasin source":"Sélectionnez d'abord un magasin source"}),r.jsxs("div",{className:"mt-4 text-sm text-gray-400 space-y-1",children:[r.jsx("p",{children:r.jsx("strong",{children:"Statistiques :"})}),r.jsxs("p",{children:["• Magasins actifs: ",n.length]}),r.jsxs("p",{children:["• Produits actifs: ",a.length]}),r.jsxs("p",{children:["• Magasin source: ",((Y=n.find(U=>U.id===l))==null?void 0:Y.name)||"Non sélectionné"]}),l&&r.jsxs("p",{children:["• Produits avec stock dans ce magasin: ",a.filter(U=>I(U.id,l)>0).length]})]})]}):se.map(U=>{const K=I(U.id,l);return r.jsxs("div",{className:"flex items-center justify-between p-4 bg-white hover:bg-blue-50 rounded-lg cursor-pointer transition-all duration-200 border border-gray-200 hover:border-blue-300 hover:shadow-md",onClick:()=>ee(U.id),children:[r.jsxs("div",{className:"flex items-center flex-1",children:[r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4",children:r.jsx(ht,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"font-medium text-gray-900",children:U.name}),r.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[r.jsxs("span",{children:["Réf: ",U.reference]}),U.barcode&&r.jsxs("span",{className:"font-mono",children:["Code: ",U.barcode]})]})]})]}),r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:"flex items-center",children:[r.jsxs("div",{className:"text-right mr-4",children:[r.jsx("p",{className:"text-lg font-bold text-green-600",children:K}),r.jsxs("p",{className:"text-xs text-gray-500",children:[U.unit," disponible(s)"]})]}),r.jsxs(O,{type:"button",size:"sm",onClick:de=>{de.stopPropagation(),ee(U.id)},className:"ml-2",children:[r.jsx(Rt,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]})})]},U.id)})}),r.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-gray-200",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:[se.length," produit(s) disponible(s) pour le transfert",D&&` (recherche: "${D}")`]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(O,{variant:"ghost",onClick:()=>R(""),disabled:!D,children:"Effacer recherche"}),r.jsx(O,{variant:"ghost",onClick:()=>{b(!1),R("")},children:"Fermer"})]})]})]})]})})]})})},wD=({readOnly:t=!1})=>{const[e,s]=A.useState([]),[n,i]=A.useState(!0),[a,o]=A.useState(""),[l,d]=A.useState("all"),[u,m]=A.useState(!1),[h,f]=A.useState(null),[x,y]=A.useState(!1),{user:P}=Le(),_=async()=>{if(P!=null&&P.establishmentId)try{i(!0),y(!1);try{const v=Ne(je(H,"stock_transfers"),oe("establishmentId","==",P.establishmentId),wi("createdAt","desc")),N=(await _e(v)).docs.map(g=>{var I;const w=g.data();return{id:g.id,establishmentId:w.establishmentId,sourceStoreId:w.sourceStoreId,sourceStoreName:w.sourceStoreName,destinationStoreId:w.destinationStoreId,destinationStoreName:w.destinationStoreName,items:w.items,status:w.status,notes:w.notes,createdById:w.createdById,createdByName:w.createdByName,completedById:w.completedById,completedByName:w.completedByName,createdAt:w.createdAt.toDate(),completedAt:(I=w.completedAt)==null?void 0:I.toDate(),updatedAt:w.updatedAt.toDate()}});s(N)}catch(v){if(v.code==="failed-precondition"&&v.message.includes("index")){y(!0),console.warn("Index composite requis pour les transferts. Chargement des données alternatives...");const b=Ne(je(H,"stock_transfers"),oe("establishmentId","==",P.establishmentId)),g=(await _e(b)).docs.map(w=>{var E;const I=w.data();return{id:w.id,establishmentId:I.establishmentId,sourceStoreId:I.sourceStoreId,sourceStoreName:I.sourceStoreName,destinationStoreId:I.destinationStoreId,destinationStoreName:I.destinationStoreName,items:I.items,status:I.status,notes:I.notes,createdById:I.createdById,createdByName:I.createdByName,completedById:I.completedById,completedByName:I.completedByName,createdAt:I.createdAt.toDate(),completedAt:(E=I.completedAt)==null?void 0:E.toDate(),updatedAt:I.updatedAt.toDate()}});g.sort((w,I)=>I.createdAt.getTime()-w.createdAt.getTime()),s(g)}else throw v}}catch(v){console.error("Erreur lors du chargement des transferts:",v),L.error("Erreur lors du chargement des transferts")}finally{i(!1)}};A.useEffect(()=>{_()},[P==null?void 0:P.establishmentId]);const C=e.filter(v=>{const b=v.sourceStoreName.toLowerCase().includes(a.toLowerCase())||v.destinationStoreName.toLowerCase().includes(a.toLowerCase())||v.createdByName.toLowerCase().includes(a.toLowerCase()),N=l==="all"||v.status===l;return b&&N}),k=v=>{switch(v){case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},T=v=>{switch(v){case"pending":return r.jsx(Es,{className:"w-4 h-4 text-yellow-600"});case"completed":return r.jsx(Lt,{className:"w-4 h-4 text-green-600"});case"cancelled":return r.jsx(ua,{className:"w-4 h-4 text-red-600"});default:return r.jsx(Es,{className:"w-4 h-4 text-gray-600"})}},S=v=>{switch(v){case"pending":return"En attente";case"completed":return"Complété";case"cancelled":return"Annulé";default:return v}},D=v=>{f(v),m(!0)},R=()=>{f(null),m(!0)};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transferts de Stock"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez les mouvements de stock entre vos différents magasins"})]}),!t&&r.jsxs(O,{onClick:R,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Nouveau transfert"]})]}),t&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les transferts mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),r.jsxs(G,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx("div",{className:"md:col-span-2",children:r.jsx(fe,{placeholder:"Rechercher par magasin ou créateur...",value:a,onChange:v=>o(v.target.value),leftIcon:r.jsx(Is,{className:"w-5 h-5 text-gray-400"})})}),r.jsxs("select",{value:l,onChange:v=>d(v.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Tous les statuts"}),r.jsx("option",{value:"pending",children:"En attente"}),r.jsx("option",{value:"completed",children:"Complétés"}),r.jsx("option",{value:"cancelled",children:"Annulés"})]})]}),r.jsxs("div",{className:"flex justify-between items-center mt-4",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:[C.length," transfert(s) trouvé(s)"]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:_,disabled:n,children:[r.jsx(qs,{className:`w-4 h-4 mr-2 ${n?"animate-spin":""}`}),"Actualiser"]})]})]}),n?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des transferts..."})]})}):C.length===0?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Ms,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun transfert trouvé"}),r.jsx("p",{className:"text-gray-500 mb-6",children:a||l!=="all"?"Aucun transfert ne correspond à vos critères de recherche":"Commencez par créer votre premier transfert de stock"}),!t&&r.jsxs(O,{onClick:R,children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Créer un transfert"]})]})}):r.jsx("div",{className:"space-y-4",children:C.map(v=>r.jsxs(G,{padding:"md",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{className:"flex items-start space-x-4",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:r.jsx(Ms,{className:"w-6 h-6 text-blue-600"})})}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("h3",{className:"font-medium text-gray-900",children:v.sourceStoreName}),r.jsx(v1,{className:"mx-2 text-gray-400"}),r.jsx("h3",{className:"font-medium text-gray-900",children:v.destinationStoreName})]}),r.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[r.jsxs("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${k(v.status)}`,children:[T(v.status),r.jsx("span",{className:"ml-1",children:S(v.status)})]}),r.jsxs("span",{className:"text-sm text-gray-500",children:[v.items.length," produit(s)"]})]}),r.jsxs("div",{className:"flex items-center mt-1 text-xs text-gray-500",children:[r.jsx(ut,{className:"w-3 h-3 mr-1"}),"Créé le ",v.createdAt.toLocaleDateString()," par ",v.createdByName]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>D(v),children:[r.jsx(As,{className:"w-4 h-4 mr-2"}),"Détails"]}),v.status==="pending"&&!t&&r.jsxs(O,{variant:"success",size:"sm",onClick:()=>D(v),children:[r.jsx(Lt,{className:"w-4 h-4 mr-2"}),"Compléter"]})]})]}),r.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[r.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Produits transférés:"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:[v.items.slice(0,3).map(b=>r.jsxs("div",{className:"flex items-center p-2 bg-gray-50 rounded-lg",children:[r.jsx(ht,{className:"w-4 h-4 text-gray-500 mr-2"}),r.jsxs("div",{className:"flex-1 truncate",children:[r.jsx("span",{className:"font-medium text-gray-900",children:b.productName}),r.jsxs("span",{className:"ml-2 text-gray-500",children:[b.quantity," ",b.unit]})]})]},b.id)),v.items.length>3&&r.jsx("div",{className:"flex items-center p-2 bg-gray-50 rounded-lg",children:r.jsxs("span",{className:"text-sm text-gray-500",children:["+",v.items.length-3," autres produits"]})})]})]})]},v.id))}),u&&r.jsx(bD,{onClose:()=>{m(!1),f(null)},onSuccess:_,existingTransfer:h})]})},bg=A.createContext(null),jD=({value:t,onValueChange:e,children:s,className:n=""})=>r.jsx(bg.Provider,{value:{activeValue:t,onChange:e},children:r.jsx("div",{className:n,children:s})}),ND=({children:t,className:e=""})=>r.jsx("div",{className:`inline-flex p-1 bg-gray-100 rounded-lg ${e}`,children:t}),fv=({value:t,children:e,className:s="",disabled:n=!1})=>{const i=A.useContext(bg);if(!i)throw new Error("TabsTrigger must be used within a Tabs component");const{activeValue:a,onChange:o}=i,l=a===t;return r.jsx("button",{type:"button",role:"tab","aria-selected":l,disabled:n,onClick:()=>o(t),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${l?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"} ${n?"opacity-50 cursor-not-allowed":""} ${s}`,children:e})},gv=({value:t,children:e,className:s=""})=>{const n=A.useContext(bg);if(!n)throw new Error("TabsContent must be used within a Tabs component");const{activeValue:i}=n;return i!==t?null:r.jsx("div",{role:"tabpanel",className:s,children:e})},_D=()=>{const[t,e]=A.useState("stores"),{user:s}=Le(),n=(s==null?void 0:s.role)==="reader";return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion Multi-Magasins"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez vos différents points de vente et les transferts de stock entre eux"})]}),n&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Mode lecture seule"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"En tant que Lecteur, vous pouvez uniquement consulter les magasins et les transferts mais pas les modifier. Contactez un administrateur si vous avez besoin de ces permissions."})]})]})}),r.jsxs(jD,{value:t,onValueChange:e,children:[r.jsxs(ND,{children:[r.jsxs(fv,{value:"stores",className:"flex items-center",children:[r.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Magasins"]}),r.jsxs(fv,{value:"transfers",className:"flex items-center",children:[r.jsx(B5,{className:"w-4 h-4 mr-2"}),"Transferts de stock"]})]}),r.jsx(gv,{value:"stores",className:"mt-6",children:r.jsx(vD,{readOnly:n})}),r.jsx(gv,{value:"transfers",className:"mt-6",children:r.jsx(wD,{readOnly:n})})]})]})},SD=({isOpen:t,onToggleRegister:e})=>{var $;const[s,n]=A.useState(1e5),[i,a]=A.useState(245500),[o,l]=A.useState(""),[d,u]=A.useState(""),[m,h]=A.useState(!1),[f,x]=A.useState(!1),[y,P]=A.useState(""),[_,C]=A.useState([]),[k,T]=A.useState("today"),[S,D]=A.useState("summary"),[R,v]=A.useState({totalRevenue:0,totalExpenses:0,netProfit:0,salesCount:0,expensesCount:0}),[b,N]=A.useState(!1),[g,w]=A.useState(""),[I,E]=A.useState(!1),[ee,V]=A.useState([]),{user:F}=Le(),X=(F==null?void 0:F.role)==="reader",W=async()=>{if(F!=null&&F.establishmentId)try{const q=Ne(je(H,"stores"),oe("establishmentId","==",F.establishmentId),oe("isActive","==",!0)),Ae=(await _e(q)).docs.map(B=>{const pe=B.data();return{id:B.id,name:pe.name,isMainStore:pe.isMainStore||!1}});V(Ae);const Ve=Ae.find(B=>B.isMainStore);Ve?w(Ve.id):Ae.length>0&&w(Ae[0].id),Ae.length>1&&!t&&E(!0)}catch(q){console.error("Erreur lors du chargement des magasins:",q)}},re=async()=>{if(!(!(F!=null&&F.establishmentId)||!g)){N(!0);try{const{startDate:q,endDate:he}=Z(k);let Ae=[];try{const Te=Ne(je(H,"sales"),oe("establishmentId","==",F.establishmentId),oe("storeId","==",g),oe("createdAt",">=",J.fromDate(q)),oe("createdAt","<=",J.fromDate(he)),oe("status","==","completed"),wi("createdAt","desc"));Ae=(await _e(Te)).docs.map(De=>{const qe=De.data();return{id:De.id,type:"sale",amount:qe.total,description:`Vente ${qe.receiptNumber}`,paymentMethod:qe.paymentMethod,time:qe.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:qe.createdAt.toDate(),category:"Vente"}})}catch{console.warn("Index composite non disponible, utilisation d'une requête simplifiée pour les ventes");const Be=Ne(je(H,"sales"),oe("establishmentId","==",F.establishmentId),oe("storeId","==",g),oe("status","==","completed"));Ae=(await _e(Be)).docs.map(qe=>{const Me=qe.data(),nt=Me.createdAt.toDate();return nt>=q&&nt<=he?{id:qe.id,type:"sale",amount:Me.total,description:`Vente ${Me.receiptNumber}`,paymentMethod:Me.paymentMethod,time:nt.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:nt,category:"Vente"}:null}).filter(Boolean).sort((qe,Me)=>Me.date.getTime()-qe.date.getTime())}let Ve=[];try{const Te=Ne(je(H,"expenses"),oe("establishmentId","==",F.establishmentId),oe("storeId","==",g),oe("createdAt",">=",J.fromDate(q)),oe("createdAt","<=",J.fromDate(he)),oe("status","==","paid"),wi("createdAt","desc"));Ve=(await _e(Te)).docs.map(De=>{const qe=De.data();return{id:De.id,type:"expense",amount:-qe.amount,description:qe.title,paymentMethod:qe.paymentMethod,time:qe.createdAt.toDate().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:qe.createdAt.toDate(),category:qe.categoryName}})}catch{console.warn("Index composite non disponible, utilisation d'une requête simplifiée pour les dépenses");const Be=Ne(je(H,"expenses"),oe("establishmentId","==",F.establishmentId),oe("storeId","==",g),oe("status","==","paid"));Ve=(await _e(Be)).docs.map(qe=>{const Me=qe.data(),nt=Me.createdAt.toDate();return nt>=q&&nt<=he?{id:qe.id,type:"expense",amount:-Me.amount,description:Me.title,paymentMethod:Me.paymentMethod,time:nt.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:nt,category:Me.categoryName}:null}).filter(Boolean).sort((qe,Me)=>Me.date.getTime()-qe.date.getTime())}try{const Te=me(H,"cash_registers",`${F.establishmentId}_${g}`),Be=await hs(Te);if(Be.exists()){const De=Be.data();De.status==="open"?(a(De.currentAmount||0),n(De.openingAmount||0)):(a(0),n(1e5))}}catch(Te){console.error("Erreur lors du chargement de l'état de la caisse:",Te)}const B=[...Ae,...Ve].sort((Te,Be)=>Be.date.getTime()-Te.date.getTime());C(B);const pe=Ae.reduce((Te,Be)=>Te+Be.amount,0),Ce=Math.abs(Ve.reduce((Te,Be)=>Te+Be.amount,0)),Je=pe-Ce;v({totalRevenue:pe,totalExpenses:Ce,netProfit:Je,salesCount:Ae.length,expensesCount:Ve.length})}catch(q){console.error("Erreur lors du chargement des données financières:",q),L.error("Erreur lors du chargement des données. Veuillez créer les index Firestore requis."),L.error("Pour résoudre ce problème, créez les index composites dans la console Firebase.",{duration:8e3})}finally{N(!1)}}};A.useEffect(()=>{W()},[F==null?void 0:F.establishmentId]),A.useEffect(()=>{g&&re()},[k,g,F==null?void 0:F.establishmentId]);const Z=q=>{const he=new Date;let Ae,Ve=new Date(he.getFullYear(),he.getMonth(),he.getDate(),23,59,59);switch(q){case"today":Ae=new Date(he.getFullYear(),he.getMonth(),he.getDate(),0,0,0);break;case"yesterday":const B=new Date(he);B.setDate(B.getDate()-1),Ae=new Date(B.getFullYear(),B.getMonth(),B.getDate(),0,0,0),Ve=new Date(B.getFullYear(),B.getMonth(),B.getDate(),23,59,59);break;case"week":Ae=new Date(he),Ae.setDate(he.getDate()-7),Ae.setHours(0,0,0,0);break;case"month":Ae=new Date(he.getFullYear(),he.getMonth(),1,0,0,0);break;case"year":Ae=new Date(he.getFullYear(),0,1,0,0,0);break;default:Ae=new Date(he.getFullYear(),he.getMonth(),he.getDate(),0,0,0)}return{startDate:Ae,endDate:Ve}},se=q=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(q).replace("MGA","Ar"),Y=q=>({today:"Aujourd'hui",yesterday:"Hier",week:"Cette semaine",month:"Ce mois",year:"Cette année"})[q]||q,U=async()=>{if(!g){L.error("Veuillez sélectionner un magasin");return}if(s<=0){L.error("Le montant d'ouverture doit être supérieur à 0");return}if(!(F!=null&&F.establishmentId)){L.error("Établissement non trouvé");return}try{const q={id:`mov_${Date.now()}`,type:"opening",amount:s,description:"Ouverture de caisse",paymentMethod:"cash",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};C([q,..._]),a(s);const he=`${F.establishmentId}_${g}`;await Ze(me(H,"cash_registers",he),{id:he,establishmentId:F.establishmentId,storeId:g,cashierId:F.id,cashierName:F.name,openingAmount:s,currentAmount:s,openedAt:J.now(),status:"open",movements:[{id:q.id,type:q.type,amount:q.amount,description:q.description,paymentMethod:q.paymentMethod,createdAt:J.now()}]}),e(),L.success("Caisse ouverte avec succès")}catch(q){console.error("Erreur lors de l'ouverture de la caisse:",q),L.error("Erreur lors de l'ouverture de la caisse")}},K=async()=>{if(!(F!=null&&F.establishmentId)||!g){L.error("Informations manquantes");return}try{const q=i,he=`${F.establishmentId}_${g}`;await Ze(me(H,"cash_registers",he),{status:"closed",closingAmount:q,closedAt:J.now(),updatedAt:J.now()},{merge:!0}),L.success(`Caisse fermée. Total: ${se(q)}`),e()}catch(q){console.error("Erreur lors de la fermeture de la caisse:",q),L.error("Erreur lors de la fermeture de la caisse")}},de=()=>{if(X){L.error("Vous n'avez pas les permissions nécessaires pour ajuster les fonds");return}const q=parseFloat(o);if(isNaN(q)||q===0){L.error("Montant invalide");return}if(!d.trim()){L.error("Raison requise");return}const he={id:`mov_${Date.now()}`,type:"adjustment",amount:q,description:d,paymentMethod:"cash",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};C([he,..._]),a(Ae=>Ae+q),l(""),u(""),h(!1),L.success(q>0?"Fonds ajoutés":"Fonds retirés")},ne=q=>{if(X){L.error("Vous n'avez pas les permissions nécessaires pour effectuer des retraits");return}if(q>i){L.error("Fonds insuffisants en caisse");return}const he={id:`mov_${Date.now()}`,type:"withdrawal",amount:-q,description:`Retrait de ${se(q)}`,paymentMethod:"cash",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};C([he,..._]),a(Ae=>Ae-q),L.success("Retrait effectué")},be=()=>{if(X){L.error("Vous n'avez pas les permissions nécessaires pour réinitialiser la caisse");return}if(!y.trim()){L.error("Veuillez indiquer une raison pour la réinitialisation");return}const q={id:`mov_${Date.now()}`,type:"reset",amount:-i,description:`Réinitialisation de caisse: ${y}`,paymentMethod:"system",time:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),date:new Date};C([q,..._]),a(0),x(!1),P(""),L.success("Solde de caisse réinitialisé avec succès")},ke=q=>{switch(q){case"sale":return r.jsx(or,{className:"w-4 h-4 text-green-600"});case"expense":return r.jsx(Ni,{className:"w-4 h-4 text-red-600"});case"adjustment":return r.jsx(av,{className:"w-4 h-4 text-blue-600"});case"withdrawal":return r.jsx(qd,{className:"w-4 h-4 text-orange-600"});case"opening":return r.jsx(lv,{className:"w-4 h-4 text-purple-600"});case"reset":return r.jsx(qs,{className:"w-4 h-4 text-red-600"});default:return r.jsx(kt,{className:"w-4 h-4 text-gray-600"})}},Fe=q=>q>=0?"text-green-600":"text-red-600",ue=()=>{const q=[["Type","Description","Catégorie","Montant","Méthode","Date","Heure"],..._.map(B=>[B.type==="sale"?"Recette":B.type==="expense"?"Dépense":B.type==="adjustment"?"Ajustement":B.type==="withdrawal"?"Retrait":B.type==="opening"?"Ouverture":B.type==="reset"?"Réinitialisation":B.type,B.description,B.category||"",Math.abs(B.amount),B.paymentMethod,B.date.toLocaleDateString("fr-FR"),B.time])].map(B=>B.join(",")).join(`
`),he=new Blob([q],{type:"text/csv"}),Ae=window.URL.createObjectURL(he),Ve=document.createElement("a");Ve.href=Ae,Ve.download=`rapport_financier_${k}_${new Date().toISOString().split("T")[0]}.csv`,Ve.click(),window.URL.revokeObjectURL(Ae),L.success("Rapport exporté avec succès")},we=()=>r.jsxs("div",{className:"space-y-6",children:[_.length===0&&!b&&r.jsx(G,{padding:"md",className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(ut,{className:"w-5 h-5 text-yellow-600 mt-0.5"})}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Configuration requise"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Pour afficher les données financières complètes, veuillez créer les index composites Firestore requis dans votre console Firebase."}),r.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:"Les données locales de la caisse restent disponibles."})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsx(G,{padding:"md",className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-green-500 rounded-lg",children:r.jsx(or,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-green-700",children:"Recettes totales"}),r.jsx("p",{className:"text-2xl font-bold text-green-900",children:se(R.totalRevenue)}),r.jsxs("p",{className:"text-xs text-green-600",children:[R.salesCount," vente(s)"]})]})]})}),r.jsx(G,{padding:"md",className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-red-500 rounded-lg",children:r.jsx(Ni,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-red-700",children:"Dépenses totales"}),r.jsx("p",{className:"text-2xl font-bold text-red-900",children:se(R.totalExpenses)}),r.jsxs("p",{className:"text-xs text-red-600",children:[R.expensesCount," dépense(s)"]})]})]})}),r.jsx(G,{padding:"md",className:`bg-gradient-to-br ${i>=0?"from-blue-50 to-blue-100 border-blue-200":"from-orange-50 to-orange-100 border-orange-200"}`,children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`p-3 rounded-lg ${i>=0?"bg-blue-500":"bg-orange-500"}`,children:r.jsx(av,{className:"w-6 h-6 text-white"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:`text-sm font-medium ${i>=0?"text-blue-700":"text-orange-700"}`,children:"Solde de caisse"}),r.jsx("p",{className:`text-2xl font-bold ${i>=0?"text-blue-900":"text-orange-900"}`,children:se(i)}),r.jsx("p",{className:`text-xs ${i>=0?"text-blue-600":"text-orange-600"}`,children:"Montant disponible"})]})]})})]}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Répartition financière"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-green-700",children:"Recettes"}),r.jsx("span",{className:"text-sm text-green-600",children:se(R.totalRevenue)})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:r.jsx("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-500",style:{width:R.totalRevenue>0?`${R.totalRevenue/(R.totalRevenue+R.totalExpenses)*100}%`:"0%"}})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between items-center mb-2",children:[r.jsx("span",{className:"text-sm font-medium text-red-700",children:"Dépenses"}),r.jsx("span",{className:"text-sm text-red-600",children:se(R.totalExpenses)})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:r.jsx("div",{className:"bg-red-500 h-3 rounded-full transition-all duration-500",style:{width:R.totalExpenses>0?`${R.totalExpenses/(R.totalRevenue+R.totalExpenses)*100}%`:"0%"}})})]})]})]})]}),ye=()=>r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Mouvements financiers - ",Y(k)]}),r.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:_.length===0?r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(ds,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),r.jsx("p",{children:"Aucun mouvement pour cette période"}),r.jsx("p",{className:"text-sm mt-2",children:"Les données Firestore nécessitent la création d'index composites"})]}):_.map(q=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[ke(q.type),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-sm",children:q.description}),r.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[r.jsx("span",{children:q.paymentMethod}),r.jsx("span",{children:"•"}),r.jsx("span",{children:q.time}),q.category&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"•"}),r.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full",children:q.category})]})]})]})]}),r.jsx("div",{className:"text-right",children:r.jsxs("p",{className:`font-semibold ${Fe(q.amount)}`,children:[q.amount>=0?"+":"",se(Math.abs(q.amount))]})})]},q.id))})]});return t?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500"}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestion Financière"}),r.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:"Caisse ouverte"})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[r.jsxs("div",{className:"flex items-center bg-blue-50 px-3 py-1 rounded-lg border border-blue-200",children:[r.jsx(Ms,{className:"w-4 h-4 text-blue-600 mr-2"}),r.jsx("span",{className:"text-sm font-medium text-blue-800",children:(($=ee.find(q=>q.id===g))==null?void 0:$.name)||"Magasin"}),r.jsx(O,{variant:"ghost",size:"sm",className:"ml-2 text-blue-600 hover:bg-blue-100 p-1",onClick:()=>E(!0),children:r.jsx(qs,{className:"w-3 h-3"})})]}),r.jsxs("select",{value:k,onChange:q=>T(q.target.value),className:"px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"today",children:"Aujourd'hui"}),r.jsx("option",{value:"yesterday",children:"Hier"}),r.jsx("option",{value:"week",children:"Cette semaine"}),r.jsx("option",{value:"month",children:"Ce mois"}),r.jsx("option",{value:"year",children:"Cette année"})]}),r.jsxs(O,{variant:"ghost",onClick:ue,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),r.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[r.jsxs("button",{onClick:()=>D("summary"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${S==="summary"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Vu,{className:"w-4 h-4 inline mr-2"}),"Résumé"]}),r.jsxs("button",{onClick:()=>D("movements"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${S==="movements"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(ds,{className:"w-4 h-4 inline mr-2"}),"Mouvements"]})]}),b?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des données financières..."})]}):r.jsxs(r.Fragment,{children:[S==="summary"&&we(),S==="movements"&&ye()]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"État de la caisse"}),r.jsx("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200 mb-4",children:r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx(r6,{className:"w-10 h-10 text-blue-600 mr-4"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Solde actuel"}),r.jsx("p",{className:"text-3xl font-bold text-blue-900",children:se(i)})]})]})}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Va,{className:"w-5 h-5 text-green-600 mr-3"}),r.jsx("p",{className:"text-sm font-medium",children:"Espèces en caisse"})]}),r.jsx("p",{className:"font-semibold",children:se(i)})]})]}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Actions rapides"}),r.jsxs("div",{className:"space-y-3",children:[!X&&r.jsxs(r.Fragment,{children:[r.jsxs(O,{fullWidth:!0,variant:"success",onClick:()=>h(!0),children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Ajuster fonds"]}),r.jsxs(O,{fullWidth:!0,variant:"warning",onClick:()=>ne(5e4),children:[r.jsx(qd,{className:"w-4 h-4 mr-2"}),"Retrait rapide (50,000 Ar)"]}),r.jsxs(O,{fullWidth:!0,variant:"ghost",children:[r.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Imprimer rapport"]}),r.jsxs(O,{fullWidth:!0,variant:"danger",onClick:()=>x(!0),children:[r.jsx(qs,{className:"w-4 h-4 mr-2"}),"Réinitialiser solde"]})]}),r.jsxs(O,{fullWidth:!0,variant:"danger",onClick:K,children:[r.jsx(cs,{className:"w-4 h-4 mr-2"}),"Fermer caisse"]})]})]})]}),m&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ajustement de caisse"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(fe,{label:"Montant (Ar)",type:"number",value:o,onChange:q=>l(q.target.value),placeholder:"Montant positif ou négatif",leftIcon:r.jsx(kt,{className:"w-4 h-4"})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Raison de l'ajustement"}),r.jsx("textarea",{value:d,onChange:q=>u(q.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Erreur de caisse, monnaie rendue incorrecte..."})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>h(!1),children:"Annuler"}),r.jsx(O,{onClick:de,children:"Confirmer"})]})]})}),f&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Pn,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Réinitialiser le solde de caisse"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Cette action va remettre à zéro le solde de la caisse. Cette opération est irréversible."})]}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Pn,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Attention"}),r.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["Le solde actuel de ",se(i)," sera remis à zéro. Un mouvement de caisse sera enregistré pour tracer cette opération."]})]})]})}),r.jsx("div",{className:"space-y-4 mb-6",children:r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Raison de la réinitialisation *"}),r.jsx("textarea",{value:y,onChange:q=>P(q.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Ex: Clôture de journée, correction d'erreur...",required:!0})]})}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(O,{variant:"ghost",onClick:()=>x(!1),children:"Annuler"}),r.jsx(O,{variant:"danger",onClick:be,disabled:!y.trim(),children:"Réinitialiser"})]})]})}),I&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-md",padding:"lg",children:r.jsx(E1,{onStoreSelect:q=>{w(q),E(!1),re()},selectedStore:g,onClose:()=>E(!1)})})})]}):r.jsxs(G,{className:"max-w-md mx-auto",padding:"lg",children:[r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(cs,{className:"w-8 h-8 text-blue-600"})}),r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Ouverture de Caisse"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Sélectionnez un magasin et saisissez le montant d'ouverture"})]}),r.jsxs("div",{className:"space-y-4",children:[ee.length>0?r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Magasin *"}),r.jsxs("select",{value:g,onChange:q=>w(q.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"",children:"Sélectionner un magasin"}),ee.map(q=>r.jsxs("option",{value:q.id,children:[q.name," ",q.isMainStore?"(Principal)":""]},q.id))]})]}):r.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Pn,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Aucun magasin disponible"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:`Veuillez créer au moins un magasin dans la section "Magasins" avant d'ouvrir une caisse.`})]})]})}),r.jsx(fe,{label:"Montant d'ouverture (Ar)",type:"number",value:s,onChange:q=>n(Number(q.target.value)),leftIcon:r.jsx(kt,{className:"w-4 h-4"}),placeholder:"100000"}),r.jsxs(O,{fullWidth:!0,onClick:U,disabled:!g||ee.length===0,children:[r.jsx(lv,{className:"w-4 h-4 mr-2"}),"Ouvrir la caisse"]})]})]})},ED=()=>{const[t,e]=A.useState("today"),[s,n]=A.useState({start:new Date().toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[i,a]=A.useState("sales"),[o,l]=A.useState(!1),[d,u]=A.useState(!1),[m,h]=A.useState({totalSales:0,totalExpenses:0,netProfit:0,transactions:0,salesByProduct:[],salesByCategory:[],salesByPaymentMethod:[]}),[f,x]=A.useState(!1),{user:y}=Le();A.useEffect(()=>{(async()=>{if(y!=null&&y.establishmentId){l(!0),u(!1);try{let g,w;if(f)g=new Date(s.start),g.setHours(0,0,0,0),w=new Date(s.end),w.setHours(23,59,59,999);else{const ue=new Date;switch(w=new Date(ue),w.setHours(23,59,59,999),t){case"today":g=new Date(ue),g.setHours(0,0,0,0);break;case"yesterday":g=new Date(ue),g.setDate(g.getDate()-1),g.setHours(0,0,0,0),w=new Date(g),w.setHours(23,59,59,999);break;case"week":g=new Date(ue),g.setDate(g.getDate()-7),g.setHours(0,0,0,0);break;case"month":g=new Date(ue),g.setMonth(g.getMonth()-1),g.setHours(0,0,0,0);break;case"year":g=new Date(ue),g.setFullYear(g.getFullYear()-1),g.setHours(0,0,0,0);break;default:g=new Date(ue),g.setHours(0,0,0,0)}}let I=[],E=0,ee=0;try{const ue=Ne(je(H,"sales"),oe("establishmentId","==",y.establishmentId),oe("status","==","completed"),oe("createdAt",">=",J.fromDate(g)),oe("createdAt","<=",J.fromDate(w)));I=(await _e(ue)).docs.map(ye=>ye.data()),E=I.reduce((ye,$)=>ye+$.total,0),ee=I.length}catch(ue){if(ue.code==="failed-precondition"&&ue.message.includes("index")){u(!0),console.warn("Index composite requis pour les ventes. Chargement des données alternatives...");const we=Ne(je(H,"sales"),oe("establishmentId","==",y.establishmentId)),ye=await _e(we),$=J.fromDate(g),q=J.fromDate(w);I=ye.docs.map(he=>he.data()).filter(he=>he.status==="completed"&&he.createdAt&&he.createdAt.toMillis()>=$.toMillis()&&he.createdAt.toMillis()<=q.toMillis()),E=I.reduce((he,Ae)=>he+Ae.total,0),ee=I.length}else throw ue}let V=[],F=0;try{const ue=Ne(je(H,"expenses"),oe("establishmentId","==",y.establishmentId),oe("status","==","paid"),oe("createdAt",">=",J.fromDate(g)),oe("createdAt","<=",J.fromDate(w)));V=(await _e(ue)).docs.map(ye=>ye.data()),F=V.reduce((ye,$)=>ye+$.amount,0)}catch(ue){if(ue.code==="failed-precondition"&&ue.message.includes("index")){console.warn("Index composite requis pour les dépenses. Chargement des données alternatives...");const we=Ne(je(H,"expenses"),oe("establishmentId","==",y.establishmentId)),ye=await _e(we),$=J.fromDate(g),q=J.fromDate(w);V=ye.docs.map(he=>he.data()).filter(he=>he.status==="paid"&&he.createdAt&&he.createdAt.toMillis()>=$.toMillis()&&he.createdAt.toMillis()<=q.toMillis()),F=V.reduce((he,Ae)=>he+Ae.amount,0)}else throw ue}const X={},W=Ne(je(H,"products"),oe("establishmentId","==",y.establishmentId)),Z=(await _e(W)).docs.reduce((ue,we)=>{const ye=we.data();return ue[we.id]={name:ye.name,purchasePrice:ye.purchasePrice||0,salePrice:ye.salePrice||0},ue},{});for(const ue of I)if(ue.items&&Array.isArray(ue.items))for(const we of ue.items){const ye=we.productId;X[ye]||(X[ye]={productId:ye,productName:we.productName,quantity:0,totalSales:0,costPrice:0,margin:0,marginPercentage:0}),X[ye].quantity+=we.quantity,X[ye].totalSales+=we.total;const $=Z[ye];if($){const q=$.purchasePrice*we.quantity;X[ye].costPrice+=q}}Object.values(X).forEach(ue=>{ue.margin=ue.totalSales-ue.costPrice,ue.costPrice>0&&(ue.marginPercentage=ue.margin/ue.costPrice*100)});const se=Object.values(X).sort((ue,we)=>we.totalSales-ue.totalSales),Y=se.reduce((ue,we)=>ue+we.margin,0),U={};for(const ue of I){const we=ue.paymentMethod||"unknown";U[we]||(U[we]={method:we,amount:0,count:0}),U[we].amount+=ue.total,U[we].count+=1}const K=Object.values(U).sort((ue,we)=>we.amount-ue.amount),de={},ne=Ne(je(H,"categories"),oe("establishmentId","==",y.establishmentId)),ke=(await _e(ne)).docs.reduce((ue,we)=>(ue[we.id]=we.data().name,ue),{});for(const ue of I)if(ue.items&&Array.isArray(ue.items))for(const we of ue.items){const ye=Z[we.productId];if(ye&&ye.categoryId){const $=ye.categoryId,q=ke[$]||"Autre";de[$]||(de[$]={category:q,amount:0,count:0}),de[$].amount+=we.total,de[$].count+=we.quantity}}const Fe=Object.values(de).sort((ue,we)=>we.amount-ue.amount);h({totalSales:E,totalExpenses:F,netProfit:Y-F,transactions:ee,salesByProduct:se,salesByCategory:Fe,salesByPaymentMethod:K,startDate:g,endDate:w})}catch(g){console.error("Erreur lors du chargement des données du rapport:",g),L.error("Erreur lors du chargement des données du rapport")}finally{l(!1)}}})()},[y==null?void 0:y.establishmentId,t,f,s]);const P=N=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(N).replace("MGA","Ar"),_=N=>N.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),C=()=>{if(f)return s.start===s.end?`le ${_(new Date(s.start))}`:`du ${_(new Date(s.start))} au ${_(new Date(s.end))}`;switch(t){case"today":return"aujourd'hui";case"yesterday":return"hier";case"week":return"cette semaine";case"month":return"ce mois";case"year":return"cette année";default:return t}},k=(N,g)=>{n(w=>({...w,[N]:g}))},T=()=>{if(x(!f),!f){const N=new Date().toISOString().split("T")[0];n({start:N,end:N})}},S=N=>{let g="",w="";const I=new Date().toISOString().split("T")[0];N==="sales"?(w=`rapport_ventes_${I}.csv`,g=`data:text/csv;charset=utf-8,Produit,Quantité,Ventes Totales,Coût,Marge,Marge (%)
`+m.salesByProduct.map(V=>`"${V.productName}",${V.quantity},${V.totalSales},${V.costPrice},${V.margin},${V.marginPercentage.toFixed(2)}`).join(`
`)):N==="categories"?(w=`rapport_categories_${I}.csv`,g=`data:text/csv;charset=utf-8,Catégorie,Montant,Nombre de ventes
`+m.salesByCategory.map(V=>`"${V.category}",${V.amount},${V.count}`).join(`
`)):N==="payment"?(w=`rapport_paiements_${I}.csv`,g=`data:text/csv;charset=utf-8,Méthode de paiement,Montant,Nombre de transactions
`+m.salesByPaymentMethod.map(V=>`"${V.method}",${V.amount},${V.count}`).join(`
`)):(w=`rapport_complet_${I}.csv`,g=`data:text/csv;charset=utf-8,Période,Ventes Totales,Dépenses Totales,Bénéfice Net,Transactions
"${C()}",${m.totalSales},${m.totalExpenses},${m.netProfit},${m.transactions}`);const E=encodeURI(g),ee=document.createElement("a");ee.setAttribute("href",E),ee.setAttribute("download",w),document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),L.success("Rapport exporté avec succès")},D=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Récapitulatif des ventes ",C()]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ventes"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Coût"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Marge"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Marge (%)"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.salesByProduct.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"Aucune vente pour cette période"})}):m.salesByProduct.map((N,g)=>r.jsxs("tr",{className:g%2===0?"bg-white":"bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:N.productName}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:N.quantity}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:P(N.totalSales)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:P(N.costPrice)}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium",children:r.jsx("span",{className:N.margin>=0?"text-green-600":"text-red-600",children:P(N.margin)})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:r.jsxs("span",{className:`font-medium ${N.marginPercentage>=30?"text-green-600":N.marginPercentage>=15?"text-yellow-600":"text-red-600"}`,children:[N.marginPercentage.toFixed(1),"%"]})})]},N.productId))}),m.salesByProduct.length>0&&r.jsx("tfoot",{className:"bg-gray-100",children:r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-3 text-left text-sm font-bold text-gray-900",children:"Total"}),r.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:m.salesByProduct.reduce((N,g)=>N+g.quantity,0)}),r.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:P(m.totalSales)}),r.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:P(m.salesByProduct.reduce((N,g)=>N+g.costPrice,0))}),r.jsx("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:P(m.salesByProduct.reduce((N,g)=>N+g.margin,0))}),r.jsxs("td",{className:"px-6 py-3 text-right text-sm font-bold text-gray-900",children:[(m.salesByProduct.reduce((N,g)=>N+g.margin,0)/m.salesByProduct.reduce((N,g)=>N+g.costPrice,0)*100).toFixed(1),"%"]})]})})]})})]}),r.jsx("div",{className:"flex justify-end",children:r.jsxs(O,{onClick:()=>S("sales"),children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]}),R=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Ventes par catégorie ",C()]}),m.salesByCategory.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Wd,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"Aucune vente par catégorie pour cette période"})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Catégorie"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pourcentage"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.salesByCategory.map((N,g)=>r.jsxs("tr",{className:g%2===0?"bg-white":"bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:N.category}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:P(N.amount)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:[(N.amount/m.totalSales*100).toFixed(1),"%"]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:N.count})]},g))})]})}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Répartition graphique"}),r.jsx("div",{className:"space-y-4",children:m.salesByCategory.map((N,g)=>{const w=N.amount/m.totalSales*100,I=["blue","green","purple","orange","red","yellow","indigo","pink"],E=I[g%I.length];return r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:N.category}),r.jsxs("div",{className:"text-right",children:[r.jsx("span",{className:"font-semibold",children:P(N.amount)}),r.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",w.toFixed(1),"%)"]})]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:r.jsx("div",{className:`h-2.5 rounded-full bg-${E}-500`,style:{width:`${w}%`}})})]},g)})})]})]})]}),r.jsx("div",{className:"flex justify-end",children:r.jsxs(O,{onClick:()=>S("categories"),children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]}),v=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Répartition des paiements ",C()]}),m.salesByPaymentMethod.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Hs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500",children:"Aucun paiement pour cette période"})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Méthode"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pourcentage"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transactions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.salesByPaymentMethod.map((N,g)=>{const w=N.method==="cash"?"Espèces":N.method==="card"?"Carte bancaire":N.method==="mvola"?"MVola":N.method==="orange_money"?"Orange Money":N.method==="airtel_money"?"Airtel Money":N.method;return r.jsxs("tr",{className:g%2===0?"bg-white":"bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:w}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right font-medium",children:P(N.amount)}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:[(N.amount/m.totalSales*100).toFixed(1),"%"]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right",children:N.count})]},g)})})]})}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Répartition graphique"}),r.jsx("div",{className:"space-y-4",children:m.salesByPaymentMethod.map((N,g)=>{const w=N.amount/m.totalSales*100,I=["blue","green","red","orange","purple"],E=I[g%I.length],ee=N.method==="cash"?"Espèces":N.method==="card"?"Carte bancaire":N.method==="mvola"?"MVola":N.method==="orange_money"?"Orange Money":N.method==="airtel_money"?"Airtel Money":N.method;return r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"text-sm font-medium text-gray-700",children:ee}),r.jsxs("div",{className:"text-right",children:[r.jsx("span",{className:"font-semibold",children:P(N.amount)}),r.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",w.toFixed(1),"%)"]})]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:r.jsx("div",{className:`h-2.5 rounded-full bg-${E}-500`,style:{width:`${w}%`}})})]},g)})})]})]})]}),r.jsx("div",{className:"flex justify-end",children:r.jsxs(O,{onClick:()=>S("payment"),children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]}),b=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Résumé financier ",C()]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(or,{className:"w-6 h-6 text-green-600 mr-2"}),r.jsx("h4",{className:"text-lg font-medium text-green-800",children:"Recettes totales"})]}),r.jsx("p",{className:"text-3xl font-bold text-green-700",children:P(m.totalSales)}),r.jsxs("p",{className:"text-sm text-green-600 mt-2",children:[m.transactions," transaction(s)"]})]}),r.jsxs("div",{className:"bg-red-50 p-6 rounded-lg border border-red-200",children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(Ni,{className:"w-6 h-6 text-red-600 mr-2"}),r.jsx("h4",{className:"text-lg font-medium text-red-800",children:"Dépenses totales"})]}),r.jsx("p",{className:"text-3xl font-bold text-red-700",children:P(m.totalExpenses)})]}),r.jsxs("div",{className:`p-6 rounded-lg border ${m.netProfit>=0?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200"}`,children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx(kt,{className:`w-6 h-6 ${m.netProfit>=0?"text-blue-600":"text-orange-600"} mr-2`}),r.jsx("h4",{className:`text-lg font-medium ${m.netProfit>=0?"text-blue-800":"text-orange-800"}`,children:m.netProfit>=0?"Bénéfice net":"Perte nette"})]}),r.jsx("p",{className:`text-3xl font-bold ${m.netProfit>=0?"text-blue-700":"text-orange-700"}`,children:P(Math.abs(m.netProfit))}),m.totalSales>0&&r.jsxs("p",{className:`text-sm ${m.netProfit>=0?"text-blue-600":"text-orange-600"} mt-2`,children:[(m.netProfit/m.totalSales*100).toFixed(1),"% des recettes"]})]})]}),r.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[r.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Répartition recettes/dépenses"}),r.jsxs("div",{className:"relative pt-1",children:[r.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[r.jsx("div",{children:r.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200",children:"Recettes"})}),r.jsx("div",{className:"text-right",children:r.jsx("span",{className:"text-xs font-semibold inline-block text-green-600",children:P(m.totalSales)})})]}),r.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200",children:r.jsx("div",{style:{width:"100%"},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500"})}),r.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[r.jsx("div",{children:r.jsx("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-red-600 bg-red-200",children:"Dépenses"})}),r.jsx("div",{className:"text-right",children:r.jsx("span",{className:"text-xs font-semibold inline-block text-red-600",children:P(m.totalExpenses)})})]}),r.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200",children:r.jsx("div",{style:{width:`${m.totalSales>0?m.totalExpenses/m.totalSales*100:0}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-500"})}),r.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[r.jsx("div",{children:r.jsx("span",{className:`text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full ${m.netProfit>=0?"text-blue-600 bg-blue-200":"text-orange-600 bg-orange-200"}`,children:m.netProfit>=0?"Bénéfice":"Perte"})}),r.jsx("div",{className:"text-right",children:r.jsx("span",{className:`text-xs font-semibold inline-block ${m.netProfit>=0?"text-blue-600":"text-orange-600"}`,children:P(Math.abs(m.netProfit))})})]}),r.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200",children:r.jsx("div",{style:{width:`${m.totalSales>0?Math.abs(m.netProfit)/m.totalSales*100:0}%`},className:`shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center ${m.netProfit>=0?"bg-blue-500":"bg-orange-500"}`})})]})]})]}),r.jsx("div",{className:"flex justify-end",children:r.jsxs(O,{onClick:()=>S("complete"),children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter ce rapport"]})})]});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Rapports & Analytics"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Analysez les performances de votre établissement"})]}),r.jsxs("div",{className:"flex flex-wrap gap-3",children:[r.jsxs(O,{variant:f?"primary":"outline",onClick:T,children:[r.jsx(ut,{className:"w-4 h-4 mr-2"}),f?"Masquer date personnalisée":"Date personnalisée"]}),r.jsxs(O,{onClick:()=>S("complete"),children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),f?r.jsx(G,{children:r.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de début"}),r.jsx("input",{type:"date",value:s.start,onChange:N=>k("start",N.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de fin"}),r.jsx("input",{type:"date",value:s.end,onChange:N=>k("end",N.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),r.jsx(O,{variant:"ghost",onClick:()=>{const N=new Date().toISOString().split("T")[0];n({start:N,end:N})},children:"Aujourd'hui"})]})}):r.jsx(G,{children:r.jsx("div",{className:"flex flex-wrap gap-2",children:["today","yesterday","week","month","year"].map(N=>r.jsx("button",{onClick:()=>e(N),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${t===N?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:N==="today"?"Aujourd'hui":N==="yesterday"?"Hier":N==="week"?"Cette semaine":N==="month"?"Ce mois":"Cette année"},N))})}),r.jsx(G,{children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("button",{onClick:()=>a("financial"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="financial"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(kt,{className:"w-4 h-4 inline mr-1"}),"Résumé financier"]}),r.jsxs("button",{onClick:()=>a("sales"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="sales"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(br,{className:"w-4 h-4 inline mr-1"}),"Ventes par produit"]}),r.jsxs("button",{onClick:()=>a("categories"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="categories"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(Wd,{className:"w-4 h-4 inline mr-1"}),"Ventes par catégorie"]}),r.jsxs("button",{onClick:()=>a("payment"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="payment"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r.jsx(Hs,{className:"w-4 h-4 inline mr-1"}),"Méthodes de paiement"]})]})}),d&&r.jsx(fg,{indexUrl:"https://console.firebase.google.com/v1/r/project/saas-915ec/firestore/indexes?create_composite=Ckhwcm9qZWN0cy9zYWFzLTkxNWVjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9zYWxlcy9pbmRleGVzL18QARoTCg9lc3RhYmxpc2htZW50SWQQARoKCgZzdGF0dXMQARoNCgljcmVhdGVkQXQQAhoMCghfX25hbWVfXxAC",title:"Index de base de données requis pour les rapports",description:"Pour des performances optimales, un index composite doit être créé dans Firebase. Les données sont actuellement chargées avec une méthode alternative qui peut être plus lente."}),o?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx(qs,{className:"w-12 h-12 text-blue-500 animate-spin mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Chargement des données..."}),r.jsx("p",{className:"text-gray-500",children:"Veuillez patienter pendant que nous générons votre rapport"})]})}):r.jsxs(r.Fragment,{children:[i==="financial"&&b(),i==="sales"&&D(),i==="categories"&&R(),i==="payment"&&v()]})]})},AD=()=>{const[t,e]=A.useState(!1),[s,n]=A.useState(null),[i,a]=A.useState(!1),[o,l]=A.useState(""),[d,u]=A.useState(null),[m,h]=A.useState({sales:0,expenses:0,customers:0,products:0}),[f,x]=A.useState(!1),{user:y}=Le(),P=()=>(y==null?void 0:y.role)==="admin",_=()=>y!=null&&y.email?as.isDemoEmail(y.email):!1,C=async()=>{if(y!=null&&y.establishmentId){x(!0);try{const E=["sales","expenses","customers","products"],ee={sales:0,expenses:0,customers:0,products:0};for(const V of E){const F=Ne(je(H,V),oe("establishmentId","==",y.establishmentId)),X=await _e(F);ee[V]=X.size}h(ee)}catch(E){console.error("Erreur lors du chargement des statistiques:",E)}finally{x(!1)}}};A.useEffect(()=>{P()&&C()},[y==null?void 0:y.establishmentId]);const k=E=>E==="admin123",T=(E,ee)=>{if(!P()){L.error("Accès refusé : Seuls les administrateurs peuvent effectuer cette action");return}if(_()){L.error("Les comptes de démonstration ne peuvent pas effectuer cette action");return}u({type:E,action:ee}),a(!0),l("")},S=()=>{if(!k(o)){L.error("Mot de passe administrateur incorrect"),l("");return}d&&(a(!1),n(d.type),u(null),l(""))},D=async E=>{if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}if(_()){L.error("Les comptes de démonstration ne peuvent pas supprimer des données");return}e(!0);try{const ee=Ne(je(H,E),oe("establishmentId","==",y.establishmentId)),V=await _e(ee);if(V.empty){L.info(`Aucune donnée ${v(E)} à supprimer`),e(!1);return}const F=Jy(H);V.docs.forEach(X=>{F.delete(X.ref)}),await F.commit(),await C(),L.success(`Toutes les données ${v(E)} ont été supprimées`),n(null)}catch(ee){console.error(`Erreur lors de la suppression des ${E}:`,ee),L.error(`Erreur lors de la suppression des ${v(E)}`)}finally{e(!1)}},R=async()=>{if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}if(_()){L.error("Les comptes de démonstration ne peuvent pas supprimer des données");return}e(!0);try{const E=["sales","expenses","customers","products"];let ee=0;for(const V of E){const F=Ne(je(H,V),oe("establishmentId","==",y.establishmentId)),X=await _e(F);if(!X.empty){const W=Jy(H);X.docs.forEach(re=>{W.delete(re.ref)}),await W.commit(),ee+=X.size}}await C(),L.success(`${ee} éléments supprimés avec succès`),n(null)}catch(E){console.error("Erreur lors de la suppression complète:",E),L.error("Erreur lors de la suppression des données")}finally{e(!1)}},v=E=>({sales:"de ventes",expenses:"de dépenses",customers:"de clients",products:"de produits"})[E]||E,b=E=>({sales:r.jsx(ds,{className:"w-5 h-5"}),expenses:r.jsx(Ni,{className:"w-5 h-5"}),customers:r.jsx(Ke,{className:"w-5 h-5"}),products:r.jsx(ht,{className:"w-5 h-5"})})[E]||r.jsx(Mo,{className:"w-5 h-5"}),N=E=>({sales:"text-green-600 bg-green-50 border-green-200",expenses:"text-red-600 bg-red-50 border-red-200",customers:"text-blue-600 bg-blue-50 border-blue-200",products:"text-purple-600 bg-purple-50 border-purple-200"})[E]||"text-gray-600 bg-gray-50 border-gray-200",g=()=>r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-md",padding:"lg",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Or,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Authentification Administrateur"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Cette action nécessite une authentification administrateur. Veuillez saisir votre mot de passe pour continuer."}),r.jsx("div",{className:"mb-6",children:r.jsx("input",{type:"password",value:o,onChange:E=>l(E.target.value),placeholder:"Mot de passe administrateur",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",onKeyPress:E=>E.key==="Enter"&&S(),autoFocus:!0})}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-6",children:r.jsx("p",{className:"text-sm text-gray-700",children:"Veuillez saisir votre mot de passe administrateur pour confirmer cette action."})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>{a(!1),u(null),l("")},children:"Annuler"}),r.jsx(O,{variant:"danger",fullWidth:!0,onClick:S,disabled:!o.trim(),children:"Confirmer"})]})]})})}),w=({dataType:E,onConfirm:ee,onCancel:V})=>r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-md",padding:"lg",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Oe,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Confirmer la suppression"}),r.jsx("p",{className:"text-gray-600 mb-6",children:E==="all"?"Êtes-vous sûr de vouloir supprimer TOUTES les données ? Cette action est irréversible.":`Êtes-vous sûr de vouloir supprimer toutes les données ${v(E)} ? Cette action est irréversible.`}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Xe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-yellow-800",children:[r.jsx("p",{className:"font-medium",children:"⚠️ Attention :"}),r.jsxs("ul",{className:"mt-2 space-y-1 text-left",children:[r.jsx("li",{children:"• Cette action ne peut pas être annulée"}),r.jsx("li",{children:"• Toutes les données seront définitivement perdues"}),r.jsx("li",{children:"• Assurez-vous d'avoir une sauvegarde si nécessaire"})]})]})]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(O,{variant:"ghost",fullWidth:!0,onClick:V,disabled:t,children:"Annuler"}),r.jsx(O,{variant:"danger",fullWidth:!0,onClick:ee,disabled:t,children:t?"Suppression...":"Supprimer définitivement"})]})]})})}),I=()=>r.jsxs("div",{className:"space-y-6",children:[r.jsx(G,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:r.jsx(s6,{className:"w-10 h-10 text-red-600"})}),r.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Accès Restreint"}),r.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:'La gestion des données est réservée aux administrateurs. Seuls les utilisateurs avec le rôle "Administrateur" peuvent accéder à cette section.'}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Xe,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-blue-800 text-left",children:[r.jsx("p",{className:"font-medium",children:"Votre rôle actuel :"}),r.jsx("p",{className:"mt-1",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(y==null?void 0:y.role)==="manager"?"bg-blue-100 text-blue-800":(y==null?void 0:y.role)==="cashier"?"bg-green-100 text-green-800":(y==null?void 0:y.role)==="reader"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:(y==null?void 0:y.role)==="manager"?"Gérant":(y==null?void 0:y.role)==="cashier"?"Caissier":(y==null?void 0:y.role)==="reader"?"Lecteur":(y==null?void 0:y.role)||"Utilisateur"})})]})]})}),r.jsx("div",{className:"mt-8",children:r.jsx("p",{className:"text-sm text-gray-500",children:"Contactez votre administrateur pour obtenir l'accès à cette fonctionnalité."})})]})}),r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[r.jsx(cs,{className:"w-5 h-5 mr-2"}),"Permissions par rôle"]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 border border-red-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Xe,{className:"w-5 h-5 text-red-600 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-red-900",children:"Administrateur"}),r.jsx("p",{className:"text-sm text-red-700",children:"Accès complet à la gestion des données"})]})]}),r.jsx("span",{className:"text-green-600",children:"✓"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ke,{className:"w-5 h-5 text-blue-600 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Gérant"}),r.jsx("p",{className:"text-sm text-gray-700",children:"Accès en lecture seule aux statistiques"})]})]}),r.jsx("span",{className:"text-red-600",children:"✗"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(kt,{className:"w-5 h-5 text-green-600 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Caissier"}),r.jsx("p",{className:"text-sm text-gray-700",children:"Aucun accès à la gestion des données"})]})]}),r.jsx("span",{className:"text-red-600",children:"✗"})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Mo,{className:"w-5 h-5 text-purple-600 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Lecteur"}),r.jsx("p",{className:"text-sm text-gray-700",children:"Aucun accès à la gestion des données"})]})]}),r.jsx("span",{className:"text-red-600",children:"✗"})]})]})]})]});return P()?r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Xe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsxs("h4",{className:"text-sm font-medium text-red-800 flex items-center",children:["Zone Sécurisée - Administrateur Uniquement",r.jsx(cs,{className:"w-4 h-4 ml-2"})]}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Ces actions nécessitent une double authentification et suppriment définitivement vos données. Utilisez avec précaution."})]})]})}),r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[r.jsx(Mo,{className:"w-5 h-5 mr-2"}),"État actuel des données"]}),f?r.jsxs("div",{className:"text-center py-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Chargement des statistiques..."})]}):r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(m).map(([E,ee])=>r.jsx("div",{className:`p-4 rounded-lg border ${N(E)}`,children:r.jsxs("div",{className:"flex items-center",children:[b(E),r.jsxs("div",{className:"ml-3",children:[r.jsx("p",{className:"text-sm font-medium capitalize",children:E==="sales"?"Ventes":E==="expenses"?"Dépenses":E==="customers"?"Clients":"Produits"}),r.jsx("p",{className:"text-2xl font-bold",children:ee})]})]})},E))}),r.jsx("div",{className:"mt-4 flex justify-end",children:r.jsxs(O,{variant:"ghost",size:"sm",onClick:C,disabled:f,children:[r.jsx(qs,{className:"w-4 h-4 mr-2"}),"Actualiser"]})})]}),_()&&r.jsx(G,{className:"bg-red-50 border-red-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(cs,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Restriction pour les comptes de démonstration"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Les comptes de démonstration ne peuvent pas supprimer de données. Cette restriction est en place pour protéger l'environnement de démonstration."})]})]})}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Suppression par type de données"}),r.jsx("div",{className:"space-y-4",children:Object.entries(m).map(([E,ee])=>r.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center",children:[b(E),r.jsxs("div",{className:"ml-3",children:[r.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:E==="sales"?"Ventes":E==="expenses"?"Dépenses":E==="customers"?"Clients":"Produits"}),r.jsxs("p",{className:"text-sm text-gray-600",children:[ee," élément",ee>1?"s":""," dans la base"]})]})]}),r.jsxs(O,{variant:"danger",size:"sm",onClick:()=>T(E,()=>D(E)),disabled:ee===0||t||_(),className:_()?"opacity-50 cursor-not-allowed":"",children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),r.jsx(cs,{className:"w-3 h-3 mr-1"}),"Supprimer tout"]})]},E))})]}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4 text-red-600",children:"Suppression complète"}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Action irréversible"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Cette action supprimera TOUTES vos données : ventes, dépenses, clients et produits. Seuls votre compte utilisateur et les paramètres de l'établissement seront conservés."})]})]})}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Remise à zéro complète"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Supprime toutes les données commerciales pour repartir à zéro"})]}),r.jsxs(O,{variant:"danger",onClick:()=>T("all",R),disabled:Object.values(m).every(E=>E===0)||t||_(),className:_()?"opacity-50 cursor-not-allowed":"",children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),r.jsx(cs,{className:"w-3 h-3 mr-1"}),"Tout supprimer"]})]})]}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"💡 Recommandations de sécurité"}),r.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[r.jsxs("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),r.jsxs("p",{children:[r.jsx("strong",{children:"Double authentification :"})," Chaque action nécessite votre mot de passe administrateur."]})]}),r.jsxs("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),r.jsxs("p",{children:[r.jsx("strong",{children:"Accès restreint :"})," Seuls les administrateurs peuvent accéder à cette section."]})]}),r.jsxs("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),r.jsxs("p",{children:[r.jsx("strong",{children:"Avant de supprimer :"})," Exportez vos données importantes depuis les sections Ventes, Dépenses, etc."]})]}),r.jsxs("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),r.jsxs("p",{children:[r.jsx("strong",{children:"Données conservées :"})," Votre compte, paramètres d'établissement et catégories restent intacts."]})]}),r.jsxs("div",{className:"flex items-start",children:[r.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),r.jsxs("p",{children:[r.jsx("strong",{children:"Alternative :"})," Créez un nouvel établissement si vous voulez conserver les données actuelles."]})]})]})]}),i&&r.jsx(g,{}),s&&r.jsx(w,{dataType:s,onConfirm:()=>{s==="all"?R():D(s)},onCancel:()=>n(null)})]}):r.jsx(I,{})},ID=({users:t,onUsersUpdate:e})=>{const[s,n]=A.useState(null),[i,a]=A.useState(""),[o,l]=A.useState(""),[d,u]=A.useState(!1),[m,h]=A.useState(!1),[f,x]=A.useState(!1),[y,P]=A.useState(!1),[_,C]=A.useState(""),{user:k}=Le(),T=I=>{n(I),a(I.email),l(""),x(!1),I.id===(k==null?void 0:k.id)&&h(!0)},S=I=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I),D=async()=>{if(!s||!i.trim()){L.error("Email requis");return}if(!S(i)){L.error("Format d'email invalide");return}if(i===s.email){L.error("Le nouvel email doit être différent de l'actuel");return}if(s.id===(k==null?void 0:k.id)&&!o.trim()){L.error("Mot de passe requis pour modifier votre propre email");return}u(!0);try{if(s.id===(k==null?void 0:k.id)&&We.currentUser)try{const I=ki.credential(s.email,o);await AC(We.currentUser,I),await kC(We.currentUser,i),L.success("Email de vérification envoyé ! Vérifiez votre nouvelle adresse email pour confirmer le changement."),x(!0)}catch(I){console.error("Erreur Firebase Auth:",I);let E="Erreur lors de la mise à jour";switch(I.code){case"auth/email-already-in-use":E="Cette adresse email est déjà utilisée par un autre compte";break;case"auth/invalid-email":E="Format d'email invalide";break;case"auth/wrong-password":E="Mot de passe incorrect. Veuillez vérifier votre mot de passe actuel.";break;case"auth/invalid-credential":E="Mot de passe incorrect. Veuillez vérifier votre mot de passe actuel.";break;case"auth/requires-recent-login":E="Pour des raisons de sécurité, veuillez vous reconnecter avant de modifier votre email";break;case"auth/operation-not-allowed":E="Cette opération n'est pas autorisée. Contactez l'administrateur.";break;case"auth/too-many-requests":E="Trop de tentatives. Veuillez attendre quelques minutes avant de réessayer.";break;default:E=I.message||"Erreur inconnue lors de la mise à jour de l'email"}L.error(E),u(!1);return}(s.id!==(k==null?void 0:k.id)||f)&&(await pt(me(H,"users",s.id),{email:i,updatedAt:J.now(),...s.id===(k==null?void 0:k.id)&&{emailVerified:!1}}),await e(),s.id!==(k==null?void 0:k.id)&&(L.success("Email mis à jour avec succès. L'utilisateur devra se reconnecter avec sa nouvelle adresse."),n(null),h(!1),l("")))}catch(I){console.error("Erreur lors de la mise à jour de l'email:",I),L.error("Erreur lors de la mise à jour de l'email")}finally{u(!1)}},R=()=>{n(null),h(!1),l(""),x(!1)},v=async I=>{if(I.preventDefault(),!_.trim()){L.error("Veuillez saisir une adresse email");return}if(!S(_)){L.error("Format d'email invalide");return}u(!0);try{const E={url:window.location.origin+"/login",handleCodeInApp:!1};await Nf(We,_,E),console.log(`Email de réinitialisation envoyé à: ${_}`),L.success("Email de réinitialisation envoyé ! Vérifiez votre boîte de réception et vos spams."),P(!1),C("")}catch(E){console.error("Erreur lors de l'envoi de l'email de réinitialisation:",E);let ee="Erreur lors de l'envoi de l'email";switch(E.code){case"auth/user-not-found":ee="Aucun compte trouvé avec cette adresse email";break;case"auth/invalid-email":ee="Format d'email invalide";break;case"auth/too-many-requests":ee="Trop de tentatives. Veuillez réessayer plus tard.";break;default:ee=E.message||"Erreur lors de l'envoi de l'email"}L.error(ee)}finally{u(!1)}},b=()=>t.filter(I=>I.email.includes("@saaspos.mg")),N=()=>t.filter(I=>!I.email.includes("@saaspos.mg")),g=b(),w=N();return r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[r.jsx(It,{className:"w-5 h-5 mr-2"}),"Gestion des adresses email"]}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Lt,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Comment modifier les emails"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsx("p",{children:`• Cliquez sur "Modifier" à côté de l'email à changer`}),r.jsx("p",{children:"• Saisissez votre vraie adresse email"}),r.jsx("p",{children:"• Pour votre propre compte, vous devrez confirmer votre mot de passe"}),r.jsx("p",{children:"• Un email de vérification sera envoyé à la nouvelle adresse"}),r.jsx("p",{children:"• Vous devrez cliquer sur le lien de vérification pour finaliser le changement"})]})]})]})}),r.jsxs("div",{className:"mt-4",children:[r.jsxs(O,{onClick:()=>P(!0),variant:"ghost",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[r.jsx(Or,{className:"w-4 h-4 mr-2"}),"Réinitialiser un mot de passe"]}),r.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Envoyez un email de réinitialisation à n'importe quelle adresse email"})]})]}),g.length>0&&r.jsxs(G,{children:[r.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center",children:[r.jsx(Oe,{className:"w-5 h-5 mr-2 text-orange-600"}),"Comptes avec emails de démonstration (",g.length,")"]}),r.jsx("div",{className:"space-y-3",children:g.map(I=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:r.jsx(Ke,{className:"w-5 h-5 text-orange-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:I.name}),r.jsx("p",{className:"text-sm text-orange-700 font-mono",children:I.email}),r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800",children:I.role==="admin"?"Administrateur":I.role==="manager"?"Gérant":I.role==="cashier"?"Caissier":"Lecteur"})]})]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>T(I),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-100",children:[r.jsx(wr,{className:"w-4 h-4 mr-2"}),"Modifier"]})]},I.id))})]}),w.length>0&&r.jsxs(G,{children:[r.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-4 flex items-center",children:[r.jsx(Lt,{className:"w-5 h-5 mr-2 text-green-600"}),"Comptes avec vraies adresses email (",w.length,")"]}),r.jsx("div",{className:"space-y-3",children:w.map(I=>r.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:r.jsx(Ke,{className:"w-5 h-5 text-green-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:I.name}),r.jsx("p",{className:"text-sm text-green-700 font-mono",children:I.email}),r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:I.role==="admin"?"Administrateur":I.role==="manager"?"Gérant":I.role==="cashier"?"Caissier":"Lecteur"})]})]}),r.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>T(I),className:"text-green-600 hover:text-green-700 hover:bg-green-100",children:[r.jsx(wr,{className:"w-4 h-4 mr-2"}),"Modifier"]})]},I.id))})]}),s&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(It,{className:"w-5 h-5 mr-2"}),"Modifier l'email"]}),r.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:r.jsx(Ke,{className:"w-5 h-5 text-blue-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:s.name}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Email actuel: ",s.email]})]})]})}),f?r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Lt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Email de vérification envoyé !"}),r.jsxs("div",{className:"text-sm text-green-700 mt-1 space-y-1",children:[r.jsxs("p",{children:["Un email de vérification a été envoyé à ",r.jsx("strong",{children:i})]}),r.jsx("p",{children:"Cliquez sur le lien dans l'email pour confirmer le changement d'adresse."}),r.jsx("p",{children:"Votre email actuel restera actif jusqu'à la vérification."})]})]})]})}):r.jsxs(r.Fragment,{children:[r.jsx(fe,{label:"Nouvelle adresse email",type:"email",value:i,onChange:I=>a(I.target.value),placeholder:"votre@vraiemail.com",leftIcon:r.jsx(It,{className:"w-4 h-4"}),disabled:d}),m&&s.id===(k==null?void 0:k.id)&&r.jsxs("div",{children:[r.jsx(fe,{label:"Votre mot de passe actuel (pour sécurité)",type:"password",value:o,onChange:I=>l(I.target.value),placeholder:"••••••••",leftIcon:r.jsx(Or,{className:"w-4 h-4"}),disabled:d}),r.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Requis pour modifier votre propre email. Assurez-vous de saisir le bon mot de passe."})]}),s.id!==(k==null?void 0:k.id)&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-yellow-800",children:[r.jsx("p",{className:"font-medium",children:"Modification d'un autre utilisateur"}),r.jsx("p",{children:"L'email sera mis à jour dans la base de données. L'utilisateur devra se reconnecter avec sa nouvelle adresse."})]})]})}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-4 h-4 text-blue-600 mt-0.5 mr-2 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-blue-800",children:[r.jsx("p",{className:"font-medium",children:"Processus de changement d'email :"}),r.jsx("ul",{className:"mt-1 space-y-1",children:s.id===(k==null?void 0:k.id)?r.jsxs(r.Fragment,{children:[r.jsx("li",{children:"• Un email de vérification sera envoyé à la nouvelle adresse"}),r.jsx("li",{children:"• Vous devrez cliquer sur le lien de vérification"}),r.jsx("li",{children:"• L'ancien email restera actif jusqu'à la vérification"}),r.jsx("li",{children:"• Une fois vérifié, vous devrez vous reconnecter"})]}):r.jsxs(r.Fragment,{children:[r.jsx("li",{children:"• L'email sera mis à jour immédiatement"}),r.jsx("li",{children:"• L'utilisateur devra se connecter avec le nouvel email"}),r.jsx("li",{children:"• L'ancien email ne fonctionnera plus"})]})})]})]})})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:R,disabled:d,children:f?"Fermer":"Annuler"}),!f&&r.jsx(O,{onClick:D,disabled:d||!i.trim()||!S(i)||i===s.email||m&&!o.trim(),children:d?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Mise à jour..."]}):r.jsxs(r.Fragment,{children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),"Mettre à jour"]})})]})]})}),y&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Or,{className:"w-5 h-5 mr-2"}),"Réinitialiser un mot de passe"]}),r.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:v,className:"space-y-4",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Comment ça fonctionne"}),r.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Saisissez l'adresse email de l'utilisateur qui souhaite réinitialiser son mot de passe. Un email contenant un lien de réinitialisation lui sera envoyé."})]})]})}),r.jsx(fe,{label:"Adresse email",type:"email",value:_,onChange:I=>C(I.target.value),placeholder:"email@example.com",leftIcon:r.jsx(It,{className:"w-4 h-4"}),disabled:d,required:!0}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-yellow-800",children:[r.jsx("p",{className:"font-medium",children:"Important"}),r.jsx("p",{children:"Assurez-vous que l'adresse email est correcte et associée à un compte existant."}),r.jsx("p",{className:"mt-1",children:"L'email peut arriver dans les spams, vérifiez tous les dossiers."})]})]})}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>P(!1),disabled:d,type:"button",children:"Annuler"}),r.jsx(O,{type:"submit",disabled:d||!_.trim()||!S(_),children:d?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Envoi en cours..."]}):r.jsxs(r.Fragment,{children:[r.jsx(It,{className:"w-4 h-4 mr-2"}),"Envoyer l'email"]})})]})]})]})})]})},kD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(!0),[i,a]=A.useState(!1),[o,l]=A.useState(null),[d,u]=A.useState(!1),[m,h]=A.useState(null),[f,x]=A.useState(!1),[y,P]=A.useState(null),[_,C]=A.useState(""),[k,T]=A.useState(!0),[S,D]=A.useState({name:"",email:"",password:""}),{user:R}=Le(),v=(R==null?void 0:R.isSystemAdmin)===!0,b=()=>R!=null&&R.email?as.isDemoEmail(R.email):!1,N=async()=>{if(v)try{n(!0);const X=Ne(je(H,"users"),oe("isSystemAdmin","==",!0)),re=(await _e(X)).docs.map(Z=>{var Y,U,K;const se=Z.data();return{id:Z.id,email:se.email,name:se.name,role:se.role,establishmentId:se.establishmentId,isActive:se.isActive??!0,isSuperAdmin:se.isSuperAdmin??!1,isSystemAdmin:se.isSystemAdmin??!1,lastLogin:((Y=se.lastLogin)==null?void 0:Y.toDate())||null,createdAt:((U=se.createdAt)==null?void 0:U.toDate())||new Date,updatedAt:((K=se.updatedAt)==null?void 0:K.toDate())||new Date}});e(re)}catch(X){console.error("Erreur lors du chargement des administrateurs système:",X),L.error("Erreur lors du chargement des administrateurs système")}finally{n(!1)}};A.useEffect(()=>{v&&N()},[v]);const g=()=>{if(k){L.error("La création de comptes Super Admin est désactivée pour des raisons de sécurité");return}l(null),D({name:"",email:"",password:""}),a(!0)},w=X=>{if(k){L.error("La modification de comptes Super Admin est désactivée pour des raisons de sécurité");return}l(X),D({name:X.name,email:X.email,password:""}),a(!0)},I=async()=>{if(k){L.error("La création/modification de comptes Super Admin est désactivée pour des raisons de sécurité");return}if(!S.name||!S.email){L.error("Le nom et l'email sont requis");return}if(!o&&!S.password){L.error("Le mot de passe est requis pour un nouveau compte");return}if(!v){L.error("Seuls les Super Admins peuvent gérer les administrateurs système");return}if(b()){L.error("Les comptes de démonstration ne peuvent pas gérer les administrateurs système");return}n(!0);try{if(o){const X={name:S.name,updatedAt:J.now()};await pt(me(H,"users",o.id),X),L.success("Administrateur modifié avec succès")}else{const X=await nl(We,S.email,S.password);await al(X.user,{displayName:S.name});const W={id:X.user.uid,email:S.email,name:S.name,role:"admin",establishmentId:"SYSTEM_ADMIN",isActive:!0,isSuperAdmin:!0,isSystemAdmin:!0,isClientAdmin:!1,lastLogin:null,createdAt:J.now(),updatedAt:J.now()};await Ze(me(H,"users",X.user.uid),W),L.success("Administrateur système ajouté avec succès")}await N(),D({name:"",email:"",password:""}),a(!1),l(null)}catch(X){console.error("Erreur lors de la gestion de l'administrateur:",X);let W="Erreur lors de la gestion de l'administrateur";switch(X.code){case"auth/email-already-in-use":W="Cette adresse email est déjà utilisée";break;case"auth/weak-password":W="Le mot de passe doit contenir au moins 6 caractères";break;case"auth/invalid-email":W="Format d'email invalide";break;default:W=X.message||W}L.error(W)}finally{n(!1)}},E=X=>{if(k){L.error("La suppression de comptes Super Admin est désactivée pour des raisons de sécurité");return}if(X.id===(R==null?void 0:R.id)){L.error("Vous ne pouvez pas supprimer votre propre compte");return}if(b()){L.error("Les comptes de démonstration ne peuvent pas supprimer d'administrateurs système");return}h(X),u(!0),C("")},ee=async()=>{if(m){if(!_){L.error("Mot de passe administrateur requis");return}if(_!=="superadmin123"){L.error("Mot de passe administrateur incorrect"),C("");return}n(!0);try{await Ds(me(H,"users",m.id)),L.success("Administrateur supprimé avec succès"),await N(),u(!1),h(null),C("")}catch(X){console.error("Erreur lors de la suppression de l'administrateur:",X),L.error("Erreur lors de la suppression de l'administrateur")}finally{n(!1)}}},V=X=>{if(k){L.error("La réinitialisation de mot de passe pour les comptes Super Admin est désactivée pour des raisons de sécurité");return}if(b()){L.error("Les comptes de démonstration ne peuvent pas réinitialiser les mots de passe");return}P(X),x(!0)},F=async()=>{if(y)try{n(!0);const X={url:window.location.origin+"/login",handleCodeInApp:!1};await Nf(We,y.email,X),console.log(`Email de réinitialisation envoyé à: ${y.email}`),L.success(`Email de réinitialisation envoyé à ${y.email}`),x(!1),P(null)}catch(X){console.error("Erreur lors de l'envoi de l'email:",X);let W="Erreur lors de l'envoi de l'email";switch(X.code){case"auth/user-not-found":W="Utilisateur non trouvé";break;case"auth/invalid-email":W="Adresse email invalide";break;case"auth/too-many-requests":W="Trop de tentatives. Réessayez plus tard.";break;default:W=X.message||W}L.error(W)}finally{n(!1)}};return v?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Xe,{className:"w-5 h-5 mr-2 text-red-600"}),"Gestion des Administrateurs Système"]}),r.jsxs(O,{onClick:g,disabled:k,className:k?"opacity-50 cursor-not-allowed":"",children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Ajouter un Admin"]})]}),r.jsx(G,{className:"bg-red-50 border-red-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(cs,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Restriction de sécurité active"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"La création, modification et suppression de comptes Super Admin système est désactivée pour des raisons de sécurité. Ces opérations sont réservées uniquement aux processus internes sécurisés."})]})]})}),r.jsx(G,{children:r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"À propos des Administrateurs Système"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsx("p",{children:"• Les Administrateurs Système ont accès à la validation des paiements"}),r.jsx("p",{children:"• Ils peuvent gérer tous les établissements clients"}),r.jsx("p",{children:"• Ils ont un accès complet au système d'administration"}),r.jsx("p",{children:"• Chaque Admin Système a les mêmes droits et privilèges"})]})]})]})})}),r.jsx(G,{children:s?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des administrateurs..."})]}):t.length===0?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun administrateur trouvé"}),r.jsx("p",{className:"text-gray-500 mb-4",children:"Les administrateurs système apparaîtront ici"})]}):r.jsx("div",{className:"space-y-3",children:t.map(X=>r.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(Xe,{className:"w-5 h-5 text-red-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:X.name}),r.jsx("p",{className:"text-sm text-gray-600",children:X.email}),r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 mt-1",children:"Super Admin"})]})]}),r.jsx("div",{className:"flex items-center space-x-2",children:X.id===(R==null?void 0:R.id)?r.jsx("span",{className:"text-xs text-gray-500 italic",children:"Vous-même"}):r.jsxs(r.Fragment,{children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>w(X),title:"Modifier l'administrateur",disabled:k,className:k?"opacity-50 cursor-not-allowed":"",children:r.jsx(wr,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>V(X),title:"Réinitialiser le mot de passe",className:`text-orange-600 hover:text-orange-700 hover:bg-orange-50 ${k?"opacity-50 cursor-not-allowed":""}`,disabled:k,children:r.jsx(Or,{className:"w-4 h-4"})}),r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>E(X),title:"Supprimer l'administrateur",className:`text-red-600 hover:text-red-700 hover:bg-red-50 ${k?"opacity-50 cursor-not-allowed":""}`,disabled:k,children:r.jsx(ms,{className:"w-4 h-4"})})]})})]},X.id))})}),i&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Xe,{className:"w-5 h-5 mr-2 text-red-600"}),o?"Modifier l'administrateur":"Ajouter un administrateur système"]}),r.jsx("button",{onClick:()=>{a(!1),l(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(fe,{label:"Nom complet",value:S.name,onChange:X=>D({...S,name:X.target.value}),placeholder:"Ex: Jean Dupont",disabled:s}),r.jsx(fe,{label:"Adresse email",type:"email",value:S.email,onChange:X=>D({...S,email:X.target.value}),placeholder:"admin@example.com",disabled:s||!!o,leftIcon:r.jsx(It,{className:"w-4 h-4"})}),!o&&r.jsx(fe,{label:"Mot de passe",type:"password",value:S.password,onChange:X=>D({...S,password:X.target.value}),placeholder:"••••••••",disabled:s,leftIcon:r.jsx(Or,{className:"w-4 h-4"})}),o&&r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:r.jsxs("p",{className:"text-sm text-blue-800",children:[r.jsx("strong",{children:"Note :"}),` L'email ne peut pas être modifié pour des raisons de sécurité. Pour changer le mot de passe, utilisez le bouton "🔑\\" dans la liste des administrateurs.`]})}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Attention : Privilèges élevés"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Les Administrateurs Système ont un accès complet à toutes les fonctionnalités d'administration, y compris la validation des paiements et la gestion des clients."})]})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>{a(!1),l(null)},disabled:s,children:"Annuler"}),r.jsx(O,{onClick:I,disabled:s,className:"bg-red-600 hover:bg-red-700",children:s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),o?"Modification...":"Création..."]}):r.jsxs(r.Fragment,{children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),o?"Modifier":"Ajouter"]})})]})]})}),d&&m&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(ms,{className:"w-5 h-5 mr-2 text-red-600"}),"Supprimer l'administrateur"]}),r.jsx("button",{onClick:()=>{u(!1),h(null),C("")},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Confirmation de suppression"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Êtes-vous sûr de vouloir supprimer cet administrateur système ? Cette action est irréversible."})]})]})}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(Xe,{className:"w-5 h-5 text-red-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:m.name}),r.jsx("p",{className:"text-sm text-gray-600",children:m.email}),r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 mt-1",children:"Super Admin"})]})]})}),r.jsxs("div",{className:"mb-6",children:[r.jsx(fe,{label:"Mot de passe administrateur",type:"password",value:_,onChange:X=>C(X.target.value),placeholder:"Saisissez votre mot de passe admin"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Veuillez saisir votre mot de passe administrateur pour confirmer cette action."})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>{u(!1),h(null),C("")},disabled:s,children:"Annuler"}),r.jsx(O,{variant:"danger",onClick:ee,disabled:s||!_.trim(),children:s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Suppression..."]}):r.jsxs(r.Fragment,{children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),"Supprimer définitivement"]})})]})]})}),f&&y&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Or,{className:"w-5 h-5 mr-2"}),"Réinitialiser le mot de passe"]}),r.jsx("button",{onClick:()=>{x(!1),P(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-orange-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-orange-800",children:"Réinitialisation sécurisée"}),r.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Un email de réinitialisation sera envoyé à l'administrateur. Il pourra alors créer un nouveau mot de passe en toute sécurité."})]})]})}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:r.jsx(Xe,{className:"w-5 h-5 text-red-600"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:y.name}),r.jsx("p",{className:"text-sm text-gray-600",children:y.email}),r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 mt-1",children:"Super Admin"})]})]})}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Processus de réinitialisation"}),r.jsxs("ol",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsxs("li",{children:["1. Un email sera envoyé à ",r.jsx("strong",{children:y.email})]}),r.jsx("li",{children:"2. L'administrateur cliquera sur le lien dans l'email"}),r.jsx("li",{children:"3. Il pourra définir un nouveau mot de passe"}),r.jsx("li",{children:"4. Le nouveau mot de passe sera actif immédiatement"})]})]})]})})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>{x(!1),P(null)},disabled:s,children:"Annuler"}),r.jsx(O,{onClick:F,disabled:s,className:"bg-orange-600 hover:bg-orange-700",children:s?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Envoi en cours..."]}):r.jsxs(r.Fragment,{children:[r.jsx(It,{className:"w-4 h-4 mr-2"}),"Envoyer l'email"]})})]})]})})]}):r.jsx(G,{className:"p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Xe,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Seuls les Super Administrateurs système peuvent accéder à cette section."})]})})},CD=()=>{const[t,e]=A.useState(!1),[s,n]=A.useState(""),[i,a]=A.useState(!1),[o,l]=A.useState(null),d=()=>{a(!0),n(""),l(null)},u=async()=>{if(!s){L.error("Mot de passe requis");return}e(!0);try{await ca(We);try{const h=await il(We,"superadmin@saaspos.mg",s);if(h.user){await Mj(h.user),console.log("✅ Utilisateur Firebase Auth supprimé");try{await Ds(me(H,"users",h.user.uid)),console.log("✅ Document Firestore supprimé")}catch(f){console.error("❌ Erreur lors de la suppression du document Firestore:",f)}try{const f=Ne(je(H,"users"),oe("email","==","superadmin@saaspos.mg")),x=await _e(f);if(!x.empty)for(const y of x.docs)await Ds(y.ref),console.log("✅ Document supplémentaire supprimé:",y.id)}catch(f){console.error("❌ Erreur lors de la recherche de documents supplémentaires:",f)}l({success:!0,message:"Compte superadmin supprimé avec succès !",details:"Le compte a été complètement supprimé de Firebase Authentication et de Firestore."}),localStorage.clear(),sessionStorage.clear(),a(!1)}}catch(h){if(console.error("❌ Erreur de connexion:",h),h.code==="auth/invalid-credential")l({success:!1,message:"Mot de passe incorrect",details:"Le mot de passe saisi ne correspond pas au compte superadmin@saaspos.mg. Vérifiez le mot de passe ou utilisez la console Firebase pour supprimer le compte manuellement."});else if(h.code==="auth/user-not-found"){l({success:!0,message:"Le compte superadmin n'existe plus",details:"Le compte superadmin@saaspos.mg a déjà été supprimé de Firebase Authentication. Nettoyage des données Firestore en cours..."});try{const f=Ne(je(H,"users"),oe("email","==","superadmin@saaspos.mg")),x=await _e(f);if(!x.empty){for(const y of x.docs)await Ds(y.ref),console.log("✅ Document Firestore supplémentaire supprimé:",y.id);l({success:!0,message:"Nettoyage terminé",details:"Le compte n'existait plus dans Firebase Auth, mais des documents Firestore ont été supprimés."})}}catch(f){console.error("❌ Erreur lors du nettoyage Firestore:",f)}a(!1)}else h.code==="auth/wrong-password"?l({success:!1,message:"Mot de passe incorrect",details:"Le mot de passe saisi est incorrect. Essayez avec le mot de passe correct ou utilisez la console Firebase."}):h.code==="auth/too-many-requests"?l({success:!1,message:"Trop de tentatives",details:"Trop de tentatives de connexion échouées. Attendez quelques minutes avant de réessayer."}):l({success:!1,message:"Erreur lors de la tentative de connexion",details:`Code d'erreur: ${h.code}. ${h.message}`})}}catch(h){console.error("❌ Erreur lors du nettoyage:",h),l({success:!1,message:"Erreur lors du nettoyage",details:h.message})}finally{e(!1)}},m=async()=>{try{await We.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/login",L.success("Déconnexion forcée réussie")}catch(h){console.error("Erreur lors de la déconnexion forcée:",h),L.error("Erreur lors de la déconnexion forcée")}};return r.jsxs(G,{className:"p-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Xe,{className:"w-5 h-5 mr-2 text-red-600"}),"Nettoyage du compte Super Admin"]})}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Xe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsxs("h4",{className:"text-sm font-medium text-red-800 flex items-center",children:["Zone Sécurisée - Administrateur Uniquement",r.jsx(cs,{className:"w-4 h-4 ml-2"})]}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Si vous avez supprimé le compte superadmin@saaspos.mg mais qu'il reste accessible, utilisez cet outil pour le supprimer complètement de Firebase Authentication et de Firestore."})]})]})}),o&&r.jsx("div",{className:`border rounded-lg p-4 ${o.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:r.jsxs("div",{className:"flex items-start",children:[o.success?r.jsx(Lt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}):r.jsx(Oe,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{className:`text-sm ${o.success?"text-green-800":"text-red-800"}`,children:[r.jsx("p",{className:"font-medium",children:o.message}),o.details&&r.jsx("p",{className:"mt-1",children:o.details}),o.success&&r.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded",children:[r.jsx("p",{className:"text-blue-800 font-medium text-xs mb-2",children:"🎉 Nettoyage terminé !"}),r.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[r.jsx("p",{children:"• Le compte superadmin a été complètement supprimé"}),r.jsx("p",{children:"• Vous devez maintenant vous déconnecter et vous reconnecter"}),r.jsx("p",{children:"• Si nécessaire, reconfigurer le système depuis la page de configuration"})]})]}),!o.success&&r.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[r.jsx("p",{className:"text-yellow-800 font-medium text-xs mb-2",children:"Solutions possibles :"}),r.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[r.jsx("li",{children:"• Vérifiez que le mot de passe est correct"}),r.jsx("li",{children:"• Essayez la déconnexion forcée ci-dessous"}),r.jsx("li",{children:"• Utilisez la console Firebase pour supprimer le compte manuellement"}),r.jsx("li",{children:"• Attendez quelques minutes si trop de tentatives ont été effectuées"})]})]})]})]})}),r.jsxs("div",{className:"flex flex-col gap-4",children:[r.jsxs(O,{variant:"danger",onClick:d,disabled:t,className:"w-full",children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),"Supprimer définitivement le compte superadmin"]}),r.jsxs(O,{variant:"ghost",onClick:m,disabled:t,className:"w-full",children:[r.jsx(Lo,{className:"w-4 h-4 mr-2"}),"Déconnexion forcée et nettoyage du cache"]})]}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Mots de passe courants"}),r.jsx("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:r.jsxs("p",{children:["• Pour cette démo, utilisez le mot de passe : ",r.jsx("strong",{children:"superadmin123"})]})})]})]})}),r.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(cs,{className:"w-5 h-5 text-gray-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-800",children:"Comment ça fonctionne"}),r.jsxs("ol",{className:"text-sm text-gray-700 mt-1 space-y-1",children:[r.jsx("li",{children:"1. L'outil tente de se connecter au compte superadmin"}),r.jsx("li",{children:"2. Si la connexion réussit, il supprime le compte de Firebase Auth"}),r.jsx("li",{children:"3. Il supprime également tous les documents Firestore associés"}),r.jsx("li",{children:"4. Si le compte n'existe plus, il nettoie seulement Firestore"}),r.jsx("li",{children:"5. Après la suppression, vous devrez vous reconnecter"})]})]})]})})]}),i&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-md",padding:"lg",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Or,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Mot de passe du compte superadmin"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Pour supprimer le compte superadmin@saaspos.mg, veuillez saisir son mot de passe."}),r.jsxs("div",{className:"mb-6",children:[r.jsx("input",{type:"password",value:s,onChange:h=>n(h.target.value),placeholder:"Mot de passe superadmin",className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",onKeyPress:h=>h.key==="Enter"&&!t&&u(),autoFocus:!0}),r.jsx("div",{className:"text-xs text-gray-500 mt-2 space-y-1",children:r.jsxs("p",{children:["Pour cette démo, utilisez le mot de passe : ",r.jsx("strong",{children:"superadmin123"})]})})]}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-4 h-4 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-yellow-800",children:[r.jsx("p",{className:"font-medium",children:"⚠️ Attention :"}),r.jsx("p",{children:"Cette action supprimera définitivement le compte superadmin et est irréversible."})]})]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>{a(!1),n("")},disabled:t,children:"Annuler"}),r.jsx(O,{variant:"danger",fullWidth:!0,onClick:u,disabled:t||!s.trim(),children:t?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Suppression..."]}):r.jsxs(r.Fragment,{children:[r.jsx(ms,{className:"w-4 h-4 mr-2"}),"Supprimer"]})})]})]})})})]})},TD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(!0),[i,a]=A.useState(""),[o,l]=A.useState(!0),[d,u]=A.useState(!0),[m,h]=A.useState(!0),[f,x]=A.useState(!0),[y,P]=A.useState(!0),[_,C]=A.useState({}),[k,T]=A.useState([]),{user:S}=Le(),D=(S==null?void 0:S.isSystemAdmin)===!0,R=async()=>{if(D)try{n(!0);const V=Ne(je(H,"users")),X=(await _e(V)).docs.map(Z=>{var Y,U,K;const se=Z.data();return{id:Z.id,email:se.email,name:se.name||"Sans nom",role:se.role||"inconnu",establishmentId:se.establishmentId||"inconnu",establishmentName:se.establishmentId==="SYSTEM_ADMIN"?"Système":se.establishmentId,isActive:se.isActive??!0,isSuperAdmin:se.isSuperAdmin??!1,isSystemAdmin:se.isSystemAdmin??!1,isClientAdmin:se.isClientAdmin??!1,lastLogin:((Y=se.lastLogin)==null?void 0:Y.toDate())||null,createdAt:((U=se.createdAt)==null?void 0:U.toDate())||new Date,updatedAt:((K=se.updatedAt)==null?void 0:K.toDate())||new Date}});e(X);const W=Array.from(new Set(X.map(Z=>Z.establishmentId))).map(Z=>{const se=Z==="SYSTEM_ADMIN"?"Système":Z==="demo-establishment-main"?"Établissement Démo":`Établissement ${Z.substring(0,8)}`;return{id:Z,name:se}});T(W);const re={};W.forEach(Z=>{re[Z.id]=!0}),C(re),L.success(`${X.length} utilisateurs trouvés`)}catch(V){console.error("Erreur lors du chargement des utilisateurs:",V),L.error("Erreur lors du chargement des utilisateurs")}finally{n(!1)}};A.useEffect(()=>{D&&R()},[D]);const v=t.filter(V=>{const F=V.name.toLowerCase().includes(i.toLowerCase())||V.email.toLowerCase().includes(i.toLowerCase())||V.establishmentId.toLowerCase().includes(i.toLowerCase())||V.role.toLowerCase().includes(i.toLowerCase()),X=V.isSystemAdmin===!0,W=V.role==="admin"&&!X,re=V.role==="manager",Z=V.role==="cashier",se=V.role==="reader";return F&&(X&&y||W&&o||re&&d||Z&&m||se&&f)}),b=()=>{const V={};return v.forEach(F=>{V[F.establishmentId]||(V[F.establishmentId]=[]),V[F.establishmentId].push(F)}),V},N=V=>{const F=k.find(X=>X.id===V);return(F==null?void 0:F.name)||V},g=V=>V==="SYSTEM_ADMIN"?"bg-red-100 border-red-200 text-red-800":V==="demo-establishment-main"?"bg-blue-100 border-blue-200 text-blue-800":"bg-gray-100 border-gray-200 text-gray-800",w=V=>{C(F=>({...F,[V]:!F[V]}))},I=V=>V.isSystemAdmin?"bg-red-50 border-red-200":V.role==="admin"||V.isClientAdmin?"bg-blue-50 border-blue-200":V.role==="manager"?"bg-green-50 border-green-200":V.role==="cashier"?"bg-yellow-50 border-yellow-200":V.role==="reader"?"bg-purple-50 border-purple-200":"bg-gray-50 border-gray-200",E=V=>V.isSystemAdmin?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Super Admin Système"}):V.isClientAdmin?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Admin Client"}):V.role==="admin"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Administrateur"}):V.role==="manager"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Gérant"}):V.role==="cashier"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Caissier"}):V.role==="reader"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Lecteur"}):r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:V.role||"Rôle inconnu"}),ee=V=>V.isSystemAdmin?r.jsx(Xe,{className:"w-5 h-5 text-red-600"}):V.role==="admin"||V.isClientAdmin?r.jsx(St,{className:"w-5 h-5 text-blue-600"}):V.role==="manager"?r.jsx(St,{className:"w-5 h-5 text-green-600"}):V.role==="cashier"?r.jsx(St,{className:"w-5 h-5 text-yellow-600"}):V.role==="reader"?r.jsx(St,{className:"w-5 h-5 text-purple-600"}):r.jsx(Ke,{className:"w-5 h-5 text-gray-600"});return D?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Ke,{className:"w-5 h-5 mr-2 text-blue-600"}),"Liste complète des utilisateurs"]}),r.jsxs(O,{onClick:R,variant:"ghost",disabled:s,children:[r.jsx(qs,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`}),"Actualiser"]})]}),r.jsx(G,{children:r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"À propos de cette liste"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsxs("p",{children:["• Cette liste affiche ",r.jsx("strong",{children:"tous"})," les utilisateurs du système, organisés par établissement"]}),r.jsx("p",{children:"• Les Super Admins Système sont marqués en rouge"}),r.jsx("p",{children:"• Les Administrateurs sont marqués en bleu"}),r.jsx("p",{children:"• Les Gérants sont marqués en vert"}),r.jsx("p",{children:"• Les Caissiers sont marqués en jaune"}),r.jsx("p",{children:"• Les Lecteurs sont marqués en violet"})]})]})]})})}),r.jsx(G,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[r.jsx("div",{className:"flex-1",children:r.jsx(fe,{placeholder:"Rechercher par nom, email, rôle ou établissement...",value:i,onChange:V=>a(V.target.value),leftIcon:r.jsx(Is,{className:"w-4 h-4 text-gray-400"})})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:y,onChange:()=>P(!y),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Super Admins"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:o,onChange:()=>l(!o),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Admins"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:d,onChange:()=>u(!d),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Gérants"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:m,onChange:()=>h(!m),className:"rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Caissiers"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:f,onChange:()=>x(!f),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),r.jsx("span",{className:"text-sm text-gray-700",children:"Lecteurs"})]})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:[v.length," utilisateur(s) trouvé(s)"]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(_1,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Filtres actifs"})]})]})]})}),r.jsx("div",{className:"space-y-4",children:s?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des utilisateurs..."})]})}):v.length===0?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun utilisateur trouvé"}),r.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur ne correspond à vos critères de recherche"})]})}):Object.entries(b()).map(([V,F])=>r.jsxs(G,{className:"overflow-hidden",children:[r.jsx("div",{className:`p-4 ${g(V)} cursor-pointer`,onClick:()=>w(V),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Yr,{className:"w-5 h-5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold",children:N(V)}),r.jsxs("p",{className:"text-sm",children:[F.length," utilisateur(s)"]})]})]}),_[V]?r.jsx(j1,{className:"w-5 h-5"}):r.jsx(Ou,{className:"w-5 h-5"})]})}),_[V]&&r.jsx("div",{className:"divide-y divide-gray-100",children:F.map(X=>r.jsx("div",{className:`p-4 ${I(X)}`,children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[r.jsxs("div",{className:"flex items-start space-x-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-white shadow-sm border border-gray-200 flex-shrink-0",children:ee(X)}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:X.name}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(It,{className:"w-3 h-3 text-gray-500"}),r.jsx("p",{className:"text-sm text-gray-600 font-mono truncate max-w-[200px] sm:max-w-none",children:X.email})]}),r.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[E(X),X.isActive?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Actif"}):r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Inactif"}),X.id===(S==null?void 0:S.id)&&r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Vous-même"})]})]})]}),r.jsxs("div",{className:"text-left sm:text-right mt-2 sm:mt-0",children:[r.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[r.jsx(Es,{className:"w-3 h-3"}),r.jsx("span",{children:X.lastLogin?`Dernière connexion: ${X.lastLogin.toLocaleDateString("fr-FR")}`:"Jamais connecté"})]}),r.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mt-1",children:[r.jsx(ut,{className:"w-3 h-3"}),r.jsxs("span",{children:["Créé le: ",X.createdAt.toLocaleDateString("fr-FR")]})]})]})]})},X.id))})]},V))}),r.jsxs(G,{children:[r.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Légende des types d'utilisateurs"}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-50 rounded-lg",children:[r.jsx(Xe,{className:"w-5 h-5 text-red-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-red-900",children:"Super Admin Système"}),r.jsx("p",{className:"text-sm text-red-700",children:"Accès à la validation des paiements et à l'administration complète"})]})]}),r.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-blue-50 rounded-lg",children:[r.jsx(St,{className:"w-5 h-5 text-blue-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-blue-900",children:"Administrateur"}),r.jsx("p",{className:"text-sm text-blue-700",children:"Gère un établissement spécifique avec tous les droits"})]})]}),r.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-50 rounded-lg",children:[r.jsx(St,{className:"w-5 h-5 text-green-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-green-900",children:"Gérant"}),r.jsx("p",{className:"text-sm text-green-700",children:"Gère les opérations quotidiennes de l'établissement"})]})]}),r.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-yellow-50 rounded-lg",children:[r.jsx(St,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-yellow-900",children:"Caissier"}),r.jsx("p",{className:"text-sm text-yellow-700",children:"Gère les ventes et la caisse"})]})]}),r.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-purple-50 rounded-lg",children:[r.jsx(St,{className:"w-5 h-5 text-purple-600 mt-0.5"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-purple-900",children:"Lecteur"}),r.jsx("p",{className:"text-sm text-purple-700",children:"Accès en lecture seule aux données"})]})]})]})]})]}):r.jsx(G,{className:"p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Xe,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Seuls les Super Administrateurs système peuvent accéder à cette section."})]})})},RD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState(!0),[i,a]=A.useState(""),[o,l]=A.useState("all"),[d,u]=A.useState("all"),[m,h]=A.useState([]),[f,x]=A.useState({}),{user:y}=Le(),P=(y==null?void 0:y.isSystemAdmin)===!0,_=async()=>{if(P)try{n(!0);const g=Ne(je(H,"users")),I=(await _e(g)).docs.map(V=>{var X,W,re;const F=V.data();return{id:V.id,email:F.email,name:F.name||"Sans nom",role:F.role||"inconnu",establishmentId:F.establishmentId||"inconnu",establishmentName:F.establishmentId==="SYSTEM_ADMIN"?"Système":F.establishmentId,isActive:F.isActive??!0,isSuperAdmin:F.isSuperAdmin??!1,isSystemAdmin:F.isSystemAdmin??!1,isClientAdmin:F.isClientAdmin??!1,lastLogin:((X=F.lastLogin)==null?void 0:X.toDate())||null,createdAt:((W=F.createdAt)==null?void 0:W.toDate())||new Date,updatedAt:((re=F.updatedAt)==null?void 0:re.toDate())||new Date}});e(I);const E=Array.from(new Set(I.map(V=>V.establishmentId))).map(V=>{const F=I.filter(W=>W.establishmentId===V),X=V==="SYSTEM_ADMIN"?"Système":V==="demo-establishment-main"?"Établissement Démo":`Établissement ${V.substring(0,8)}`;return{id:V,name:X}});h(E);const ee={};E.forEach(V=>{ee[V.id]=!0}),x(ee),L.success(`${I.length} utilisateurs trouvés`)}catch(g){console.error("Erreur lors du chargement des utilisateurs:",g),L.error("Erreur lors du chargement des utilisateurs")}finally{n(!1)}};A.useEffect(()=>{P&&_()},[P]);const C=t.filter(g=>{const w=g.name.toLowerCase().includes(i.toLowerCase())||g.email.toLowerCase().includes(i.toLowerCase())||g.establishmentId.toLowerCase().includes(i.toLowerCase()),I=o==="all"||g.role===o,E=d==="all"||g.establishmentId===d;return w&&I&&E}),k=g=>g.isSystemAdmin?"bg-red-50 border-red-200":g.role==="admin"||g.isClientAdmin?"bg-blue-50 border-blue-200":g.role==="manager"?"bg-green-50 border-green-200":g.role==="cashier"?"bg-yellow-50 border-yellow-200":g.role==="reader"?"bg-purple-50 border-purple-200":"bg-gray-50 border-gray-200",T=g=>g.isSystemAdmin?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Super Admin Système"}):g.isClientAdmin?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Admin Client"}):g.role==="admin"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Administrateur"}):g.role==="manager"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Gérant"}):g.role==="cashier"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Caissier"}):g.role==="reader"?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Lecteur"}):r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:g.role||"Rôle inconnu"}),S=g=>g.isSystemAdmin?r.jsx(Xe,{className:"w-5 h-5 text-red-600"}):g.role==="admin"||g.isClientAdmin?r.jsx(Xe,{className:"w-5 h-5 text-blue-600"}):g.role==="manager"?r.jsx(St,{className:"w-5 h-5 text-green-600"}):g.role==="cashier"?r.jsx(St,{className:"w-5 h-5 text-yellow-600"}):g.role==="reader"?r.jsx(As,{className:"w-5 h-5 text-purple-600"}):r.jsx(St,{className:"w-5 h-5 text-gray-600"}),D=()=>{const g={};return C.forEach(w=>{g[w.establishmentId]||(g[w.establishmentId]=[]),g[w.establishmentId].push(w)}),g},R=g=>{const w=m.find(I=>I.id===g);return(w==null?void 0:w.name)||g},v=g=>g==="SYSTEM_ADMIN"?"bg-red-100 border-red-200 text-red-800":g==="demo-establishment-main"?"bg-blue-100 border-blue-200 text-blue-800":"bg-gray-100 border-gray-200 text-gray-800",b=g=>{x(w=>({...w,[g]:!w[g]}))},N=()=>{const g=[["ID","Nom","Email","Rôle","Établissement","Statut","Dernière connexion","Créé le"],...C.map(ee=>[ee.id,ee.name,ee.email,ee.role,ee.establishmentId,ee.isActive?"Actif":"Inactif",ee.lastLogin?ee.lastLogin.toLocaleDateString("fr-FR"):"Jamais",ee.createdAt.toLocaleDateString("fr-FR")])].map(ee=>ee.join(",")).join(`
`),w=new Blob([g],{type:"text/csv"}),I=window.URL.createObjectURL(w),E=document.createElement("a");E.href=I,E.download=`utilisateurs_${new Date().toISOString().split("T")[0]}.csv`,E.click(),window.URL.revokeObjectURL(I),L.success("Liste des utilisateurs exportée avec succès")};return P?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(Ke,{className:"w-5 h-5 mr-2 text-blue-600"}),"Liste complète des utilisateurs"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(O,{onClick:_,variant:"ghost",disabled:s,children:[r.jsx(qs,{className:`w-4 h-4 mr-2 ${s?"animate-spin":""}`}),"Actualiser"]}),r.jsxs(O,{onClick:N,variant:"ghost",disabled:s||C.length===0,children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]})]}),r.jsx(G,{children:r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Ks,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Liste complète des utilisateurs"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-1",children:[r.jsxs("p",{children:["• Cette liste affiche ",r.jsx("strong",{children:"tous"})," les utilisateurs du système, organisés par établissement"]}),r.jsx("p",{children:"• Les Super Admins Système sont marqués en rouge"}),r.jsx("p",{children:"• Les Admins Clients sont marqués en bleu"}),r.jsx("p",{children:"• Les Gérants sont marqués en vert"}),r.jsx("p",{children:"• Les Caissiers sont marqués en jaune"}),r.jsx("p",{children:"• Les Lecteurs sont marqués en violet"})]})]})]})})}),r.jsx(G,{children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx("div",{className:"md:col-span-1",children:r.jsx(fe,{placeholder:"Rechercher par nom, email ou établissement...",value:i,onChange:g=>a(g.target.value),leftIcon:r.jsx(Is,{className:"w-4 h-4 text-gray-400"})})}),r.jsxs("select",{value:o,onChange:g=>l(g.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Tous les rôles"}),r.jsx("option",{value:"admin",children:"Administrateurs"}),r.jsx("option",{value:"manager",children:"Gérants"}),r.jsx("option",{value:"cashier",children:"Caissiers"}),r.jsx("option",{value:"reader",children:"Lecteurs"})]}),r.jsxs("select",{value:d,onChange:g=>u(g.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Tous les établissements"}),m.map(g=>r.jsx("option",{value:g.id,children:g.name},g.id))]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-600",children:[C.length," utilisateur(s) trouvé(s)"]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(_1,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{className:"text-sm text-gray-600",children:"Filtres actifs"})]})]})]})}),r.jsx("div",{className:"space-y-4",children:s?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des utilisateurs..."})]})}):C.length===0?r.jsx(G,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx(Ke,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun utilisateur trouvé"}),r.jsx("p",{className:"text-gray-500",children:"Aucun utilisateur ne correspond à vos critères de recherche"})]})}):Object.entries(D()).map(([g,w])=>r.jsxs(G,{className:"overflow-hidden",children:[r.jsx("div",{className:`p-4 ${v(g)} cursor-pointer`,onClick:()=>b(g),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Yr,{className:"w-5 h-5"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-semibold",children:R(g)}),r.jsxs("p",{className:"text-sm",children:[w.length," utilisateur(s)"]})]})]}),f[g]?r.jsx(j1,{className:"w-5 h-5"}):r.jsx(Ou,{className:"w-5 h-5"})]})}),f[g]&&r.jsx("div",{className:"divide-y divide-gray-100",children:w.map(I=>r.jsx("div",{className:`p-4 ${k(I)}`,children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[r.jsxs("div",{className:"flex items-start space-x-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-white shadow-sm border border-gray-200 flex-shrink-0",children:S(I)}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:I.name}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(It,{className:"w-3 h-3 text-gray-500"}),r.jsx("p",{className:"text-sm text-gray-600 font-mono truncate max-w-[200px] sm:max-w-none",children:I.email})]}),r.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[T(I),I.isActive?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800",children:"Actif"}):r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Inactif"}),I.id===(y==null?void 0:y.id)&&r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"Vous-même"})]})]})]}),r.jsxs("div",{className:"text-left sm:text-right mt-2 sm:mt-0",children:[r.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[r.jsx(Es,{className:"w-3 h-3"}),r.jsx("span",{children:I.lastLogin?`Dernière connexion: ${I.lastLogin.toLocaleDateString("fr-FR")}`:"Jamais connecté"})]}),r.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 mt-1",children:[r.jsx(ut,{className:"w-3 h-3"}),r.jsxs("span",{children:["Créé le: ",I.createdAt.toLocaleDateString("fr-FR")]})]})]})]})},I.id))})]},g))}),r.jsxs(G,{children:[r.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"Statistiques des utilisateurs"}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[r.jsx("div",{className:"text-lg font-bold text-blue-800",children:t.length}),r.jsx("div",{className:"text-sm text-blue-600",children:"Total utilisateurs"})]}),r.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[r.jsx("div",{className:"text-lg font-bold text-red-800",children:t.filter(g=>g.isSystemAdmin).length}),r.jsx("div",{className:"text-sm text-red-600",children:"Super Admins"})]}),r.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[r.jsx("div",{className:"text-lg font-bold text-green-800",children:m.length}),r.jsx("div",{className:"text-sm text-green-600",children:"Établissements"})]}),r.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[r.jsx("div",{className:"text-lg font-bold text-yellow-800",children:t.filter(g=>g.isActive).length}),r.jsx("div",{className:"text-sm text-yellow-600",children:"Utilisateurs actifs"})]})]})]})]}):r.jsx(G,{className:"p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Xe,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Seuls les Super Administrateurs système peuvent accéder à cette section."})]})})},PD=({onClose:t})=>{const[e,s]=A.useState({serviceId:"",templateId:"",publicKey:""}),[n,i]=A.useState(!1),[a,o]=A.useState(!1),[l,d]=A.useState(!1),[u,m]=A.useState(!1),[h,f]=A.useState(!0),{user:x}=Le();gn.useEffect(()=>{const C=async()=>{if(x!=null&&x.establishmentId){f(!0);try{const k=await yg(x.establishmentId),T=vg();s({serviceId:T.serviceId,templateId:T.templateId,publicKey:T.publicKey}),T.publicKey!=="ton_public_key"&&T.serviceId!=="ton_service_id"&&T.templateId!=="ton_template_id"&&d(!0),console.log(k?"✅ Configuration EmailJS chargée depuis Firestore":"ℹ️ Aucune configuration EmailJS trouvée, utilisation des valeurs par défaut")}catch(k){console.error("Erreur lors du chargement de la configuration:",k),L.error("Erreur lors du chargement de la configuration EmailJS")}finally{f(!1)}}};x!=null&&x.establishmentId&&C()},[x==null?void 0:x.establishmentId]);const y=()=>{if(!(x!=null&&x.establishmentId)){L.error("Établissement non trouvé");return}if(!e.serviceId||!e.templateId||!e.publicKey){L.error("Tous les champs sont requis");return}m(!0),V6(x.establishmentId,e.serviceId,e.templateId,e.publicKey).then(C=>{d(!0),C.saved?L.success("Configuration EmailJS sauvegardée avec succès"):L.success("Configuration EmailJS mise à jour (erreur de sauvegarde)"),console.log("Configuration mise à jour:",C)}).catch(C=>{L.error("Erreur lors de la mise à jour de la configuration"),console.error("Erreur de configuration:",C)}).finally(()=>{m(!1)})},P=async()=>{if(!l){L.error("Veuillez d'abord configurer EmailJS");return}o(!0);try{const C=await O6();C.success?L.success("Configuration EmailJS valide !"):(L.error(`Test échoué: ${C.message}`),console.error("Erreur de test:",C.error))}catch(C){L.error("Erreur lors du test de configuration"),console.error("Erreur de test:",C)}finally{o(!1)}},_=C=>{navigator.clipboard.writeText(C),L.success("Copié dans le presse-papiers")};return r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[r.jsx(It,{className:"w-6 h-6 mr-2 text-blue-600"}),"Configuration EmailJS"]})}),h&&r.jsx(G,{children:r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement de la configuration..."})]})}),!h&&r.jsxs(G,{children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx($n,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Configuration EmailJS"}),r.jsxs("div",{className:"text-sm text-blue-700 mt-1 space-y-2",children:[r.jsxs("p",{children:["1. Créez un compte gratuit sur ",r.jsx("a",{href:"https://www.emailjs.com",target:"_blank",rel:"noopener noreferrer",className:"underline font-medium",children:"EmailJS.com"})]}),r.jsx("p",{children:"2. Créez un service email (Gmail, Outlook, etc.)"}),r.jsx("p",{children:"3. Créez un template d'email pour les reçus"}),r.jsx("p",{children:"4. Copiez vos clés ci-dessous"}),r.jsx("p",{className:"font-medium text-blue-800",children:"✅ La configuration sera automatiquement sauvegardée"})]})]})]})}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(fe,{label:"Service ID",value:e.serviceId,onChange:C=>s({...e,serviceId:C.target.value}),placeholder:"service_xxxxxxx",leftIcon:r.jsx(It,{className:"w-4 h-4"}),rightIcon:r.jsx("button",{type:"button",onClick:()=>_(e.serviceId),className:"text-gray-400 hover:text-gray-600",disabled:!e.serviceId,children:r.jsx(qm,{className:"w-4 h-4"})})}),r.jsx(fe,{label:"Template ID",value:e.templateId,onChange:C=>s({...e,templateId:C.target.value}),placeholder:"template_xxxxxxx",leftIcon:r.jsx(Xr,{className:"w-4 h-4"}),rightIcon:r.jsx("button",{type:"button",onClick:()=>_(e.templateId),className:"text-gray-400 hover:text-gray-600",disabled:!e.templateId,children:r.jsx(qm,{className:"w-4 h-4"})})}),r.jsx(fe,{label:"Public Key",type:n?"text":"password",value:e.publicKey,onChange:C=>s({...e,publicKey:C.target.value}),placeholder:"user_xxxxxxxxxxxxxxx",leftIcon:r.jsx(Or,{className:"w-4 h-4"}),rightIcon:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{type:"button",onClick:()=>i(!n),className:"text-gray-400 hover:text-gray-600",children:n?r.jsx(pl,{className:"w-4 h-4"}):r.jsx(As,{className:"w-4 h-4"})}),r.jsx("button",{type:"button",onClick:()=>_(e.publicKey),className:"text-gray-400 hover:text-gray-600",disabled:!e.publicKey,children:r.jsx(qm,{className:"w-4 h-4"})})]})})]})]}),r.jsxs(G,{children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-800 mb-3 flex items-center",children:[r.jsx(Xr,{className:"w-4 h-4 mr-2"}),"Template d'email suggéré pour EmailJS"]}),r.jsxs("div",{className:"bg-white p-3 rounded border text-xs font-mono overflow-x-auto",children:[r.jsx("div",{className:"text-gray-600 mb-2",children:"Variables à utiliser dans votre template EmailJS :"}),r.jsxs("div",{className:"space-y-1 text-gray-800",children:[r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{establishment_name}}"})," - Nom de l'établissement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{establishment_address}}"})," - Adresse de l'établissement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{establishment_phone}}"})," - Téléphone de l'établissement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{establishment_email}}"})," - Email de l'établissement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{establishment_nif}}"})," - NIF de l'établissement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{establishment_stat}}"})," - STAT de l'établissement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{receipt_number}}"})," - Numéro du reçu"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{date}}"})," - Date de la vente"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{cashier_name}}"})," - Nom du caissier"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{customer_name}}"})," - Nom du client"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{items_content}}"})," - Tableau HTML des articles"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{subtotal}}"})," - Sous-total"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{tax_amount}}"})," - Montant de la TVA"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{total_amount}}"})," - Montant total"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{payment_method}}"})," - Méthode de paiement"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{payment_amount}}"})," - Montant payé"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{change_amount}}"})," - Montant rendu (optionnel)"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{amount_in_words}}"})," - Montant en lettres (optionnel)"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{to_email}}"})," - Email du destinataire"]}),r.jsxs("div",{children:["• ",r.jsx("span",{className:"text-blue-600",children:"{{to_name}}"})," - Nom du destinataire"]})]})]}),r.jsx("div",{className:"mt-3",children:r.jsxs("a",{href:"https://dashboard.emailjs.com/admin/templates",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-700",children:[r.jsx(K5,{className:"w-4 h-4 mr-1"}),"Créer un template sur EmailJS"]})})]}),r.jsx(G,{children:r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx(O,{variant:"outline",onClick:P,disabled:!l||a,children:a?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Test en cours..."]}):r.jsxs(r.Fragment,{children:[r.jsx(t6,{className:"w-4 h-4 mr-2"}),"Tester la config"]})}),r.jsx(O,{onClick:y,disabled:u,children:u?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Sauvegarde..."]}):r.jsxs(r.Fragment,{children:[r.jsx($n,{className:"w-4 h-4 mr-2"}),"Sauvegarder la configuration"]})})]})}),l&&r.jsx(G,{children:r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Lt,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Configuration sauvegardée"}),r.jsx("p",{className:"text-sm text-green-700 mt-1",children:"EmailJS est maintenant configuré et sauvegardé. La configuration sera conservée après actualisation. Vous pouvez tester l'envoi d'emails."})]})]})})}),r.jsx(G,{children:r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Aide et support"}),r.jsxs("div",{className:"text-sm text-yellow-700 mt-1 space-y-1",children:[r.jsx("p",{children:"• EmailJS offre 200 emails gratuits par mois"}),r.jsx("p",{children:"• Assurez-vous que votre template contient toutes les variables nécessaires"}),r.jsx("p",{children:"• Testez d'abord avec votre propre email"}),r.jsx("p",{children:"• En cas de problème, vérifiez la console du navigateur"})]})]})]})})})]})},DD=()=>{const[t,e]=A.useState("general"),[s,n]=A.useState(!1),[i,a]=A.useState(null),[o,l]=A.useState(!1),[d,u]=A.useState([]),[m,h]=A.useState(!0),[f,x]=A.useState(null),[y,P]=A.useState(""),{user:_,signOut:C}=Le(),[k,T]=A.useState({name:"Nirina Nirina Pos Madagascar",address:"Antananarivo, Madagascar",phone:"+261 34 12 345 67",email:"contact@saaspos.mg",nif:"1234567890",stat:"12345678901234",currency:"MGA",taxRate:20,logo:""}),[S,D]=A.useState({autoOpenDrawer:!0,autoPrintReceipt:!1,defaultPaymentMethod:"cash",receiptFooter:"Merci de votre visite !",lowStockAlert:10,enableLoyalty:!0}),[R,v]=A.useState({name:"",email:"",password:"",role:"cashier",isActive:!0}),b=[{id:"general",label:"Général",icon:Ms},{id:"pos",label:"Point de Vente",icon:Hs},{id:"users",label:"Utilisateurs",icon:Ke},{id:"emails",label:"Emails",icon:Q5},{id:"emailjs",label:"Config EmailJS",icon:It},{id:"data",label:"Données",icon:Mo},{id:"printer",label:"Impression",icon:Oa},{id:"backup",label:"Sauvegarde",icon:Mo},{id:"security",label:"Sécurité",icon:Xe}];_!=null&&_.isSystemAdmin&&(b.push({id:"system-admin",label:"Admin Système",icon:Xe}),b.push({id:"admin-list",label:"Liste Admins",icon:Ke}),b.push({id:"all-users",label:"Tous les utilisateurs",icon:Ke}));const N=[{id:"admin",name:"Administrateur",description:"Accès complet au système"},{id:"manager",name:"Gérant",description:"Gestion de l'établissement"},{id:"cashier",name:"Caissier",description:"Ventes et caisse uniquement"},{id:"reader",name:"Lecteur",description:"Consultation seule"}],g=async()=>{if(_!=null&&_.establishmentId)try{h(!0);const $=Ne(je(H,"users"),oe("establishmentId","==",_.establishmentId)),he=(await _e($)).docs.map(Ae=>{var B,pe,Ce;const Ve=Ae.data();return{id:Ae.id,email:Ve.email,name:Ve.name,role:Ve.role,establishmentId:Ve.establishmentId,isActive:Ve.isActive??!0,isSuperAdmin:Ve.isSuperAdmin??!1,isSystemAdmin:Ve.isSystemAdmin??!1,isClientAdmin:Ve.isClientAdmin??!1,lastLogin:((B=Ve.lastLogin)==null?void 0:B.toDate())||null,createdAt:((pe=Ve.createdAt)==null?void 0:pe.toDate())||new Date,updatedAt:((Ce=Ve.updatedAt)==null?void 0:Ce.toDate())||new Date}});u(he)}catch($){console.error("Erreur lors du chargement des utilisateurs:",$),L.error("Erreur lors du chargement des utilisateurs")}finally{h(!1)}},w=async()=>{if(_!=null&&_.establishmentId)try{const $=await hs(me(H,"establishments",_.establishmentId));if($.exists()){const q=$.data();T({name:q.name||"Nirina Nirina Pos Madagascar",address:q.address||"Antananarivo, Madagascar",phone:q.phone||"+261 34 12 345 67",email:q.email||"contact@saaspos.mg",nif:q.nif||"1234567890",stat:q.stat||"12345678901234",currency:q.currency||"MGA",taxRate:q.taxRate||20,logo:q.logo||""})}}catch($){console.error("Erreur lors du chargement des paramètres:",$)}},I=async()=>{if(_!=null&&_.establishmentId)try{const $=await hs(me(H,"pos_settings",_.establishmentId));if($.exists()){const q=$.data();D({autoOpenDrawer:q.autoOpenDrawer??!0,autoPrintReceipt:q.autoPrintReceipt??!1,defaultPaymentMethod:q.defaultPaymentMethod||"cash",receiptFooter:q.receiptFooter||"Merci de votre visite !",lowStockAlert:q.lowStockAlert||10,enableLoyalty:q.enableLoyalty??!0})}}catch($){console.error("Erreur lors du chargement des paramètres POS:",$)}};A.useEffect(()=>{(t==="users"||t==="emails")&&g(),t==="general"&&w(),t==="pos"&&I()},[t,_==null?void 0:_.establishmentId]);const E=()=>{if(!(_!=null&&_.establishmentId)){L.error("Établissement non trouvé");return}l(!0),Ze(me(H,"establishments",_.establishmentId),{name:k.name,address:k.address,phone:k.phone,email:k.email,nif:k.nif,stat:k.stat,currency:k.currency,taxRate:k.taxRate,updatedAt:J.now()},{merge:!0}).then(()=>{L.success("Paramètres de l'établissement sauvegardés avec succès"),l(!1)}).catch($=>{console.error("Erreur lors de la sauvegarde:",$),L.error("Erreur lors de la sauvegarde des paramètres"),l(!1)})},ee=()=>{if(!(user!=null&&user.establishmentId)){L.error("Établissement non trouvé");return}l(!0),Ze(me(H,"pos_settings",user.establishmentId),{...S,establishmentId:user.establishmentId,updatedAt:J.now()}).then(()=>{L.success("Paramètres POS sauvegardés avec succès"),l(!1)}).catch($=>{console.error("Erreur lors de la sauvegarde:",$),L.error("Erreur lors de la sauvegarde des paramètres POS"),l(!1)})},V=async()=>{if(!R.name||!R.email||!R.password){L.error("Tous les champs sont requis");return}if(!(_!=null&&_.establishmentId)){L.error("Établissement non trouvé");return}if(_.role!=="admin"){L.error("Seuls les administrateurs peuvent ajouter des utilisateurs");return}if(as.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas créer de nouveaux utilisateurs");return}if(as.isSuperAdminEmail(R.email)){L.error("Cet email est réservé pour l'administration système. Veuillez utiliser une autre adresse email.");return}l(!0);try{const $=await nl(We,R.email,R.password);await al($.user,{displayName:R.name});const q={id:$.user.uid,email:R.email,name:R.name,role:R.role,establishmentId:_.establishmentId,isActive:R.isActive,isSuperAdmin:!1,isSystemAdmin:!1,isClientAdmin:R.role==="admin",lastLogin:null,createdAt:J.now(),updatedAt:J.now()};await Ze(me(H,"users",$.user.uid),q),await g(),v({name:"",email:"",password:"",role:"cashier",isActive:!0}),n(!1),L.success("Utilisateur ajouté avec succès")}catch($){let q="Erreur lors de l'ajout de l'utilisateur";if($!=null&&$.code)switch($.code){case"auth/email-already-in-use":q="Cette adresse email est déjà utilisée";break;case"auth/weak-password":q="Le mot de passe doit contenir au moins 6 caractères";break;case"auth/invalid-email":q="Format d'email invalide";break;case"auth/operation-not-allowed":q="Création de compte désactivée";break;case"auth/too-many-requests":q="Trop de tentatives. Veuillez réessayer plus tard";break;default:q=`Erreur Firebase: ${$.code}`}else $!=null&&$.message&&(q=$.message);L.error(q),console.error("Détails de l'erreur d'ajout d'utilisateur:",{code:$==null?void 0:$.code,message:$==null?void 0:$.message,email:R.email})}finally{l(!1)}},F=$=>{if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent modifier les utilisateurs");return}if(as.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas modifier d'autres utilisateurs");return}if($.isSystemAdmin){L.error("Les comptes Super Admin système ne peuvent pas être modifiés par cette méthode");return}a($),v({name:$.name,email:$.email,password:"",role:$.role,isActive:$.isActive}),n(!0),L.success(`Modification de l'utilisateur ${$.name}`)},X=async $=>{if($===(_==null?void 0:_.id)){L.error("Vous ne pouvez pas supprimer votre propre compte");return}if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent supprimer des utilisateurs");return}if(as.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas supprimer d'autres utilisateurs");return}const q=d.find(he=>he.id===$);if(q&&q.isSystemAdmin){L.error("Les comptes Super Admin système ne peuvent pas être supprimés par cette méthode");return}x($)},W=async()=>{if(f){if(!y){L.error("Mot de passe administrateur requis");return}if(y!=="admin123"){L.error("Mot de passe administrateur incorrect"),P("");return}l(!0);try{const $=d.find(q=>q.id===f);if(!$){L.error("Utilisateur non trouvé");return}await Ds(me(H,"users",f)),console.log("✅ Document Firestore supprimé");try{const q=Gj();q.currentUser&&await ca(q);try{await il(We,$.email,"password-inconnu"),We.currentUser&&await Mj(We.currentUser)}catch(Ae){console.log("Impossible de se connecter avec l'utilisateur à supprimer:",Ae)}if(_)try{await il(We,_.email,y)}catch(Ae){console.log("Erreur de reconnexion:",Ae),window.location.href="/login";return}}catch(q){console.log("Erreur lors de la tentative de suppression Auth:",q)}await g(),x(null),P(""),L.success("Utilisateur supprimé avec succès de la base de données"),L.info("Note: Pour supprimer complètement le compte de Firebase Authentication, utilisez la console Firebase.")}catch($){console.error("Erreur lors de la suppression complète:",$),L.error("Erreur lors de la suppression: "+$.message)}finally{l(!1)}}},re=async $=>{if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent modifier le statut des utilisateurs");return}if(as.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas modifier le statut des utilisateurs");return}const q=d.find(he=>he.id===$);if(q){if(q.isSystemAdmin){L.error("Le statut des comptes Super Admin ne peut pas être modifié par cette méthode");return}try{await pt(me(H,"users",$),{isActive:!q.isActive,updatedAt:J.now()}),await g(),L.success("Statut utilisateur mis à jour")}catch(he){console.error("Erreur lors de la mise à jour du statut:",he),L.error("Erreur lors de la mise à jour du statut")}}},Z=$=>{switch($){case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";case"cashier":return"bg-green-100 text-green-800";case"reader":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},se=$=>{const q=N.find(he=>he.id===$);return q?q.name:$},Y=async()=>{if(!i){L.error("Aucun utilisateur sélectionné pour la modification");return}if(!R.name){L.error("Le nom est requis");return}if((_==null?void 0:_.role)!=="admin"){L.error("Seuls les administrateurs peuvent modifier les utilisateurs");return}if(as.isDemoEmail(_.email)){L.error("Les comptes de démonstration ne peuvent pas modifier d'autres utilisateurs");return}if(i.isSystemAdmin){L.error("Les comptes Super Admin système ne peuvent pas être modifiés par cette méthode");return}l(!0);try{await pt(me(H,"users",i.id),{name:R.name,role:R.role,isActive:R.isActive,isClientAdmin:R.role==="admin",updatedAt:J.now()}),await g(),v({name:"",email:"",password:"",role:"cashier",isActive:!0}),n(!1),a(null),L.success("Utilisateur modifié avec succès")}catch($){console.error("Erreur lors de la modification de l'utilisateur:",$),L.error("Erreur lors de la modification de l'utilisateur")}finally{l(!1)}},U=()=>r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations de l'établissement"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(fe,{label:"Nom de l'établissement",value:k.name,onChange:$=>T({...k,name:$.target.value})}),r.jsx(fe,{label:"Adresse",value:k.address,onChange:$=>T({...k,address:$.target.value})}),r.jsx(fe,{label:"Téléphone",value:k.phone,onChange:$=>T({...k,phone:$.target.value})}),r.jsx(fe,{label:"Email",type:"email",value:k.email,onChange:$=>T({...k,email:$.target.value})}),r.jsx(fe,{label:"NIF",value:k.nif,onChange:$=>T({...k,nif:$.target.value})}),r.jsx(fe,{label:"STAT",value:k.stat,onChange:$=>T({...k,stat:$.target.value})}),r.jsx(fe,{label:"Devise",value:k.currency,onChange:$=>T({...k,currency:$.target.value})}),r.jsx(fe,{label:"Taux de TVA (%)",type:"number",value:k.taxRate.toString(),onChange:$=>T({...k,taxRate:parseInt($.target.value)})})]}),r.jsx("div",{className:"mt-6",children:r.jsxs(O,{onClick:E,disabled:o,children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),o?"Sauvegarde...":"Sauvegarder"]})})]}),K=()=>r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Configuration du Point de Vente"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ouverture automatique du tiroir-caisse"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Ouvrir automatiquement le tiroir après chaque vente"})]}),r.jsx("input",{type:"checkbox",checked:S.autoOpenDrawer,onChange:$=>D({...S,autoOpenDrawer:$.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Impression automatique des reçus"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Imprimer automatiquement après chaque vente"})]}),r.jsx("input",{type:"checkbox",checked:S.autoPrintReceipt,onChange:$=>D({...S,autoPrintReceipt:$.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mode de paiement par défaut"}),r.jsxs("select",{value:S.defaultPaymentMethod,onChange:$=>D({...S,defaultPaymentMethod:$.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"cash",children:"Espèces"}),r.jsx("option",{value:"card",children:"Carte"}),r.jsx("option",{value:"mobile",children:"Mobile Money"})]})]}),r.jsx(fe,{label:"Pied de page des reçus",value:S.receiptFooter,onChange:$=>D({...S,receiptFooter:$.target.value}),placeholder:"Message à afficher en bas des reçus"}),r.jsx(fe,{label:"Seuil d'alerte stock faible",type:"number",value:S.lowStockAlert.toString(),onChange:$=>D({...S,lowStockAlert:parseInt($.target.value)})}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Programme de fidélité"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Activer le système de points de fidélité"})]}),r.jsx("input",{type:"checkbox",checked:S.enableLoyalty,onChange:$=>D({...S,enableLoyalty:$.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})]})]}),r.jsx("div",{className:"mt-6",children:r.jsxs(O,{onClick:ee,disabled:o,children:[r.jsx(ji,{className:"w-4 h-4 mr-2"}),o?"Sauvegarde...":"Sauvegarder"]})})]}),de=()=>r.jsx("div",{className:"space-y-6",children:r.jsxs(G,{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Gestion des utilisateurs"}),(_==null?void 0:_.role)==="admin"&&!as.isDemoEmail(_.email)&&r.jsxs(O,{onClick:()=>n(!0),children:[r.jsx(Rt,{className:"w-4 h-4 mr-2"}),"Ajouter un utilisateur"]})]}),m?r.jsxs("div",{className:"text-center py-8",children:[r.jsx(qs,{className:"w-8 h-8 animate-spin mx-auto text-gray-400"}),r.jsx("p",{className:"text-gray-500 mt-2",children:"Chargement des utilisateurs..."})]}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Utilisateur"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rôle"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dernière connexion"}),r.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map($=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:r.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:r.jsx(Ke,{className:"w-5 h-5 text-gray-600"})})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:$.name}),r.jsx("div",{className:"text-sm text-gray-500",children:$.email})]})]})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Z($.role)}`,children:se($.role)}),$.isSystemAdmin&&r.jsx("span",{className:"ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:"Super Admin"})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${$.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:$.isActive?"Actif":"Inactif"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:$.lastLogin?$.lastLogin.toLocaleDateString():"Jamais"}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:r.jsx("div",{className:"flex items-center justify-end space-x-2",children:(_==null?void 0:_.role)==="admin"&&!as.isDemoEmail(_.email)&&!$.isSystemAdmin&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>F($),className:"text-blue-600 hover:text-blue-900",children:r.jsx(wr,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>re($.id),className:$.isActive?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900",children:$.isActive?r.jsx(pl,{className:"w-4 h-4"}):r.jsx(As,{className:"w-4 h-4"})}),$.id!==(_==null?void 0:_.id)&&r.jsx("button",{onClick:()=>X($.id),className:"text-red-600 hover:text-red-900",children:r.jsx(ms,{className:"w-4 h-4"})})]})})})]},$.id))})]})})]})}),ne=()=>r.jsx(ID,{users:d}),be=()=>r.jsx(PD,{onClose:()=>e("general")}),ke=()=>r.jsx(AD,{}),Fe=()=>r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sauvegarde et restauration"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Sauvegarde automatique"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Sauvegarde quotidienne de vos données"})]}),r.jsxs(O,{variant:"outline",onClick:()=>L.info("Fonctionnalité de sauvegarde en cours de développement"),children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Télécharger"]})]}),r.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900",children:"Restaurer les données"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Restaurer à partir d'une sauvegarde"})]}),r.jsxs(O,{variant:"outline",onClick:()=>L.info("Fonctionnalité de restauration en cours de développement"),children:[r.jsx(Fu,{className:"w-4 h-4 mr-2"}),"Restaurer"]})]})]})]}),ue=()=>r.jsx(kD,{}),we=()=>r.jsx(TD,{}),ye=()=>r.jsx(RD,{});return r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Paramètres"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Configurez votre système de point de vente"})]})}),r.jsx("div",{className:"border-b border-gray-200 overflow-x-auto",children:r.jsx("nav",{className:"-mb-px flex space-x-8",children:b.map($=>{const q=$.icon;return r.jsxs("button",{onClick:()=>e($.id),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${t===$.id?$.id==="system-admin"?"border-red-500 text-red-600":"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[r.jsx(q,{className:"w-4 h-4"}),r.jsx("span",{children:$.label})]},$.id)})})}),r.jsxs("div",{children:[t==="general"&&U(),t==="pos"&&K(),t==="users"&&de(),t==="emails"&&ne(),t==="emailjs"&&be(),t==="data"&&ke(),t==="backup"&&Fe(),t==="system-admin"&&ue(),t==="admin-list"&&we(),t==="all-users"&&ye(),t==="printer"&&r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Configuration d'impression"}),r.jsx("p",{className:"text-gray-600",children:"Module d'impression en cours de développement..."})]}),t==="security"&&r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Paramètres de sécurité"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Module de sécurité en cours de développement..."})]}),r.jsx(G,{className:"bg-red-50 border-red-200",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(cs,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Restriction de sécurité active"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:"La création, modification et suppression de comptes Super Admin système est désactivée pour des raisons de sécurité. Ces opérations sont réservées uniquement aux processus internes sécurisés."})]})]})}),r.jsx(CD,{})]})]}),s&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-md",padding:"lg",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:i?"Modifier l'utilisateur":"Ajouter un utilisateur"}),r.jsxs("div",{className:"space-y-4",children:[r.jsx(fe,{label:"Nom complet",value:R.name,onChange:$=>v({...R,name:$.target.value}),placeholder:"Ex: Marie Dupont",disabled:o}),r.jsx(fe,{label:"Adresse email",type:"email",value:R.email,onChange:$=>v({...R,email:$.target.value}),placeholder:"marie@nirinanirina.mg",disabled:o||!!i}),!i&&r.jsx(fe,{label:"Mot de passe",type:"password",value:R.password,onChange:$=>v({...R,password:$.target.value}),placeholder:"••••••••",disabled:o}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rôle"}),r.jsx("select",{value:R.role,onChange:$=>v({...R,role:$.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:o,children:N.map($=>r.jsxs("option",{value:$.id,children:[$.name," - ",$.description]},$.id))})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"isActive",checked:R.isActive,onChange:$=>v({...R,isActive:$.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:o}),r.jsx("label",{htmlFor:"isActive",className:"ml-2 text-sm text-gray-700",children:"Utilisateur actif"})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[r.jsx(O,{variant:"ghost",onClick:()=>{n(!1),a(null),v({name:"",email:"",password:"",role:"cashier",isActive:!0})},disabled:o,children:"Annuler"}),r.jsx(O,{onClick:i?Y:V,disabled:o,children:o?"Traitement en cours...":i?"Mettre à jour":"Ajouter"})]})]})}),f&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsx(G,{className:"w-full max-w-md",padding:"lg",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(Oe,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Suppression complète de l'utilisateur"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Cette action supprimera l'utilisateur de Firestore ET de Firebase Authentication. Cette action est irréversible."}),r.jsxs("div",{className:"mb-6",children:[r.jsx(fe,{label:"Mot de passe administrateur",type:"password",value:y,onChange:$=>P($.target.value),placeholder:"Saisissez votre mot de passe admin"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Veuillez saisir votre mot de passe administrateur pour confirmer cette action."})]}),r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(Oe,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0"}),r.jsxs("div",{className:"text-sm text-yellow-800",children:[r.jsx("p",{className:"font-medium",children:"⚠️ Attention :"}),r.jsxs("ul",{className:"mt-2 space-y-1 text-left",children:[r.jsx("li",{children:"• Suppression du document Firestore"}),r.jsx("li",{children:"• Suppression du compte Firebase Auth"}),r.jsx("li",{children:"• Action irréversible"})]})]})]})}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx(O,{variant:"ghost",fullWidth:!0,onClick:()=>{x(null),P("")},disabled:o,children:"Annuler"}),r.jsx(O,{variant:"danger",fullWidth:!0,onClick:W,disabled:o||!y.trim(),children:o?"Suppression...":"Supprimer définitivement"})]})]})})})]})},MD=[{id:"starter",name:"Starter",price:15e3,maxUsers:2,maxProducts:100,features:["Point de vente basique","Gestion des produits","Gestion des clients","Rapports simples","Support par email"]},{id:"business",name:"Business",price:35e3,maxUsers:10,maxProducts:1e3,isPopular:!0,features:["Toutes les fonctionnalités Starter","Gestion des dépenses","Rapports avancés","Gestion multi-utilisateurs","Sauvegarde automatique","Support prioritaire"]},{id:"enterprise",name:"Enterprise",price:75e3,maxUsers:-1,maxProducts:-1,features:["Toutes les fonctionnalités Business","Établissements multiples","API Access","Formations personnalisées","Support dédié 24/7","Personnalisation avancée"]}],LD=({onSelectPlan:t,currentPlan:e})=>{const s=i=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(i).replace("MGA","Ar"),n=i=>i.includes("utilisateur")?r.jsx(Ke,{className:"w-4 h-4"}):i.includes("produit")?r.jsx(ht,{className:"w-4 h-4"}):i.includes("rapport")?r.jsx(Vu,{className:"w-4 h-4"}):i.includes("support")?r.jsx(Y5,{className:"w-4 h-4"}):i.includes("API")?r.jsx(gl,{className:"w-4 h-4"}):r.jsx(w1,{className:"w-4 h-4"});return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Choisissez votre plan d'abonnement"}),r.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Sélectionnez le plan qui correspond le mieux aux besoins de votre établissement. Tous les plans incluent 14 jours d'essai gratuit."})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto",children:MD.map(i=>r.jsxs(G,{className:`relative ${i.isPopular?"border-blue-500 shadow-lg scale-105":"border-gray-200"}`,padding:"lg",children:[i.isPopular&&r.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:r.jsxs("span",{className:"bg-blue-500 text-white px-4 py-1 rounded-full text-sm font-medium flex items-center",children:[r.jsx(fl,{className:"w-4 h-4 mr-1"}),"Plus populaire"]})}),r.jsxs("div",{className:"text-center mb-6",children:[r.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:i.name}),r.jsxs("div",{className:"mb-4",children:[r.jsx("span",{className:"text-4xl font-bold text-blue-600",children:s(i.price)}),r.jsx("span",{className:"text-gray-600",children:"/mois"})]}),r.jsxs("div",{className:"flex justify-center space-x-4 text-sm text-gray-600 mb-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(Ke,{className:"w-4 h-4 mr-1"}),i.maxUsers===-1?"Illimité":`${i.maxUsers} utilisateurs`]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(ht,{className:"w-4 h-4 mr-1"}),i.maxProducts===-1?"Illimité":`${i.maxProducts} produits`]})]})]}),r.jsx("div",{className:"space-y-3 mb-8",children:i.features.map((a,o)=>r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0 mt-0.5",children:n(a)}),r.jsx("span",{className:"text-sm text-gray-700",children:a})]},o))}),r.jsx(O,{fullWidth:!0,variant:i.isPopular?"primary":"ghost",onClick:()=>t(i.id),disabled:e===i.id,children:e===i.id?"Plan actuel":"Choisir ce plan"})]},i.id))}),r.jsxs("div",{className:"text-center text-sm text-gray-600",children:[r.jsx("p",{children:"💡 Tous les plans incluent 14 jours d'essai gratuit"}),r.jsx("p",{children:"🔒 Paiement sécurisé • 📞 Support en français • 🇲🇬 Adapté pour Madagascar"})]})]})},VD=({subscription:t,onUpgrade:e})=>{const s=d=>{switch(d){case"trial":return"bg-blue-100 text-blue-800 border-blue-200";case"active":return"bg-green-100 text-green-800 border-green-200";case"expired":return"bg-red-100 text-red-800 border-red-200";case"suspended":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},n=d=>{switch(d){case"trial":return r.jsx(Es,{className:"w-5 h-5"});case"active":return r.jsx(Lt,{className:"w-5 h-5"});case"expired":return r.jsx(Oe,{className:"w-5 h-5"});case"suspended":return r.jsx(Oe,{className:"w-5 h-5"});default:return r.jsx(Es,{className:"w-5 h-5"})}},i=d=>{switch(d){case"trial":return"Période d'essai";case"active":return"Actif";case"expired":return"Expiré";case"suspended":return"Suspendu";default:return d}},a=d=>{switch(d){case"starter":return"Starter";case"business":return"Business";case"enterprise":return"Enterprise";case"trial":return"Essai gratuit";default:return d}},o=t.daysLeft<=7,l=t.daysLeft<=0;return r.jsxs(G,{className:`${o?"border-orange-200 bg-orange-50":""}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:`p-3 rounded-lg ${t.status==="active"?"bg-green-100":t.status==="trial"?"bg-blue-100":"bg-gray-100"}`,children:r.jsx(N1,{className:`w-8 h-8 ${t.status==="active"?"text-green-600":t.status==="trial"?"text-blue-600":"text-gray-600"}`})}),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Plan ",a(t.plan)]}),r.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[n(t.status),r.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${s(t.status)}`,children:i(t.status)})]})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"flex items-center text-gray-600 mb-1",children:[r.jsx(ut,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"text-sm",children:l?"Expiré le":"Expire le"})]}),r.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.endDate.toLocaleDateString("fr-FR")}),r.jsx("p",{className:`text-sm font-medium ${l?"text-red-600":o?"text-orange-600":"text-green-600"}`,children:l?"Expiré":`${t.daysLeft} jours restants`})]})]}),(o||l)&&r.jsx("div",{className:"mt-4 p-4 bg-orange-100 border border-orange-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx(Oe,{className:"w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-orange-800",children:l?"Abonnement expiré":"Abonnement bientôt expiré"}),r.jsx("p",{className:"text-sm text-orange-700 mt-1",children:l?"Votre abonnement a expiré. Renouvelez-le pour continuer à utiliser toutes les fonctionnalités.":`Votre abonnement expire dans ${t.daysLeft} jours. Renouvelez-le pour éviter toute interruption de service.`}),r.jsxs(O,{size:"sm",className:"mt-3",onClick:e,children:[r.jsx(gl,{className:"w-4 h-4 mr-2"}),l?"Renouveler maintenant":"Renouveler l'abonnement"]})]})]})}),t.status==="trial"&&!o&&r.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx(Lt,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-blue-800",children:"Période d'essai active"}),r.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Profitez de toutes les fonctionnalités gratuitement pendant votre période d'essai. Vous pourrez choisir un plan avant la fin de votre essai."})]})]})})]})},xv=[{id:"mvola",name:"MVola",icon:rr,color:"text-red-600",instructions:"Envoyez le montant au numéro MVola : +261 34 XX XXX XX"},{id:"orange_money",name:"Orange Money",icon:rr,color:"text-orange-600",instructions:"Envoyez le montant au numéro Orange Money : +261 32 XX XXX XX"},{id:"airtel_money",name:"Airtel Money",icon:rr,color:"text-red-600",instructions:"Envoyez le montant au numéro Airtel Money : +261 33 XX XXX XX"},{id:"bank_transfer",name:"Virement bancaire",icon:Yr,color:"text-blue-600",instructions:"Effectuez un virement vers : BNI Madagascar - Compte : 12345678901"},{id:"cash",name:"Espèces",icon:Va,color:"text-green-600",instructions:"Déposez le montant dans nos bureaux à Antananarivo"}],OD=({subscriptionId:t,amount:e,onSubmit:s,onCancel:n,isLoading:i=!1})=>{const[a,o]=A.useState({paymentMethod:"mvola",paymentReference:"",notes:""}),[l,d]=A.useState({}),u=y=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(y).replace("MGA","Ar"),m=xv.find(y=>y.id===a.paymentMethod),h=(y,P)=>{o(_=>({..._,[y]:P})),l[y]&&d(_=>({..._,[y]:""}))},f=()=>{const y={};return a.paymentReference.trim()||(y.paymentReference="La référence de paiement est requise"),d(y),Object.keys(y).length===0},x=y=>{y.preventDefault(),f()&&s({subscriptionId:t,amount:e,...a})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Demande de paiement"}),r.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("form",{onSubmit:x,className:"p-6",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Montant à payer"}),r.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:u(e)})]})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Méthode de paiement *"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:xv.map(y=>{const P=y.icon;return r.jsx("button",{type:"button",onClick:()=>h("paymentMethod",y.id),className:`p-4 border-2 rounded-lg transition-all ${a.paymentMethod===y.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(P,{className:`w-6 h-6 ${y.color}`}),r.jsx("span",{className:"font-medium text-gray-900",children:y.name})]})},y.id)})})]}),m&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx(Pn,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-yellow-800",children:"Instructions de paiement"}),r.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:m.instructions})]})]})}),r.jsx(fe,{label:"Référence de paiement *",value:a.paymentReference,onChange:y=>h("paymentReference",y.target.value),error:l.paymentReference,placeholder:"Ex: Transaction ID, numéro de reçu, etc.",leftIcon:r.jsx(Hs,{className:"w-4 h-4"})}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optionnel)"}),r.jsx("textarea",{value:a.notes,onChange:y=>h("notes",y.target.value),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Informations supplémentaires sur le paiement..."})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Preuve de paiement (optionnel)"}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx(Fu,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),r.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Téléchargez une capture d'écran ou photo du reçu"}),r.jsx(O,{variant:"ghost",size:"sm",type:"button",children:"Choisir un fichier"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formats acceptés: JPG, PNG, PDF (max 5MB)"})]})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"⏰ Délai de traitement"}),r.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[r.jsx("li",{children:"• MVola/Orange Money/Airtel Money: 2-4 heures ouvrables"}),r.jsx("li",{children:"• Virement bancaire: 1-2 jours ouvrables"}),r.jsx("li",{children:"• Espèces: Immédiat lors du dépôt"})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 mt-8 pt-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:n,disabled:i,children:"Annuler"}),r.jsx(O,{type:"submit",disabled:i,children:i?"Envoi en cours...":"Envoyer la demande"})]})]})]})})},FD=()=>{const[t,e]=A.useState(!1),[s,n]=A.useState(null),[i,a]=A.useState(!1),[o,l]=A.useState(null),[d,u]=A.useState([]),[m,h]=A.useState(!0),[f,x]=A.useState(!1),{user:y}=Le(),P={starter:15e3,business:35e3,enterprise:75e3},_=async()=>{var v,b,N,g,w,I;if(y!=null&&y.establishmentId)try{h(!0);const E=await hs(me(H,"subscriptions",`sub_${y.establishmentId}`));if(E.exists()){const W=E.data();l({...W,startDate:(v=W.startDate)==null?void 0:v.toDate(),endDate:(b=W.endDate)==null?void 0:b.toDate(),trialEndDate:(N=W.trialEndDate)==null?void 0:N.toDate(),lastPaymentDate:(g=W.lastPaymentDate)==null?void 0:g.toDate(),nextPaymentDate:(w=W.nextPaymentDate)==null?void 0:w.toDate(),daysLeft:Math.ceil((((I=W.endDate)==null?void 0:I.toDate().getTime())-Date.now())/(1e3*60*60*24))})}else{const W=new Date(Date.now()+12096e5),re={id:`sub_${y.establishmentId}`,establishmentId:y.establishmentId,establishmentName:y.name||"Mon Établissement",plan:"trial",status:"trial",startDate:new Date,endDate:W,trialEndDate:W,monthlyPrice:0,nextPaymentDate:W,daysLeft:14,createdAt:new Date,updatedAt:new Date};l(re),await Ze(me(H,"subscriptions",`sub_${y.establishmentId}`),{...re,startDate:J.fromDate(re.startDate),endDate:J.fromDate(re.endDate),trialEndDate:J.fromDate(re.trialEndDate),nextPaymentDate:J.fromDate(re.nextPaymentDate),createdAt:J.now(),updatedAt:J.now()})}const ee=Ne(je(H,"payment_requests"),oe("establishmentId","==",y.establishmentId)),X=(await _e(ee)).docs.map(W=>{var Z,se;const re=W.data();return{id:W.id,...re,submittedAt:(Z=re.submittedAt)==null?void 0:Z.toDate(),processedAt:(se=re.processedAt)==null?void 0:se.toDate()}}).sort((W,re)=>!W.submittedAt||!re.submittedAt?0:re.submittedAt.getTime()-W.submittedAt.getTime());u(X)}catch(E){console.error("Erreur lors du chargement des données:",E),L.error("Erreur lors du chargement des données d'abonnement")}finally{h(!1),x(!1)}};A.useEffect(()=>{if(!(y!=null&&y.establishmentId))return;const v=me(H,"subscriptions",`sub_${y.establishmentId}`),b=zP(v,N=>{var g,w,I,E,ee,V;if(N.exists()){const F=N.data();l({...F,startDate:(g=F.startDate)==null?void 0:g.toDate(),endDate:(w=F.endDate)==null?void 0:w.toDate(),trialEndDate:(I=F.trialEndDate)==null?void 0:I.toDate(),lastPaymentDate:(E=F.lastPaymentDate)==null?void 0:E.toDate(),nextPaymentDate:(ee=F.nextPaymentDate)==null?void 0:ee.toDate(),daysLeft:Math.ceil((((V=F.endDate)==null?void 0:V.toDate().getTime())-Date.now())/(1e3*60*60*24))})}},N=>{console.error("Erreur lors de l'écoute des changements d'abonnement:",N)});return()=>b()},[y==null?void 0:y.establishmentId]),A.useEffect(()=>{_()},[y==null?void 0:y.establishmentId]);const C=v=>{n(v),e(!0)},k=async v=>{if(!(y!=null&&y.establishmentId)){L.error("Établissement non trouvé");return}a(!0);try{const b=`payment_${Date.now()}`,N={id:b,subscriptionId:`sub_${y.establishmentId}`,establishmentId:y.establishmentId,establishmentName:(o==null?void 0:o.establishmentName)||"Mon Établissement",amount:v.amount,paymentMethod:v.paymentMethod,paymentReference:v.paymentReference,status:"pending",submittedAt:J.now(),notes:v.notes,createdAt:J.now(),updatedAt:J.now()};if(await Ze(me(H,"payment_requests",b),N),s){const g=o.endDate,w=new Date,I=g>w?g:w,E=new Date(I);E.setDate(E.getDate()+30),await pt(me(H,"subscriptions",`sub_${y.establishmentId}`),{plan:s,status:"pending_payment",endDate:J.fromDate(E),nextPaymentDate:J.fromDate(E),monthlyPrice:P[s],updatedAt:J.now()}),await _()}e(!1),n(null),L.success("Demande de paiement envoyée avec succès !"),L("Votre demande sera traitée dans les prochaines heures.")}catch(b){console.error("Erreur lors de l'envoi de la demande:",b),L.error("Erreur lors de l'envoi de la demande")}finally{a(!1)}},T=()=>{x(!0),_()},S=v=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(v).replace("MGA","Ar"),D=v=>{switch(v){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=v=>{switch(v){case"pending":return"En attente";case"approved":return"Approuvé";case"rejected":return"Rejeté";default:return v}};return m?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement de votre abonnement..."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestion de votre abonnement"}),r.jsx("p",{className:"text-gray-600",children:"Gérez votre abonnement Nirina Nirina Pos et accédez à toutes les fonctionnalités pour développer votre business à Madagascar."})]}),r.jsxs(O,{variant:"ghost",onClick:T,disabled:f,children:[r.jsx(qs,{className:`w-4 h-4 mr-2 ${f?"animate-spin":""}`}),"Actualiser"]})]}),o&&r.jsx(VD,{subscription:o,onUpgrade:()=>e(!0)}),o&&o.status==="pending_payment"&&r.jsx(G,{className:"bg-yellow-50 border-yellow-200",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx(Es,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-yellow-800",children:"Paiement en attente de validation"}),r.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["Votre demande de paiement pour le plan ",r.jsx("strong",{children:s||o.plan})," est en cours de traitement. Votre abonnement sera activé dès que notre équipe aura validé votre paiement."]}),r.jsx("p",{className:"text-sm text-yellow-700 mt-2",children:"Délai de traitement habituel : 2-4 heures ouvrables."})]})]})}),d.length>0&&r.jsxs(G,{children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[r.jsx(X5,{className:"w-5 h-5 mr-2"}),"Historique des paiements"]}),r.jsxs(O,{variant:"ghost",size:"sm",children:[r.jsx(ls,{className:"w-4 h-4 mr-2"}),"Exporter"]})]}),r.jsx("div",{className:"space-y-3",children:d.slice(0,5).map(v=>{var b;return r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-sm text-gray-900",children:S(v.amount)}),r.jsxs("p",{className:"text-xs text-gray-600",children:[v.paymentMethod," • ",v.paymentReference]})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D(v.status)}`,children:R(v.status)}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(b=v.submittedAt)==null?void 0:b.toLocaleDateString("fr-FR")})]})]},v.id)})})]}),r.jsx(LD,{onSelectPlan:C,currentPlan:o==null?void 0:o.plan}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"💳 Méthodes de paiement acceptées"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-red-600 font-bold text-sm",children:"M"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"MVola"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Paiement mobile"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-orange-600 font-bold text-sm",children:"O"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Orange Money"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Paiement mobile"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-red-600 font-bold text-sm",children:"A"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Airtel Money"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Paiement mobile"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[r.jsx(Hs,{className:"w-8 h-8 text-blue-600"}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Virement bancaire"}),r.jsx("p",{className:"text-sm text-gray-600",children:"BNI, BOA, BFV"})]})]}),r.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg",children:[r.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:r.jsx("span",{className:"text-green-600 font-bold text-sm",children:"💰"})}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:"Espèces"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Dépôt en agence"})]})]})]})]}),r.jsxs(G,{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"🆘 Besoin d'aide ?"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Contact Support"}),r.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[r.jsx("p",{children:"📧 Email: admin@saasmada.pro"}),r.jsx("p",{children:"📱 WhatsApp: +261 32 46 118 07"}),r.jsx("p",{children:"🕒 Lundi - Vendredi: 8h - 17h"})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Questions fréquentes"}),r.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[r.jsx("p",{children:"• Comment changer de plan ?"}),r.jsx("p",{children:"• Délai de validation des paiements"}),r.jsx("p",{children:"• Remboursement et annulation"}),r.jsx("p",{children:"• Formation et support technique"})]})]})]})]}),t&&r.jsx(OD,{subscriptionId:`sub_${y==null?void 0:y.establishmentId}`,amount:s?P[s]:(o==null?void 0:o.monthlyPrice)||0,onSubmit:k,onCancel:()=>{e(!1),n(null)},isLoading:i})]})},$D=({request:t,onClose:e,onApprove:s,onReject:n})=>{const i=u=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(u).replace("MGA","Ar"),a=u=>{switch(u){case"mvola":return r.jsx(rr,{className:"w-5 h-5 text-red-600"});case"orange_money":return r.jsx(rr,{className:"w-5 h-5 text-orange-600"});case"airtel_money":return r.jsx(rr,{className:"w-5 h-5 text-red-600"});case"bank_transfer":return r.jsx(Yr,{className:"w-5 h-5 text-blue-600"});case"cash":return r.jsx(Va,{className:"w-5 h-5 text-green-600"});default:return r.jsx(Hs,{className:"w-5 h-5 text-gray-600"})}},o=u=>({mvola:"MVola",orange_money:"Orange Money",airtel_money:"Airtel Money",bank_transfer:"Virement bancaire",cash:"Espèces"})[u]||u,l=u=>{switch(u){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},d=u=>{switch(u){case"pending":return"En attente";case"approved":return"Approuvé";case"rejected":return"Rejeté";default:return u}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs(G,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",padding:"none",children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[r.jsx(Xr,{className:"w-6 h-6 mr-2"}),"Détails de la demande de paiement"]}),r.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(bt,{className:"w-5 h-5"})})]}),r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(St,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Établissement"}),r.jsx("p",{className:"font-semibold text-gray-900",children:t.establishmentName})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(ut,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Date de soumission"}),r.jsxs("p",{className:"font-semibold text-gray-900",children:[t.submittedAt.toLocaleDateString("fr-FR")," à ",t.submittedAt.toLocaleTimeString("fr-FR")]})]})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(kt,{className:"w-5 h-5 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Montant"}),r.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i(t.amount)})]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"mr-3",children:a(t.paymentMethod)}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Méthode de paiement"}),r.jsx("p",{className:"font-semibold text-gray-900",children:o(t.paymentMethod)})]})]})]})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Référence de paiement"}),r.jsx("p",{className:"font-mono text-lg text-gray-800 bg-white p-3 rounded border",children:t.paymentReference})]}),t.notes&&r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Notes"}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:r.jsx("p",{className:"text-gray-700",children:t.notes})})]}),r.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Statut de la demande"}),r.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-semibold rounded-full border ${l(t.status)}`,children:d(t.status)})]}),t.processedAt&&r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Traité le"}),r.jsx("p",{className:"font-medium text-gray-900",children:t.processedAt.toLocaleDateString("fr-FR")}),t.processedBy&&r.jsxs("p",{className:"text-sm text-gray-500",children:["par ",t.processedBy]})]})]}),r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[r.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Instructions de vérification"}),r.jsxs("div",{className:"text-sm text-yellow-700",children:[t.paymentMethod==="mvola"&&r.jsx("p",{children:"Vérifiez la transaction MVola avec la référence fournie dans votre historique des transactions."}),t.paymentMethod==="orange_money"&&r.jsx("p",{children:"Vérifiez la transaction Orange Money avec la référence fournie dans votre historique des transactions."}),t.paymentMethod==="airtel_money"&&r.jsx("p",{children:"Vérifiez la transaction Airtel Money avec la référence fournie dans votre historique des transactions."}),t.paymentMethod==="bank_transfer"&&r.jsx("p",{children:"Vérifiez le virement bancaire dans votre compte avec la référence fournie."}),t.paymentMethod==="cash"&&r.jsx("p",{children:"Vérifiez le dépôt d'espèces avec la référence fournie auprès de votre agence."})]})]})]}),r.jsxs("div",{className:"flex justify-between gap-3 p-6 border-t border-gray-200",children:[r.jsx(O,{variant:"ghost",onClick:e,children:"Fermer"}),t.status==="pending"&&r.jsxs("div",{className:"flex gap-3",children:[r.jsxs(O,{variant:"danger",onClick:()=>{n(t.id),e()},children:[r.jsx(ua,{className:"w-4 h-4 mr-2"}),"Rejeter"]}),r.jsxs(O,{variant:"success",onClick:()=>{s(t.id),e()},children:[r.jsx(Lt,{className:"w-4 h-4 mr-2"}),"Approuver"]})]})]})]})})},zD=()=>{const[t,e]=A.useState([]),[s,n]=A.useState("pending"),[i,a]=A.useState(""),[o,l]=A.useState(!0),[d,u]=A.useState(null),[m,h]=A.useState(!1),{user:f}=Le(),x=async()=>{try{l(!0);let v;s==="all"?v=Ne(je(H,"payment_requests")):v=Ne(je(H,"payment_requests"),oe("status","==",s));const g=(await _e(v)).docs.map(w=>{var E,ee,V,F;const I=w.data();return{id:w.id,...I,submittedAt:((E=I.submittedAt)==null?void 0:E.toDate())||new Date,processedAt:(ee=I.processedAt)==null?void 0:ee.toDate(),createdAt:((V=I.createdAt)==null?void 0:V.toDate())||new Date,updatedAt:((F=I.updatedAt)==null?void 0:F.toDate())||new Date}}).sort((w,I)=>I.submittedAt.getTime()-w.submittedAt.getTime());e(g)}catch(v){console.error("Erreur lors du chargement des demandes:",v),L.error("Erreur lors du chargement des demandes")}finally{l(!1)}};A.useEffect(()=>{(f==null?void 0:f.role)==="admin"&&x()},[s,f]);const y=async v=>{var b;if(window.confirm("Êtes-vous sûr de vouloir approuver ce paiement ?"))try{const N=t.find(I=>I.id===v);if(!N){L.error("Demande de paiement non trouvée");return}await pt(me(H,"payment_requests",v),{status:"approved",processedAt:J.now(),processedBy:(f==null?void 0:f.name)||"Admin"});const g=N.subscriptionId,w=await hs(me(H,"subscriptions",g));if(w.exists()){const E=((b=w.data().endDate)==null?void 0:b.toDate())||new Date,ee=new Date,V=E>ee?E:ee,F=new Date(V);F.setDate(F.getDate()+30),await pt(me(H,"subscriptions",g),{status:"active",endDate:J.fromDate(F),nextPaymentDate:J.fromDate(F),lastPaymentDate:J.now(),updatedAt:J.now()})}await x(),L.success("Paiement approuvé avec succès")}catch(N){console.error("Erreur lors de l'approbation:",N),L.error("Erreur lors de l'approbation")}},P=async(v,b)=>{var N;if(window.confirm("Êtes-vous sûr de vouloir rejeter ce paiement ?"))try{const g=t.find(E=>E.id===v);if(!g){L.error("Demande de paiement non trouvée");return}await pt(me(H,"payment_requests",v),{status:"rejected",processedAt:J.now(),processedBy:(f==null?void 0:f.name)||"Admin",notes:b||"Paiement rejeté par l'administrateur"});const w=g.subscriptionId,I=await hs(me(H,"subscriptions",w));if(I.exists()){const E=I.data();E.status==="pending_payment"&&await pt(me(H,"subscriptions",w),{status:((N=E.endDate)==null?void 0:N.toDate())<new Date?"expired":"active",updatedAt:J.now()})}await x(),L.success("Paiement rejeté")}catch(g){console.error("Erreur lors du rejet:",g),L.error("Erreur lors du rejet")}},_=v=>{u(v),h(!0)},C=v=>new Intl.NumberFormat("mg-MG",{style:"currency",currency:"MGA",minimumFractionDigits:0}).format(v).replace("MGA","Ar"),k=v=>{switch(v){case"pending":return r.jsx(Es,{className:"w-4 h-4 text-yellow-600"});case"approved":return r.jsx(Lt,{className:"w-4 h-4 text-green-600"});case"rejected":return r.jsx(ua,{className:"w-4 h-4 text-red-600"});default:return r.jsx(Es,{className:"w-4 h-4 text-gray-600"})}},T=v=>{switch(v){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},S=v=>({mvola:"MVola",orange_money:"Orange Money",airtel_money:"Airtel Money",bank_transfer:"Virement bancaire",cash:"Espèces"})[v]||v,D=t.filter(v=>v.establishmentName.toLowerCase().includes(i.toLowerCase())||v.paymentReference.toLowerCase().includes(i.toLowerCase())),R={pending:t.filter(v=>v.status==="pending").length,approved:t.filter(v=>v.status==="approved").length,rejected:t.filter(v=>v.status==="rejected").length,totalAmount:t.filter(v=>v.status==="pending").reduce((v,b)=>v+b.amount,0)};return(f==null?void 0:f.role)!=="admin"?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Oe,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Accès restreint"}),r.jsx("p",{className:"text-gray-600",children:"Seuls les administrateurs peuvent accéder à cette section."})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Validation des paiements"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Gérez les demandes de paiement des abonnements clients"})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:r.jsx(Es,{className:"w-6 h-6 text-yellow-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"En attente"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.pending})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:r.jsx(Lt,{className:"w-6 h-6 text-green-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approuvés"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.approved})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:r.jsx(ua,{className:"w-6 h-6 text-red-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejetés"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:R.rejected})]})]})}),r.jsx(G,{padding:"md",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:r.jsx(kt,{className:"w-6 h-6 text-blue-600"})}),r.jsxs("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Montant en attente"}),r.jsx("p",{className:"text-xl font-bold text-gray-900",children:C(R.totalAmount)})]})]})})]}),r.jsx(G,{children:r.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"relative",children:[r.jsx(Is,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Rechercher par établissement ou référence...",value:i,onChange:v=>a(v.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})}),r.jsxs("select",{value:s,onChange:v=>n(v.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"all",children:"Tous les statuts"}),r.jsx("option",{value:"pending",children:"En attente"}),r.jsx("option",{value:"approved",children:"Approuvés"}),r.jsx("option",{value:"rejected",children:"Rejetés"})]})]})}),r.jsx(G,{children:o?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Chargement des demandes..."})]}):D.length===0?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(kt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune demande trouvée"}),r.jsx("p",{className:"text-gray-500",children:"Aucune demande de paiement ne correspond à vos critères"})]}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Établissement"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Montant"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Méthode"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Référence"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Statut"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(v=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(St,{className:"w-8 h-8 text-gray-400 mr-3"}),r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:v.establishmentName}),r.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",v.establishmentId.slice(-8)]})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-lg font-bold text-blue-600",children:C(v.amount)})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:"text-sm text-gray-900",children:S(v.paymentMethod)})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:"text-sm font-mono text-gray-900",children:v.paymentReference})}),r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm text-gray-900",children:v.submittedAt.toLocaleDateString("fr-FR")}),r.jsx("div",{className:"text-sm text-gray-500",children:v.submittedAt.toLocaleTimeString("fr-FR")})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[k(v.status),r.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${T(v.status)}`,children:v.status==="pending"?"En attente":v.status==="approved"?"Approuvé":"Rejeté"})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(O,{variant:"ghost",size:"sm",onClick:()=>_(v),title:"Voir les détails",children:r.jsx(As,{className:"w-4 h-4"})}),v.status==="pending"&&r.jsxs(r.Fragment,{children:[r.jsx(O,{variant:"success",size:"sm",onClick:()=>y(v.id),title:"Approuver",children:r.jsx(Lt,{className:"w-4 h-4"})}),r.jsx(O,{variant:"danger",size:"sm",onClick:()=>P(v.id),title:"Rejeter",children:r.jsx(ua,{className:"w-4 h-4"})})]})]})})]},v.id))})]})})}),m&&d&&r.jsx($D,{request:d,onClose:()=>{h(!1),u(null)},onApprove:y,onReject:P})]})},UD=({size:t="md",color:e="blue",text:s})=>{const n={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"},i={blue:"border-blue-600",green:"border-green-600",purple:"border-purple-600",gray:"border-gray-600"};return r.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[r.jsx("div",{className:`${n[t]} border-2 ${i[e]} border-t-transparent rounded-full animate-spin`}),s&&r.jsx("p",{className:"text-sm text-gray-600 font-medium",children:s})]})},xs=({children:t})=>{const{user:e,isLoading:s}=Le();return s?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx(UD,{size:"lg",text:"Chargement..."})}):e?r.jsx(r.Fragment,{children:t}):r.jsx(zw,{to:"/login",replace:!0})};function BD(){const{initialize:t,user:e}=Le(),[s,n]=gn.useState(!1);return A.useEffect(()=>{t()},[t]),A.useEffect(()=>{const i=async()=>{e!=null&&e.establishmentId&&await yg(e.establishmentId)};e!=null&&e.establishmentId&&i()},[e==null?void 0:e.establishmentId]),r.jsxs(r.Fragment,{children:[r.jsx(PE,{children:r.jsxs(EE,{children:[r.jsx(Ot,{path:"/login",element:r.jsx(h6,{})}),r.jsx(Ot,{path:"/setup",element:r.jsx(f6,{})}),r.jsx(Ot,{path:"/",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(b6,{})})})}),r.jsx(Ot,{path:"/pos",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(U6,{})})})}),r.jsx(Ot,{path:"/products",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(K6,{})})})}),r.jsx(Ot,{path:"/categories",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(Q6,{})})})}),r.jsx(Ot,{path:"/stores",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(_D,{})})})}),r.jsx(Ot,{path:"/customers",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(eD,{})})})}),r.jsx(Ot,{path:"/sales",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(aD,{})})})}),r.jsx(Ot,{path:"/receipts",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(lD,{})})})}),r.jsx(Ot,{path:"/expenses",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(yD,{})})})}),r.jsx(Ot,{path:"/cash-register",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(SD,{isOpen:s,onToggleRegister:()=>n(!s)})})})}),r.jsx(Ot,{path:"/reports",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(ED,{})})})}),r.jsx(Ot,{path:"/settings",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(DD,{})})})}),r.jsx(Ot,{path:"/subscription",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(FD,{})})})}),r.jsx(Ot,{path:"/admin/payments",element:r.jsx(xs,{children:r.jsx(gs,{children:r.jsx(zD,{})})})})]})}),r.jsx(EA,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})}Tw(document.getElementById("root")).render(r.jsx(A.StrictMode,{children:r.jsx(BD,{})}));
